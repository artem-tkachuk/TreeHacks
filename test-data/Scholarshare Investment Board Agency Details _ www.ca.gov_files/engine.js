// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/views/2d/engine/Bitmap":function(){define("require exports ../../../core/tsSupport/extendsHelper @dojo/framework/shim/Set ../../webgl ./DisplayObject".split(" "),function(d,a,c,g,b,e){function k(a){var c=document.createElement("canvas");c.width=a.width;c.height=a.height;a.render(c.getContext("2d"));return c}function m(a,c,h){var e={target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,flipped:!0};c&&h&&(e.width=c,e.height=h);return new b.Texture(a,e)}
function h(a){u.has(a)&&(n.splice(n.indexOf(a),1),u.delete(a))}Object.defineProperty(a,"__esModule",{value:!0});var n=[],u=new g.default;d=function(a){function b(c){void 0===c&&(c=null);var b=a.call(this)||this;b._height=void 0;b.pixelRatio=1;b.resolution=0;b.rotation=0;b._source=null;b._width=void 0;b.x=0;b.y=0;b.source=c;b.requestRender=b.requestRender.bind(b);return b}c(b,a);Object.defineProperty(b.prototype,"height",{get:function(){return void 0!==this._height?this._height:this.sourceHeight},
set:function(a){this._height=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"source",{get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sourceHeight",{get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sourceWidth",{get:function(){return this._source instanceof
HTMLImageElement?this._source.naturalWidth:this._source.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a},enumerable:!0,configurable:!0});b.prototype.attach=function(){this.updateTexture();a.prototype.attach.call(this);return!0};b.prototype.detach=function(){this._texture.dispose();this._texture=null;h(this)};b.prototype.invalidateTexture=function(){this.attached?
this.updateTexture():h(this)};b.prototype.updateTexture=function(){this._texture||(this._texture=this.source?m(this.stage.context,this.sourceWidth,this.sourceHeight):m(this.stage.context));var a=this.source;a?(this._texture.resize(this.sourceWidth,this.sourceHeight),a&&"render"in a?this._texture.setData(k(a)):!a||"render"in a||this._texture.setData(a),this.ready(),this.requestRender()):this._texture.setData(null)};b.prototype.setSamplingMode=function(a){if(this._texture){var c=a;if(this._texture.descriptor.hasMipmap)c=
9728===a?9985:9729===a?9987:a;else if(this.width!==this.sourceHeight||this.height!==this.sourceHeight)c=9729;this._texture.setSamplingMode(c)}};b.prototype.bind=function(a){this._texture&&this.stage.context.bindTexture(this._texture,a)};b.prototype.doRender=function(a){if(this.source&&0<this.width&&this.isReady){var c=this.resolution/this.pixelRatio/a.state.resolution;.05>c||this.stage.painter.drawBitmap(a,this,c)}};return b}(e.DisplayObject);a.Bitmap=d})},"esri/views/2d/engine/DisplayObject":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function b(){var c=null!==a&&a.apply(this,arguments)||this;c._renderRequestedCalled=!1;c._attached=!1;c._isReady=!1;c._opacity=1;c.renderRequested=!1;c._visible=!0;return c}c(b,a);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&
this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},
set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(){this.ready();return!0};b.prototype.detach=function(){};b.prototype.processRender=function(a){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(a),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};b.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=
this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};b.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return b}(g);a.DisplayObject=d})},"esri/views/2d/engine/BitmapContainer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Container ./webgl/enums".split(" "),function(d,
a,c,g,b,e){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);b.prototype.doRender=function(c){this.visible&&c.drawPhase===e.WGLDrawPhase.MAP&&a.prototype.doRender.call(this,c)};b.prototype.renderChildren=function(a){var c=this.stage.painter,b=this.children,h=a.drawPhase;this.sortChildren(function(a,c){return c.resolution-a.resolution});a.drawPhase=e.WGLDrawPhase.CLIP;c.startStencilBurn();for(var k=0,m=b.length;k<m;k++){var g=
b[k];g.attached&&g.visible&&(c.stencilRef=k,g.processRender(a))}a.drawPhase=h;c.startStencilDraw();k=0;for(m=b.length;k<m;k++)g=b[k],g.attached&&g.visible&&(c.stencilRef=k,g.processRender(a));c.endStencilDraw()};return b}(b.Container);a.BitmapContainer=d})},"esri/views/2d/engine/Container":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./DisplayObject"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function b(){var c=null!==a&&a.apply(this,
arguments)||this;c._childrenSet=new Set;c._childrenToAttach=[];c._childrenToDetach=[];c._renderPhase=3;c.children=[];return c}c(b,a);Object.defineProperty(b.prototype,"numChildren",{get:function(){return this.children.length},enumerable:!0,configurable:!0});b.prototype.detach=function(){for(var a=0,c=this.children.concat(this._childrenToDetach);a<c.length;a++){var b=c[a];b.attached&&(this.detachChild(b),b.attached=!1,b.parent=null)}};b.prototype.doRender=function(a){var c=a.globalOpacity;a.globalOpacity*=
this.opacity;this._renderPhase=0;this.attachChildren();this._renderPhase=1;for(var b=this._childrenToDetach;0<b.length;){var e=b.shift();this.detachChild(e);e.attached=!1;e.parent=null;e.stage=null}this._renderPhase=2;this.renderChildren(a);this._renderPhase=3;a.globalOpacity=c};b.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};b.prototype.addChildAt=function(a,c){void 0===c&&(c=this.numChildren);if(!a||this.contains(a))return a;var b=a.parent;b&&b!==this&&b.removeChild(a);
c>=this.numChildren?this.children.push(a):this.children.splice(c,0,a);this._childrenSet.add(a);c=this._childrenToDetach.indexOf(a);-1<c&&this._childrenToDetach.splice(c,1);this._childrenToAttach.push(a);2<=this._renderPhase&&this.requestRender();return a};b.prototype.contains=function(a){return this._childrenSet.has(a)};b.prototype.getChildIndex=function(a){return this.children.indexOf(a)};b.prototype.getChildAt=function(a){return 0>a||a>this.children.length?null:this.children[a]};b.prototype.removeAllChildren=
function(){for(var a=this.numChildren;a--;)this.removeChildAt(0)};b.prototype.removeChild=function(a){return this.contains(a)?this.removeChildAt(this.getChildIndex(a)):a};b.prototype.removeChildAt=function(a){if(0>a||a>=this.children.length)return null;a=this.children.splice(a,1)[0];this._childrenSet["delete"](a);if(a.attached)this._childrenToDetach.push(a),2<=this._renderPhase&&this.requestRender();else{var c=this._childrenToAttach.indexOf(a);-1<c&&this._childrenToAttach.splice(c,1)}return a};b.prototype.requestChildRender=
function(a){a&&a.parent===this&&2<=this._renderPhase&&this.requestRender()};b.prototype.setChildIndex=function(a,c){var b=this.getChildIndex(a);-1<b&&(this.children.splice(b,1),this.children.splice(c,0,a),2<=this._renderPhase&&this.requestRender())};b.prototype.sortChildren=function(a){2<this._renderPhase&&this.requestRender();return this.children.sort(a)};b.prototype.attachChildren=function(){var a=this._childrenToAttach;if(0!==a.length)for(var c=0,b=!1;!b;)b=a[c],b.parent=this,b.stage=this.stage,
this.attachChild(b)?(b.attached=!0,a.splice(c,1)):++c,b=a.length===c};b.prototype.renderChildren=function(a){for(var c=this.children,b=c.length,e=0;e<b;e++)c[e].processRender(a)};b.prototype.attachChild=function(a){return a.attach()};b.prototype.detachChild=function(a){a.detach()};return b}(g.DisplayObject);a.Container=d})},"esri/views/2d/engine/webgl/enums":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});(function(a){a[a.FILL=0]="FILL";a[a.LINE=
1]="LINE";a[a.MARKER=2]="MARKER";a[a.TEXT=3]="TEXT";a[a.LABEL=4]="LABEL"})(a.WGLGeometryType||(a.WGLGeometryType={}));(function(a){a[a.SUCCEEDED=0]="SUCCEEDED";a[a.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(a.WGLGeometryTransactionStatus||(a.WGLGeometryTransactionStatus={}));(function(a){a[a.NONE=0]="NONE";a[a.MAP=1]="MAP";a[a.LABEL=2]="LABEL";a[a.LABEL_ALPHA=4]="LABEL_ALPHA";a[a.HITTEST=8]="HITTEST";a[a.HIGHLIGHT=16]="HIGHLIGHT";a[a.CLIP=32]="CLIP";a[a.DEBUG=64]="DEBUG";a[a.NUM_DRAW_PHASES=
9]="NUM_DRAW_PHASES"})(a.WGLDrawPhase||(a.WGLDrawPhase={}));(function(a){a[a.SIZE=0]="SIZE";a[a.COLOR=1]="COLOR";a[a.OPACITY=2]="OPACITY";a[a.ROTATION=3]="ROTATION"})(a.VVType||(a.VVType={}));(function(a){a[a.NONE=0]="NONE";a[a.OPACITY=1]="OPACITY";a[a.COLOR=2]="COLOR";a[a.ROTATION=4]="ROTATION";a[a.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";a[a.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";a[a.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";a[a.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(a.WGLVVFlag||(a.WGLVVFlag={}));
(function(a){a[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(a.WGLVVTarget||(a.WGLVVTarget={}));(function(a){a[a.SPRITE=0]="SPRITE";a[a.GLYPH=1]="GLYPH"})(a.MosaicType||(a.MosaicType={}))})},"esri/views/2d/engine/BitmapTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/ObjectPool ../tiling ./Bitmap".split(" "),
function(d,a,c,g,b,e,k){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function h(b){b=a.call(this,b)||this;b.key=new e.TileKey(0,0,0,0);return b}c(h,a);h.prototype.acquire=function(a){};h.prototype.release=function(){this.key.set(0,0,0,0);this.source=null};h.pool=new b(h,!0);return h}(k.Bitmap);a.BitmapTile=d})},"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/events ../../../core/promiseUtils ../../../core/scheduling ../../../core/libs/gl-matrix-2/common ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../webgl ./Container ./webgl/BitBlitRenderer ./webgl/enums ./webgl/Painter ./webgl/shaders/StencilPrograms ../../support/screenshotUtils".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function l(f,c){void 0===c&&(c={});var l=a.call(this)||this;l._renderParameters={drawPhase:0,state:l.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};l._renderRequested=!1;l._clipData=new Float32Array(8);l._upperLeft=C.vec2f64.create();l._upperRight=C.vec2f64.create();l._lowerLeft=C.vec2f64.create();l._lowerRight=C.vec2f64.create();l._mat2=u.mat2df64.create();l._clipRendererInitialized=
!1;l._supersampleScreenshots=!0;l.stage=l;l._stationary=!0;l.attached=!0;var h=c.canvas,h=void 0===h?document.createElement("canvas"):h,n=c.alpha,n=void 0===n?!0:n,k=c.stencil,k=void 0===k?!0:k,g=c.renderContext,g=void 0===g?"webgl":g,r=c.supersampleScreenshots,r=void 0===r?!0:r;c=c.contextOptions;c=void 0===c?{}:c;l._canvas=h;h.setAttribute("style","width: 100%; height:100%; display:block;");f.appendChild(h);f=t.createContextOrErrorHTML(h,{alpha:n,antialias:!1,depth:!0,stencil:k},g);l.context=new t.RenderingContext(f,
c);l.painter=new v.default(l.context);l._taskHandle=m.addFrameTask({render:function(){return l.renderFrame()}});l._taskHandle.pause();l._supersampleScreenshots=r;l._lostWebGLContextHandle=e.on(h,"webglcontextlost",function(){l.emit("webgl-error",{error:new b("webgl-context-lost")})});return l}c(l,a);l.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._labelsFBO1&&
(this._labelsFBO1.dispose(),this._labelsFBO1=null);this._labelsFBO2&&(this._labelsFBO2.dispose(),this._labelsFBO2=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null);this.painter.dispose();this.context.dispose();
this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._canvas=null};Object.defineProperty(l.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"state",{get:function(){return this._state},set:function(a){this._state=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"stationary",{get:function(){return this._stationary},
set:function(a){this._stationary!==a&&(this._stationary=a,this.requestRender())},enumerable:!0,configurable:!0});l.prototype.requestRender=function(){this._renderRequested=!0;this._taskHandle&&this._taskHandle.resume()};l.prototype.renderFrame=function(){this._renderRequested&&(this._renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this.processRender(this._renderParameters));
this._renderRequested||this._taskHandle.pause()};l.prototype.setHighlightOptions=function(a){this.painter.setHighlightOptions(a)};l.prototype.renderChildren=function(a){var b=this.context,f=this.children;this.beforeRenderChildren(a);a.drawPhase=r.WGLDrawPhase.MAP;for(var f=a.children?a.children:f,c=f.length,l=0;l<c;l++){var h=f[l];h.attached&&h.processRender(a)}var e=b.getBoundFramebufferObject();b.bindFramebuffer(this._labelsFBO2);l=a.stationary;b.setClearColor(0,0,0,l?0:1);b.clear(b.gl.COLOR_BUFFER_BIT);
if(l)for(a.drawPhase=r.WGLDrawPhase.LABEL_ALPHA,a.labelFBO=this._labelsFBO1,l=0;l<c;l++)h=f[l],h.attached&&h.processRender(a);b.bindFramebuffer(e);a.labelFBO=this._labelsFBO2;a.drawPhase=r.WGLDrawPhase.LABEL;for(l=0;l<c;l++)h=f[l],h.attached&&h.processRender(a);a=this._labelsFBO2;this._labelsFBO2=this._labelsFBO1;this._labelsFBO1=a;this.afterRenderChildren()};l.prototype.beforeRenderChildren=function(a){var b=this.context,f=a.state,c=a.pixelRatio;if(this.painter){b.enforceState();var l=f.size;a=f.rotation;
var e=Math.round(l[0]*c),l=Math.round(l[1]*c);this._boundFBO=b.getBoundFramebufferObject();this._labelsFBO1&&this._labelsFBO1.width===e&&this._labelsFBO1.height===l||(this._labelsFBO1&&(this._labelsFBO1.dispose(),this._labelsFBO2.dispose()),this._labelsFBO1=t.FramebufferObject.createWithAttachments(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:l},{colorTarget:0,depthStencilTarget:0}),b.bindFramebuffer(this._labelsFBO1),b.setDepthWriteEnabled(!0),
b.setStencilWriteMask(255),b.setClearColor(0,0,0,0),b.setClearDepth(1),b.setClearStencil(0),b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT),b.setDepthWriteEnabled(!1),b.bindFramebuffer(this._boundFBO),this._labelsFBO2=t.FramebufferObject.createWithAttachments(b,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:e,height:l},{colorTarget:0,depthStencilTarget:0}));if(f.spatialReference&&(f.spatialReference._isWrappable?
f.spatialReference._isWrappable():f.spatialReference.isWrappable)){var k=h.common.toRadian(a),m=Math.abs(Math.cos(k)),g=Math.abs(Math.sin(k)),r=Math.round(f.worldScreenWidth);if(Math.round(e*m+l*g)<=r)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===e&&this._clipFBO.height===l||(this._clipFBO=new t.FramebufferObject(b,{colorTarget:0,depthStencilTarget:3,width:e,height:l}));var d=.5*e,v=.5*l,f=1/e,u=1/l,c=.5*r*c,w=.5*(e*g+l*m),e=this._upperLeft,m=this._upperRight,g=this._lowerLeft,r=this._lowerRight;
x.vec2.set(e,-c,-w);x.vec2.set(m,c,-w);x.vec2.set(g,-c,w);x.vec2.set(r,c,w);n.mat2d.identity(this._mat2);n.mat2d.translate(this._mat2,this._mat2,[d,v]);0!==a&&n.mat2d.rotate(this._mat2,this._mat2,k);x.vec2.transformMat2d(e,e,this._mat2);x.vec2.transformMat2d(m,m,this._mat2);x.vec2.transformMat2d(g,g,this._mat2);x.vec2.transformMat2d(r,r,this._mat2);a=this._clipData;a.set([2*g[0]*f-1,2*(l-g[1])*u-1,2*r[0]*f-1,2*(l-r[1])*u-1,2*e[0]*f-1,2*(l-e[1])*u-1,2*m[0]*f-1,2*(l-m[1])*u-1]);this._clipRendererInitialized||
this._initializeClipRenderer(b);this._clipVBO.setData(a);this._boundFBO=b.getBoundFramebufferObject();b.bindFramebuffer(this._clipFBO);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};l.prototype.afterRenderChildren=function(){var a=this.context;a.logIno();this._clipFrame&&this._clipRendererInitialized&&
(a.bindFramebuffer(this._boundFBO),this._boundFBO=null,a.bindVAO(this._clipVAO),a.bindProgram(this._clipStencilProgram),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!1),a.setStencilOp(7680,7680,7681),a.setStencilWriteMask(255),a.setStencilFunction(519,1,255),a.drawElements(4,6,5123,0),a.bindVAO(),a.setColorMask(!0,!0,!0,!0),a.setBlendingEnabled(!0),a.setStencilFunction(514,1,255),this._blitRenderer.render(a,this._clipFBO.colorTexture,
9728,1),a.setStencilTestEnabled(!1))};l.prototype.doRender=function(b){var f=this.context,c=b.state,l=b.pixelRatio;this._resizeCanvas(b);this.context.enforceState();f.setViewport(0,0,l*c.size[0],l*c.size[1]);f.setDepthWriteEnabled(!0);f.setStencilWriteMask(255);this.background&&this.background.color?(c=this.background.color,f.setClearColor(c.r/255,c.g/255,c.b/255,c.a)):f.setClearColor(0,0,0,0);f.setClearDepth(1);f.setClearStencil(0);f.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT|f.gl.STENCIL_BUFFER_BIT);
f.setDepthWriteEnabled(!1);a.prototype.doRender.call(this,b)};l.prototype.takeScreenshot=function(a,b){var c=f.screenshotSuperSampleSettings(a,this._supersampleScreenshots),l=c.framebufferWidth,h=c.framebufferHeight,e=this.context,n=a.layers,m={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:c.pixelRatio};if(null!=a.rotation){var g=m.state.viewpoint;g.rotation=a.rotation;m.state.viewpoint=g}0<n.length&&(m.children=[],n.forEach(function(a){var f=b.find(function(b){return b.layer.id===
a.id});f&&f.container&&f.attached&&m.children.push(f.container)}));var r=t.FramebufferObject.create(e,{colorTarget:0,depthStencilTarget:3,width:l,height:h}),n=e.getBoundFramebufferObject(),g=e.getViewport();e.bindFramebuffer(r);e.setViewport(0,0,l,h);l=e.gl;e.setClearColor(0,0,0,0);e.setClearDepth(1);e.setClearStencil(0);e.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT|l.STENCIL_BUFFER_BIT);this.renderChildren(m);c=this._readbackScreenshot(c);e.bindFramebuffer(n);e.setViewport(g.x,g.y,g.width,g.height);
this.requestRender();e=this._ensureScreenshotEncodeCanvas();a=f.encodeResult(c,a,e,{flipY:!0,premultipliedAlpha:!0});return k.resolve(a)};l.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};l.prototype._readbackScreenshot=function(a){var b=a.framebufferWidth,c=a.framebufferHeight,l=a.region;a=a.resample;var h=this.context.gl;if(a){var e=f.createEmptyImageData(b,c,this._ensureScreenshotEncodeCanvas());
h.readPixels(0,0,b,c,6408,5121,new Uint8Array(e.data.buffer));b=f.createEmptyImageData(l.width,l.height,this._ensureScreenshotEncodeCanvas());return f.resampleHermite(e,b,!0,a.region.x,c-(a.region.y+a.region.height),a.region.width,a.region.height)}e=f.createEmptyImageData(l.width,l.height,this._ensureScreenshotEncodeCanvas());h.readPixels(l.x,c-(l.y+l.height),l.width,l.height,6408,5121,new Uint8Array(e.data.buffer));return e};l.prototype._resizeCanvas=function(a){var b=this._canvas,f=b.style,c=a.state.size,
l=a.pixelRatio;a=c[0];var c=c[1],h=Math.round(a*l),l=Math.round(c*l);if(b.width!==h||b.height!==l)b.width=h,b.height=l;f.width=a+"px";f.height=c+"px"};l.prototype._initializeClipRenderer=function(a){if(this._clipRendererInitialized)return!0;this._blitRenderer=new z.BitBlitRenderer;var b=B.stencil.attributes,f=t.createProgram(a,B.stencil);if(!f)return!1;var c=t.BufferObject.createVertex(a,35040,32),l=new Uint16Array([0,1,2,2,1,3]),l=t.BufferObject.createIndex(a,35044,l);a=new t.VertexArrayObject(a,
b,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:c},l);this._clipStencilProgram=f;this._clipVBO=c;this._clipVAO=a;return this._clipRendererInitialized=!0};return l}(w.Container);a.Stage=d})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["require","exports","../../../webgl","./shaders/BitBlitPrograms"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._initialized=!1}a.prototype.dispose=
function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.render=function(a,b,c,h){a&&(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),b.setSamplingMode(c),a.bindTexture(b,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",h),a.drawArrays(5,0,4),a.bindVAO())};a.prototype._initialize=
function(a){if(this._initialized)return!0;var b=g.bitBlit.attributes,e=c.createProgram(a,g.bitBlit);if(!e)return!1;var h=new Int8Array(16);h[0]=-1;h[1]=-1;h[2]=0;h[3]=0;h[4]=1;h[5]=-1;h[6]=1;h[7]=0;h[8]=-1;h[9]=1;h[10]=0;h[11]=1;h[12]=1;h[13]=1;h[14]=1;h[15]=1;a=new c.VertexArrayObject(a,b,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:c.BufferObject.createVertex(a,35044,h)});
this._program=e;this._vertexArrayObject=a;return this._initialized=!0};return a}();a.BitBlitRenderer=d})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});a.bitBlit={name:"bitBlit",shaders:{vertexShader:c.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:c.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require",
"exports","../../../../../webgl","./shaderRepository"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});var b=new c.ShaderCompiler(function(a){var b=g;a.split("/").forEach(function(a){b&&(b=b[a])});return b});a.resolveIncludes=function(a){return b.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(d,a){return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\n  gl_FragColor \x3d u_color;\n}",
"background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\n  gl_FragColor \x3d color *  u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n  v_uv \x3d a_tex;\n}"},
highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_texture;\nmediump vec4 gauss4(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\n}\nmediump float gauss1(mediump vec2 dir) {\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas[3] * u_sigmas[3]));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\n  return u_channelSelector * sample;\n}\nvoid accumGauss4(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\n  mediump vec4 w \x3d gauss4(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\n  weight +\x3d w;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\n  mediump float w \x3d gauss1(i * u_direction.xy);\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\n  weight +\x3d w;\n}\nvoid main(void) {\n  mediump float tot \x3d 0.0;\n  mediump float weight \x3d 0.0;\n  accumGauss1(-4.0, tot, weight);\n  accumGauss1(-3.0, tot, weight);\n  accumGauss1(-2.0, tot, weight);\n  accumGauss1(-1.0, tot, weight);\n  accumGauss1(0.0, tot, weight);\n  accumGauss1(1.0, tot, weight);\n  accumGauss1(2.0, tot, weight);\n  accumGauss1(3.0, tot, weight);\n  accumGauss1(4.0, tot, weight);\n  gl_FragColor \x3d vec4(0.0, 0.0, 0.0, tot / weight);\n}",
"highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump vec4 u_sigmas;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\n  mediump float sigma \x3d u_sigmas[3];\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\n  const mediump float y0 \x3d 0.5;\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);\n  mediump float d \x3d (y - y0) / m0;\n  return d;\n}\nmediump vec4 shade(mediump float d) {\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\n  mediump float d \x3d estimateDistance();\n  gl_FragColor \x3d shade(d);\n}",
"textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\n  v_texcoord \x3d a_texcoord;\n}"},magnifier:{"magnifier.frag":"uniform lowp vec4 u_background;\nuniform mediump sampler2D u_readbackTexture;\nuniform mediump sampler2D u_maskTexture;\nuniform mediump sampler2D u_overlyTexture;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  lowp vec4 color \x3d texture2D(u_readbackTexture, v_texCoord);\n  color \x3d color + (1.0 - color.a) * u_background;\n  lowp vec4 mask_color \x3d texture2D(u_maskTexture, v_texCoord);\n  lowp float gray \x3d 1.0 - dot(mask_color, vec4(0.3, 0.59, 0.11, 0));\n  color *\x3d gray;\n  lowp vec4 overley_color \x3d texture2D(u_overlyTexture, v_texCoord);\n  overley_color.rgb *\x3d overley_color.a;\n  gl_FragColor \x3d overley_color + (1.0 - overley_color.a) * color;\n}",
"magnifier.vert":"precision mediump float;\nattribute mediump vec2 a_pos;\nuniform mediump vec2 u_drawPos;\nuniform mediump float u_width;\nuniform mediump float u_height;\nvarying mediump vec2 v_texCoord;\nvoid main(void)\n{\n  v_texCoord \x3d a_pos;\n  vec2 coord \x3d u_drawPos + vec2(a_pos - 0.5) * vec2(u_width, u_height);\n  gl_Position \x3d vec4(coord, 0.0, 1.0);\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D u_attributeData0;\nuniform highp sampler2D u_attributeData1;\nuniform highp sampler2D u_attributeData2;\nuniform int u_attributeTextureSize;\nvec2 getAttributeDataCoords(in highp vec4 id) {\n  float size \x3d float(u_attributeTextureSize);\n  highp float u32 \x3d float(int(id.r) + int(id.g) * 256 + int(id.b) * 256 * 256 + int(id.a) * 256 * 256 * 256);\n  highp float col \x3d mod(u32, size);\n  highp float row \x3d (u32 - col) / size;\n  highp float u \x3d col / size;\n  highp float v \x3d row / size;\n  return vec2(u, v);\n}\nvec4 getAttributeData0(in vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData0, coords);\n}\nvec4 getAttributeData1(in vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData1, coords);\n}\nvec4 getAttributeData2(in vec4 id) {\n  vec2 coords \x3d getAttributeDataCoords(id);\n  return texture2D(u_attributeData2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\n  bool isMagic \x3d v.x \x3d\x3d 255.0 \x26\x26 v.y \x3d\x3d 255.0;\n  if (isMagic) {\n    return NAN_MAGIC_NUMBER;\n  }\n  return (v.x + v.y * float(0x100)) - 32768.0;\n}",
"constants.glsl":"const float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\nconst float SOFT_EDGE_RATIO \x3d 1.0;\nconst float THIN_LINE_WIDTH_FACTOR \x3d 1.1;\nconst float THIN_LINE_HALF_WIDTH \x3d 1.0;\nconst float OFFSET_PRECISION \x3d 1.0 / 8.0;\nconst float OUTLINE_SCALE \x3d 1.0 / 5.0;\nconst float SDF_FONT_SIZE \x3d 24.0;\nconst float MAX_SDF_DISTANCE \x3d 8.0;\nconst float PLACEMENT_PADDING \x3d 8.0;\nconst float EPSILON \x3d 0.0000001;\nconst int MAX_FILTER_COUNT \x3d 2;\nconst int ATTR_DATA_FILTER \x3d 0;\nconst int ATTR_DATA_VV \x3d 1;\nconst int ATTR_DATA_DD0 \x3d 1;\nconst int ATTR_DATA_DD1 \x3d 2;\nconst int ATTR_VV_SIZE \x3d 0;\nconst int ATTR_VV_COLOR \x3d 1;\nconst int ATTR_VV_OPACITY \x3d 2;\nconst int ATTR_VV_ROTATION \x3d 3;\nconst highp float NAN_MAGIC_NUMBER \x3d 1e-30;",
"effects.glsl":"uniform mat4 u_insideEffectMat4[ MAX_FILTER_COUNT ];\nuniform mat4 u_outsideEffectMat4[ MAX_FILTER_COUNT ];\nuniform float u_insideOpacities[ MAX_FILTER_COUNT ];\nuniform float u_outsideOpacities[ MAX_FILTER_COUNT ];\nvec4 getEffectColor(in vec4 color, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  return vec4(rgbw.rgb * a, a);\n}\nvec3 applyFilter(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  vec4 rgbw \x3d vec4(color.a \x3e 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\n  float a \x3d color.a;\n  for (int i \x3d 0; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getBit(filterFlags, i);\n    rgbw \x3d u_insideEffectMat4[ i ] * (bit  * rgbw) + u_outsideEffectMat4[ i ] * ((1.0 - bit) * rgbw);\n    a    \x3d u_insideOpacities[ i ]  * (bit  * a)    + u_outsideOpacities[ i ]  * ((1.0 - bit) * a);\n  }\n  color.rgb \x3d rgbw.rgb * a;\n  color.a \x3d a;\n  pos.z +\x3d 2.0 * (1.0 - getBit(filterFlags, 0));\n  return pos;\n}\nvec3 applyFilterLabels(inout vec4 color, inout vec3 pos, in float filterFlags) {\n  float bit \x3d getBit(filterFlags, 0);\n  pos.z +\x3d 2.0 * (1.0 - bit);\n#ifndef OUTSIDE_LABELS_VISIBLE\n  for (int i \x3d 1; i \x3c EFFECT_COUNT + 1; i++) {\n    float bit \x3d getBit(filterFlags, i);\n    pos.z +\x3d 2.0 * (1.0 - bit);\n  }\n#endif\n  return pos;\n}",
fill:{"common.glsl":"#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\n#endif\n#ifdef DOT_DENSITY\nuniform float u_dotValue;\nuniform float u_tileDotsOverArea;\nuniform vec4 u_isActive[ 2 ];\nuniform float u_dotTextureDotCount;\nuniform float u_tileZoomFactor;\n#endif\nvarying vec3 v_pos;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nvarying vec4 v_dotThresholds[ 2 ];\nvarying vec2 v_dotTextureCoords;\n#endif",
"fill.frag":"precision highp float;\n#include \x3cmaterials/constants.glsl\x3e\nvarying highp vec4 v_id;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\nvarying highp vec4 v_dotThresholds[ 2 ];\nvarying vec2 v_dotTextureCoords;\n#endif\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nfloat max4(vec4 target) {\n  return max(max(max(target.x, target.y), target.z), target.w);\n}\nvoid main() {\n#ifdef ID\n  gl_FragColor \x3d v_id;\n#elif defined(PATTERN)\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\n  gl_FragColor \x3d v_opacity * v_color * color;\n#elif defined(DOT_DENSITY) \x26\x26 !defined(HIGHLIGHT)\n  vec4 textureThresholds0 \x3d texture2D(u_dotTextures[0], v_dotTextureCoords);\n  vec4 textureThresholds1 \x3d texture2D(u_dotTextures[1], v_dotTextureCoords);\n  vec4 difference0 \x3d v_dotThresholds[0] - textureThresholds0;\n  vec4 difference1 \x3d v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\n  vec4 isPositive0 \x3d step(0.0, difference0);\n  vec4 isPositive1 \x3d step(0.0, difference1);\n  float weightSum \x3d dot(isPositive0, difference0) + dot(isPositive1, difference1);\n  float lessThanEqZero \x3d step(weightSum, 0.0);\n  float greaterThanZero \x3d 1.0 - lessThanEqZero ;\n  float divisor \x3d (weightSum + lessThanEqZero);\n  vec4 weights0 \x3d difference0 * isPositive0 / divisor;\n  vec4 weights1 \x3d difference1 * isPositive1 / divisor;\n  vec4 dotColor \x3d u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\n  gl_FragColor \x3d greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\n  float diffMax \x3d max(max4(difference0), max4(difference1));\n  float lessThanZero \x3d step(diffMax, 0.0);\n  float greaterOrEqZero \x3d 1.0 - lessThanZero;\n  vec4 isMax0 \x3d step(diffMax, difference0);\n  vec4 isMax1 \x3d step(diffMax, difference1);\n  vec4 dotColor \x3d u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\n  gl_FragColor \x3d greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\n#else\n  gl_FragColor \x3d v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d 1.0;\n#endif\n}",
"fill.vert":"precision mediump float;\n#ifdef DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\nvec4 a_aux3 \x3d vec4(0.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_tlbr;\nattribute vec4 a_aux1;\nattribute vec2 a_aux2;\nattribute vec4 a_aux3;\n#endif\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/fill/common.glsl\x3e\n#ifdef DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\n  return featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef PATTERN\nmat3 getPatternMatrix() {\n  mat3 patternMatrix \x3d mat3(1.0);\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\n  return patternMatrix;\n}\n#endif\nvoid main()\n{\n  INIT;\n  float a_bitSet \x3d a_aux3.a;\n  v_color   \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity \x3d getOpacity(a_bitSet, 1);\n  v_id      \x3d norm(a_id);\n  v_pos     \x3d u_dvsMat3 * vec3(a_pos, 1.);\n#ifdef PATTERN\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - SIGNED_BYTE_TO_UNSIGNED);\n  v_tileTextureCoord \x3d (getPatternMatrix() * vec3(a_pos + symbolOffset, 1.0)).xy;\n  v_tlbr \x3d a_tlbr / u_mosaicSize.xyxy;\n#elif defined(DOT_DENSITY)\n  vec4 ddAttributeData0 \x3d getAttributeData1(a_id) * u_isActive[0] * a_inverseArea;\n  vec4 ddAttributeData1 \x3d getAttributeData2(a_id) * u_isActive[1] * a_inverseArea;\n  float size \x3d u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\n  v_dotThresholds[0] \x3d dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\n  v_dotThresholds[1] \x3d dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\n  v_dotTextureCoords \x3d (a_pos + 0.5) / size;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
icon:{"common.glsl":"uniform vec2 u_mosaicSize;\nvarying vec3 v_pos;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying vec2 v_tex;\nvarying vec2 v_size;\nvarying float v_filters;\n#ifdef SDF\nvarying float v_isThin;\nvarying float v_overridingOutlineColor;\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\n#endif","icon.frag":"precision mediump float;\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor \x3d v_color;\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\n  float size \x3d max(v_size.x, v_size.y);\n  float dist \x3d d * size * SOFT_EDGE_RATIO * v_distRatio;\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\n  float outlineWidth \x3d v_outlineWidth;\n  #ifdef HIGHLIGHT\n    outlineWidth \x3d max(outlineWidth, 4.0 * v_isThin);\n  #endif\n  if (outlineWidth \x3e 0.25) {\n    lowp vec4 outlinePixelColor \x3d v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\n    float clampedOutlineSize \x3d min(outlineWidth, size);\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\n    gl_FragColor \x3d v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n  }\n  else {\n    gl_FragColor \x3d v_opacity * fillPixelColor;\n  }\n#else\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\n   gl_FragColor \x3d v_opacity * getEffectColor(texColor, v_filters);\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"icon.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAndBitSet;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/icon/common.glsl\x3e\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float referenceSize, in float bitSet) {\n#ifdef VV_SIZE\n  float r \x3d getSize(baseSize.y) / referenceSize;\n  baseSize.xy *\x3d r;\n  offset.xy *\x3d r;\n  float scaleSymbolProportionally \x3d getBit(bitSet, 3);\n  outlineSize *\x3d scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\n  return baseSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\n  float isMapAligned \x3d getBit(a_bitSet, 0);\n  vec3  offset       \x3d getRotation() * vec3(in_offset, 0.0);\n  return getMatrix(isMapAligned) * offset;\n}\nvoid main()\n{\n  INIT;\n  vec2  a_size   \x3d a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 256.0;\n  vec2  a_offset \x3d a_vertexOffset / 16.0;\n  vec2  a_tex    \x3d a_texAndBitSet.xy;\n  float a_outlineSize \x3d a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 256.0;\n  float a_bitSet \x3d a_texAndBitSet.z;\n  v_color    \x3d getColor(a_color, a_bitSet, 1);\n  v_opacity  \x3d getOpacity(a_bitSet, 1);\n  v_size     \x3d getMarkerSize(a_offset, a_size, a_outlineSize, a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 256.0, a_bitSet);\n  v_id       \x3d norm(a_id);\n  v_filters  \x3d getFilterFlags();\n  v_tex      \x3d a_tex / u_mosaicSize;\n  v_pos      \x3d u_dvsMat3 * vec3(a_pos, 1.0) + getOffset(a_offset, a_bitSet);\n#ifdef SDF\n  v_isThin   \x3d getBit(a_bitSet, 2);\n  #ifdef VV_COLOR\n    v_overridingOutlineColor \x3d v_isThin;\n  #else\n    v_overridingOutlineColor \x3d 0.0;\n  #endif\n  v_outlineWidth \x3d min(a_outlineSize, max(max(v_size.x, v_size.y) - 0.99, 0.0));\n  v_outlineColor \x3d getEffectColor(a_outlineColor, v_filters);\n  v_distRatio \x3d a_texAndBitSet.w / 126.0;\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, v_filters), 1.0);\n}"},
label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nuniform vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\n#ifdef ID\nuniform mediump float u_fadeStep;\nvarying mediump float v_fadeStep;\n#endif","label.frag":"precision mediump float;\n#include \x3cmaterials/label/common.glsl\x3e\nuniform mediump sampler2D u_referenceTex;\nuniform mediump vec2 u_screenSize;\nuniform highp float u_pixelRatio;\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\n  mediump vec4 referenceFragment \x3d texture2D(u_referenceTex, refTextPos);\n#ifdef ID\n  mediump float alpha \x3d clamp(referenceFragment.a + v_fadeStep, 0.0, 1.0);\n  gl_FragColor \x3d vec4(alpha);\n#else\n  lowp float fadeAlpha \x3d referenceFragment.a;\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist);\n  gl_FragColor \x3d fadeAlpha * sdfAlpha * v_color;\n#endif\n}",
"label.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_zoomRangeAndEmpty;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/label/common.glsl\x3e\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\n  float glyphAngle \x3d angle * 360.0 / 254.0;\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\n  float z \x3d 0.0;\n  z +\x3d 2.0 * (1.0 - step(minZoom, u_zoomLevel));\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, maxZoom));\n  z +\x3d 2.0 * u_mapAligned * step(90.0, diffAngle);\n  return z;\n}\nvoid main()\n{\n  INIT;\n  float groupMinZoom    \x3d getMinZoom();\n  float glyphMinZoom    \x3d a_zoomRangeAndEmpty.x;\n  float a_minZoom       \x3d max(groupMinZoom, glyphMinZoom);\n  float a_maxZoom       \x3d a_zoomRangeAndEmpty.y;\n  vec2  a_placementDir  \x3d a_refSymbolAndPlacementOffset.zw - 1.0;\n  float a_refSymbolSize \x3d a_refSymbolAndPlacementOffset.y;\n  float fontSize        \x3d a_texAndSize.z;\n  float isHalo          \x3d mod(a_pos, 2.0).x;\n  vec2  vertexOffset \x3d a_vertexOffset * OFFSET_PRECISION;\n  vec3  pos          \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float z            \x3d getZ(a_minZoom, a_maxZoom, a_refSymbolAndPlacementOffset.x);\n  float fontScale    \x3d fontSize / SDF_FONT_SIZE;\n  float halfSize     \x3d getSize(a_refSymbolSize) / 2.0;\n  v_color \x3d a_color;\n  v_tex   \x3d a_texAndSize.xy / u_mosaicSize;\n#ifdef ID\n  v_fadeStep \x3d u_fadeStep;\n#endif\n  v_edgeDistanceOffset \x3d isHalo * OUTLINE_SCALE * a_texAndSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.106 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  vec2 placementOffset \x3d a_placementDir * (halfSize + PLACEMENT_PADDING);\n  vec3 glyphOffset     \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\n  vec3 v_pos           \x3d vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\n  gl_Position \x3d vec4(applyFilterLabels(v_color, v_pos, getFilterFlags()), 1.0);\n#ifdef DEBUG\n  v_color \x3d vec4(a_color.rgb, z \x3d\x3d 0.0 ? 1.0 : 0.645);\n#endif\n}"},
line:{"common.glsl":"varying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying highp vec4 v_id;\nvarying vec3 v_pos;\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif","line.frag":"precision lowp float;\n#include \x3cutil/encoding.glsl\x3e\n#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nuniform lowp float u_blur;\nuniform mediump float u_zoomFactor;\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\n#endif\n#ifdef SDF\nconst float sdfPatternHalfWidth \x3d 15.5;\nconst float widthFactor \x3d 2.0;\n#endif\nvoid main()\n{\n  mediump float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(v_lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\n  float dist \x3d d * lineHalfWidth;\n  lowp vec4 fillPixelColor \x3d v_opacity * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n  gl_FragColor \x3d fillPixelColor;\n#elif defined(PATTERN) \x26\x26 !defined(HIGHLIGHT)\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\n  gl_FragColor \x3d v_opacity * alpha * v_color * color;\n#else\n  gl_FragColor \x3d v_opacity * alpha * v_color;\n#endif\n#ifdef HIGHLIGHT\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\n#endif\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"line.vert":"precision mediump float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/line/common.glsl\x3e\nconst float SCALE \x3d 1.0 / 31.0;\nfloat getBaseLineHalfWidth(in float in_lineHalfWidth) {\n#ifdef VV_SIZE\n  float referenceHalfWidth \x3d a_aux.x * SCALE;\n  float lineWidth \x3d 2.0 * in_lineHalfWidth;\n  return 0.5 * (in_lineHalfWidth / referenceHalfWidth) * getSize(lineWidth);\n#else\n  return in_lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\n  float halfWidth \x3d max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\n  halfWidth \x3d max(halfWidth, 2.0);\n#endif\n  return halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\n  float thinLineFactor \x3d max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\n#if defined(SDF) \x26\x26 !defined(HIGHLIGHT)\n  thinLineFactor *\x3d 2.0;\n#endif\n  return thinLineFactor * halfWidth * offset * SCALE;\n}\nvoid main()\n{\n  INIT;\n  float a_bitSet          \x3d a_segmentDirection.w;\n  float a_accumulatedDist \x3d a_accumulatedDistanceAndHalfWidth.x;\n  float a_lineHalfWidth   \x3d a_accumulatedDistanceAndHalfWidth.y * SCALE;\n  float aa                \x3d 0.5 * u_antialiasing;\n  vec2  a_offset          \x3d a_offsetAndNormal.xy;\n  float baseWidth \x3d getBaseLineHalfWidth(a_lineHalfWidth);\n  float halfWidth \x3d getLineHalfWidth(baseWidth, aa);\n  float z         \x3d 2.0 * step(baseWidth, 0.0);\n  vec2  dist      \x3d getDist(a_offset, halfWidth);\n  vec3  offset    \x3d u_displayViewMat3 * vec3(dist, 0.0);\n  vec3  pos       \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\n  v_color         \x3d getColor(a_color, a_bitSet, 0);\n  v_opacity       \x3d getOpacity(a_bitSet, 0);\n  v_lineHalfWidth \x3d halfWidth;\n  v_id            \x3d norm(a_id);\n  v_normal        \x3d a_offsetAndNormal.zw * SCALE;\n  v_pos           \x3d vec3(pos.xy, z);\n#ifdef PATTERN\n  v_tlbr          \x3d a_tlbr / u_mosaicSize.xyxy;\n  v_patternSize   \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\n#endif\n#if defined(PATTERN) || defined(SDF)\n  v_accumulatedDistance \x3d a_accumulatedDist + dot(SCALE * a_segmentDirection.xy, dist / u_zoomFactor);\n#endif\n  gl_Position \x3d vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
text:{"common.glsl":"uniform vec2 u_mosaicSize;\nvarying highp vec4 v_id;\nvarying vec3 v_pos;\nvarying vec4 v_color;\nvarying vec2 v_tex;\nvarying float v_opacity;\nvarying float v_antialiasingWidth;\nvarying float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","text.frag":"precision mediump float;\n#include \x3cmaterials/text/common.glsl\x3e\nuniform lowp sampler2D u_texture;\nvoid main()\n{\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\n  #ifdef HIGHLIGHT\n    glyphEdgeDistance /\x3d 2.0;\n  #endif\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_opacity;\n  gl_FragColor \x3d alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor \x3d v_id;\n#endif\n}",
"text.vert":"precision mediump float;\n#include \x3cmaterials/vcommon.glsl\x3e\n#include \x3cmaterials/text/common.glsl\x3e\nattribute vec4 a_color;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nvoid main()\n{\n  INIT;\n  float a_bitSet    \x3d a_aux.w;\n  float a_fontSize  \x3d a_texFontSize.z;\n  vec2  a_offset    \x3d a_vertexOffset * OFFSET_PRECISION;\n  float a_isHalo    \x3d getBit(a_pos.x, 0);\n  vec3  in_pos      \x3d vec3(floor(a_pos * 0.5), 1.0);\n  float fontSize    \x3d getSize(a_fontSize);\n  float scaleFactor \x3d fontSize / a_fontSize;\n  float fontScale   \x3d fontSize / SDF_FONT_SIZE;\n  vec3  offset      \x3d getRotation() * vec3(scaleFactor * a_offset, 0.0);\n  v_color   \x3d a_isHalo * a_color + (1.0 - a_isHalo) * getColor(a_color, a_bitSet, 0);\n  v_opacity \x3d getOpacity(a_bitSet, 0);\n  v_id      \x3d norm(a_id);\n  v_tex     \x3d a_texFontSize.xy / u_mosaicSize;\n  v_pos     \x3d u_dvsMat3 * in_pos + u_displayMat3 * offset;\n  v_edgeDistanceOffset \x3d a_isHalo * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\n  v_antialiasingWidth  \x3d 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n  gl_Position \x3d  vec4(applyFilter(v_color, v_pos, getFilterFlags()), 1.0);\n}"},
"utils.glsl":"float rshift(in float u32, in int amount) {\n  return floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\nvec4 unpack(in float u32) {\n  float r \x3d mod(rshift(u32, 0), 255.0);\n  float g \x3d mod(rshift(u32, 8), 255.0);\n  float b \x3d mod(rshift(u32, 16), 255.0);\n  float a \x3d mod(rshift(u32, 24), 255.0);\n  return vec4(r, g, b, a);\n}\nvec4 norm(in vec4 v) {\n  return v /\x3d 255.0;\n}",
"vcommon.glsl":"#include \x3cmaterials/constants.glsl\x3e\n#include \x3cmaterials/utils.glsl\x3e\n#include \x3cmaterials/attributeData.glsl\x3e\n#include \x3cmaterials/vv.glsl\x3e\n#include \x3cmaterials/effects.glsl\x3e\nattribute vec2 a_pos;\nattribute highp vec4 a_id;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform highp float u_pixelRatio;\nuniform mediump float u_zoomFactor;\nuniform mediump float u_antialiasing;\nvec4 VV_ADATA \x3d vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target, int index) {\n#ifdef OES_TEXTURE_FLOAT\n  target.rgba \x3d getAttributeData1(a_id);\n#else\n  vec4 data0 \x3d getAttributeData1(a_id);\n  vec4 data1 \x3d getAttributeData2(a_id);\n  target.r \x3d u88VVToFloat(data0.rg * 255.0);\n  target.g \x3d u88VVToFloat(data0.ba * 255.0);\n  target.b \x3d u88VVToFloat(data1.rg * 255.0);\n  target.a \x3d u88VVToFloat(data1.ba * 255.0);\n#endif\n}\n#ifdef VV\n  #define INIT loadVisualVariableData(VV_ADATA, ATTR_DATA_VV)\n#else\n  #define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\n  float isColorLocked   \x3d getBit(a_bitSet, index);\n  return getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\n  return a_color;\n#endif\n}\nfloat getOpacity(in float a_bitSet, in int index) {\n#ifdef VV_OPACITY\n  float isOpacityLocked \x3d getBit(a_bitSet, index);\n  return getVVOpacity(VV_ADATA[ATTR_VV_OPACITY], isOpacityLocked);\n#else\n  return 1.0;\n#endif\n}\nfloat getSize(in float in_size) {\n#ifdef VV_SIZE\n  return getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE]);\n#else\n  return in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\n  return getVVRotationMat3(VV_ADATA[ATTR_VV_ROTATION]);\n#else\n  return mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n  return getAttributeData0(a_id).x * 255.0;\n}\nfloat getMinZoom() {\n  vec4 data0 \x3d getAttributeData0(a_id) * 255.0;\n  return data0.g;\n}\nmat3 getMatrix(float isMapAligned) {\n  return isMapAligned * u_displayViewMat3 + (1.0 - isMapAligned) * u_displayMat3;\n}",
"vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n  #define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n  #define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float u_vvColorValues[8];\nuniform vec4 u_vvColors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 u_vvSizeMinMaxValue;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float u_vvSizeScaleStopsValue;\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float u_vvSizeFieldStopsValues[6];\nuniform float u_vvSizeFieldStopsSizes[6];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float u_vvOpacityValues[8];\nuniform float u_vvOpacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float u_vvRotationType;\n#endif\nbool isNan(float val) {\n  return (val \x3d\x3d NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N \x3d 6;\nfloat getVVStopsSize(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\n    return u_vvSizeFieldStopsSizes[0];\n  }\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\n    }\n  }\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\n  if (isNan(sizeValue)) {\n    return fallback;\n  }\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N \x3d 8;\nfloat getVVOpacity(float opacityValue, float isOpacityLocked) {\n  if (isNan(opacityValue) || isOpacityLocked \x3d\x3d 1.0) {\n    return 1.0;\n  }\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\n    return u_vvOpacities[0];\n  }\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\n    }\n  }\n  return u_vvOpacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat4(1, 0, 0, 0,\n                0, 1, 0, 0,\n                0, 0, 1, 0,\n                0, 0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat4(cosA, sinA, 0, 0,\n              -sinA,  cosA, 0, 0,\n              0,     0, 1, 0,\n              0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\n  if (isNan(rotationValue)) {\n    return mat3(1, 0, 0,\n                0, 1, 0,\n                0, 0, 1);\n  }\n  float rotation \x3d rotationValue;\n  if (u_vvRotationType \x3d\x3d 1.0) {\n    rotation \x3d 90.0 - rotation;\n  }\n  float angle \x3d C_DEG_TO_RAD * -rotation;\n  float sinA \x3d sin(angle);\n  float cosA \x3d cos(angle);\n  return mat3(cosA, -sinA, 0,\n             sinA, cosA, 0,\n              0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N \x3d 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\n  if (isNan(colorValue) || isColorLocked \x3d\x3d 1.0) {\n    return fallback;\n  }\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\n    return u_vvColors[0];\n  }\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\n    }\n  }\n  return u_vvColors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\n  return getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\n  return u_vvSizeScaleStopsValue;\n#elif defined(VV_SIZE_FIELD_STOPS)\n  return getVVStopsSize(vvSize, size);\n#elif defined(VV_SIZE_UNIT_VALUE)\n  return getVVUnitValue(vvSize, size);\n#else\n  return size;\n#endif\n}"},
raster:{"solid.frag":"precision mediump float;\nvoid main(void) {\n  gl_FragColor \x3d vec4(1.0, 0.0, 0.0, 1.0);\n}","texture.frag":"precision mediump float;\nvarying highp vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_opacity;\nvoid main(void) {\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\n  color.a *\x3d u_opacity;\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\n}","transform.vert":"precision mediump float;\nattribute vec2 a_position;\nuniform highp mat4 u_transform;\nvarying highp vec2 v_texcoord;\nvoid main(void) {\n  gl_Position \x3d u_transform * vec4((2.0 * a_position - 1.0), 0.0, 1.0);\n  v_texcoord \x3d a_position;\n}"},
stencil:{"stencil.frag":"void main() {\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nvoid main() {\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\n  gl_FragColor \x3d 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump float u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\n  v_tex \x3d a_pos;\n}"},
util:{"encoding.glsl":"const vec4 rgba2float_factors \x3d vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../webgl ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./Utils ./VertexStream ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil ./brushes/WGLGeometryBrushFill ./brushes/WGLGeometryBrushLabel ./brushes/WGLGeometryBrushLine ./brushes/WGLGeometryBrushMarker ./brushes/WGLGeometryBrushText ./painter/WGLHighlightPainter ./shaders/RasterPrograms".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f,y,l,D,A){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._initialized=!1}a.prototype.registerPass=function(a,b){this._initialize();for(var f=0;f<u.WGLDrawPhase.NUM_DRAW_PHASES-2;f++){var c=1<<f;c&b&&this._passMap.set(c,a)}return this};a.prototype.getPaintPassTs=function(a){this._initialize();return this._passMap.has(a)?[this._passMap.get(a)]:[]};a.prototype._initialize=function(){this._initialized||(this._passMap=new Map,
this._initialized=!0)};return a}();a.PainterOptions=d;var G=new Uint8Array(4*t.C_HITTEST_SEARCH_SIZE*t.C_HITTEST_SEARCH_SIZE),E=new Uint32Array(G.buffer),N=m.vec3f32.create(),L=[0,0];m=function(){function a(a){this.context=a;this._hlPainter=new D.default;this._blitRenderer=new n.BitBlitRenderer;this._boundFBO=this._globalOpacityFBO=null;this.textureManager=new C;this.stencilRef=-1;this.materialManager=new x(a);this._quadVertexStream=new w(a,[0,0,1,0,0,1,1,1]);this._transformTextureProgram=h.createProgram(a,
A.transformTexture);this._transformSolidProgram=h.createProgram(a,A.transformSolid);this._transform=e.mat4f32.create()}a.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this._hlPainter&&(this._hlPainter.dispose(),this._hlPainter=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null);this._boundFBO=null;this._hittestFBO&&(this._hittestFBO.dispose(),
this._hittestFBO=null);this._passes&&(this._passes.forEach(function(a){return a.dispose()}),this._passes.clear());this._brushes&&(this._brushes.forEach(function(a){return a.forEach(function(a){return a.dispose()})}),this._brushes.clear());this._geometryBrushes&&(this._geometryBrushes.forEach(function(a){return a.dispose()}),this._geometryBrushes.clear());this._quadVertexStream.dispose()};a.prototype.getBrushes=function(a){if(a===u.WGLDrawPhase.MAP)throw Error("Painter: Tried to get brush for the MAP phase; use a specific geometry type and call getMapBrush() instead.");
if(!this._brushes){var b=[this.getGeometryBrush(u.WGLGeometryType.FILL),this.getGeometryBrush(u.WGLGeometryType.LINE),this.getGeometryBrush(u.WGLGeometryType.MARKER),this.getGeometryBrush(u.WGLGeometryType.TEXT)],f=new B.default,c=new z.default,l=new r.default;this._brushes=new Map;this._brushes.set(u.WGLDrawPhase.LABEL,[f]);this._brushes.set(u.WGLDrawPhase.LABEL_ALPHA,[f]);this._brushes.set(u.WGLDrawPhase.HITTEST,b);this._brushes.set(u.WGLDrawPhase.HIGHLIGHT,b);this._brushes.set(u.WGLDrawPhase.CLIP,
[l]);this._brushes.set(u.WGLDrawPhase.DEBUG,[c])}if(!this._brushes.has(a))throw Error("Painter: Tried to get brush for unknown phase: "+a);return this._brushes.get(a)};a.prototype.getGeometryBrush=function(a){if(!this._geometryBrushes){var b=new v.default,c=new f.default,h=new y.default,e=new l.default,n=new B.default;this._geometryBrushes=new Map;this._geometryBrushes.set(u.WGLGeometryType.FILL,b);this._geometryBrushes.set(u.WGLGeometryType.LINE,c);this._geometryBrushes.set(u.WGLGeometryType.MARKER,
h);this._geometryBrushes.set(u.WGLGeometryType.TEXT,e);this._geometryBrushes.set(u.WGLGeometryType.LABEL,n)}return this._geometryBrushes.get(a)};a.prototype.draw=function(a,b,f,c){this._setGlobalOpacity(a,f);0===(f&(u.WGLDrawPhase.LABEL_ALPHA|u.WGLDrawPhase.LABEL))&&this._drawClippingRects(a,b);var l=this.context;l.setBlendingEnabled(!0);l.setStencilWriteMask(0);l.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,b,f,c);this._applyGlobalOpacity(a,f);this._debugTiles(a,b)};a.prototype.highlight=
function(a,b){var f=this.context,c=f.getViewport();this._hlPainter.setup(f,c.width,c.height);this._hlPainter.startMaskDraw(f);this._drawClippingRects(a,b);f.setBlendingEnabled(!0);f.setStencilWriteMask(0);f.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,b,u.WGLDrawPhase.HIGHLIGHT);this._hlPainter.draw(f)};a.prototype.setHighlightOptions=function(a){this._hlPainter.setHighlightOptions(a)};a.prototype.hitTest=function(a,b){var f=this.context,c=t.C_HITTEST_SEARCH_SIZE,l=[0,0],e=[0,0],n=a.state;
n.toMap(l,[0,0]);n.toMap(e,[c,c]);if(0===b.filter(function(a){return!(l[0]>a.bounds[2]||e[0]<a.bounds[0]||l[1]<a.bounds[1]||e[1]>a.bounds[3])}).length)return[];this._hittestFBO||(this._hittestFBO=h.FramebufferObject.create(f,{colorTarget:0,depthStencilTarget:3,width:c,height:c}));var n=f.getViewport(),k=f.getBoundFramebufferObject();f.bindFramebuffer(this._hittestFBO);f.setViewport(0,0,c,c);this._drawClippingRects(a,b);var g=f.gl;f.setClearColor(1,1,1,1);f.clear(g.COLOR_BUFFER_BIT);f.setBlendingEnabled(!1);
f.setStencilWriteMask(0);this._drawPhases(a,b,u.WGLDrawPhase.HITTEST);f.setBlendingEnabled(!0);this._hittestFBO.readPixels(0,0,c,c,6408,5121,G);a=c*c;b=new Set;for(c=0;c<a;c++)g=E[c],4294967295!==g&&b.add(g);f.bindFramebuffer(k);f.setViewport(n.x,n.y,n.width,n.height);var m=[];b.forEach(function(a){m.push(a)});return m};a.prototype.startStencilBurn=function(){this.context.setStencilTestEnabled(!0);this.context.setStencilWriteMask(255);this.context.setClearStencil(0);this.context.clear(this.context.gl.STENCIL_BUFFER_BIT);
this.context.setStencilOp(7680,7680,7681);this.context.setColorMask(!1,!1,!1,!1);this.context.setBlendingEnabled(!1);this._quadVertexStream.bind();this.context.bindProgram(this._transformSolidProgram)};a.prototype.startStencilDraw=function(){this.context.setStencilWriteMask(0);this.context.setStencilOp(7680,7680,7680);this.context.setColorMask(!0,!0,!0,!0);this.context.setBlendingEnabled(!0);this.context.setBlendFunction(1,771);this._quadVertexStream.bind();this.context.bindProgram(this._transformTextureProgram)};
a.prototype.endStencilDraw=function(){this.context.setStencilTestEnabled(!1);this._quadVertexStream.unbind();this.context.bindProgram()};a.prototype.drawBitmap=function(a,f,c){var l=this.context,h=a.state,e=-Math.PI*h.rotation/180,n=-Math.PI*f.rotation/180;!(e+f.rotation)&&1.05>c&&.95<c?f.setSamplingMode(9728):f.setSamplingMode(9729);var g=h.toScreen(L,f.x,f.y),h=g[0],g=g[1],m=a.state.size[0],r=a.state.size[1],d=c*f.width;c*=f.height;var v=a.globalOpacity*f.opacity,t=this._transform,w=this._quadVertexStream;
a=a.drawPhase;a===u.WGLDrawPhase.CLIP?(l.setStencilFunction(519,this.stencilRef,255),l=this._transformSolidProgram):(l.setStencilFunction(514,this.stencilRef,255),l=this._transformTextureProgram);b.mat4.identity(t);b.mat4.scale(t,t,k.vec3.set(N,2/m,2/r,1));b.mat4.translate(t,t,k.vec3.set(N,h-m/2,-g+r/2,0));b.mat4.rotateZ(t,t,e);b.mat4.translate(t,t,k.vec3.set(N,d/2,-c/2,0));b.mat4.rotateZ(t,t,-n);b.mat4.scale(t,t,k.vec3.set(N,d/2,c/2,1));l.setUniformMatrix4fv("u_transform",t);a!==u.WGLDrawPhase.CLIP&&
(f.bind(0),l.setUniform1i("u_texture",0));l.setUniform1f("u_opacity",v);w.draw()};a.prototype._getPaintPass=function(a){this._passes||(this._passes=new Map);if(!this._passes.has(a))try{this._passes.set(a,new a)}catch(O){throw Error("Tried to instantiate WGLPaintPass with unknown constructor: "+a+",\n"+O);}return this._passes.get(a)};a.prototype._getPaintPasses=function(a,b){var f=this;return b.getPaintPassTs(a).map(function(a){return f._getPaintPass(a)})};a.prototype._drawPhases=function(a,b,f,l){var h=
this.context;h.setStencilTestEnabled(!0);for(var e=0;e<u.WGLDrawPhase.NUM_DRAW_PHASES-2;e++){var n=1<<e;if(n&f){var k=l?this._getPaintPasses(n,l):[],n=c({},a,{drawPhase:n});k.forEach(function(b){return b.preRender(a,a.rendererInfo)});for(var g=0,m=b;g<m.length;g++)m[g].doRender(n);k.reverse().forEach(function(b){return b.postRender(a,a.rendererInfo)})}}h.setStencilTestEnabled(!1)};a.prototype._debugTiles=function(a,b){};a.prototype._drawClippingRects=function(a,b){if(0!==b.length){var f=this.context;
f.setDepthWriteEnabled(!1);f.setDepthTestEnabled(!1);f.setStencilTestEnabled(!0);f.setBlendingEnabled(!1);f.setColorMask(!1,!1,!1,!1);f.setStencilOp(7680,7680,7681);f.setClearStencil(0);f.clear(f.gl.STENCIL_BUFFER_BIT);f.setStencilWriteMask(255);for(var c=0,l=b.length;c<b.length;c++,l--){var h=b[c];h.attached&&(h.stencilRef=l)}this._drawPhases(a,b,u.WGLDrawPhase.CLIP);f.setColorMask(!0,!0,!0,!0)}};a.prototype._setGlobalOpacity=function(a,b){if(b===u.WGLDrawPhase.MAP&&1!==a.globalOpacity){b=a.context;
var f=a.pixelRatio,c=a.state.size;a=Math.round(c[0]*f);f=Math.round(c[1]*f);if(null===this._globalOpacityFBO||this._globalOpacityFBO.width!==a||this._globalOpacityFBO.height!==f)null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=h.FramebufferObject.create(b,{colorTarget:0,depthStencilTarget:3,width:a,height:f});this._boundFBO=b.getBoundFramebufferObject();b.bindFramebuffer(this._globalOpacityFBO);b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,
0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(b.gl.COLOR_BUFFER_BIT|b.gl.DEPTH_BUFFER_BIT|b.gl.STENCIL_BUFFER_BIT);b.setDepthWriteEnabled(!1)}};a.prototype._applyGlobalOpacity=function(a,b){b===u.WGLDrawPhase.MAP&&1!==a.globalOpacity&&(b=a.context,b.bindFramebuffer(this._boundFBO),this._blitRenderer.render(b,this._globalOpacityFBO.colorTexture,9728,a.globalOpacity),this._boundFBO=null)};return a}();a.default=m})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ../../../../core/tsSupport/assignHelper @dojo/framework/shim/Map ../../../webgl ./enums ./shaders/MaterialPrograms".split(" "),
function(d,a,c,g,b,e,k){return function(){function a(a){this._programByKey=new g.default;this._programCache=new b.ProgramCache(a)}a.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(a,b,g,m,d){var h;h=a.getVariationHash()+"-"+((b===e.WGLDrawPhase.HITTEST||b===e.WGLDrawPhase.LABEL_ALPHA?1:0)|(b===e.WGLDrawPhase.HIGHLIGHT?2:0))+"-"+g.getVariationHash();if(this._programByKey.has(h))return this._programByKey.get(h);a=c({},a.getVariation(),g.getVariation(),
{highlight:b===e.WGLDrawPhase.HIGHLIGHT,id:b===e.WGLDrawPhase.HITTEST||b===e.WGLDrawPhase.LABEL_ALPHA});m=this._programCache.getProgram(k.createProgramTemplate(m,d),a);if(!m)throw Error("Unable to get program for key: ${key}");this._programByKey.set(h,m);return m};return a}()})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});var b=function(a){var b=
{},e;for(e in a){for(var h=e,n=void 0,n=""+h[0].toUpperCase(),g=1;g<h.length;g++){var d=h[g];d===d.toUpperCase()?(n+="_",n+=d):n+=d.toUpperCase()}b[n]=a[e]}return c.glslifyDefineMap(b)};a.createProgramTemplate=function(a,c){return{name:a,attributes:c,shaders:function(c){return{vertexShader:b(c)+g.resolveIncludes("materials/"+a+"/"+a+".vert"),fragmentShader:b(c)+g.resolveIncludes("materials/"+a+"/"+a+".frag")}}}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../symbols/cim/CIMSymbolHelper ../../../../symbols/cim/SDFHelper ./definitions ./enums ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SpriteMosaic ./Utils ./util/Result".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f,y,l,D,A){function G(a){if(a.type){switch(D.normalizeSymbolType(a.type)){case "simple-marker":return a.path?"simple-marker"+a.style+a.path:"simple-marker"+a.style;case "simple-line":return"simple-line"+a.style+a.cap;case "simple-fill":return"simple-fill"+a.style}if(a.mosaicHash)return a.mosaicHash;if(D.isPictureSymbol(a))return a.imageData?a.imageData:a.url+(""+a.width+a.height)}return JSON.stringify(a)}var E=C.vec2f32.create(),N=n.getLogger("esri.views.2d.engine.webgl.TextureManager"),
L=function(){function a(a,b,f){this.mosaicType=a;this.page=b;this.sdf=f}a.fromMosaic=function(b,f){return new a(b,f.page,f.sdf)};return a}();return function(){function a(){this._invalidFontsMap=new Map;this._sdfConverter=new y.default(126);this._bindingInfos=[];this._hashToBindingIndex=new Map;this._spriteMosaic=new l(1024,1024,300);this._glyphSource=new f(e.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new B(1024,1024,this._glyphSource)}Object.defineProperty(a.prototype,"sprites",{get:function(){return this._spriteMosaic},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();this._rasterizationCanvas=this._glyphMosaic=this._spriteMosaic=null};a.prototype._hashMosaic=function(a,b){return 1|a<<1|(b.sdf?1:0)<<2|b.page<<3};a.prototype._setTextureBinding=function(a,b){var f=this._hashMosaic(a,b);this._hashToBindingIndex.has(f)||(a=L.fromMosaic(a,
b),this._hashToBindingIndex.set(f,this._bindingInfos.length+1),this._bindingInfos.push(a));b.textureBinding=this._hashToBindingIndex.get(f)};a.prototype.rasterizeItem=function(a,b,f){var c=this;void 0===b&&(b=null);return a?a.type&&-1!==a.type.toLowerCase().indexOf("3d")?(N.error(new h("mapview-invalid-type","MapView does not support 3d symbol type: "+a.type,a)),u.resolve({glyphMosaicItems:[],spriteMosaicItem:null})):!a.type||"text"!==a.type&&"esriTS"!==a.type&&"CIMTextSymbol"!==a.type?m.safeCast(this._rasterizeSpriteSymbol(a,
f)).then(function(a){A.ok(a)&&a&&c._setTextureBinding(r.MosaicType.SPRITE,a);return{spriteMosaicItem:a}}):this._rasterizeTextSymbol(a,b,f).then(function(a){a.forEach(function(a){return c._setTextureBinding(r.MosaicType.GLYPH,a)});return{glyphMosaicItems:a}}):(N.error(new h("mapview-null-resource","Unable to rasterize null resource")),u.resolve(null))};a.prototype.bindTextures=function(a,b,f,c){void 0===c&&(c=1);if(0!==f.textureBinding){var l=this._bindingInfos[f.textureBinding-1];f=l.page;switch(l.mosaicType){case r.MosaicType.SPRITE:l=
this.sprites.getWidth(f)/c;c=this.sprites.getHeight(f)/c;c=x.vec2.set(E,l,c);this._bindSpritePage(a,f,z.TEXTURE_BINDING_SPRITE_ATLAS,9729);b.setUniform1i("u_texture",z.TEXTURE_BINDING_SPRITE_ATLAS);b.setUniform2fv("u_mosaicSize",c);break;case r.MosaicType.GLYPH:l=this.glyphs.width/c;c=this.glyphs.height/c;c=x.vec2.set(E,l,c);this._bindGlyphsPage(a,f,z.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform1i("u_texture",z.TEXTURE_BINDING_GLYPH_ATLAS);b.setUniform2fv("u_mosaicSize",c);break;default:N.error("mapview-texture-manager",
"Cannot handle unknown type "+l.mosaicType)}}};a.prototype._bindSpritePage=function(a,b,f,c){c||(c=9729);this._spriteMosaic.bind(a,c,b,f)};a.prototype._bindGlyphsPage=function(a,b,f){this._glyphMosaic.bind(a,9729,b,f)};a.prototype._rasterizeTextSymbol=function(a,b,f){var c=this,l=v.getFullyQualifiedFontName(a.font);a=this._invalidFontsMap.has(l);return this._glyphMosaic.getGlyphItems(a?"arial-unicode-ms-regular":l,b,f).catch(function(a){N.error(new h("mapview-invalid-resource","Couldn't find font "+
l+". Falling back to Arial Unicode MS Regular"));c._invalidFontsMap.set(l,!0);return c._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",b,f)})};a.prototype._rasterizeSpriteSymbol=function(a,f){return g(this,void 0,void 0,function(){var c,l,e,n,g,k;return b(this,function(b){b="CIMSolidStroke"===a.type||"CIMSolidFill"===a.type?!0:a&&(D.isFillSymbol(a)||D.isLineSymbol(a))&&"style"in a&&("solid"===a.style||"esriSFSSolid"===a.style||"esriSLSSolid"===a.style||"none"===a.style||"esriSFSNull"===a.style||
"esriSLSNull"===a.style);if(b)return[2,null];c=G(a);return this._spriteMosaic.has(c)?[2,this._spriteMosaic.getSpriteItem(c)]:"simple-marker"!==a.type&&"esriSMS"!==a.type||!a.path?a.url||a.imageData?[2,this._handleImage(a,c,f)]:(l=this._rasterizeJSON(a))?(e=l.size,n=l.image,g=l.sdf,k=l.simplePattern,[2,this._addItemToMosaic(c,e,n,!D.isMarkerSymbol(a),g,k)]):[2,new h("TextureManager","unrecognized or null rasterized image")]:[2,this._handleSVG(a,c,f)]})})};a.prototype._handleSVG=function(a,f,c){return g(this,
void 0,void 0,function(){var l,h;return b(this,function(b){switch(b.label){case 0:return l=[126,126],[4,this._sdfConverter.draw(a.path,c)];case 1:return h=b.sent(),[2,this._addItemToMosaic(f,l,new Uint32Array(h.buffer),!1,!0,!0)]}})})};a.prototype._handleImage=function(a,f,l){return g(this,void 0,void 0,function(){var e,n,g,m,r,d,v;return b(this,function(b){switch(b.label){case 0:e=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url,b.label=1;case 1:return b.trys.push([1,3,,4]),[4,k(e,
c({responseType:"image"},l))];case 2:return n=b.sent().data,g=this._rasterizeImageResource(n,a.colorSubstitutions),m=g.size,r=g.sdf,d=g.image,[2,this._addItemToMosaic(f,m,d,!D.isMarkerSymbol(a),r,!1)];case 3:return v=b.sent(),u.isAbortError(v)?[3,4]:[2,new h("mapview-invalid-resource","Could not fetch requested resource at "+e)];case 4:return[2]}})})};a.prototype._rasterizeImageResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=
a.width;this._rasterizationCanvas.height=a.height;var f=this._rasterizationCanvas.getContext("2d");f.drawImage(a,0,0,a.width,a.height);f=f.getImageData(0,0,a.width,a.height);f=new Uint8Array(f.data);if(b)for(var c=0;c<b.length;c++){var l=b[c];if(l&&l.oldColor&&4===l.oldColor.length&&l.newColor&&4===l.newColor.length){var h=l.oldColor,e=h[0],n=h[1],g=h[2],h=h[3],k=l.newColor,l=k[0],m=k[1],r=k[2],d=k[3];if(e!==l||n!==m||g!==r||h!==d)for(k=0;k<f.length;k+=4)e===f[k]&&n===f[k+1]&&g===f[k+2]&&h===f[k+
3]&&(f[k]=l,f[k+1]=m,f[k+2]=r,f[k+3]=d)}}for(k=0;k<f.length;k+=4)b=f[k+3]/255,f[k]*=b,f[k+1]*=b,f[k+2]*=b;b=a.width;c=a.height;e=f;if(512<=b||512<=c)e=a.width/a.height,1<e?(b=512,c=Math.round(512/e)):(c=512,b=Math.round(512*e)),e=new Uint8Array(4*b*c),D.resampleHermite(f,a.width,a.height,new Uint8ClampedArray(e.buffer),b,c,!1);return{size:[b,c],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1}};a.prototype._addItemToMosaic=function(a,b,f,c,l,h){return this._spriteMosaic.addSpriteItem(a,b,f,
c,l,h)};a.prototype._rasterizeJSON=function(a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type)return a=t.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style),{size:[a[1],a[2]],image:new Uint32Array(a[0].buffer),sdf:!1,simplePattern:!0};if("simple-line"===a.type||"esriSLS"===a.type)return a=t.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,a.style,a.cap),{size:[a[1],a[2]],image:new Uint32Array(a[0].buffer),
sdf:!0,simplePattern:!0};var b;a="simple-marker"===a.type||"esriSMS"===a.type?t.CIMSymbolHelper.fromSimpleMarker(a):a;if(b=w.getSDFInfo(a))return a=w.buildSDF(b),(b=a[0])?{size:[a[1],a[2]],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0}:null;a=t.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a);return(b=a[0])?{size:[a[1],a[2]],image:new Uint32Array(b.buffer),sdf:!1,simplePattern:!1}:null};return a}()})},"esri/symbols/cim/CIMSymbolHelper":function(){define("require exports ../../Color ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMCursor ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./CIMSymbolDrawHelper ./packingUtils".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u){function x(a,b){switch(b.type){case "CIMSymbolReference":var c={type:"point",x:0,y:0};a.drawSymbol(b.symbol,c);break;case "CIMPointSymbol":c={type:"point",x:0,y:0};a.drawSymbol(b,c);break;case "CIMVectorMarker":c=new h.Placement,a.drawMarker(b,c)}return a.envelope()}Object.defineProperty(a,"__esModule",{value:!0});var C=Math.PI,t=C/2,w=g.getLogger("esri.symbols.cim.CIMSymbolHelper");d=function(){function a(){}a.getEnvelope=function(a){var b=new n.EnvDrawHelper;if(Array.isArray(a)){for(var c=
void 0,f=0;f<a.length;f++){var h=a[f];c?c.union(x(b,h)):c=x(b,h)}return c}return x(b,a)};a.getTextureAnchor=function(a){a=this.getEnvelope(a);if(!a||0>=a.width||0>=a.height)return[0,0];var b=96/72;return[(a.x+.5*a.width)*b/(a.width*b+2),-(a.y+.5*a.height)*b/(a.height*b+2)]};a.rasterize=function(a,b){var c=this.getEnvelope(b);if(!c||0>=c.width||0>=c.height)return[null,0,0];var f=96/72,e=(c.x+.5*c.width)*f,l=-(c.y+.5*c.height)*f;a.width=c.width*f+2;a.height=c.height*f+2;c=a.getContext("2d");f=n.Transformation.createScale(f,
-f);f.translate(.5*a.width-e,.5*a.height-l);e=new n.CanvasDrawHelper(c,f);switch(b.type){case "CIMPointSymbol":e.drawSymbol(b,{type:"point",x:0,y:0});break;case "CIMVectorMarker":l=new h.Placement,e.drawMarker(b,l)}b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(e=0;e<b.length;e+=4)c=b[e+3]/255,b[e]*=c,b[e+1]*=c,b[e+2]*=c;return[b,a.width,a.height]};a.fromSimpleMarker=function(a){var b,c,f=a.style;if("circle"===f||"esriSMSCircle"===f){b=Math.acos(.995);c=Math.ceil(C/b/4);0===c&&
(c=1);b=t/c;c*=4;f=[];f.push([50,0]);for(var h=1;h<c;h++)f.push([50*Math.cos(h*b),-50*Math.sin(h*b)]);f.push([50,0]);b={rings:[f]};c={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===f||"esriSMSCross"===f)b=0,b={rings:[[[b,50],[b,b],[50,b],[50,-b],[b,-b],[b,-50],[-b,-50],[-b,-b],[-50,-b],[-50,b],[-b,b],[-b,50],[b,50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===f||"esriSMSDiamond"===f)b={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===
f||"esriSMSSquare"===f)b={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===f||"esriSMSX"===f)b=0,b={rings:[[[0,b],[50-b,50],[50,50-b],[b,0],[50,b-50],[50-b,-50],[0,-b],[b-50,-50],[-50,b-50],[-b,0],[-50,50-b],[b-50,50],[0,b]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===f||"esriSMSTriangle"===f)c=2/3*100,f=c-100,b={rings:[[[-57.735026918962575,f],[0,c],[57.735026918962575,f],[-57.735026918962575,f]]]},c={xmin:-57.735026918962575,
ymin:f,xmax:57.735026918962575,ymax:c};var l;b&&c&&(l=[{type:"CIMSolidFill",enable:!0,color:a.color}],a.outline&&l.push({type:"CIMSolidStroke",enable:!0,width:a.outline.width,color:a.outline.color}),l={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.angle,size:a.size,offsetX:a.xoffset,offsetY:a.yoffset,frame:c,markerGraphics:[{type:"CIMMarkerGraphic",geometry:b,symbol:{type:"CIMPolygonSymbol",symbolLayers:l}}]}]});return l};a.getFillColor=function(b){if(!b)return null;
switch(b.type){case "CIMPolygonSymbol":if(b.symbolLayers){var c=0;for(b=b.symbolLayers;c<b.length;c++){var h=a.getFillColor(b[c]);if(null!=h)return h}}break;case "CIMTextSymbol":return a.getFillColor(b.symbol);case "CIMSolidFill":return b.color}};a.getStrokeColor=function(b){if(b)switch(b.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(b.symbolLayers){var c=0;for(b=b.symbolLayers;c<b.length;c++){var h=a.getStrokeColor(b[c]);if(void 0!==h)return h}}break;case "CIMTextSymbol":return a.getStrokeColor(b.symbol);
case "CIMSolidStroke":return b.color}};a.getStrokeWidth=function(b){if(b)switch(b.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(b.symbolLayers){var c=0;for(b=b.symbolLayers;c<b.length;c++){var h=a.getStrokeWidth(b[c]);if(void 0!==h)return h}}break;case "CIMTextSymbol":return a.getStrokeWidth(b.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return b.width}};a.getSize=function(b){if(b)switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var c=
0;if(b.symbolLayers){var h=0;for(b=b.symbolLayers;h<b.length;h++){var f=a.getSize(b[h]);f>c&&(c=f)}}return c;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":return b.width;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":return b.size}};a.getMarkerScaleRatio=function(a){if(a)switch(a.type){case "CIMVectorMarker":if(!1!==a.scaleSymbolsProportionally&&a.frame)return a.size/(a.frame.ymax-a.frame.ymin)}return 1};a.executeEffects=function(a,b,c){void 0===
c&&(c=!1);var f=96/72,h=a?a.length:0;h&&c&&--h;for(c=0;c<h;++c){var l=a[c];if(l){var e=m.getEffectOperator(l);e&&(b=e.execute(b,l,f))}}return b};a.processEffects=function(c,h,n){var f;c.effects&&0<c.effects.length&&(f=e.deltaEncodeGeometry(n),f=new k.SimpleGeometryCursor(f),f=a.executeEffects(c.effects,f));c=c.symbolLayers[h];c.effects&&0<c.effects.length&&(h=!1,"CIMGeometricEffectDashes"===c.effects[c.effects.length-1].type&&(h=!0),f||(f=e.deltaEncodeGeometry(n),f=new k.SimpleGeometryCursor(f)),
f=a.executeEffects(c.effects,f,h));if(!f)return n;n=[];for(c=f.next();c;)n.push(c),c=f.next();f=n.length;switch(f){case 0:return null;case 1:return e.deltaEncodeGeometry(n[0]);default:c=n[0];for(h=1;h<f;++h){var g=n[h];b.isPolygon(c)&&b.isPolygon(g)&&Array.prototype.push.apply(c.rings,g.rings);b.isPolyline(c)&&b.isPolyline(g)&&Array.prototype.push.apply(c.paths,g.paths)}return e.deltaEncodeGeometry(c)}};return a}();a.CIMSymbolHelper=d;d=function(){function a(){}a.rasterizeSimpleFill=function(a,b){"solid"!==
b&&"none"!==b&&"esriSFSSolid"!==b&&"esriSFSNull"!==b||console.error("Unexpected: style does not require rasterization");a.width=8;a.height=8;var c=a.getContext("2d");c.strokeStyle="#FFFFFF";c.lineWidth=1;c.beginPath();if("vertical"===b||"cross"===b||"esriSFSCross"===b||"esriSFSVertical"===b)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===b||"cross"===b||"esriSFSCross"===b||"esriSFSHorizontal"===b)c.moveTo(0,0),c.lineTo(8,0);if("forward-diagonal"===b||"diagonal-cross"===b||"esriSFSDiagonalCross"===b||
"esriSFSForwardDiagonal"===b)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===b||"diagonal-cross"===b||"esriSFSBackwardDiagonal"===b||"esriSFSDiagonalCross"===b)c.moveTo(8,0),c.lineTo(0,8);c.stroke();b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(var f=0;f<b.length;f+=4)c=b[f+3]/255,b[f]*=c,b[f+1]*=c,b[f+2]*=c;return[b,a.width,a.height]};a.rasterizeSimpleLine=function(a,b,c){switch(c){case "butt":c="Butt";break;case "square":c="Square";break;default:c="Round"}var f="Butt"===
c;switch(b){case "dash":case "esriSLSDash":b=f?[4,3]:[3,4];break;case "dash-dot":case "esriSLSDashDot":b=f?[4,3,1,3]:[3,4,0,4];break;case "dot":case "esriSLSDot":b=f?[1,3]:[0,4];break;case "long-dash":case "esriSLSLongDash":b=f?[8,3]:[7,4];break;case "long-dash-dot":case "esriSLSLongDashDot":b=f?[8,3,1,3]:[7,4,0,4];break;case "long-dash-dot-dot":case "esriSLSDashDotDot":b=f?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case "short-dash":case "esriSLSShortDash":b=f?[4,1]:[3,2];break;case "short-dash-dot":case "esriSLSShortDashDot":b=
f?[4,1,1,1]:[3,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":b=f?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":b=f?[1,1]:[0,2];break;case "solid":case "esriSLSSolid":case "none":w.error("Unexpected: style does not require rasterization");b=[0,0];break;default:w.error("Tried to rasterize SLS, but found an unexpected style: "+b+"!"),b=[0,0]}return this.rasterizeDash(a,b,c)};a.rasterizeDash=function(a,b,c){a="Butt"===c;var f="Square"===c;c=!a&&!f;for(var h=
0,l=0;l<b.length;l++)var e=b[l],h=h+e;for(var h=15*h,n=31*h,l=new Float32Array(n),k=c?225:15,e=0;e<n;++e)l[e]=k;for(var k=n=0,g=!0,m=0;m<b.length;m++){for(var e=b[m],n=k,k=k+15*e,d=n;d<k;){for(var t=0;31>t;){var e=t*h+d,w=c?(t-15)*(t-15):Math.abs(t-15);l[e]=g?a?Math.max(Math.max(n+7.5-d,w),Math.max(d-k+7.5,w)):w:c?Math.min((d-n)*(d-n)+w,(d-k)*(d-k)+w):f?Math.min(Math.max(d-n,w),Math.max(k-d,w)):Math.min(Math.max(d-n+7.5,w),Math.max(k+7.5-d,w));t++}d++}g=!g}b=l.length;a=new Uint8Array(4*b);for(e=0;e<
b;++e)u.packFloatRGBA((c?Math.sqrt(l[e]):l[e])/15,a,4*e);return[a,h,31]};return a}();a.SymbolHelper=d;d=function(){function a(){}a.findApplicableOverrides=function(b,c,h){if(c){if(b.primitiveName){for(var f=!1,e=0;e<h.length;e++){var l=h[e];if(l.primitiveName===b.primitiveName){f=!0;break}}if(!f)for(f=0;f<c.length;f++)l=c[f],l.primitiveName===b.primitiveName&&h.push(l)}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(f=0,e=b.effects;f<e.length;f++)l=
e[f],a.findApplicableOverrides(l,c,h);if(b.symbolLayers)for(l=0,b=b.symbolLayers;l<b.length;l++)a.findApplicableOverrides(b[l],c,h);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(b.effects)for(f=0,e=b.effects;f<e.length;f++)l=e[f],a.findApplicableOverrides(l,c,h);b.markerPlacement&&a.findApplicableOverrides(b.markerPlacement,
c,h);if("CIMVectorMarker"===b.type){if(b.markerGraphics)for(l=0,b=b.markerGraphics;l<b.length;l++)f=b[l],a.findApplicableOverrides(f,c,h),a.findApplicableOverrides(f.symbol,c,h)}else"CIMCharacterMarker"===b.type?a.findApplicableOverrides(b.symbol,c,h):"CIMHatchFill"===b.type&&a.findApplicableOverrides(b.lineSymbol,c,h)}}};a.applyOverrides=function(b,c,h,f){if(c){if(b.primitiveName)for(var e=0;e<c.length;e++){var l=c[e];if(l.primitiveName===b.primitiveName){f&&f.push({cim:b,propertyName:l.propertyName,
value:b[l.propertyName]});l.expression&&(l.value=a.toValue(l.propertyName,l.expression));if(h){for(var n=!1,k=0,g=h;k<g.length;k++)g[k].primitiveName===b.primitiveName&&(n=!0);n||h.push(l)}b[l.propertyName]=l.value}}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(l=0,n=b.effects;l<n.length;l++)e=n[l],a.applyOverrides(e,c,h,f);if(b.symbolLayers)for(e=0,b=b.symbolLayers;e<b.length;e++)a.applyOverrides(b[e],c,h,f);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(b.effects)for(l=
0,n=b.effects;l<n.length;l++)e=n[l],a.applyOverrides(e,c,h,f);if("CIMVectorMarker"===b.type&&b.markerGraphics)for(e=0,b=b.markerGraphics;e<b.length;e++)l=b[e],a.applyOverrides(l,c,h,f),a.applyOverrides(l.symbol,c,h,f)}}};a.restoreOverrides=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.cim[c.propertyName]=c.value}};a.getOverride=function(b,c,h){if(c&&0!==c.length)for(var f=0;f<b.length;f++){var e=b[f];if(e.primitiveName===c&&e.propertyName===h)return a.toValue(h,e.value)}};a.buildOverrideKey=
function(a){for(var b="",c=0;c<a.length;c++){var f=a[c];void 0!==f.value&&(b+=""+f.primitiveName+f.propertyName+JSON.stringify(f.value))}return b};a.toValue=function(a,b){return"dashTemplate"===a?b.split(" ").map(function(a){return Number(a)}):"color"===a?(a=(new c(b)).toRgba(),a[3]*=255,a):b};return a}();a.OverrideHelper=d})},"esri/symbols/cim/CIMCursor":function(){define(["require","exports","../../geometry/support/jsonUtils","./CIMPlacements"],function(d,a,c,g){function b(a){if(a)for(var b=a.length-
1;0<b;--b)a[b][0]-=a[b-1][0],a[b][1]-=a[b-1][1]}function e(a){if(a)for(var c=0;c<a.length;c++)b(a[c])}function k(a){if(a)for(var b=a.length,c=1;c<b;++c)a[c][0]+=a[c-1][0],a[c][1]+=a[c-1][1]}function m(a){if(a)for(var b=0;b<a.length;b++)k(a[b])}function h(a){a&&a.reverse()}function n(a){return{rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]}}Object.defineProperty(a,"__esModule",{value:!0});a.deltaEncodePath=b;a.deltaEncodeMultipath=e;a.deltaDecodeGeometry=
function(a){c.isPolygon(a)?m(a.rings):c.isPolyline(a)?m(a.paths):c.isMultipoint(a)&&k(a.points);return a};a.deltaEncodeGeometry=function(a){c.isPolygon(a)?e(a.rings):c.isPolyline(a)?e(a.paths):c.isMultipoint(a)&&b(a.points);return a};a.reverseMultipath=function(a){if(a)for(var b=0;b<a.length;b++)h(a[b])};a.reversePath=h;a.getCoord2D=function(a,b,c){return[a[0]+(b[0]-a[0])*c,a[1]+(b[1]-a[1])*c]};a.isClosedPath=function(a){return a&&0!==a.length?a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]:
!1};a.getId=function(a){return a[4]};a.setId=function(a,b){a[4]=b};d=function(){function a(a,b,h,e){this.acceptPolygon=b;this.acceptPolyline=h;this.geomUnitsPerPoint=e;this.pathIndex=this.pathCount=-1;this.iteratePath=!1;a&&(c.isPolygon(a)?b&&(this.multiPath=a.rings,this.isClosed=!0):c.isPolyline(a)?h&&(this.multiPath=a.paths,this.isClosed=!1):c.isExtent(a)&&b&&(this.multiPath=n(a).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length));this.internalPlacement=new g.Placement}
a.prototype.next=function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var a=this.processPath(this.multiPath[this.pathIndex]);if(a)return a}this.pathIndex=this.pathCount=-1;return this.multiPath=null};a.prototype.processPath=function(a){return null};return a}();a.PathTransformationCursor=d;d=function(){function a(a,b,c,h){this.inputGeometries=a;this.acceptPolygon=b;this.acceptPolyline=c;this.geomUnitsPerPoint=h;this.pathIndex=
this.pathCount=-1;this.iteratePath=!1}a.prototype.next=function(){for(;;){if(!this.multiPath){for(var a=this.inputGeometries.next();a;)if(c.isPolygon(a)?this.acceptPolygon&&(this.multiPath=a.rings,this.isClosed=!0):c.isPolyline(a)?this.acceptPolyline&&(this.multiPath=a.paths,this.isClosed=!1):c.isExtent(a)&&this.acceptPolygon&&(this.multiPath=n(a).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length;this.pathIndex=-1;break}else a=this.inputGeometries.next();if(!this.multiPath)return null}for(;this.iteratePath||
this.pathIndex<this.pathCount-1;)if(this.iteratePath||this.pathIndex++,a=this.processPath(this.multiPath[this.pathIndex]))return a;this.pathIndex=this.pathCount=-1;this.multiPath=null}};a.prototype.processPath=function(a){return null};return a}();a.PathGeometryCursor=d})},"esri/symbols/cim/CIMPlacements":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this.setIdentity()}a.prototype.setIdentity=function(){this.tz=this.ty=
this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rz_c=1;this.rz_s=0};a.prototype.setTranslate=function(a,b){this.tx=a;this.ty=b};a.prototype.setTranslateZ=function(a){this.tz=a};a.prototype.setRotateCS=function(a,b){this.rz=void 0;this.rz_c=a;this.rz_s=b};a.prototype.setRotate=function(a){this.rz=a;this.rz_s=this.rz_c=void 0};a.prototype.setRotateY=function(a){this.ry=a};a.prototype.setScale=function(a){this.s=a};a.prototype.setMeasure=function(a){this.m=a};return a}();a.Placement=d;d=function(){function a(a){}
a.prototype.next=function(){return null};return a}();a.EmptyPlacementCursor=d})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../core/lang"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a){this._geometry=a}a.prototype.next=function(){var a=this._geometry;this._geometry=null;return a};return a}();a.SimpleGeometryCursor=d;a.clone=function(a){return c.clone(a)}})},"esri/symbols/cim/CIMOperators":function(){define(["require","exports"],
function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.getEffectOperator=function(a){return null};a.getPlacementOperator=function(a){return null}})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./Rect".split(" "),function(d,a,c,g,b,e,k,m,h,n){Object.defineProperty(a,"__esModule",{value:!0});
a.C_DEG_TO_RAD=Math.PI/180;var u=b.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),x=function(){function a(a){this._t=a}a.createIdentity=function(){return new a([1,0,0,0,1,0])};a.prototype.clone=function(){return new a(this._t.slice())};a.prototype.transform=function(a){var b=this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]};a.createScale=function(b,c){return new a([b,0,0,0,c,0])};a.prototype.scale=function(a,b){var c=this._t;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=b;c[4]*=b;c[5]*=b;return this};
a.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};a.createTranslate=function(b,c){return new a([0,0,b,0,0,c])};a.prototype.translate=function(a,b){var c=this._t;c[2]+=a;c[5]+=b;return this};a.createRotate=function(b){var c=Math.cos(b);b=Math.sin(b);return new a([c,-b,0,b,c,0])};a.prototype.rotate=function(b){return this.multiply(a.createRotate(b))};a.prototype.multiply=function(a){var b=this._t;a=a._t;var c=b[1]*a[0]+b[4]*a[1],h=b[2]*a[0]+b[5]*a[1]+a[2],
e=b[0]*a[3]+b[3]*a[4],n=b[1]*a[3]+b[4]*a[4],f=b[2]*a[3]+b[5]*a[4]+a[5];b[0]=b[0]*a[0]+b[3]*a[1];b[1]=c;b[2]=h;b[3]=e;b[4]=n;b[5]=f;return this};return a}();a.Transformation=x;d=function(){function b(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||x.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}b.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};b.prototype.transformSize=function(a){return a*this._sizeTransfos[this._sizeTransfos.length-
1]};b.prototype.back=function(){return this._transfos[this._transfos.length-1]};b.prototype.push=function(a){var b=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*b)};b.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};b.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,b)}};b.prototype.drawMultiLayerSymbol=
function(a,b){if(a){var c=a.symbolLayers;if(c)if(a=a.effects){if(b=this.executeEffects(a,b))for(a=b.next();a;)this.drawSymbolLayers(c,a),a=b.next()}else this.drawSymbolLayers(c,b)}};b.prototype.executeEffects=function(a,b){var c=96/72;b=new k.SimpleGeometryCursor(b);for(var h=a?a.length:0,e=0;e<h;++e){var n=a[e];if(n){var f=m.getEffectOperator(n);f&&(b=f.execute(b,n,c))}}return b};b.prototype.drawSymbolLayers=function(a,b){for(var c=a.length;c--;){var h=a[c];if(h&&!1!==h.enable){var e=h.effects;if(e){if(e=
this.executeEffects(e,b))for(var n=e.next();n;)this.drawSymbolLayer(h,n),n=e.next()}else this.drawSymbolLayer(h,b)}}};b.prototype.drawSymbolLayer=function(a,b){switch(a.type){case "CIMSolidFill":this.drawSolidFill(b,a.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,a.color,a.width);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(a,b)}};b.prototype.drawMarkerLayer=function(a,b){var c=a.markerPlacement;if(c){var e=96/72,n=m.getPlacementOperator(c);
if(n&&(b=n.execute(b,c,e)))for(c=b.next();c;)this.drawMarker(a,c),c=b.next()}else c=new h.Placement,c.tx=b.x,c.ty=b.y,this.drawMarker(a,c)};b.prototype.drawMarker=function(a,b){switch(a.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(a,b);break;case "CIMVectorMarker":this.drawVectorMarker(a,b)}};b.prototype.drawPictureMarker=function(a,b){};b.prototype.drawVectorMarker=function(b,c){if(b){var h=b.markerGraphics;if(h){var e=b.size,n=b.frame,k=n?n.ymax-n.ymin:0,e=e&&k?
e/k:1,k=x.createIdentity();n&&k.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));var f=b.anchorPoint;if(f){var g=f.x,f=f.y;"Absolute"!==b.anchorPointUnits&&n&&(g*=n.xmax-n.xmin,f*=n.ymax-n.ymin);k.translate(-g,-f)}1!==e&&k.scale(e,e);b.rotation&&k.rotate(b.rotation*a.C_DEG_TO_RAD);k.translate(b.offsetX||0,b.offsetY||0);k.translate(c.tx,c.ty);this.push(k);for(b=0;b<h.length;b++)(c=h[b])&&c.symbol&&c.geometry||u.error("Invalid marker graphic",c),this.drawSymbol(c.symbol,c.geometry);this.pop()}}};
b.prototype.drawSolidFill=function(a,b){};b.prototype.drawSolidStroke=function(a,b,c){};return b}();a.CIMSymbolDrawHelper=d;g=function(a){function b(){var b=a.call(this)||this;b.reset();return b}c(b,a);b.prototype.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity};b.prototype.envelope=function(){return new n.default(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};b.prototype._merge=function(a,b){a[0]-b<this._xmin&&(this._xmin=a[0]-b);a[0]+b>this._xmax&&
(this._xmax=a[0]+b);a[1]-b<this._ymin&&(this._ymin=a[1]-b);a[1]+b>this._ymax&&(this._ymax=a[1]+b)};b.prototype.drawSolidFill=function(a,b){if(a&&a.rings)for(b=0,a=a.rings;b<a.length;b++){var c=a[b],h=c?c.length:0;if(2<h){this._merge(this.transformPt(c[0]),0);for(var e=1;e<h;++e)this._merge(this.transformPt(c[e]),0)}}};b.prototype.drawSolidStroke=function(a,b,c){b=.5*this.transformSize(c);if(a=e.isPolygon(a)?a.rings:a.paths)for(c=0;c<a.length;c++){var h=a[c],n=h?h.length:0;if(1<n){this._merge(this.transformPt(h[0]),
b);for(var f=1;f<n;++f)this._merge(this.transformPt(h[f]),b)}}};return b}(d);a.EnvDrawHelper=g;d=function(a){function b(b,c){c=a.call(this,c)||this;c._ctx=b;return c}c(b,a);b.prototype.drawSolidFill=function(a,b){if(a&&a.rings){var c=this._ctx;c.fillStyle="string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";c.beginPath();b=0;for(a=a.rings;b<a.length;b++){var h=a[b],e=h?h.length:0;if(2<e){var f=this.transformPt(h[0]);c.moveTo(f[0],f[1]);for(var n=
1;n<e;++n)f=this.transformPt(h[n]),c.lineTo(f[0],f[1]);c.closePath()}}c.fill("evenodd")}};b.prototype.drawSolidStroke=function(a,b,c){var h=this._ctx;h.strokeStyle="string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";h.lineWidth=this.transformSize(c)+.5;h.beginPath();b=!1;e.isPolygon(a)?(c=a.rings,b=!0):c=a.paths;for(a=0;a<c.length;a++){var n=c[a],f=n?n.length:0;if(1<f){var k=this.transformPt(n[0]);h.moveTo(k[0],k[1]);for(var l=1;l<f;++l)k=this.transformPt(n[l]),
h.lineTo(k[0],k[1]);b&&h.closePath()}}h.stroke()};return b}(d);a.CanvasDrawHelper=d})},"esri/symbols/cim/Rect":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b,c,k){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===k&&(k=0);this.x=a;this.y=b;this.width=c;this.height=k}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});a.prototype.union=
function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,a.height)};return a}();a.default=d})},"esri/symbols/cim/packingUtils":function(){define(["require","exports"],function(d,a){function c(a){return a-Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});var g=[1,256,65536,16777216],b=[1/256,1/65536,1/16777216,1/4294967296],e=function(a,c){void 0===c&&(c=0);for(var h=0,e=0;4>e;e++)h+=a[c+e]*b[e];return h}(new Uint8ClampedArray([255,
255,255,255]));a.packFloatRGBA=function(a,b,h){void 0===h&&(h=0);a=0>a?0:a>e?e:a;for(var n=0;4>n;n++)b[h+n]=Math.floor(256*c(a*g[n]))}})},"esri/symbols/cim/SDFHelper":function(){define(["require","exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(d,a,c,g,b){function e(a){if(!a)return null;switch(a.type){case "CIMPointSymbol":a=a.symbolLayers;if(!a||1!==a.length)break;return e(a[0]);case "CIMVectorMarker":a=a.markerGraphics;if(!a||1!==a.length)break;var b=a[0];if(!b)break;
a=b.geometry;if(!a)break;b=b.symbol;if(!b||"CIMPolygonSymbol"!==b.type&&"CIMLineSymbol"!==b.type)break;return{geom:a,asFill:"CIMPolygonSymbol"===b.type};case "sdf":return{geom:a.geom,asFill:a.asFill}}return null}function k(a){for(var b=Infinity,c=-Infinity,e=Infinity,k=-Infinity,g=0;g<a.length;g++)for(var m=0,d=a[g];m<d.length;m++){var z=d[m];z[0]<b&&(b=z[0]);z[0]>c&&(c=z[0]);z[1]<e&&(e=z[1]);z[1]>k&&(k=z[1])}return[b,e,c,k]}Object.defineProperty(a,"__esModule",{value:!0});a.getSDFInfo=e;a.getSDFSymbol=
function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};a.getExtent=function(a){return a?a.rings?k(a.rings):a.paths?k(a.paths):c.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};a.getSDFMetrics=function(a,b,c,e,k){var h=a[0],n=a[1],g=a[2];a=a[3];if(g<h||a<n)return[0,0,0];var d=g-h,m=a-n,g=Math.floor(31.5);a=(128-2*(g+1))/Math.max(d,m);var d=Math.round(d*a),m=Math.round(m*a)+2*g,u=
1;b&&(u=m/a/(b.ymax-b.ymin));var B=0,f=0;e&&(k?b&&c&&0<b.ymax-b.ymin&&(B=e.x/((b.xmax-b.xmin)/(b.ymax-b.ymin)*c),f=e.y/c):(B=e.x,f=e.y));B=.5*(b.xmax+b.xmin)+B*(b.xmax-b.xmin);f=.5*(b.ymax+b.ymin)+f*(b.ymax-b.ymin);B=(B-h)*a+g;f=(f-n)*a+g;return[u,B/(d+2*g)-.5,-(f/m-.5)]};a.buildSDF=function(a){var c,e=a.geom;c=e?e.rings?e.rings:e.paths?e.paths:void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:
null;var k,e=Infinity,d=-Infinity,m=Infinity,t=-Infinity;for(k=0;k<c.length;k++)for(var w=0,z=c[k];w<z.length;w++){var r=z[w];r[0]<e&&(e=r[0]);r[0]>d&&(d=r[0]);r[1]<m&&(m=r[1]);r[1]>t&&(t=r[1])}k=new b.default(e,m,d-e,t-m);m=Math.floor(31.5);w=(128-2*(m+1))/Math.max(k.width,k.height);e=Math.round(k.width*w)+2*m;d=Math.round(k.height*w)+2*m;t=[];for(z=0;z<c.length;z++){var v=c[z];if(v&&1<v.length){for(var r=[],B=0;B<v.length;B++){var f=v[B],y=f[0],f=f[1],y=y-k.x,f=f-k.y,y=y*w,f=f*w,y=y+(m-.5),f=f+
(m-.5);r.push([y,f])}a.asFill&&(B=r.length-1,r[0][0]===r[B][0]&&r[0][1]===r[B][1]||r.push(r[0]));t.push(r)}}k=e*d;c=Array(k);z=m*m+1;for(w=0;w<k;++w)c[w]=z;for(z=0;z<t.length;z++)for(r=t[z],B=r.length,w=1;w<B;++w){var v=r[w-1],y=r[w],l=void 0,f=void 0;v[0]<y[0]?(l=v[0],f=y[0]):(l=y[0],f=v[0]);var D=void 0,A=void 0;v[1]<y[1]?(D=v[1],A=y[1]):(D=y[1],A=v[1]);var G=Math.floor(l)-m,f=Math.floor(f)+m,D=Math.floor(D)-m,A=Math.floor(A)+m;0>G&&(G=0);f>e&&(f=e);0>D&&(D=0);A>d&&(A=d);for(var l=y[0]-v[0],E=y[1]-
v[1],N=l*l+E*E;G<f;G++)for(var L=D;L<A;L++){var Q=(G-v[0])*l+(L-v[1])*E,R=void 0,O=void 0;0>Q?(R=v[0],O=v[1]):Q>N?(R=y[0],O=y[1]):(Q/=N,R=v[0]+Q*l,O=v[1]+Q*E);Q=(G-R)*(G-R)+(L-O)*(L-O);R=(d-L-1)*e+G;Q<c[R]&&(c[R]=Q)}}for(w=0;w<k;++w)c[w]=Math.sqrt(c[w]);if(a.asFill)for(a=0;a<t.length;a++)for(k=t[a],w=k.length,z=1;z<w;++z)for(r=k[z-1],B=k[z],y=v=void 0,r[0]<B[0]?(v=r[0],y=B[0]):(v=B[0],y=r[0]),f=D=void 0,r[1]<B[1]?(D=r[1],f=B[1]):(D=B[1],f=r[1]),v=Math.floor(v),y=Math.floor(y)+1,D=Math.floor(D),f=
Math.floor(f)+1,v<m&&(v=m),y>e-m&&(y=e-m),D<m&&(D=m),f>d-m&&(f=d-m);D<f;++D)if(r[1]>D!==B[1]>D){A=(d-D-1)*e;for(l=v;l<y;++l)l<(B[0]-r[0])*(D-r[1])/(B[1]-r[1])+r[0]&&(c[A+l]=-c[A+l]);for(l=m;l<v;++l)c[A+l]=-c[A+l]}m*=2;t=c.length;a=new Uint8Array(4*t);for(k=0;k<t;++k)g.packFloatRGBA(.5-c[k]/m,a,4*k);return[a,e,d]}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.WEBGL_MAX_STOPS=8;a.WEBGL_MAX_INNER_STOPS=
a.WEBGL_MAX_STOPS-2;a.NAN_MAGIC_NUMBER=1E-30;a.EXTRUDE_SCALE=64;a.PICTURE_FILL_COLOR=4294967295;a.TILE_SIZE=512;a.ANGLE_FACTOR_256=256/360;a.DEBUG_LABELS=!1;a.COLLISION_BUCKET_SIZE=128;a.DOT_DENSITY_MAX_FIELDS=8;a.COLLISION_MAX_ZOOM_DELTA=3;a.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;a.COLLISION_BOX_PADDING=8;a.COLLISION_TILE_BOX_SIZE=a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;a.COLLISION_PLACEMENT_PADDING=8;a.HEURISTIC_GLYPHS_PER_LINE=50;a.HEURISTIC_GLYPHS_PER_FEATURE=10;a.GLYPH_SIZE=24;a.TEXT_LINE_HEIGHT=
1.2*a.GLYPH_SIZE;a.TEXT_MAX_WIDTH=10*a.GLYPH_SIZE;a.TEXT_SPACING=0;a.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};a.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;a.TEXTURE_BINDING_SPRITE_ATLAS=0;a.TEXTURE_BINDING_GLYPH_ATLAS=0;a.TEXTURE_BINDING_HIGHLIGHT_0=2;a.TEXTURE_BINDING_HIGHLIGHT_1=3;a.TEXTURE_BINDING_ATTRIBUTE_DATA_0=4;a.TEXTURE_BINDING_ATTRIBUTE_DATA_1=5;a.TEXTURE_BINDING_ATTRIBUTE_DATA_2=6;a.TEXTURE_BINDING_RENDERER_0=7;a.TEXTURE_BINDING_RENDERER_1=8;a.MAX_FILTERS=
2;a.FILTER_FLAG_0=1;a.EFFECT_FLAG_0=2;a.THIN_LINE_THRESHOLD=2.5})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(d,a){function c(a){a=a.toLowerCase().split(" ").join("-");switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";case "cursive":return"redressed";default:return a}}Object.defineProperty(a,"__esModule",{value:!0});a.getFullyQualifiedFontName=function(a){var b;
a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":b="-bold";break a}b=""}var e;a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblic":e="-italic";break a}e=""}b+=e;return c(a.family)+(0<b.length?b:"-regular")};a.getFontDecorationTop=function(a){switch(a){case "underline":return-26;case "line-through":return-18}return NaN}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ../../../webgl ./Rect ./RectangleBinPack".split(" "),
function(d,a,c,g,b,e,k){return function(){function a(a,b,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=a;this.height=b;this._glyphSource=c;this._binPack=new k(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0);this._addDecorationGlyph()}a.prototype.getGlyphItems=function(a,b,c){for(var e=this,h=[],k=this._glyphSource,n=new Set,d=1/256,
m=0;m<b.length;m++)n.add(Math.floor(b[m]*d));var u=[];n.forEach(function(b){if(256>=b){var f=a+b;e._rangePromises.has(f)?u.push(e._rangePromises.get(f)):(b=k.getRange(a,b,c).then(function(){e._rangePromises["delete"](f)}).catch(function(a){e._rangePromises["delete"](f);if(!g.isAbortError(a))throw Error("Unable to query resource");}),e._rangePromises.set(f,b),u.push(b))}});return g.all(u).then(function(c){var f=e._glyphIndex[a];f||(f={},e._glyphIndex[a]=f);for(var n=0;n<b.length;n++){c=b[n];var l=
f[c];if(l)h[c]={sdf:!0,rect:l.rect,metrics:l.metrics,page:l.page};else if((l=k.getGlyph(a,c))&&l.metrics){var g=e._recordGlyph(l,c);f[c]={rect:g,metrics:l.metrics,tileIDs:null,page:e._currentPage};h[c]={sdf:!0,rect:g,metrics:l.metrics,page:e._currentPage};e._dirties[e._currentPage]=!0}}return h})};a.prototype._recordGlyph=function(a,b){var c=a.metrics;if(0===c.width)c=new e.default(0,0,0,0);else{b=c.width+6;var h=c.height+6,n=b%4?4-b%4:4,g=h%4?4-h%4:4;1===n&&(n=5);1===g&&(g=5);c=this._binPack.allocate(b+
n,h+g);c.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new k(this.width-4,this.height-4),c=this._binPack.allocate(b+n,h+g));n=this._glyphData[this._currentPage];a=a.bitmap;var d=g=void 0;if(a)for(var m=0;m<h;m++)for(var g=b*m,d=this.width*(c.y+m+1)+c.x,r=0;r<b;r++)n[d+r+1]=a[g+r]}return c};a.prototype._addDecorationGlyph=
function(){for(var a=[117,149,181,207,207,181,149,117],b=[],c=0;c<a.length;c++)for(var e=a[c],k=0;11>k;k++)b.push(e);a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(b)};this._recordGlyph(a,0)};a.prototype.bind=function(a,c,e,k){this._textures[e]||(this._textures[e]=new b.Texture(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var h=this._textures[e];h.setSamplingMode(c);this._dirties[e]&&h.setData(this._glyphData[e]);
a.bindTexture(h,k);this._dirties[e]=!1};a.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0;this._glyphData.length=0};return a}()})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b,c,k){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===k&&(k=0);this.x=a;this.y=b;this.width=c;this.height=
k}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});a.prototype.union=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.width=Math.max(this.width,a.width);this.height=Math.max(this.height,a.height)};return a}();a.default=d})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(d,a,c){return function(){function a(a,e){this._height=this._width=0;
this._free=[];this._width=a;this._height=e;this._free.push(new c.default(0,0,a,e))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.allocate=function(a,e){if(a>this._width||e>this._height)return new c.default;for(var b=null,g=-1,h=0;h<this._free.length;++h){var n=this._free[h];a<=n.width&&e<=n.height&&(null===b||n.y<=
b.y&&n.x<=b.x)&&(b=n,g=h)}if(null===b)return new c.default;this._free.splice(g,1);b.width<b.height?(b.width>a&&this._free.push(new c.default(b.x+a,b.y,b.width-a,e)),b.height>e&&this._free.push(new c.default(b.x,b.y+e,b.width,b.height-e))):(b.width>a&&this._free.push(new c.default(b.x+a,b.y,b.width-a,b.height)),b.height>e&&this._free.push(new c.default(b.x,b.y+e,a,b.height-e)));return new c.default(b.x,b.y,a,e)};a.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var c=this._free[b];
if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)c.width+=a.width;else if(c.x===a.x&&c.width===a.width&&c.y+c.height===a.y)c.height+=a.height;else if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)c.x=a.x,c.width+=a.width;else if(a.x===c.x&&a.width===c.width&&a.y+a.height===c.y)c.y=a.y,c.height+=a.height;else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../request ../../../../core/pbf ../../../../core/promiseUtils".split(" "),
function(d,a,c,g,b,e){var k=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=b.getMessage(),e=void 0,h=void 0,n=void 0,k=void 0,g=void 0,d=void 0,m=void 0;c.next();)switch(c.tag()){case 1:e=c.getUInt32();break;case 2:h=c.getBytes();break;case 3:n=c.getUInt32();break;case 4:k=c.getUInt32();break;case 5:g=c.getSInt32();break;case 6:d=c.getSInt32();break;case 7:m=c.getUInt32();break;default:c.skip()}e&&
(this._metrics[e]={width:n,height:k,left:g,top:d,advance:m},this._bitmaps[e]=h);break;default:b.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),m=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function a(a){this._glyphInfo={};this._baseURL=a}a.prototype.getRange=
function(a,h,d){var n=this._getFontStack(a);if(n.getRange(h))return e.resolve();var m=256*h,w=m+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",m+"-"+w);return g(a,c({responseType:"array-buffer"},d)).then(function(a){n.addRange(h,new k(new b(new Uint8Array(a.data),new DataView(a.data))))})};a.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};a.prototype._getFontStack=
function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new m);return b};return a}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(d,a,c,g,b){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a){this.size=a;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.context=this.canvas.getContext("2d");this._gridOuter=
new Float64Array(a*a);this._gridInner=new Float64Array(a*a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a);a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("style","position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");document.body.appendChild(a);this._svg=a}a.prototype.draw=function(a,e,h){var n=this;void 0===h&&(h=31);var k=this._createSVGString(a);return c.create(function(a,c){var d=
new Image;d.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(k);d.onload=function(){n.context.clearRect(0,0,n.size,n.size);n.context.drawImage(d,0,0,n.size,n.size);for(var c=n.context.getImageData(0,0,n.size,n.size),e=new Uint8Array(n.size*n.size*4),k=0;k<n.size*n.size;k++){var g=c.data[4*k+3]/255;n._gridOuter[k]=1===g?0:0===g?1E20:Math.pow(Math.max(0,.5-g),2);n._gridInner[k]=1===g?1E20:0===g?0:Math.pow(Math.max(0,g-.5),2)}n._edt(n._gridOuter,n.size,n.size);n._edt(n._gridInner,n.size,
n.size);for(k=0;k<n.size*n.size;k++)b.packFloatRGBA(.5-(n._gridOuter[k]-n._gridInner[k])/(2*h),e,4*k);a(e)};var m=e&&e.signal;if(m)g.onAbort(m,function(){return c(g.createAbortError())})})};a.prototype._createSVGString=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",a);this._svg.appendChild(b);a=b.getBBox();var c=a.width/a.height,e=this.size/2,k,g,d;1<c?(g=k=e/a.width,d=this.size/4,c=e-1/c*e/2):(k=g=e/a.height,d=e-e*c/2,c=this.size/4);b.setAttribute("style",
"transform: matrix("+k+", 0, 0, "+g+", "+(-a.x*k+d)+", "+(-a.y*g+c)+")");a='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(b);return a};a.prototype._edt=function(a,b,c){for(var e=this._f,h=this._d,k=this._v,g=this._z,d=0;d<b;d++){for(var m=0;m<c;m++)e[m]=a[m*b+d];this._edt1d(e,h,k,g,c);for(m=0;m<c;m++)a[m*b+d]=h[m]}for(m=0;m<c;m++){for(d=0;d<b;d++)e[d]=a[m*b+d];this._edt1d(e,
h,k,g,b);for(d=0;d<b;d++)a[m*b+d]=Math.sqrt(h[d])}};a.prototype._edt1d=function(a,b,c,e,g){c[0]=0;e[0]=-1E20;e[1]=1E20;for(var h=1,k=0;h<g;h++){for(var n=(a[h]+h*h-(a[c[k]]+c[k]*c[k]))/(2*h-2*c[k]);n<=e[k];)k--,n=(a[h]+h*h-(a[c[k]]+c[k]*c[k]))/(2*h-2*c[k]);k++;c[k]=h;e[k]=n;e[k+1]=1E20}for(k=h=0;h<g;h++){for(;e[k+1]<h;)k++;b[h]=(h-c[k])*(h-c[k])+a[c[k]]}};return a}();a.default=d})},"esri/views/2d/engine/webgl/packingUtils":function(){define(["require","exports"],function(d,a){function c(a){return a-
Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});var g=[1,256,65536,16777216],b=[1/256,1/65536,1/16777216,1/4294967296],e=function(a,c){void 0===c&&(c=0);for(var e=0,k=0;4>k;k++)e+=a[c+k]*b[k];return e}(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(a,b,h){void 0===h&&(h=0);a=0>a?0:a>e?e:a;for(var k=0;4>k;k++)b[h+k]=Math.floor(256*c(a*g[k]))}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ../../../../core/has ../../../webgl ./GeometryUtils ./Rect ./RectangleBinPack".split(" "),
function(d,a,c,g,b,e,k){return function(){function a(a,b,e){void 0===e&&(e=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._currentPage=this._maxItemSize=0;this._fixSpriteLocationsTable=c("fix-sprite-locations");this._pageHeight=this._pageWidth=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=b;0<e&&(this._maxItemSize=
e);this.pixelRatio=window.devicePixelRatio||1;if(this._fixSpriteLocationsTable){a=[];for(var h in this._fixSpriteLocationsTable)b=this._fixSpriteLocationsTable[h],a[b.page]=b.pageSize;for(h=0;h<a.length;h++)b=a[h],this._mosaicsData.push(new Uint32Array(b[0]*b[1])),this._dirties.push(!0),this._size.push([b[0],b[1]]),this._textures.push(void 0)}this._binPack=new k(this._pageWidth-4,this._pageHeight-4);this._mosaicsData.push(new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight)));
this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}a.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};a.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};a.prototype.getPage=function(a){return a<this._textures.length?this._textures[a]:null};a.prototype.has=function(a){return this._mosaicRects.has(a)};Object.defineProperty(a.prototype,"itemCount",{get:function(){return this._mosaicRects.size},
enumerable:!0,configurable:!0});a.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};a.prototype.addSpriteItem=function(a,b,c,e,k,g){var h;if(this._mosaicRects.has(a))return this._mosaicRects.get(a);var d,n;this._fixSpriteLocationsTable&&this._fixSpriteLocationsTable[a]?(h=this._fixSpriteLocationsTable[a],d=h.rect,n=h.page,h=h.pageSize):(h=this._allocateImage(b[0],b[1]),d=h[0],n=h[1],h=h[2]);if(0>=d.width||0>=d.height)return null;g={rect:d,width:b[0],height:b[1],sdf:k,simplePattern:g,
pixelRatio:1,page:n};this._mosaicRects.set(a,g);this._copy({rect:d,spriteSize:b,spriteData:c,page:n,pageSize:h,repeat:e,sdf:k});return g};a.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};a.prototype.processNextItem=function(){var a=this._spriteCopyQueue.pop();a&&this._copy(a)};a.prototype.getSpriteItems=function(a){for(var b={},c=0;c<a.length;c++){var e=a[c];b[e]=this.getSpriteItem(e)}return b};a.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a))&&
a.rect;if(!b)return null;b.width=a.width;b.height=a.height;return{size:[a.width,a.height],tl:[(b.x+1)/this._size[a.page][0],(b.y+1)/this._size[a.page][1]],br:[(b.x+1+a.width)/this._size[a.page][0],(b.y+1+a.height)/this._size[a.page][1]],page:a.page}};a.prototype.bind=function(a,b,c,e){void 0===c&&(c=0);void 0===e&&(e=0);this._textures[c]||(this._textures[c]=new g.Texture(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));
var h=this._textures[c];h.setSamplingMode(b);this._dirties[c]&&(h.setData(new Uint8Array(this._mosaicsData[c].buffer)),h.generateMipmap());a.bindTexture(h,e);this._dirties[c]=!1};a._copyBits=function(a,b,c,e,k,g,d,m,r,v,B){var f=e*b+c;d=m*g+d;if(B)for(d-=g,B=-1;B<=v;B++,f=((B+v)%v+e)*b+c,d+=g)for(m=-1;m<=r;m++)k[d+m]=a[f+(m+r)%r];else for(B=0;B<v;B++){for(m=0;m<r;m++)k[d+m]=a[f+m];f+=b;d+=g}};a.prototype._copy=function(b){if(!(b.page>=this._mosaicsData.length)){var c=b.spriteData,e=this._mosaicsData[b.page];
e&&c||console.error("Source or target images are uninitialized!");a._copyBits(c,b.spriteSize[0],0,0,e,b.pageSize[0],b.rect.x+1,b.rect.y+1,b.spriteSize[0],b.spriteSize[1],b.repeat);this._dirties[b.page]=!0}};a.prototype._allocateImage=function(a,c){a+=2;c+=2;var h=Math.max(a,c);if(this._maxItemSize&&this._maxItemSize<h){var h=Math.pow(2,Math.ceil(b.log2(a))),g=Math.pow(2,Math.ceil(b.log2(c)));a=new e.default(0,0,a,c);this._mosaicsData.push(new Uint32Array(h*g));this._dirties.push(!0);this._size.push([h,
g]);this._textures.push(void 0);return[a,this._mosaicsData.length-1,[h,g]]}h=this._binPack.allocate(a+(a%4?4-a%4:0),c+(c%4?4-c%4:0));return 0>=h.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new k(this._pageWidth-4,this._pageHeight-
4),this._allocateImage(a,c)):[h,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0;this._mosaicsData.length=0;this._mosaicRects.clear()};return a}()})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(d,a){function c(a,c){a%=c;return 0<=a?a:a+c}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;
a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var g=1/Math.LN2;a.positiveMod=c;a.radToByte=function(b){return c(b*a.C_RAD_TO_256,256)};a.degToByte=function(b){return c(b*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*g};a.sqr=function(a){return a*a};a.interpolate=function(a,c,k){return a*(1-k)+c*k};a.between=function(a,c,k){return a>=
c&&a<=k||a>=k&&a<=c}})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/Logger ../../../../core/screenUtils ../../../../symbols/cim/enums ../../../webgl ./color ./enums ./SymbolProperties ../../support/mathUtils".split(" "),function(d,a,c,g,b,e,k,m,h,n,u,x){function C(a){for(var b={},c=0;c<a.length;c++){var f=a[c];b[f.name]=f.strideInBytes}return b}function t(a){switch(a){case n.WGLGeometryType.MARKER:return l;
case n.WGLGeometryType.FILL:return D;case n.WGLGeometryType.LINE:return A;case n.WGLGeometryType.TEXT:return G;case n.WGLGeometryType.LABEL:return E}return null}function w(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function z(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}
function r(a){return"string"===typeof a}function v(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5126:case 5124:case 5125:return 4}}function B(a){var b={},f=function(f){var e=0;b[f]=a[f].map(function(a){var b=c({},a,{normalized:a.normalized||!1,divisor:a.divisor||0,offset:e,stride:0});e+=a.count*v(a.type);return b});b[f].forEach(function(a){return a.stride=e})},e;for(e in a)f(e);return b}Object.defineProperty(a,"__esModule",{value:!0});var f,y=b.getLogger("esri.views.2d.engine.webgl.Utils");
a.C_HITTEST_SEARCH_SIZE=4;a.C_VBO_GEOMETRY="geometry";a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV="per_instance_vv";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0}];a.C_FILL_VERTEX_DEF_DD=[{name:a.C_VBO_GEOMETRY,strideInBytes:12,divisor:0}];a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0}];a.C_LABEL_VERTEX_DEF=
[{name:a.C_VBO_GEOMETRY,strideInBytes:28,divisor:0}];a.C_ICON_STRIDE_SPEC=C(a.C_ICON_VERTEX_DEF);a.C_FILL_STRIDE_SPEC=C(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_DD=C(a.C_FILL_VERTEX_DEF_DD);a.C_LINE_STRIDE_SPEC=C(a.C_LINE_VERTEX_DEF);a.C_TEXT_STRIDE_SPEC=C(a.C_TEXT_VERTEX_DEF);a.C_LABEL_STRIDE_SPEC=C(a.C_LABEL_VERTEX_DEF);a.getStrides=function(b,c){switch(b){case n.WGLGeometryType.MARKER:return a.C_ICON_STRIDE_SPEC;case n.WGLGeometryType.FILL:return c?a.C_FILL_STRIDE_SPEC_DD:a.C_FILL_STRIDE_SPEC;
case n.WGLGeometryType.LINE:return a.C_LINE_STRIDE_SPEC;case n.WGLGeometryType.TEXT:return a.C_TEXT_STRIDE_SPEC;case n.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}return null};var l=[a.C_VBO_GEOMETRY],D=[a.C_VBO_GEOMETRY],A=[a.C_VBO_GEOMETRY],G=[a.C_VBO_GEOMETRY],E=[a.C_VBO_GEOMETRY];a.getNamedBuffers=t;a.strideToPackingFactor=w;a.allocateTypedArrayBuffer=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(a*b/4));case 1:case 3:return new Uint8Array(a*b)}};a.allocateTypedArrayBufferwithData=
function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};a.normalizeSymbolType=z;a.isMarkerSymbol=function(a){if(a=z(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0;case "CIMVectorMarker":case "CIMPictureMarker":case "CIMCharacterMarker":return!0}return!1}};a.isFillSymbol=function(a){if(a=z(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}};
a.isLineSymbol=function(a){if(a=z(a.type)){switch(a){case "simple-line":case "picture-line":return!0;case "CIMLineSymbol":return!0}return!1}};a.isPictureSymbol=function(a){if(a=z(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0;case "CIMPictureMarker":return!0}return!1};a.isTextSymbol=function(a){if(a=z(a.type)){switch(a){case "text":return!0;case "CIMTextSymbol":return!0}return!1}};a.getTextProperties=function(a){return u.TextProperties.pool.acquire(a.color?
h.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?h.copyAndPremultiply(a.haloColor):[255,255,255,255],e.pt2px(a.haloSize),e.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};a.isDefined=function(a){return null!=a};a.isNumber=function(a){return"number"===typeof a};a.isString=r;a.isStringOrNull=function(a){return null==a||
r(a)};a.lerp=function(a,b,c){return a+(b-a)*c};d=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.KeysGetter=d;d=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};
return a}();a.ValuesGetter=d;a.getCapType=function(a,b){switch(a){case "butt":return k.CapType.BUTT;case "round":return b?k.CapType.SQUARE:k.CapType.ROUND;case "square":return k.CapType.SQUARE;default:return y.error(new g("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),k.CapType.ROUND}};a.getJoinType=function(a){switch(a){case "miter":return k.JoinType.MITER;case "bevel":return k.JoinType.BEVEL;case "round":return k.JoinType.ROUND;default:return y.error(new g("mapview-invalid-type",
"Join type "+a+" is not a valid option. Defaulting to round")),k.JoinType.ROUND}};a.getVVType=function(a){switch(a){case "opacity":return n.VVType.OPACITY;case "color":return n.VVType.COLOR;case "rotation":return n.VVType.ROTATION;case "size":return n.VVType.SIZE;default:return y.error("Cannot interpret unknown vv: "+a),null}};a.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};a.copyMeshData=function(a,b,c,f,e,l,h){for(var k in l)for(var g=l[k].stride,d=w(g),n=
l[k].data,m=c[k].data,r=g*e.vertexCount/d,t=g*a/d,d=g*e.vertexFrom/d,g=0;g<r;++g)m[g+t]=n[g+d];c=e.indexCount;for(g=0;g<c;++g)f[g+b]=h[g+e.indexFrom]-e.vertexFrom+a};a.C_VBO_INFO=(f={},f[a.C_VBO_GEOMETRY]=35044,f);a.createGeometryData=function(a,b){for(var c=[],f=0;5>f;++f){for(var e={},l=0,h=t(f);l<h.length;l++){var g=h[l];e[g]={data:b(f,g)}}c.push({data:a(f),buffers:e})}return c};a.resampleHermite=function(a,b,c,f,e,l,h){void 0===h&&(h=!0);var g=b/e;c/=l;for(var k=Math.ceil(g/2),d=Math.ceil(c/2),
n=0;n<l;n++)for(var m=0;m<e;m++){for(var r=4*(m+(h?l-n-1:n)*e),t=0,w=0,y=0,v=0,u=0,E=0,B=0,C=(n+.5)*c,z=Math.floor(n*c);z<(n+1)*c;z++)for(var D=Math.abs(C-(z+.5))/d,A=(m+.5)*g,D=D*D,x=Math.floor(m*g);x<(m+1)*g;x++){var G=Math.abs(A-(x+.5))/k,t=Math.sqrt(D+G*G);-1<=t&&1>=t&&(t=2*t*t*t-3*t*t+1,0<t&&(G=4*(x+z*b),B+=t*a[G+3],y+=t,255>a[G+3]&&(t=t*a[G+3]/250),v+=t*a[G],u+=t*a[G+1],E+=t*a[G+2],w+=t))}f[r]=v/w;f[r+1]=u/w;f[r+2]=E/w;f[r+3]=B/y}};a.createTextureFromTexelData=function(a,b){var c,f;x.isPowerOfTwo(b.width)&&
x.isPowerOfTwo(b.height)?(c=!0,f=9987):(c=!1,f=9729);return new m.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,hasMipmap:c,samplingMode:f,wrapMode:33071,flipped:!0},b)};a.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}};a.getBytes=v;a.getPixelBytes=function(a){switch(a){case 5121:return 1;case 32819:return 2;case 5126:return 4;default:y.error(new g("webgl-utils","Unable to handle type "+a))}};a.getPixelArrayCtor=function(a){switch(a){case 5121:return Uint8Array;
case 32819:return Uint16Array;case 5126:return Float32Array;default:y.error(new g("webgl-utils","Unable to handle type "+a))}};var N=new Map;a.createProgramDescriptor=function(a,b){if(!N.has(a)){var c=B(b),f={},e;for(e in c){var l=c[e];f[e]=l.length?l[0].stride:0}e={};for(var h in b)for(var l=0,g=b[h];l<g.length;l++){var k=g[l];e[k.name]=k.location}N.set(a,{strides:f,bufferLayouts:c,attributes:e})}return N.get(a)}})},"esri/symbols/cim/enums":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,
"__esModule",{value:!0});(function(a){a[a.BUTT=0]="BUTT";a[a.ROUND=1]="ROUND";a[a.SQUARE=2]="SQUARE";a[a.UNKNOWN=4]="UNKNOWN"})(a.CapType||(a.CapType={}));(function(a){a[a.BEVEL=0]="BEVEL";a[a.ROUND=1]="ROUND";a[a.MITER=2]="MITER";a[a.UNKNOWN=4]="UNKNOWN"})(a.JoinType||(a.JoinType={}));(function(a){a[a.SCREEN=0]="SCREEN";a[a.MAP=1]="MAP"})(a.Alignment||(a.Alignment={}))})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(d,a,c){function g(a,b){Array.isArray(b)?
(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):(a[0]=b.r,a[1]=b.g,a[2]=b.b,a[3]=b.a);return a}function b(a,b,c){void 0===b&&(b=0);void 0===c&&(c=!1);var e=a[b+3];a[b+0]*=e;a[b+1]*=e;a[b+2]*=e;c||(a[b+3]*=255);return a}Object.defineProperty(a,"__esModule",{value:!0});a.white=[255,255,255,1];var e=[0,0,0,0];a.premultiplyAlpha=b;a.copyAndPremultiply=function(a){return b(g([],a))};a.premultiplyAlphaUint32=function(a){b(g(e,a));return c.i8888to32(e[0],e[1],e[2],e[3])};a.premultiplyAlphaRGBA=function(a){var b=
a.a;return c.i8888to32(a.r*b,a.g*b,a.b*b,255*b)}})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(d,a){function c(a,b,c){return Math.round(Math.max(Math.min(a,c),b))}Object.defineProperty(a,"__esModule",{value:!0});var g=new Float32Array(1),b=new Uint32Array(g.buffer);a.i8=function(a){return c(a,-128,127)};a.i16=function(a){return c(a,-32768,32767)};a.i32=function(a){return c(a,-2147483648,2147483647)};a.u8=function(a){return c(a,0,255)};a.u16=function(a){return c(a,
0,65535)};a.u32=function(a){return c(a,0,4294967295)};a.nextHighestPowerOfTwo=function(a){var b=a;b--;b|=b>>1;b|=b>>2;b|=b>>4;b|=b>>8;b|=b>>16;b++;var c=b>>1;return b-a>a-c?c:b};a.toUint32=function(a){g[0]=a;return b[0]};a.toFloat32=function(a){b[0]=a;return g[0]};a.i1616to32=function(a,b){return 65535&a|b<<16};a.i8888to32=function(a,b,c,h){return a&255|(b&255)<<8|(c&255)<<16|h<<24};a.i8816to32=function(a,b,c){return a&255|(b&255)<<8|c<<16};a.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require",
"exports","../../../../core/ObjectPool"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}a.prototype.acquire=function(a,c,g,d,h,n,u,x,C){this.color=a;this.haloColor=c;this.haloSize=g;this.size=d;this.angle=h;this.offsetX=n;this.offsetY=u;this.hAnchor=x;this.vAnchor=C};a.prototype.release=function(){this.color[0]=this.color[1]=
this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};a.pool=new c(a);return a}();a.TextProperties=d})},"esri/views/2d/support/mathUtils":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.isPowerOfTwo=function(a){return 0===(a&a-1)};a.sign=Math.sign||function(a){return+(0<a)-+(0>a)||+a};a.log2=Math.log2||function(a){return Math.log(a)/
Math.LN2}})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});a.ok=function(a,b){return a&&"name"in a?(b&&b.error(new c(a.name,a.message,a.details)),!1):!0}})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../webgl"],function(d,a,c,g){return function(){function a(a,b){this.rctx=a;this._vertexBuffer=
g.BufferObject.createVertex(a,35044,new Uint16Array(b));this._vao=new g.VertexArrayObject(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:this._vertexBuffer})}a.prototype.bind=function(){this._vao.bind()};a.prototype.unbind=function(){this._vao.unbind()};a.prototype.dispose=function(){this._vao.dispose(!1);this._vertexBuffer.dispose()};a.prototype.draw=function(){this.rctx.drawArrays(5,0,4)};return a}()})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms".split(" "),
function(d,a,c,g,b,e,k,m,h,n){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function d(){var b=a.call(this)||this;b._initialized=!1;b._color=g.vec4f32.fromValues(1,0,0,1);b._maxWidth=0;return b}c(d,a);d.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=
null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);this._canvas=null};d.prototype.draw=function(a,b){a=a.context;if(b.isReady){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",b.dvsMat3);this._outlineProgram.setUniform1f("u_coord_range",e.TILE_SIZE);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",
this._color);a.drawArrays(3,0,4);a.bindVAO();var c=this._getTexture(a,b);c&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),a.bindTexture(c,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",b.dvsMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,0,4),
a.bindVAO())}};d.prototype._initialize=function(a){if(this._initialized)return!0;var c=b.createProgram(a,h.background),e=b.createProgram(a,n.tileInfo),g={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},d=new Int8Array([0,0,1,0,1,1,0,1]),d=b.BufferObject.createVertex(a,35044,d),d=new b.VertexArrayObject(a,h.background.attributes,g,{geometry:d}),k=new Int8Array([0,0,1,0,0,1,1,1]),k=b.BufferObject.createVertex(a,35044,k);a=new b.VertexArrayObject(a,n.tileInfo.attributes,
g,{geometry:k});this._outlineProgram=c;this._tileInfoProgram=e;this._outlineVertexArrayObject=d;this._tileInfoVertexArrayObject=a;return this._initialized=!0};d.prototype._getTexture=function(a,c){if(c.texture)return c.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var e=c.key.id,h=this._canvas.getContext("2d");
h.font="24px sans-serif";h.textAlign="left";h.textBaseline="middle";var g=h.measureText(e),g=Math.pow(2,Math.ceil(k.log2(g.width+2)));g>this._maxWidth&&(this._maxWidth=g);h.clearRect(0,0,this._maxWidth,32);h.fillStyle="blue";h.fillText(e,0,16);c.texture=new b.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return c.texture};return d}(m.default);a.default=d})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,
"__esModule",{value:!0});d=function(){return function(){}}();a.default=d})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});a.background={name:"background",shaders:{vertexShader:c.resolveIncludes("background/background.vert"),fragmentShader:c.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require",
"exports","./sources/resolver"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});a.tileInfo={name:"tileInfo",shaders:{vertexShader:c.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:c.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../webgl ../definitions ./WGLBrush ../shaders/BackgroundPrograms".split(" "),
function(d,a,c,g,b,e,k,m){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function h(){var b=a.call(this)||this;b._color=g.vec4f32.fromValues(1,0,0,1);b._initialized=!1;return b}c(h,a);h.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};h.prototype.draw=function(a,b){a=a.context;this._initialized||this._initialize(a);a.setStencilFunctionSeparate(1032,
519,b.stencilRef,255);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",b.dvsMat3);this._solidProgram.setUniform1f("u_coord_range",e.TILE_SIZE);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);a.drawArrays(5,0,4);a.bindVAO()};h.prototype._initialize=function(a){if(this._initialized)return!0;var c=b.createProgram(a,m.background);if(!c)return!1;var e=new Int8Array([0,0,1,0,
0,1,1,1]),e=b.BufferObject.createVertex(a,35044,e);a=new b.VertexArrayObject(a,m.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:e});this._solidProgram=c;this._solidVertexArrayObject=a;return this._initialized=!0};return h}(k.default);a.default=d})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/RandomLCG ../../../../webgl ../definitions ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function g(){var b=null!==a&&a.apply(this,arguments)||this;b._dotTextureSize=0;b._dotTextures=null;b._dotSamplers=new Int32Array([k.TEXTURE_BINDING_RENDERER_0,k.TEXTURE_BINDING_RENDERER_1]);return b}c(g,a);g.prototype.dispose=function(){this._disposeTextures()};g.prototype.getGeometryType=function(){return m.WGLGeometryType.FILL};g.prototype.drawGeometry=function(a,b,c,e){var g=a.context,d=a.painter,f=a.rendererInfo,
n=a.requiredLevel,l=a.drawPhase,m=c.indexCount,r=c.indexFrom;c=u.FillMaterialKey.load(c.materialKey);var t=h.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121}].concat(c.dotDensity?[]:[{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_tlbr",count:4,type:5123},{location:4,name:"a_aux1",count:4,type:5121},{location:5,name:"a_aux2",count:2,type:5123},{location:6,name:"a_aux3",count:4,type:5121}],
c.dotDensity?[{location:2,name:"a_inverseArea",count:1,type:5126}]:[])}),l=d.materialManager.getProgram(c,l,f,"fill",t.attributes);g.bindProgram(l);e=this._getVAO(g,t.bufferLayouts,t.attributes,e);g.bindVAO(e);this._setSharedUniforms(l,a,b);c.textureBinding&&(d.textureManager.bindTextures(g,l,c),d=1/Math.pow(2,n-b.key.level)/a.pixelRatio,l.setUniform1f("u_zoomFactor",d));c.vvColor&&(l.setUniform1fv("u_vvColorValues",f.vvColorValues),l.setUniform4fv("u_vvColors",f.vvColors));c.vvOpacity&&(l.setUniform1fv("u_vvOpacityValues",
f.vvOpacityValues),l.setUniform1fv("u_vvOpacities",f.vvOpacities));c.dotDensity&&(c=k.TILE_SIZE/f.ddDotSize,e=c*window.devicePixelRatio*c*window.devicePixelRatio,d=1/Math.pow(2,n-b.key.level),b=1/d*(1/d),a=f.ddDotScale?a.state.scale/f.ddDotScale:1,l.setUniform1f("u_tileZoomFactor",d),l.setUniform1f("u_tileDotsOverArea",e/(k.TILE_SIZE*window.devicePixelRatio*k.TILE_SIZE*window.devicePixelRatio)),l.setUniformMatrix4fv("u_dotColors",f.ddColors),l.setUniform4fv("u_isActive",f.ddActiveDots),l.setUniform4fv("u_dotBackgroundColor",
f.ddBackgroundColor),l.setUniform1f("u_dotValue",Math.max(1,f.ddDotValue*a*b)),this._bindDotDensityTextures(g,l,f,c));g.drawElements(4,m,5125,4*r);g.bindVAO(null)};g.prototype._disposeTextures=function(){if(this._dotTextures){for(var a=0;a<this._dotTextures.length;a++)this._dotTextures[a].dispose();this._dotTextures=null}};g.prototype._bindDotDensityTextures=function(a,b,c,e){c=this._createDotDensityTextures(a,e,c.ddSeed);b.setUniform1iv("u_dotTextures",this._dotSamplers);for(b=0;b<c.length;b++)a.bindTexture(c[b],
this._dotSamplers[b])};g.prototype._createDotDensityTextures=function(a,c,e){if(this._dotTextureSize!==c||this._seed!==e)this._disposeTextures(),this._dotTextureSize=c,this._seed=e;null===this._dotTextures&&(e=new b(e),this._dotTextures=[this._allocDotDensityTexture(a,c,e),this._allocDotDensityTexture(a,c,e)]);return this._dotTextures};g.prototype._allocDotDensityTexture=function(a,b,c){for(var h=new Float32Array(b*b*4),g=0;g<h.length;g++)h[g]=c.getFloat();return new e.Texture(a,{wrapMode:10497,pixelFormat:6408,
dataType:5126,samplingMode:9728,width:b,height:b},h)};return g}(n.default);a.default=d})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../definitions ./WGLBrush".split(" "),function(d,a,c,g,b,e){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}c(e,a);e.prototype.draw=function(a,b){var c=this;if(b.canDisplay){var e=this.getGeometryType(),
h=b.getDisplayList(a.drawPhase);if(h){var g=b.getGeometry(e);g&&h.byType(e,function(e){c.drawGeometry(a,b,e,g)})}}};e.prototype._getVAO=function(a,b,c,e){e.vao||(e.vao=new g.VertexArrayObject(a,c,b,e.vertexBufferMap,e.indexBuffer));return e.vao};e.prototype._setSharedUniforms=function(a,c,e){a.setUniform1f("u_pixelRatio",c.pixelRatio);a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3);a.setUniformMatrix3fv("u_displayViewMat3",c.state.displayViewMat3);a.setUniformMatrix4fv("u_insideEffectMat4",c.rendererInfo.insideEffect);
a.setUniformMatrix4fv("u_outsideEffectMat4",c.rendererInfo.outsideEffect);a.setUniform1fv("u_insideOpacities",c.rendererInfo.insideOpacities);a.setUniform1fv("u_outsideOpacities",c.rendererInfo.outsideOpacities);a.setUniform1i("u_attributeTextureSize",c.attributeView.size);a.setUniform1i("u_attributeData0",b.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.setUniform1i("u_attributeData1",b.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.setUniform1i("u_attributeData2",b.TEXTURE_BINDING_ATTRIBUTE_DATA_2)};return e}(e.default);
a.default=d})},"esri/views/2d/engine/webgl/materialKey/MaterialKey":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Error ../../../../../core/maybe ../enums ../mesh/templates/WGLLabelTemplate ../util/vvFlagUtils".split(" "),function(d,a,c,g,b,e,k,m,h,n){Object.defineProperty(a,"__esModule",{value:!0});a.createMaterialKey=function(a,b,c,e){if(k.isSome(b)){a:{if("heatmap"===b.type)throw Error("Symbol processor does not support heatmap renderer");
switch(a){case m.WGLGeometryType.FILL:a=t.from(b);break a;case m.WGLGeometryType.LINE:a=z.from(b,c);break a;case m.WGLGeometryType.MARKER:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Marker GeometryTypes");a=w.from(b);break a;case m.WGLGeometryType.TEXT:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Text GeometryTypes");a=r.from(b);break a;case m.WGLGeometryType.LABEL:if("dot-density"===b.type)throw Error("Dot Density renderer does not support Label GeometryTypes");
a=v.from(b,e);break a;default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}}return a}switch(a){case m.WGLGeometryType.FILL:return t.from(null);case m.WGLGeometryType.LINE:return z.from(null,c);case m.WGLGeometryType.MARKER:return w.from(null);case m.WGLGeometryType.TEXT:return r.from(null);case m.WGLGeometryType.LABEL:return v.from(null,e);default:throw Error("Unable to createMaterialKey for unknown geometryType "+a);}};d=function(){function a(a){this._data=0;this._data=
a}a.load=function(a){var b=this.shared;b.data=a;return b};Object.defineProperty(a.prototype,"data",{get:function(){return this._data},set:function(a){this._data=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryType",{get:function(){return this.bits(5,8)},set:function(a){this.setBits(a,5,8)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"mapAligned",{get:function(){return!!this.bit(17)},set:function(a){this.setBit(17,a)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"sdf",{get:function(){return!!this.bit(8)},set:function(a){this.setBit(8,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"pattern",{get:function(){return!!this.bit(9)},set:function(a){this.setBit(9,a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"textureBinding",{get:function(){return this.bits(0,5)},set:function(a){this.setBits(a,0,5)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"geometryTypeString",
{get:function(){switch(this.geometryType){case m.WGLGeometryType.FILL:return"fill";case m.WGLGeometryType.MARKER:return"marker";case m.WGLGeometryType.LINE:return"line";case m.WGLGeometryType.TEXT:return"text";case m.WGLGeometryType.LABEL:return"label";default:throw new e("Unable to handle unknown geometryType: "+this.geometryType);}},enumerable:!0,configurable:!0});a.prototype.setBit=function(a,b){a=1<<a;this._data=b?this._data|a:this._data&~a};a.prototype.bit=function(a){return(this._data&1<<a)>>
a};a.prototype.setBits=function(a,b,c){for(var f=0;b<c;b++,f++)this.setBit(b,0!==(a&1<<f))};a.prototype.bits=function(a,b){for(var c=0,f=0;a<b;a++,f++)c|=this.bit(a)<<f;return c};a.prototype.hasVV=function(){return!1};a.prototype.setVV=function(a,b){};a.prototype.getVariation=function(){var a={},b;for(b in this)"boolean"===typeof this[b]&&(a[b]=this[b]);return a};a.prototype.getVariationHash=function(){return this._data&~(4&this.textureBinding)};a.shared=new a(0);return a}();a.MaterialKeyBase=d;g=
function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);Object.defineProperty(b.prototype,"vvSizeMinMaxValue",{get:function(){return 0!==this.bit(13)},set:function(a){this.setBit(13,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeScaleStops",{get:function(){return 0!==this.bit(14)},set:function(a){this.setBit(14,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeFieldStops",{get:function(){return 0!==
this.bit(15)},set:function(a){this.setBit(15,a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vvSizeUnitValue",{get:function(){return 0!==this.bit(16)},set:function(a){this.setBit(16,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);b&=n.getSizeFlagsMask(b,c);this.vvSizeMinMaxValue=
!!(b&m.WGLVVFlag.SIZE_MINMAX_VALUE);this.vvSizeFieldStops=!!(b&m.WGLVVFlag.SIZE_FIELD_STOPS);this.vvSizeUnitValue=!!(b&m.WGLVVFlag.SIZE_UNIT_VALUE);this.vvSizeScaleStops=!!(b&m.WGLVVFlag.SIZE_SCALE_STOPS)};return b}(a)};var u=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);Object.defineProperty(b.prototype,"vvRotation",{get:function(){return 0!==this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||
this.vvRotation};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvRotation=!c&&!!(b&m.WGLVVFlag.ROTATION)};return b}(a)},x=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);Object.defineProperty(b.prototype,"vvColor",{get:function(){return 0!==this.bit(10)},set:function(a){this.setBit(10,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvColor};b.prototype.setVV=function(b,
c){a.prototype.setVV.call(this,b,c);this.vvColor=!c&&!!(b&m.WGLVVFlag.COLOR)};return b}(a)},C=function(a){return function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);Object.defineProperty(b.prototype,"vvOpacity",{get:function(){return 0!==this.bit(11)},set:function(a){this.setBit(11,a)},enumerable:!0,configurable:!0});b.prototype.hasVV=function(){return a.prototype.hasVV.call(this)||this.vvOpacity};b.prototype.setVV=function(b,c){a.prototype.setVV.call(this,b,c);this.vvOpacity=
!c&&!!(b&m.WGLVVFlag.OPACITY)};return b}(a)},t=function(a){function f(){return null!==a&&a.apply(this,arguments)||this}c(f,a);f.load=function(a){var b=this.shared;b.data=a;return b};f.from=function(a){var c=this.load(0);c.geometryType=m.WGLGeometryType.FILL;k.isSome(a)&&(a instanceof b.DotDensityRenderer?c.dotDensity=!0:(a=n.getVVFlags(a.visualVariables),c.setVV(a,!1)));return c.data};f.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};Object.defineProperty(f.prototype,
"dotDensity",{get:function(){return!!this.bit(12)},set:function(a){this.setBit(12,a)},enumerable:!0,configurable:!0});f.shared=new f(0);return f}(x(C(d)));a.FillMaterialKey=t;var w=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=m.WGLGeometryType.MARKER;k.isSome(a)&&(a=n.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};
b.shared=new b(0);return b}(x(C(u(g(d)))));a.MarkerMaterialKey=w;var z=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var c=this.load(0);c.geometryType=m.WGLGeometryType.LINE;k.isSome(a)&&(a=n.getVVFlags(a.visualVariables),c.setVV(a,b));return c.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(x(C(g(d))));a.LineMaterialKey=z;
var r=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a){var b=this.load(0);b.geometryType=m.WGLGeometryType.TEXT;k.isSome(a)&&(a=n.getVVFlags(a.visualVariables),b.setVV(a,!1));return b.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(x(C(u(g(d)))));a.TextMaterialKey=r;var v=function(a){function b(){return null!==a&&a.apply(this,arguments)||
this}c(b,a);b.load=function(a){var b=this.shared;b.data=a;return b};b.from=function(a,b){var c=this.load(0);c.geometryType=m.WGLGeometryType.LABEL;k.isSome(a)&&(a=n.getVVFlags(a.visualVariables),c.setVV(a,!1));c.mapAligned=!!h.isMapAligned(b.labelPlacement);return c.data};b.prototype.getVariation=function(){return a.prototype.getVariation.call(this)};b.shared=new b(0);return b}(g(d));a.LabelMaterialKey=v})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/mathUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../vectorTiles/GeometryUtils ../../color ../../definitions ../../enums ../../number ../../TextShaping ../../collisions/Metric ../../materialKey/MaterialKey ./GlyphGroup ./util ./WGLTextTemplate ../../../../support/mathUtils".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f,y,l){function D(a){switch(a){case "above-left":return[-1,-1];case "above-center":case "above-along":return[0,-1];case "above-right":return[1,-1];case "center-left":return[-1,0];case "center-center":case "center-along":return[0,0];case "center-right":return[1,0];case "below-left":return[-1,1];case "below-center":case "below-along":return[0,1];case "below-right":return[1,1];case "always-horizontal":return[0,0];default:L("Found invalid placement type "+
a)}}Object.defineProperty(a,"__esModule",{value:!0});var A=b.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),G=n.vec2f32.create(),E=m.mat2df32.create(),N={xOffset:0,yOffset:0,width:0,height:0},L=function(a,b){void 0===b&&(b="mapview-labeling");return A.error(new g(b,a))};a.isMapAligned=function(a){switch(a){case "above-along":case "below-along":case "center-along":return 1;default:return 0}};d=function(a){function b(b,c,f,l){f=a.call(this,b,f.font.size,f.haloSize||0,f.color&&x.premultiplyAlphaRGBA(f.color)||
0,f.haloColor&&x.premultiplyAlphaRGBA(f.haloColor)||0,f.horizontalAlignment,f.verticalAlignment,f.font.decoration,f.angle||0,f.xoffset,f.yoffset,f.id)||this;f._refTemplate=N;f.geometryType=t.WGLGeometryType.LABEL;var h=c.symbol,g;g=!!c.minScale&&l.scaleToZoom(c.minScale)||0;g=e.clamp(g,0,25.5);l=!!c.maxScale&&l.scaleToZoom(c.maxScale)||255;l=e.clamp(l,0,25.5);var d=D(c.labelPlacement),k=d[0],d=d[1];f._justify=(-1*k+1)/2;f._xAlignD=k;f._yAlignD=d;f._xPlacementD=k;f._yPlacementD=d;f._minZoom=g;f._maxZoom=
l;b=v.LabelMaterialKey.load(v.createMaterialKey(f.geometryType,b,!1,c));b.sdf=!0;f._materialKey=b.data;b=h.font.decoration.toLowerCase();"underline"===b?f._decorationTop=6:"line-through"===b&&(f._decorationTop=-5);return f}c(b,a);b.fromLabelClass=function(a,c,f){return new b(a,c,c.symbol,f)};b.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);isNaN(this._decorationTop)||z.TextShaping.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=
z.TextShaping.getBox(a)};b.prototype._computeShaping=function(a,b){return new z.TextShaping([a],C.TEXT_MAX_WIDTH,C.TEXT_LINE_HEIGHT,C.TEXT_SPACING,[0,0],.5,.5,b)};Object.defineProperty(b.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0});b.prototype.bindReferenceTemplate=function(a){this._refTemplate=a||N};b.prototype._placeGlyphs=function(a,b,c,f){var e=this._size,h=this._haloSize,g=this._shapedBox,d=this._shapedGlyphs,k=this._computeGlyphTransform(g);if("esriGeometryPolyline"!==
a)for(var n=0;n<c.length;n++)for(var m=c[n],r=0,t=d;r<t.length;r++){var w=t[r];m.place(w,a,b,k,this._materialKey,e,h,g,f,this._minZoom,this._maxZoom)}else for(n=0;n<c.length;n++)for(var m=c[n],r=w=m.order,t=r-(r-1)/2-1,E=t-(t-1)/2-1,v=E-(E-1)/2-1,w=-1===w?0:r%2?t%2?E%2?v%2?0:f-3.1:f-2.1:f-1.1:f-.1,r=Math.max(f+l.log2((this._shapedBox.width*this._scale+48)/m.pathLen),Math.max(w,this._minZoom)),t=0,E=d;t<E.length;t++)w=E[t],m.place(w,a,b,k,this._materialKey,e,h,g,f,r,this._maxZoom)};b.prototype.writeMesh=
function(a,b,c,f,e,l,h){var g=this,d=this._computeAnchors(c,e),k=w.i8888to32(0,0,0,this._bitset);if(d.length&&this._shapedGlyphs.length){this._placeGlyphs(c,e,d,l);var n=v.LabelMaterialKey.load(this._materialKey);if("esriGeometryPolyline"!==c){c=d[0];e=this._computeGlyphTransform(this._shapedBox);e=this._createBounds(this._shapedBox,e);l=c.glyphs.get(0);var m=l[0],t=m.anchorX,E=m.anchorY,u=Math.floor(10*m.minZoom),m=Math.floor(10*m.maxZoom),y=a.length;l.forEach(function(a){a.minZoom=25.5;a.maxZoom=
25.5});y=new r.default(f,{from:y,count:a.length-y},t,E,u);t=Math.floor(t/C.COLLISION_BUCKET_SIZE);E=Math.floor(E/C.COLLISION_BUCKET_SIZE);t>=C.COLLISION_TILE_BOX_SIZE||E>=C.COLLISION_TILE_BOX_SIZE||0>t||0>E||(this._writeVertices(a,b,f,l,n,k,u,m),l=Math.max(this._refTemplate.height,this._refTemplate.width),n.vvSizeFieldStops||n.vvSizeMinMaxValue||n.vvSizeScaleStops||n.vvSizeUnitValue?y.setVV(l,this._xPlacementD,this._yPlacementD):(y.offsetX=(l/2+C.COLLISION_PLACEMENT_PADDING)*this._xPlacementD,y.offsetY=
(l/2+C.COLLISION_PLACEMENT_PADDING)*this._yPlacementD),y.bounds=e,h.push(y),c.clear())}else{c=function(c){var e=d[c],l=e.x,m=e.y;c=a.length;var t=new r.default(f,{from:c,count:-1},l,m,25.5);e.glyphs.forEach(function(c){for(var h=0;h<c.length;h++){var d=c[h];d.minZoom=Math.max(e.minZoom,d.minZoom);if(d.bounds){var r=d.anchorY-m;d.bounds.center[0]+=d.anchorX-l;d.bounds.center[1]+=r;t.add(d.bounds)}}t.bounds&&g._writeHalos(a,b,f,c,n,k)});e.glyphs.forEach(function(c){t.bounds&&g._writeText(a,b,f,c,n,
k)});t.range.count=a.length-c;t.bounds&&h.push(t);e.clear()};for(e=0;e<d.length;e++)c(e);this._computedGlyphs=[]}}};b.prototype._outsideTile=function(a,b){return 0>a||512<=a||0>b||512<=b};b.prototype._smoothVertices=function(a,b){if(!(0>=b)){var c=a.length;if(!(3>c)){var e=[],l=0;e.push(0);for(var h=1;h<c;h++)l+=f.dist(a[h],a[h-1]),e.push(l);b=Math.min(b,.2*l);l=[];l.push(a[0][0]);l.push(a[0][1]);var g=a[c-1][0],d=a[c-1][1],h=f.sub([0,0],a[0],a[1]);f.normalize(h);a[0][0]+=b*h[0];a[0][1]+=b*h[1];f.sub(h,
a[c-1],a[c-2]);f.normalize(h);a[c-1][0]+=b*h[0];a[c-1][1]+=b*h[1];for(h=1;h<c;h++)e[h]+=b;e[c-1]+=b;for(var k=.5*b,h=1;h<c-1;h++){for(var n=0,m=0,r=0,t=h-1;0<=t&&!(e[t+1]<e[h]-k);t--){var w=k+e[t+1]-e[h],E=e[t+1]-e[t],v=e[h]-e[t]<k?1:w/E;if(1E-6>Math.abs(v))break;var u=v*v,y=v*w-.5*u*E,B=v*E/b,z=a[t+1],C=a[t][0]-z[0],A=a[t][1]-z[1],n=n+B/y*(z[0]*v*w+.5*u*(w*C-E*z[0])-u*v*E*C/3),m=m+B/y*(z[1]*v*w+.5*u*(w*A-E*z[1])-u*v*E*A/3),r=r+B}for(t=h+1;t<c&&!(e[t-1]>e[h]+k);t++){w=k-e[t-1]+e[h];E=e[t]-e[t-1];
v=e[t]-e[h]<k?1:w/E;if(1E-6>Math.abs(v))break;u=v*v;y=v*w-.5*u*E;B=v*E/b;z=a[t-1];C=a[t][0]-z[0];A=a[t][1]-z[1];n+=B/y*(z[0]*v*w+.5*u*(w*C-E*z[0])-u*v*E*C/3);m+=B/y*(z[1]*v*w+.5*u*(w*A-E*z[1])-u*v*E*A/3);r+=B}l.push(n/r);l.push(m/r)}l.push(g);l.push(d);for(t=h=0;h<c;h++)a[h][0]=l[t++],a[h][1]=l[t++]}}};b.prototype._computeLineAnchors=function(a,b,c){b=b.paths;var f=this._scale*this._shapedBox.width;c=f/2+c;for(var f=f/2+16,e=this._shapedBox.width*this._scale,l=0;l<b.length;l++){var h=b[l],g=[];g.push(h[0]);
for(var d=1;d<h.length;d++){var k=g[d-1],n=k[0],k=k[1],n=n+h[d][0],k=k+h[d][1];g.push([n,k])}this._smoothVertices(g,e);h=[];h.push(g[0]);for(d=1;d<g.length;d++){var k=g[d-1],m=g[d],n=Math.round(m[0]-k[0]),k=Math.round(m[1]-k[1]);h.push([n,k])}b[l]=h;g=this._getPathLength(h);if(!(g<2*f))for(var d=g/2,t=0,m=h[0][0],r=h[0][1],w=1;w<h.length;w++){var n=h[w][0],k=h[w][1],E=Math.sqrt(n*n+k*k),t=t+E;if(0<=t-d){var v=t-d,u=E-v,y=u/E,z=m+n*y,C=r+k*y;this._outsideTile(z,C)||(t=new B.default(z,C,y,l,w,m,r,E,
g,-1),a.push(t));for(var A=-1,C=0,C=u-c;0<=C;C-=c){var y=C/E,z=m+n*y,G=r+k*y;A++;this._outsideTile(z,G)||(t=new B.default(z,G,y,l,w,m,r,E,g,A),a.push(t))}t=C+c;C=E-v;y=m;z=r;for(G=w-1;0!==G;G--){var D=h[G][0],x=h[G][1],N=Math.sqrt(D*D+x*x);if(t+N>=c){for(var L=t=c-t;L<N;L+=c){var p=L/N,O=y-D*p,Q=z-x*p;A++;(t=L+C+f<d)&&!this._outsideTile(O,Q)&&(t=new B.default(O,Q,1-p,l,G,y-D,z-x,N,g,A),a.push(t))}t=N-(L-c)}else t+=N;C+=N;y-=D;z-=x}A=-1;for(C=u+c;C<=E;C+=c)y=C/E,z=m+n*y,u=r+k*y,A++,this._outsideTile(z,
u)||(t=new B.default(z,u,y,l,w,m,r,E,g,A),a.push(t));y=m+n;z=r+k;t=E-(C-c);C=v;for(G=w+1;G<h.length;G++){n=h[G][0];k=h[G][1];m=Math.sqrt(n*n+k*k);if(t+m>=c){for(r=t=c-t;r<m;r+=c)w=r/m,E=y+n*w,v=z+k*w,A++,(t=r+C+f<d)&&!this._outsideTile(E,v)&&(t=new B.default(E,v,w,l,G,y,z,m,g,A),a.push(t));t=m-(r-c)}else t+=m;C+=m;y+=n;z+=k}break}m+=n;r+=k}}return a};b.prototype._computeAnchors=function(a,b){var c=[];switch(a){case "esriGeometryPoint":return b=b.geometry,a=b.x,b=b.y,a=new B.default(a,b),c.push(a),
c;case "esriGeometryPolygon":if(b.centroid)return b=b.centroid,a=b.x,b=b.y,a=new B.default(a,b),c.push(a),c;L("Non-centroid polygon anchor placement not supported");break;case "esriGeometryPolyline":return this._computeLineAnchors(c,b.geometry,376);default:return L("Unable to handle geometryType: "+a),c}};b.prototype._getPathLength=function(a){for(var b=0,c=1;c<a.length;c++)var f=a[c][0],e=a[c][1],b=b+Math.sqrt(f*f+e*e);return b};b.prototype._computeGlyphTransform=function(a){var b=this._scale,c=
this._angle*u.C_DEG_TO_RAD,f=a.width/2,e=a.height/2,f=this._xAlignD*f*b+(this._xOffset+this._refTemplate.xOffset)+(a.x+f);a=this._yAlignD*e*b-(this._yOffset+this._refTemplate.yOffset)-(a.y+e);e=k.mat2d.identity(E);k.mat2d.translate(e,e,h.vec2.set(G,f,a));k.mat2d.scale(e,e,h.vec2.set(G,b,b));k.mat2d.rotate(e,e,c);return e};b.prototype._writeVertex=function(a,b,c,f,e,l,h,g,d){b=b.get("geometry");h=Math.min(Math.floor(Math.max(this._refTemplate.width,this._refTemplate.height)),255);var k=this._xPlacementD+
1,n=this._yPlacementD+1;g=w.i8888to32(g,d,0,0);this._refSymbolAndPlacementOffset=w.i8888to32(l.angle,h,k,n);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetUpperLeft);b.push(l.texFontSizeUpperLeft);b.push(this._refSymbolAndPlacementOffset);b.push(g);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetUpperRight);b.push(l.texFontSizeUpperRight);b.push(this._refSymbolAndPlacementOffset);b.push(g);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetLowerLeft);b.push(l.texFontSizeLowerLeft);b.push(this._refSymbolAndPlacementOffset);
b.push(g);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetLowerRight);b.push(l.texFontSizeLowerRight);b.push(this._refSymbolAndPlacementOffset);b.push(g);a.vertexCount+=4};return b}(y.default);a.default=d})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(d,a){function c(a,c){a%=c;return 0<=a?a:a+c}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=
128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var g=1/Math.LN2;a.positiveMod=c;a.radToByte=function(b){return c(b*a.C_RAD_TO_256,256)};a.degToByte=function(b){return c(b*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*g};a.sqr=function(a){return a*a};a.interpolate=function(a,c,g){return a*(1-g)+c*g};a.between=function(a,c,g){return a>=c&&a<=g||a>=g&&a<=c}})},"esri/views/2d/engine/webgl/TextShaping":function(){define(["require",
"exports","./Rect"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,c,g,d,h,n,u,x){this._glyphItems=a;this._maxWidth=c;this._lineHeight=g;this._letterSpacing=d;this._offset=h;this._hAnchor=n;this._vAnchor=u;this._justify=x}a.prototype.getShaping=function(a,c){for(var b=this._letterSpacing,e=this._lineHeight,h=this._justify,g=this._maxWidth,d=[],x=0,C=0,t=0,w=0,z=-1,r=0,v=-1,B=a.length,f=0;f<B;f++){var y=a.charCodeAt(f);if(10===y){if(f!==B-1){if(z>=w){var x=
d[z],l=x.x+x.glyphMosaicItem.metrics.advance,r=Math.max(l,r);h&&this._applyJustification(d,w,z);w=d.length}C=c?C-e:C+e;x=0;++t}}else{for(var l=void 0,D=0,A=this._glyphItems;D<A.length&&!(l=A[D][y]);D++);if(l){d.push({codePoint:y,x:x,y:C,glyphMosaicItem:l});x+=l.metrics.advance+b;if(0<g&&x>g&&0<=v){D=v+1;l=d[D].x;r=Math.max(l,r);for(A=D;A<d.length;A++)d[A].y=c?d[A].y-e:d[A].y+e,d[A].x-=l;h&&this._applyJustification(d,w,v);C=c?C-e:C+e;x-=l;++t;w=D;v=-1}++z;32===y&&(v=d.length-1)}}}z>=w&&(x=d[z],r=Math.max(r,
x.x+x.glyphMosaicItem.metrics.advance),h&&this._applyJustification(d,w,z));if(0<d.length)for(a=(h-this._hAnchor)*r,b=(-this._vAnchor*(t+1)+.5)*e,c&&t&&(b+=t*e),a+=this._offset[0],b+=this._offset[1],c=0;c<d.length;c++)e=d[c],e.x+=a,e.y+=b;return d};a.getBox=function(a){if(!a.length)return null;for(var b=Infinity,c=Infinity,g=0,h=0,d=0;d<a.length;d++)var u=a[d],x=u.glyphMosaicItem.metrics,C=x.height,t=u.x,u=u.y-(C-Math.abs(x.top)),x=t+x.width+x.left,C=u+C,b=Math.min(b,t),g=Math.max(g,x),c=Math.min(c,
u),h=Math.max(h,C);return{x:b,y:c,width:g-b,height:h-c}};a.addDecoration=function(a,e){var b=a.length;if(0!==b){for(var g=a[0].x+a[0].glyphMosaicItem.metrics.left,h=a[0].y,d=1;d<b;d++){var u=a[d];if(u.y!==h){var x=a[d-1].x+a[d-1].glyphMosaicItem.metrics.left+a[d-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:g,y:h+e-3,glyphMosaicItem:{sdf:!0,rect:new c.default(4,0,4,8),metrics:{width:x-g,height:8,left:0,top:0,advance:0},page:0}});h=u.y;g=u.x+u.glyphMosaicItem.metrics.left}}b=a[b-1].x+a[b-
1].glyphMosaicItem.metrics.left+a[b-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:g,y:h+e-3,glyphMosaicItem:{sdf:!0,rect:new c.default(4,0,4,8),metrics:{width:b-g,height:8,left:0,top:0,advance:0},page:0}})}};a.prototype._applyJustification=function(a,c,g){for(var b=a[g],b=(b.x+b.glyphMosaicItem.metrics.advance)*this._justify;c<=g;c++)a[c].x-=b};return a}();a.TextShaping=d})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f32 ../definitions ./BoundingBox ../util/serializationUtils".split(" "),
function(d,a,c,g,b,e,k){Object.defineProperty(a,"__esModule",{value:!0});var m=c.getLogger("esri/views/2d/engine/webgl/collisions/Metric");d=function(){function a(a,b,c,e,h){this.id=a;this.range=b;this.boxes=null;this.minZoom=-1;this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=0;this.anchor=g.vec2f32.fromValues(c,e);this.baseZoom=h}a.prototype.add=function(a){this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=this.bounds.clone()),this.bounds.extend(a)):
this.bounds=a};a.prototype.computeIndex=function(){var a=this.bounds,c=this.anchor[0],e=this.anchor[1],h=Math.floor(c/b.COLLISION_BUCKET_SIZE),g=Math.floor(e/b.COLLISION_BUCKET_SIZE),d=0;if(h>b.COLLISION_TILE_BOX_SIZE||g>b.COLLISION_TILE_BOX_SIZE)g=h=b.COLLISION_TILE_BOX_SIZE,d=1;if(0>h||0>g)g=h=0,d=1;a=2*Math.max(a.halfWidth+Math.abs(a.center[0]),a.halfHeight+Math.abs(a.center[1]));c%=b.COLLISION_BUCKET_SIZE;e%=b.COLLISION_BUCKET_SIZE;this.xBucket=h;this.yBucket=g;this.xOverflow=Math.ceil(Math.abs((a-
c)/b.COLLISION_BUCKET_SIZE))+d;this.yOverflow=Math.ceil(Math.abs((a-e)/b.COLLISION_BUCKET_SIZE))+d};a.prototype.findCollisionDelta=function(a){var c=this.bounds.findCollisionDelta(a.bounds),e=this.boxes&&this.boxes.length,h=a.boxes&&a.boxes.length;return Math.abs(c)>b.COLLISION_MAX_ZOOM_DELTA||!e&&!h?c:e&&h?this._boxesToBoxes(a):e?this._boxesToBox(a):this._boxToBoxes(a)};a.prototype.computeOffset=function(a,c){c||m.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+
c);var e=this.size;this.hasVV&&(a=c(a),e=isNaN(a)||null==a||Infinity===a?this.size:a);this.offsetX=this.directionX*(e/2+b.COLLISION_PLACEMENT_PADDING);this.offsetY=this.directionY*(e/2+b.COLLISION_PLACEMENT_PADDING)};a.prototype.setVV=function(a,b,c){this.hasVV=!0;this.size=a;this.directionX=b;this.directionY=c};a.prototype.clone=function(){var b=new a(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);b.minZoom=this.minZoom;this.bounds&&(b.bounds=this.bounds.clone());this.boxes&&(b.boxes=
this.boxes.map(function(a){return a.clone()}));b.xBucket=this.xBucket;b.yBucket=this.yBucket;b.xOverflow=this.xOverflow;b.yOverflow=this.yOverflow;b.hasVV=this.hasVV;b.size=this.size;b.directionX=this.directionX;b.directionY=this.directionY;b.offsetX=this.offsetX;b.offsetY=this.offsetY;return b};a.prototype._boxToBoxes=function(a){var b=-Infinity,c=0;for(a=a.boxes;c<a.length;c++)var e=this.bounds.findCollisionDelta(a[c]),b=Math.max(e,b);return b};a.prototype._boxesToBox=function(a){for(var b=this.boxes[0].findCollisionDelta(a.bounds),
c=1;c<this.boxes.length;c++)var e=this.boxes[c].findCollisionDelta(a.bounds),b=Math.max(e,b);return b};a.prototype._boxesToBoxes=function(a){for(var b=-Infinity,c=0;c<this.boxes.length;c++)for(var e=this.boxes[c],h=0,g=a.boxes;h<g.length;h++)var d=e.findCollisionDelta(g[h]),b=Math.max(d,b);return b};a.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);a.push(this.hasVV?
1:0);a.push(this.size);a.push(this.directionX);a.push(this.directionY);a.push(this.offsetX);a.push(this.offsetY);k.serializeList(a,this.boxes);return a};a.deserialize=function(b){var c=b.readInt32(),h=e.default.deserialize(b),g=b.readInt32(),d=b.readInt32(),m={from:g,count:d},n=b.readInt32(),r=b.readInt32(),v=b.readInt32(),g=b.readInt32(),d=b.readInt32(),B=b.readInt32(),f=b.readInt32(),y=b.readInt32(),l=b.readInt32();b=k.deserializeList(b,e.default);c=new a(c,m,n,r,v);c.bounds=h;c.boxes=b;c.computeIndex();
g&&c.setVV(d,B,f);c.offsetX=y;c.offsetY=l;return c};return a}();a.default=d})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2f32","../../../support/mathUtils"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b,g,h){this.center=c.vec2f32.fromValues(a,b);this.centerT=c.vec2f32.create();this.halfWidth=g/2;this.halfHeight=h/2;this.width=g;this.height=h}Object.defineProperty(a.prototype,
"x",{get:function(){return this.center[0]},set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.center[1]},set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"trX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);a.push(this.height);return a};a.prototype.findCollisionDelta=
function(a){return g.log2(Math.min((a.halfWidth+this.halfWidth)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight)/Math.abs(a.centerT[1]-this.centerT[1])))};a.prototype.extend=function(a){var b=Math.min(this.blX,a.blX),c=Math.min(this.blY,a.blY),e=Math.max(this.trY,a.trY);this.width=Math.max(this.trX,a.trX)-b;this.height=e-c;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=b+this.halfWidth;this.y=c+this.halfHeight};a.deserialize=function(b){var c=b.readF32(),e=b.readF32(),
h=b.readInt32();b=b.readInt32();return new a(c,e,h,b)};return a}();a.default=d})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.serializeList=function(a,g){if(null===g)a.push(0);else{a.push(g.length);for(var b=0;b<g.length;b++)g[b].serialize(a);return a}};a.deserializeList=function(a,g,b){for(var c=a.readInt32(),c=Array(c),d=0;d<c.length;d++)c[d]=g.deserialize(a,b);return c}})},"esri/views/2d/engine/webgl/mesh/templates/GlyphGroup":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../definitions ../../materialKey/MaterialKey ./ComputedGlyph ./util ../../../../support/mathUtils".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u){Object.defineProperty(a,"__esModule",{value:!0});var x=g.getLogger("esri.views.2d.engine.webgl.GlyphGroup");d=function(){function a(a,b,c,e,h,g,f,d,l,k){void 0===c&&(c=0);void 0===e&&(e=-1);void 0===h&&(h=-1);void 0===g&&(g=-1);void 0===f&&(f=-1);void 0===d&&(d=-1);void 0===l&&(l=0);void 0===k&&(k=-1);this.x=a;this.y=b;this.t=c;this.i=e;this.j=h;this.segmentPosX=g;this.segmentPosY=f;this.segmentLen=d;this.pathLen=l;this.order=k;this._glyphs=new Map;this.minZoom=0}Object.defineProperty(a.prototype,
"glyphs",{get:function(){return this._glyphs},enumerable:!0,configurable:!0});a.prototype.add=function(a,b){var c=this._glyphs.get(b);c?c.push(a):this._glyphs.set(b,[a])};a.prototype.clear=function(){this._glyphs.clear()};a.prototype.place=function(a,b,e,g,d,k,f,n,l,u,A){var t=a.x,r=a.y,w=a.codePoint,v=a.glyphMosaicItem;d=m.MaterialKeyBase.load(d);d.textureBinding=a.glyphMosaicItem.textureBinding;switch(b){case "esriGeometryPoint":case "esriGeometryPolygon":a=h.default.from(t,r,this.x,this.y,-1,u,
A,v,w,d.data,g,k,f);this.add(a,0);break;case "esriGeometryPolyline":b=e.geometry;this._placeGlyphAlongLine(a,d.data,b,g,n,k,f,l,u,A,-1);this._placeGlyphAlongLine(a,d.data,b,g,n,k,f,l,u,A,1);break;case "esriGeometryMultipoint":case "esriGeometryEnvelope":a=void 0,void 0===a&&(a="mapview-labeling"),x.error(new c(a,"Cannot place for unsupported geometryType: "+b))}};a.prototype._findLabelTheta=function(a,b,c,e){b*=e;a=Math.acos((0*b+-1*e*-a)/(1*c));0<b&&(a=2*Math.PI-a);return a};a.prototype._placeGlyphAlongLine=
function(a,c,g,d,m,B,f,y,l,C,A){g=g.paths[this.i];var r=g[this.j],t=r[0],w=r[1],r=a.x,v=a.y,z=a.glyphMosaicItem,D=a.codePoint,x=a.glyphMosaicItem.metrics,x=(a.x+x.left+x.width/2)*B/24;a=A*u.sign(x)||1;var x=Math.abs(x),M=n.len(t,w),H=this._findLabelTheta(t,w,M,A),S=(a+1)/2,M=-a*(-1*S+this.t)*M,J=b.mat2d.rotate(e.mat2df32.create(),d,-H),P=48<m.height;m=0===M?C:Math.max(Math.max(y+u.log2(Math.abs(x/M)),0),l);P&&(m=l);C=h.default.from(r,v,this.x,this.y,H,m,C,z,D,c,J,B,f,P||m<=y&&C>=y&&1===A);this.add(C,
this.j);if(!P)for(C=this.segmentPosX+S*t,t=this.segmentPosY+S*w,J=m,w=this.j+a;0<w&&w<g.length;w+=a){var T=C,V=t,S=g[w];m=S[0];var S=S[1],W=n.len(m,S),P=this._findLabelTheta(m,S,W,A),P=b.mat2d.rotate(e.mat2df32.create(),d,-P),T=T+-a*m/W*M,V=V+-a*S/W*M,M=M+W,W=J-.1,J=0===M?W:Math.max(Math.max(y+u.log2(Math.abs(x/M)),0),l),P=h.default.from(r,v,T,V,H,J,W,z,D,c,P,B,f,J<=y&&W>=y&&1===A);this.add(P,w);if(J<y-k.COLLISION_MAX_ZOOM_DELTA){this.minZoom=Math.max(J,this.minZoom);break}C+=a*m;t+=a*S}};return a}();
a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/ComputedGlyph":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../number ../../collisions/BoundingBox".split(" "),function(d,a,c,g,b,e,k){Object.defineProperty(a,"__esModule",{value:!0});var m=g.vec2f32.create();d=function(){function a(a,b,c,e,h,g,d,k,m,B,f,y,l,D,A){this.anchorX=a;this.anchorY=b;this.angle=c;this.bounds=e;this.minZoom=h;this.maxZoom=
g;this.materialKey=d;this.vertexOffsetUpperLeft=k;this.vertexOffsetUpperRight=m;this.vertexOffsetLowerLeft=B;this.vertexOffsetLowerRight=f;this.texFontSizeUpperLeft=y;this.texFontSizeUpperRight=l;this.texFontSizeLowerLeft=D;this.texFontSizeLowerRight=A}a.from=function(h,g,d,C,t,w,z,r,v,B,f,y,l,D,A){void 0===D&&(D=!1);void 0===A&&(A=!1);var n=r.rect,E=r.metrics;t=-1===t?255:Math.floor(180*t/Math.PI/360*254);var u=Math.round(n.x/4),x=Math.round(n.y/4);r=u+Math.round(n.width/4);var Q=x+Math.round(n.height/
4),R=-24-E.top,O=E.left,M=-E.top,H=n.width,n=n.height;v||(A||(R=0),O=4,H=E.width);h+=O;v=A?g+M:g+R;H=h+H;R=v;g=h;M=v+n;n=H;A=M;var O=g+E.width,S=M-E.height,J=E.width*y/24,E=E.height*y/24;f&&(c.vec2.transformMat2d(m,c.vec2.set(m,h,v),f),h=m[0],v=m[1],c.vec2.transformMat2d(m,c.vec2.set(m,H,R),f),H=m[0],R=m[1],c.vec2.transformMat2d(m,c.vec2.set(m,g,M),f),g=m[0],M=m[1],c.vec2.transformMat2d(m,c.vec2.set(m,n,A),f),n=m[0],A=m[1],c.vec2.transformMat2d(m,c.vec2.set(m,O,S),f),O=m[0],S=m[1]);f=D?new k.default(O,
S,J+b.COLLISION_BOX_PADDING,E+b.COLLISION_BOX_PADDING):null;D=e.i1616to32(8*h,8*v);E=e.i1616to32(8*H,8*R);h=e.i1616to32(8*g,8*M);g=e.i1616to32(8*n,8*A);n=e.i8888to32(u,x,y,l);x=e.i8888to32(r,x,y,l);u=e.i8888to32(u,Q,y,l);y=e.i8888to32(r,Q,y,l);return new a(d|0,C|0,t,f,w,z,B,D,E,h,g,n,x,u,y)};return a}();a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(d,a){function c(a,b){return Math.sqrt(a*a+b*b)}Object.defineProperty(a,"__esModule",
{value:!0});a.sub=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a};a.len=c;a.normalize=function(a){var b=c(a[0],a[1]);a[0]/=b;a[1]/=b};a.dist=function(a,b){return c(a[0]-b[0],a[1]-b[1])};a.isFunction=function(a){return"function"===typeof a};a.getLimitCosine=function(a){return 1/Math.max(a,1)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./WGLBaseTextTemplate ./WGLMeshTemplate ../../util/BidiText".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function h(c,e,h,d,n,u,f,y,l,C,A,G){var r=a.call(this)||this;r._xOffset=g.pt2px(C);r._yOffset=g.pt2px(A);r._decorationTop=k.getFontDecorationTop(y);r._color=d;r._haloColor=n;r._haloSize=Math.min(Math.floor(5*g.pt2px(g.toPt(h))),127);r._size=Math.min(Math.round(g.pt2px(e)),127);r._scale=r._size/24;r._angle=l;r._justify=b.getJustification(u||"center");r._xAlignD=b.getXAnchorDirection(u||"center");r._yAlignD=
-b.getYAnchorDirection(f||"baseline");r._baseline="baseline"===(f||"baseline");r._bitset=0;c=m.MaterialKeyBase.load(m.createMaterialKey(r.geometryType,c,!1));c.sdf=!0;r._materialKey=c.data;r.symbolId=G;return r}c(h,a);h.fromText=function(a,b,c){a=new h(a,b.font.size,b.haloSize||0,b.color&&e.premultiplyAlphaRGBA(b.color)||0,b.haloColor&&e.premultiplyAlphaRGBA(b.haloColor)||0,b.horizontalAlignment,b.verticalAlignment,b.font.decoration,b.angle||0,b.xoffset,b.yoffset,b.id);b=u.bidiText(b.text);a.bindTextInfo(c,
b[0],b[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};h.fromCIMText=function(a,b,c){a=new h(a,b.size*b.sizeRatio,b.outlineSize*b.sizeRatio,e.premultiplyAlphaRGBA(b.color),e.premultiplyAlphaRGBA(b.outlineColor),b.horizontalAlignment,b.verticalAlignment,b.decoration,b.angle,b.offsetX*b.sizeRatio,b.offsetY*b.sizeRatio,b.materialHash);b=u.bidiText(b.text);a.bindTextInfo(c,b[0],b[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};return h}(h.default(n.default));a.default=d})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["require",
"exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.getXAnchorDirection=function(a){switch(a){case "left":return 1;case "right":return-1;case "center":case "justify":return 0}};a.getYAnchorDirection=function(a){switch(a){case "top":return-1;case "middle":return 0;case "baseline":case "bottom":return 1}};a.getJustification=function(a){switch(a){case "left":return 0;case "right":return 1;case "center":case "justify":return.5}}})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../definitions ../../enums ../../number ../../TextShapingNew ../../WGLDisplayRecord ../../collisions/BoundingBox ../../materialKey/MaterialKey ./ComputedGlyph".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r){Object.defineProperty(a,"__esModule",{value:!0});var v=b.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),B=Math.PI/180,f=k.mat2df32.create(),y=h.vec2f32.create();a.default=function(a){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b.geometryType=u.WGLGeometryType.TEXT;return b}c(b,a);b.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);
isNaN(this._decorationTop)||C.TextShaping.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=C.TextShaping.getBox(a)};b.prototype.writeMesh=function(a,b,c,f,e){var l=this._computedGlyphs;if(l){var h=z.TextMaterialKey.load(this._materialKey),d=x.i8888to32(0,0,0,this._bitset);switch(c){case "esriGeometryPoint":e=e.geometry;c=e.x;e=e.y;for(var k=0;k<l.length;k++){var m=l[k];m.anchorX=c;m.anchorY=e}this._writeVertices(a,b,f,l,h,d,0,0);break;case "esriGeometryPolygon":if(e.centroid){e=
e.centroid;c=e.x;e=e.y;for(k=0;k<l.length;k++)m=l[k],m.anchorX=c,m.anchorY=e;this._writeVertices(a,b,f,l,h,d,0,0);break}case "esriGeometryMultipoint":for(var k=e.geometry.points,n=e=c=0;n<k.length;n++){m=k[n];c+=m[0];e+=m[1];for(var r=0,t=l;r<t.length;r++)m=t[r],m.anchorX=c,m.anchorY=e;this._writeVertices(a,b,f,l,h,d,0,0)}break;default:a=void 0,void 0===a&&(a="mapview-processing"),v.error(new g(a,"Unable to handle geometryType: "+c))}}};b.prototype._computeGlyphs=function(a,b){if(a&&0!==a.length){var c=
Array(a.length);b=this._computeGlyphTransform(b);for(var f=z.MaterialKeyBase.load(this._materialKey),e=0;e<a.length;e++){var l=a[e],h=l.x,g=l.y,d=l.codePoint,l=l.glyphMosaicItem;f.textureBinding=l.textureBinding;c[e]=r.default.from(h,g,0,0,-1,0,25,l,d,f.data,b,this._size,this._haloSize,!1,!0)}this._computedGlyphs=c}};b.prototype._createBounds=function(a,b){var c=a.width/2,f=a.height/2,e=b[4],l=b[5],g;if(this._angle){a=h.vec2f32.fromValues(-c,-f);g=h.vec2f32.fromValues(c,-f);var d=h.vec2f32.fromValues(-c,
f),k=h.vec2f32.fromValues(c,f);m.vec2.transformMat2d(a,a,b);m.vec2.transformMat2d(g,g,b);m.vec2.transformMat2d(d,d,b);m.vec2.transformMat2d(k,k,b);b=f=Infinity;var r=0,t=c=0;for(a=[a,g,d,k];t<a.length;t++)g=a[t],f=Math.min(g[0],f),r=Math.max(g[0],r),b=Math.min(g[1],b),c=Math.max(g[1],c);g=r-f;a=c-b}else g=a.width*this._scale,a=a.height*this._scale;return new w.default(e,l,g+n.COLLISION_BOX_PADDING,a+n.COLLISION_BOX_PADDING)};b.prototype._computeShaping=function(a,b){return new C.TextShaping([a],512,
n.TEXT_LINE_HEIGHT,n.TEXT_SPACING,[0,.5*-n.TEXT_LINE_HEIGHT],.5*(1-this._xAlignD),0,b)};b.prototype._computeGlyphTransform=function(a){var b=this._scale,c=this._angle*B,l=e.mat2d.identity(f);e.mat2d.rotate(l,l,c);e.mat2d.translate(l,l,m.vec2.set(y,this._xOffset,-this._yOffset));e.mat2d.scale(l,l,m.vec2.set(y,b,b));e.mat2d.translate(l,l,m.vec2.set(y,-4,-4-(this._baseline?25:a.y+(1-this._yAlignD)*a.height*.5)));return l};b.prototype._writeVertices=function(a,b,c,f,e,l,h,g){this._writeHalos(a,b,c,f,
e,l,h,g);this._writeText(a,b,c,f,e,l,h,g)};b.prototype._writeHalos=function(a,b,c,f,e,l,h,g){e=b.indexVector;var d=b.getVector("geometry").vertexCount,k=0;if(this._haloSize)for(var m=0;m<f.length;m++,k+=4){var n=f[m],r=x.i1616to32(2*n.anchorX+1,2*n.anchorY),v=null==h?Math.floor(10*n.minZoom):h,w=null==g?Math.floor(10*n.maxZoom):g,y=new t(c,this.geometryType,n.materialKey,v,w);y.vertexFrom=d+k;y.indexFrom=e.length;this._writeVertex(y,b,c,r,this._haloColor,n,l,v,w);this._writeIndices(y,e,d+k);a.push(y)}};
b.prototype._writeText=function(a,b,c,f,e,l,h,g){e=b.indexVector;for(var d=b.getVector("geometry").vertexCount,k=0,m=0;m<f.length;m++,k+=4){var n=f[m],r=x.i1616to32(2*n.anchorX,2*n.anchorY),v=null==h?Math.floor(10*n.minZoom):h,w=null==g?Math.floor(10*n.maxZoom):g,y=new t(c,this.geometryType,n.materialKey,v,w);y.vertexFrom=d+k;y.indexFrom=e.length;this._writeVertex(y,b,c,r,this._color,n,l,v,w);this._writeIndices(y,e,d+k);a.push(y)}};b.prototype._writeVertex=function(a,b,c,f,e,l,h,g,d){b=b.get("geometry");
b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetUpperLeft);b.push(l.texFontSizeUpperLeft);b.push(h);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetUpperRight);b.push(l.texFontSizeUpperRight);b.push(h);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetLowerLeft);b.push(l.texFontSizeLowerLeft);b.push(h);b.push(f);b.push(c);b.push(e);b.push(l.vertexOffsetLowerRight);b.push(l.texFontSizeLowerRight);b.push(h);a.vertexCount+=4};b.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+
2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return b}(a)}})},"esri/views/2d/engine/webgl/TextShapingNew":function(){define(["require","exports","./Rect"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,c,g,d,h,n,u,x){this._glyphItems=a;this._maxWidth=c;this._lineHeight=g;this._letterSpacing=d;this._offset=h;this._hAnchor=n;this._vAnchor=u;this._justify=x}a.prototype.getShaping=function(a,c){for(var b=this._letterSpacing,e=this._lineHeight,h=this._justify,
g=this._maxWidth,d=[],x=0,C=0,t=0,w=0,z=-1,r=0,v=-1,B=a.length,f=0;f<B;f++){var y=a.charCodeAt(f);if(10===y){if(f!==B-1){if(z>=w){var x=d[z],l=x.x+x.glyphMosaicItem.metrics.advance,r=Math.max(l,r);h&&this._applyJustification(d,w,z);w=d.length}C=c?C-e:C+e;x=0;++t}}else{for(var l=void 0,D=0,A=this._glyphItems;D<A.length&&!(l=A[D][y]);D++);if(l){d.push({codePoint:y,x:x,y:C,glyphMosaicItem:l});x+=l.metrics.advance+b;if(0<g&&x>g&&0<=v){D=v+1;l=d[D].x;r=Math.max(l,r);for(A=D;A<d.length;A++)d[A].y=c?d[A].y-
e:d[A].y+e,d[A].x-=l;h&&this._applyJustification(d,w,v);C=c?C-e:C+e;x-=l;++t;w=D;v=-1}++z;32===y&&(v=d.length-1)}}}z>=w&&(x=d[z],r=Math.max(r,x.x+x.glyphMosaicItem.metrics.advance),h&&this._applyJustification(d,w,z));if(0<d.length)for(a=(h-this._hAnchor)*r,b=(-this._vAnchor*(t+1)+.5)*e,c&&t&&(b+=t*e),a+=this._offset[0],b+=this._offset[1],c=0;c<d.length;c++)e=d[c],e.x+=a,e.y+=b;return d};a.prototype.getEstimatedShaping=function(a,c,d){for(var b=this._letterSpacing,e=this._lineHeight,g=this._justify,
k=this._maxWidth,x=[],C=0,t=0,w=0,z=0,r=-1,v=0,B=-1,f=a.length,y=0;y<f;y++){var l=a.charCodeAt(y);if(10===l){if(y!==f-1){if(r>=z){var C=x[r],D=C.x+C.glyphMosaicItem.metrics.advance,v=Math.max(D,v);g&&this._applyJustification(x,z,r);z=x.length}t=c?t-e:t+e;C=0;++w}}else{D=d;x.push({codePoint:l,x:C,y:t,glyphMosaicItem:D});C+=D.metrics.advance+b;if(0<k&&C>k&&0<=B){for(var A=B+1,D=x[A].x,v=Math.max(D,v),G=A;G<x.length;G++)x[G].y=c?x[G].y-e:x[G].y+e,x[G].x-=D;g&&this._applyJustification(x,z,B);t=c?t-e:
t+e;C-=D;++w;z=A;B=-1}++r;32===l&&(B=x.length-1)}}r>=z&&(C=x[r],v=Math.max(v,C.x+C.glyphMosaicItem.metrics.advance),g&&this._applyJustification(x,z,r));if(0<x.length)for(a=(g-this._hAnchor)*v,d=(-this._vAnchor*(w+1)+.5)*e,c&&w&&(d+=w*e),a+=this._offset[0],d+=this._offset[1],c=0;c<x.length;c++)e=x[c],e.x+=a,e.y+=d;return x};a.getBox=function(a){if(!a.length)return null;for(var b=Infinity,c=Infinity,d=-Infinity,h=-Infinity,g=0;g<a.length;g++)var u=a[g],x=u.glyphMosaicItem.metrics,C=u.x+x.left,u=u.y-
x.top,t=C+x.width,x=u+x.height,b=Math.min(b,C),d=Math.max(d,t),c=Math.min(c,u),h=Math.max(h,x);return{x:b,y:c,width:d-b,height:h-c}};a.addDecoration=function(a,e){var b=a.length;if(0!==b){for(var d=a[0].x+a[0].glyphMosaicItem.metrics.left,h=a[0].y,g=1;g<b;g++){var u=a[g];if(u.y!==h){var x=a[g-1].x+a[g-1].glyphMosaicItem.metrics.left+a[g-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:d,y:h,glyphMosaicItem:{sdf:!0,rect:new c.default(4,0,4,8),metrics:{width:x-d,height:2,left:0,top:e,advance:0},
page:0}});h=u.y;d=u.x+u.glyphMosaicItem.metrics.left}}b=a[b-1].x+a[b-1].glyphMosaicItem.metrics.left+a[b-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:d,y:h,glyphMosaicItem:{sdf:!0,rect:new c.default(4,0,4,8),metrics:{width:b-d,height:2,left:0,top:e,advance:0},page:0}})}};a.prototype._applyJustification=function(a,c,d){for(var b=a[d],b=(b.x+b.glyphMosaicItem.metrics.advance)*this._justify;c<=d;c++)a[c].x-=b};return a}();a.TextShaping=d})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require",
"exports","./MeshData","./Utils"],function(d,a,c,g){return function(){function a(a,b,c,h,d){void 0===h&&(h=0);void 0===d&&(d=0);this.id=a;this.geometryType=b;this.materialKey=c;this.minZoom=h;this.maxZoom=d;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=this.zOrder=this.symbolLevel=0}Object.defineProperty(a.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});a.prototype.clone=function(){return this.copy()};
a.prototype.copy=function(){var b=new a(this.id,this.geometryType,this.materialKey);b.vertexFrom=this.vertexFrom;b.vertexCount=this.vertexCount;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;b.zOrder=this.zOrder;b.symbolLevel=this.symbolLevel;b.meshData=this.meshData;b.minZoom=this.minZoom;b.maxZoom=this.maxZoom;return b};a.prototype.setMeshDataFromBuffers=function(a,b,d){var e=new c,k;for(k in b){for(var m=b[k].stride,x=b[k].data,C=[],t=g.strideToPackingFactor(m),w=0;w<m*a.vertexCount/t;++w)C[w]=
x[w+m*a.vertexFrom/t];e.vertexData.set(k,C)}for(w=e.indexData.length=0;w<a.indexCount;++w)e.indexData[w]=d[w+a.indexFrom]-a.vertexFrom;e.vertexCount=a.vertexCount;this.meshData=e};a.prototype.readMeshDataFromBuffers=function(a,b){this.meshData?this.meshData.clear():this.meshData=new c;for(var e in a){for(var h=a[e].stride,d=a[e].data,k=[],x=g.strideToPackingFactor(h),C=0;C<h*this.vertexCount/x;++C)k[C]=d[C+h*this.vertexFrom/x];this.meshData.vertexData.set(e,k)}for(C=this.meshData.indexData.length=
0;C<this.indexCount;++C)this.meshData.indexData[C]=b[C+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};a.prototype.writeMeshDataToBuffers=function(a,b,c,h){for(var e in b)for(var d=b[e].stride,k=this.meshData.vertexData.get(e),m=b[e].data,t=g.strideToPackingFactor(d),w=0;w<d*this.meshData.vertexCount/t;++w)m[w+d*a/t]=k[w];for(w=0;w<this.meshData.indexData.length;++w)h[w+c]=this.meshData.indexData[w]+a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=
c;this.indexCount=this.meshData.indexData.length};a.writeAllMeshDataToBuffers=function(a,b,c){for(var e=0,d=0,g=0;g<a.length;g++){var k=a[g];k.writeMeshDataToBuffers(e,b,d,c);e+=k.vertexCount;d+=k.indexCount}};a.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};a.prototype.serialize=function(a){a.push(this.geometryType);a.push(this.materialKey);a.push(this.symbolLevel);a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);
a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};a.deserialize=function(b,c){var e=b.readInt32(),h=b.readInt32();c=new a(c.id,e,h);c.symbolLevel=b.readInt32();c.zOrder=b.readInt32();c.vertexFrom=b.readInt32();c.vertexCount=b.readInt32();c.indexFrom=b.readInt32();c.indexCount=b.readInt32();c.minZoom=b.readInt32();c.maxZoom=b.readInt32();return c};return a}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(d,
a){return function(){function a(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}a.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};a.prototype.update=function(a,b,c){for(var e in a)this.vertexData.set(e,a[e]);for(e in this.vertexData)null===a[e]&&this.vertexData.delete(e);this.vertexCount=b;this.indexData=c};return a}()})},"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],
function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){}a.prototype.writeMesh=function(a,c,d,g,h){};a.prototype.bindFeature=function(a,c,d){};return a}();a.default=d})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","dojox/string/BidiEngine"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});var g=new c;a.bidiText=function(a){if(!g.hasBidiChar(a))return[a,!1];var b;b="rtl"===g.checkContextual(a)?"IDNNN":"ICNNN";
return[g.bidiTransform(a,b,"VLYSN"),!0]}})},"dojox/string/BidiEngine":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Stateful"],function(d,a,c){function g(a,c,f,l,h){var d=a;void 0===c&&(c=h.defInFormat);void 0===f&&(f=h.defOutFormat);void 0===l&&(l=h.defSwap);if(c!==f){var k,n=c.substring(0,1);k=c.substring(1,4);var r=f.substring(0,1),t=f.substring(1,4);"C"===k.charAt(0)&&(k=b(d),k="ltr"===k||"rtl"===k?k.toUpperCase():"L"===c.charAt(2)?"LTR":"RTL",c=n+k);"C"===t.charAt(0)&&(k=b(d),
"rtl"===k?t="RTL":"ltr"===k?(d=d.split(""),d.reverse(),k=b(d.join("")),t=k.toUpperCase()):t="L"===f.charAt(2)?"LTR":"RTL",f=r+t)}if(c===f)return a;r=c.substring(0,1);d=c.substring(1,4);n=f.substring(0,1);t=f.substring(1,4);h.inFormat=c;h.outFormat=f;h.swap=l;if("L"===r&&"VLTR"===f){if("LTR"===d)return h.dir=A,e(a,h);if("RTL"===d)return h.dir=G,e(a,h)}if("V"===r&&"V"===n)return h.dir="RTL"===d?G:A,m(a,h);if("L"===r&&"VRTL"===f)return h.dir="LTR"===d?A:G,a=e(a,h),m(a);if("VLTR"===c&&"LLTR"===f)return h.dir=
A,e(a,h);if("V"===r&&"L"===n&&d!==t)return a=m(a),"RTL"===d?g(a,"LLTR","VLTR",l,h):g(a,"LRTL","VRTL",l,h);if("VRTL"===c&&"LRTL"===f)return g(a,"LRTL","VRTL",l,h);if("L"===r&&"L"===n)return c=h.swap,h.swap=c.substr(0,1)+"N","RTL"===d?(h.dir=G,a=e(a,h),h.swap="N"+c.substr(1,2),h.dir=A,a=e(a,h)):(h.dir=A,a=e(a,h),h.swap="N"+c.substr(1,2),a=g(a,"VLTR","LRTL",h.swap,h)),a}function b(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?"z">=a[0]?"ltr":"rtl":""}
function e(a,b){a=a.split("");var c=[];k(a,c,b);if(0!==b.hiLevel&&b.swap.substr(0,1)!==b.swap.substr(1,2))for(var e=0;e<a.length;e++)if(1===c[e]){var l=e,h;b:{h=a[e];for(var d=void 0,g=0,m=L.length-1;g<=m;)if(d=Math.floor((g+m)/2),h<L[d][0])m=d-1;else if(h>L[d][0])g=d+1;else{h=L[d][1];break b}}a[l]=h}u(2,a,c,b);u(1,a,c,b);f=c;return a.join("")}function k(a,b,c){var f=a.length,e=c.dir?Z:da,h=null,d=null,g=null,h=0,d=d=null,k=-1,m=d=null,n=[],r=[];c.hiLevel=c.dir;c.lastArabic=!1;c.hasUbatAl=!1;c.hasUbatB=
!1;c.hasUbatS=!1;for(d=0;d<f;d++){var m=d,g=a[d].charCodeAt(0),t=ua[g>>8];n[m]=t<ha?t:va[t-ha][g&255]}for(m=0;m<f;m++){r[m]=d=x(a,n,r,m,c);h=e[h][d];d=h&240;h&=15;b[m]=g=e[h][l];if(0<d){if(16===d)for(d=k;d<m;d++)b[d]=1;k=-1}if(d=e[h][D])-1===k&&(k=m);else if(-1<k){for(d=k;d<m;d++)b[d]=g;k=-1}n[m]===ia&&(b[m]=0);c.hiLevel|=g}if(c.hasUbatS)for(a=0;a<f;a++)if(n[a]===ma)for(b[a]=c.dir,e=a-1;0<=e;e--)if(n[e]===na)b[e]=c.dir;else break}function m(a,b){a=a.split("");if(b){var c=[];k(a,c,b);f=c}a.reverse();
v.reverse();return a.join("")}function h(a){for(var b=0;b<W.length;b++)if(a>=W[b]&&a<=ca[b])return!0;return!1}function n(a,b,c,f){for(;b*c<f&&t(a[b]);)b+=c;return b*c<f&&h(a[b])?!0:!1}function u(a,b,c,f){if(!(f.hiLevel<a))if(1!==a||f.dir!==G||f.hasUbatB){f=b.length;for(var e=0,l,h,d;e<f;){if(c[e]>=a){for(l=e+1;l<f&&c[l]>=a;)l++;for(h=l-1;e<h;e++,h--)d=b[e],b[e]=b[h],b[h]=d,d=v[e],v[e]=v[h],v[h]=d;e=l}e++}}else b.reverse(),v.reverse()}function x(a,b,c,f,e){return{UBAT_L:function(){e.lastArabic=!1;
return ea},UBAT_R:function(){e.lastArabic=!1;return fa},UBAT_ON:function(){return X},UBAT_AN:function(){return ga},UBAT_EN:function(){return e.lastArabic?ga:aa},UBAT_AL:function(){e.lastArabic=!0;e.hasUbatAl=!0;return fa},UBAT_WS:function(){return X},UBAT_CS:function(){var a,l;if(1>f||f+1>=b.length||(a=c[f-1])!==aa&&a!==ga||(l=b[f+1])!==aa&&l!==ga)return X;e.lastArabic&&(l=ga);return l===a?l:X},UBAT_ES:function(){return(0<f?c[f-1]:ia)===aa&&f+1<b.length&&b[f+1]===aa?aa:X},UBAT_ET:function(){if(0<
f&&c[f-1]===aa)return aa;if(e.lastArabic)return X;for(var a=f+1,l=b.length;a<l&&b[a]===ka;)a++;return a<l&&b[a]===aa?aa:X},UBAT_NSM:function(){if("VLTR"===e.inFormat){for(var l=b.length,h=f+1;h<l&&b[h]===qa;)h++;if(h<l&&(l=a[f],h=b[h],(1425<=l&&2303>=l||64286===l)&&(h===fa||h===ja)))return fa}return 1>f||b[f-1]===ia?X:c[f-1]},UBAT_B:function(){e.lastArabic=!0;e.hasUbatB=!0;return e.dir},UBAT_S:function(){e.hasUbatS=!0;return X},UBAT_LRE:function(){e.lastArabic=!1;return X},UBAT_RLE:function(){e.lastArabic=
!1;return X},UBAT_LRO:function(){e.lastArabic=!1;return X},UBAT_RLO:function(){e.lastArabic=!1;return X},UBAT_PDF:function(){e.lastArabic=!1;return X},UBAT_BN:function(){return X}}[ta[b[f]]]()}function C(a,b){for(var c=0;c<M.length;c++)if(a===M[c])return b[c];return a}function t(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function w(a){if("L"===a)return"LTR";if("R"===a)return"RTL";if("C"===a)return"CLR";if("D"===a)return"CRL"}function z(a,b){for(var c=0;c<Q.length;c++)if(a===Q[c])return b[c];return a}
function r(a,b,c,f){for(var e=0;e<a.length;e++)if(a[e]>b||!c&&a[e]===b)a[e]+=f}d.getObject("string",!0,dojox);d=a("dojox.string.BidiEngine",c,{inputFormat:"ILYNN",outputFormat:"VLNNN",sourceToTarget:[],targetToSource:[],levels:[],bidiTransform:function(a,b,c){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var e=this.sourceToTarget,l=this.targetToSource,d=a.length;v=[];f=[];for(var k=0;k<d;k++)e[k]=k,l[k]=k,v[k]=k;if(!this.checkParameters(b,c))return a;b=this.inputFormat;c=this.outputFormat;
var e=a,e=y,k=w(b.charAt(1)),l=w(c.charAt(1)),m="I"===b.charAt(0)?"L":b.charAt(0),d="I"===c.charAt(0)?"L":c.charAt(0),k=m+k,l=d+l,d=b.charAt(2)+c.charAt(2);e.defInFormat=k;e.defOutFormat=l;e.defSwap=d;a=g(a,k,l,d,e);e=!1;if("R"===c.charAt(1))e=!0;else if("C"===c.charAt(1)||"D"===c.charAt(1))e=this.checkContextual(a);l=this.sourceToTarget=v;d=Array(l.length);for(k=0;k<l.length;k++)d[l[k]]=k;B=this.targetToSource=d;if(b.charAt(3)===c.charAt(3))e=a;else if("S"===c.charAt(3))if(b=e,c=!0,0===a.length)e=
void 0;else{void 0===b&&(b=!0);void 0===c&&(c=!0);a=String(a);a=a.split("");var p=0,l=1,e=a.length;b||(p=a.length-1,l=-1,e=1);for(var d=e,k=c,q=0,e=[],m=0;p*l<d;p+=l)if(h(a[p])||t(a[p])){var E;if(E="\u0644"===a[p])b:{for(var u=a,A=p+l,D=l,x=d;A*D<x&&t(u[A]);)A+=D;E=" ";if(A*D<x)for(E=u[A],u=0;u<Q.length;u++)if(Q[u]===E){E=!0;break b}E=!1}if(E){a[p]=0===q?z(a[p+l],R):z(a[p+l],O);p+=l;q=a;E=p;u=l;for(A=d;E*u<A&&t(q[E]);)E+=u;E*u<A&&(q[E]=" ");k&&(e[m]=p,m++);q=0}else{E=a[p];if(1===q){u=p;if(n(a,p+l,
l,d))b:for(A=a[p],D=0;D<M.length;D++){if(A===M[D]){A=J[D];break b}}else A=C(a[p],S);a[u]=A}else!0===n(a,p+l,l,d)?a[p]=C(a[p],P):a[p]=C(a[p],H);t(E)||(q=1);b:{for(u=0;u<T.length;u++)if(T[u]===E){E=!0;break b}E=!1}!0===E&&(q=0)}}else q=0;l="";for(d=0;d<a.length;d++){if(k=c){b:{for(k=0;k<e.length;k++)if(e[k]===d)break b;k=-1}k=-1<k}k?(r(B,d,!b,-1),v.splice(d,1)):l+=a[d]}e=l}else if(b=a,c=e,a=!0,0===b.length)e=void 0;else for(void 0===a&&(a=!0),void 0===c&&(c=!0),b=String(b),e="",l=[],l=b.split(""),d=
0;d<b.length;d++)k=!1,"\ufe70"<=l[d]&&"\ufeff">l[d]?(m=b.charCodeAt(d),"\ufef5"<=l[d]&&"\ufefc">=l[d]?(c?(0<d&&a&&" "===l[d-1]?e=e.substring(0,e.length-1)+"\u0644":(e+="\u0644",k=!0),e+=Q[(m-65269)/2]):(e+=Q[(m-65269)/2],e+="\u0644",d+1<b.length&&a&&" "===l[d+1]?d++:k=!0),k&&(r(B,d,!0,1),v.splice(d,0,v[d]))):e+=V[m-65136]):e+=l[d];this.sourceToTarget=v;this.targetToSource=B;this.levels=f;return e},_inputFormatSetter:function(a){if(!E.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.inputFormat=a},_outputFormatSetter:function(a){if(!E.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a},checkParameters:function(a,b){a?this.set("inputFormat",a):a=this.inputFormat;b?this.set("outputFormat",b):b=this.outputFormat;return a===b?!1:!0},checkContextual:function(a){a=b(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(wa){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a},hasBidiChar:function(a){return N.test(a)}});var v=
[],B=[],f=[],y={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1},l=5,D=6,A=0,G=1,E=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,N=/[\u0591-\u06ff\ufb1d-\ufefc]/,L=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],
["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],Q=["\u0622","\u0623","\u0625","\u0627"],R=["\ufef5","\ufef7","\ufef9","\ufefb"],O=["\ufef6","\ufef8","\ufefa","\ufefc"],M="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split(""),
H="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split(""),S="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split(""),
J="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split(""),P="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split(""),
T="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split(""),V="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split(""),
W=["\u0621","\u0641"],ca=["\u063a","\u064a"],da=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],Z=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],ea=0,fa=1,aa=2,ga=3,X=4,ia=5,ma=6,ja=7,na=8,ka=11,qa=12,ta="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" "),ha=100;a=ea;c=fa;var K=aa,Y=ga,p=X,la=ia,oa=ma,q=ja,ba=na,
I=ka,F=qa,ua=[ha+0,a,a,a,a,ha+1,ha+2,ha+3,c,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,ha+4,p,p,p,a,p,a,p,a,p,p,p,a,a,p,p,a,a,a,a,a,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,a,a,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,a,a,p,p,a,a,p,p,a,a,p,p,p,p,p,p,p,p,p,p,p,
p,p,p,p,p,p,p,p,p,p,p,p,a,a,a,ha+5,q,q,ha+6,ha+7],va=[[18,18,18,18,18,18,18,18,18,oa,la,oa,ba,la,18,18,18,18,18,18,18,18,18,18,18,18,18,18,la,la,la,oa,ba,p,p,I,I,I,p,p,p,p,p,10,9,10,9,9,K,K,K,K,K,K,K,K,K,K,9,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,p,18,18,18,18,18,18,la,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,p,I,I,I,I,p,p,p,p,a,p,p,18,p,p,I,I,K,K,p,a,p,p,p,K,a,p,p,
p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,a,a,a,a,a,a,a,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,a,p,p,p,p,p,p,p,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,
F,F,F,F,F,F,F,c,F,c,F,F,c,F,F,c,F,p,p,p,p,p,p,p,p,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,p,p,p,p,p,c,c,c,c,c,p,p,p,p,p,p,p,p,p,p,p],[Y,Y,Y,Y,p,p,p,p,q,I,I,q,9,q,p,p,F,F,F,F,F,F,F,F,F,F,F,q,p,p,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,I,Y,Y,q,q,q,F,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,F,F,F,F,F,F,F,Y,p,F,F,F,F,F,F,q,q,F,F,p,F,F,F,F,q,q,K,K,K,K,K,K,K,K,K,K,q,q,q,q,q,q],[q,q,q,q,q,q,q,q,q,q,q,q,q,q,p,q,q,F,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,p,p,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,F,F,F,F,F,
F,F,F,F,F,F,q,p,p,p,p,p,p,p,p,p,p,p,p,p,p,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,c,F,F,F,F,F,F,F,F,F,c,c,p,p,p,p,c,p,p,p,p,p],[ba,ba,ba,ba,ba,ba,ba,ba,ba,ba,ba,18,18,18,a,c,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,ba,la,13,14,15,16,17,9,I,I,I,I,I,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,9,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,ba,18,18,18,18,18,p,p,p,p,p,18,18,18,18,18,18,K,a,p,p,K,K,K,K,K,K,10,10,p,p,p,a,K,K,K,K,K,K,K,K,K,K,10,10,p,p,p,p,a,a,
a,a,a,a,a,a,a,a,a,a,a,p,p,p,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,I,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p],[a,a,a,a,a,a,a,p,p,p,p,p,p,p,p,p,p,p,p,a,a,a,a,a,p,p,p,p,p,c,F,c,c,c,c,c,c,c,c,c,c,10,c,c,c,c,c,c,c,c,c,c,c,c,c,p,c,c,c,c,c,p,c,p,c,c,p,c,c,p,c,c,c,c,c,c,c,c,c,c,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q],[F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,F,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,F,F,F,F,F,F,F,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,9,p,9,p,p,9,p,p,p,p,p,p,p,p,p,I,p,p,10,10,p,p,p,p,p,I,I,p,p,p,p,p,q,q,q,q,q,p,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,p,p,18],[p,p,p,I,I,I,p,p,p,p,p,10,9,10,9,9,K,K,K,K,K,K,K,K,K,K,9,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,p,p,p,p,p,p,p,p,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,p,p,p,a,a,a,a,a,a,p,p,a,a,a,a,a,a,p,p,a,a,a,a,a,a,p,p,a,a,a,p,p,p,I,I,p,p,p,I,I,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p,p]];return d})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(d,a,c,g){return d("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;return b[a]?
b[a]:b[a]={s:"_"+a+"Setter",g:"_"+a+"Getter"}},postscript:function(a){a&&this.set(a)},_get:function(a,c){return"function"===typeof this[c.g]?this[c.g]():this[a]},get:function(a){return this._get(a,this._getAttrNames(a))},set:function(a,c){if("object"===typeof a){for(var b in a)a.hasOwnProperty(b)&&"_watchCallbacks"!=b&&this.set(b,a[b]);return this}b=this._getAttrNames(a);var e=this._get(a,b);b=this[b.s];var d;"function"===typeof b?d=b.apply(this,Array.prototype.slice.call(arguments,1)):this[a]=c;
if(this._watchCallbacks){var n=this;g(d,function(){n._watchCallbacks(a,e,c)})}return this},_changeAttrValue:function(a,c){var b=this.get(a);this[a]=c;this._watchCallbacks&&this._watchCallbacks(a,b,c);return this},watch:function(a,e){var b=this._watchCallbacks;if(!b)var d=this,b=this._watchCallbacks=function(a,c,e,h){var g=function(b){if(b){b=b.slice();for(var h=0,g=b.length;h<g;h++)b[h].call(d,a,c,e)}};g(b["_"+a]);h||g(b["*"])};e||"function"!==typeof a?a="_"+a:(e=a,a="*");var h=b[a];"object"!==typeof h&&
(h=b[a]=[]);h.push(e);a={};a.unwatch=a.remove=function(){var a=c.indexOf(h,e);-1<a&&h.splice(a,1)};return a}})})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],function(d,a,c,g){function b(a,b){void 0===b&&(b=!1);var e=c.WGLVVFlag.SIZE_FIELD_STOPS|c.WGLVVFlag.SIZE_MINMAX_VALUE|c.WGLVVFlag.SIZE_SCALE_STOPS|c.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(c.WGLVVTarget.FIELD_TARGETS_OUTLINE|c.WGLVVTarget.MINMAX_TARGETS_OUTLINE|c.WGLVVTarget.SCALE_TARGETS_OUTLINE|
c.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return b?e&a:e&~a}function e(a){var e=b(a,!1);return a&(c.WGLVVFlag.COLOR|c.WGLVVFlag.OPACITY|c.WGLVVFlag.ROTATION|e)}Object.defineProperty(a,"__esModule",{value:!0});a.getVVFlags=function(a){if(!a)return c.WGLVVFlag.NONE;for(var b=0,e=0;e<a.length;e++){var d=a[e];if("size"===d.type){var k=g.getTypeOfSizeVisualVariable(d),b=b|k;"outline"===d.target&&(b|=k<<4)}else"color"===d.type?b|=c.WGLVVFlag.COLOR:"opacity"===d.type?b|=c.WGLVVFlag.OPACITY:"rotation"===d.type&&
(b|=c.WGLVVFlag.ROTATION)}return b};a.getSizeFlagsMask=b;a.getMarkerVVFlags=e;a.getFillVVFlags=function(a){return a&(c.WGLVVFlag.COLOR|c.WGLVVFlag.OPACITY)};a.getLineVVFlags=function(a,e){if(e)return e=b(a,!0),a&e;e=b(a,!1);return a&(c.WGLVVFlag.COLOR|c.WGLVVFlag.OPACITY|e)};a.getTextVVFlags=function(a){return e(a)};a.getLabelVVFlags=function(a){var c=b(a,!1);return a&c}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/Error ../../../../core/Logger ./enums ./Utils".split(" "),
function(d,a,c,g,b,e){Object.defineProperty(a,"__esModule",{value:!0});var k=g.getLogger("esri.views.2d.engine.webgl");a.getTypeOfSizeVisualVariable=function(a){if(e.isNumber(a.minDataValue)&&e.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize)return b.WGLVVFlag.SIZE_MINMAX_VALUE;if((a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops))return b.WGLVVFlag.SIZE_SCALE_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||
a.valueExpression&&"$view.scale"!==a.valueExpression)&&Array.isArray(a.stops))return b.WGLVVFlag.SIZE_FIELD_STOPS;if((null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit)return b.WGLVVFlag.SIZE_UNIT_VALUE;k.error(new c("mapview-bad-type","Found invalid size VisualVariable",a));return b.WGLVVFlag.NONE}})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(d,a,c,g,b,e,k,m){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}c(d,a);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return b.WGLGeometryType.LABEL};d.prototype.drawGeometry=function(a,c,d,h){var g=a.context,k=a.painter,n=a.drawPhase,t=a.state,u=a.rendererInfo,f=d.indexCount,y=d.indexFrom;d=m.LabelMaterialKey.load(d.materialKey);var l=d.mapAligned?1:0;if(a.requiredLevel===c.key.level||l){var C=
e.createProgramDescriptor(d.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texAndSize",count:4,type:5121},{location:5,name:"a_refSymbolAndPlacementOffset",count:4,type:5121},{location:6,name:"a_zoomRangeAndEmpty",count:4,type:5121}]}),A=k.materialManager.getProgram(d,n,u,"label",C.attributes);h=this._getVAO(g,C.bufferLayouts,
C.attributes,h);g.setStencilTestEnabled(!1);g.bindProgram(A);g.bindVAO(h);this._setSharedUniforms(A,a,c);n===b.WGLDrawPhase.LABEL_ALPHA?(g.setBlendingEnabled(!1),A.setUniform1f("u_fadeStep",c.fader.value)):k.textureManager.bindTextures(g,A,d,4);c=1===l?t.displayViewMat3:t.displayMat3;d.vvSizeMinMaxValue&&A.setUniform4fv("u_vvSizeMinMaxValue",u.vvSizeMinMaxValue);d.vvSizeScaleStops&&A.setUniform1f("u_vvSizeScaleStopsValue",u.vvSizeScaleStopsValue);d.vvSizeFieldStops&&(A.setUniform1fv("u_vvSizeFieldStopsValues",
u.vvSizeFieldStopsValues),A.setUniform1fv("u_vvSizeFieldStopsSizes",u.vvSizeFieldStopsSizes));d.vvSizeUnitValue&&A.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",u.vvSizeUnitValueToPixelsRatio);g.bindTexture(a.labelFBO.colorTexture,3);A.setUniform1i("u_referenceTex",3);A.setUniform1f("u_mapRotation",Math.floor(t.rotation/360*254));A.setUniform1f("u_mapAligned",l);A.setUniformMatrix3fv("u_displayMat3",c);A.setUniform1f("u_opacity",1);A.setUniform1f("u_zoomLevel",Math.round(10*a.displayLevel));
A.setUniform2fv("u_screenSize",a.state.size);g.drawElements(4,f,5125,4*y);g.bindVAO(null);g.setStencilTestEnabled(!0);g.setBlendingEnabled(!0)}};return d}(k.default);a.default=d})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),function(d,a,c,g,b,e,k,m){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function d(){return null!==
a&&a.apply(this,arguments)||this}c(d,a);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return b.WGLGeometryType.LINE};d.prototype.drawGeometry=function(a,b,c,d){var h=a.context,g=a.painter,k=a.rendererInfo,n=a.requiredLevel,t=a.drawPhase,f=c.indexFrom,y=c.indexCount;c=m.LineMaterialKey.load(c.materialKey);var l=e.createProgramDescriptor(c.data,{geometry:[{location:0,name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,
type:5121,normalized:!0},{location:3,name:"a_offsetAndNormal",count:4,type:5120},{location:4,name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123},{location:5,name:"a_tlbr",count:4,type:5123},{location:6,name:"a_segmentDirection",count:4,type:5120},{location:7,name:"a_aux",count:2,type:5123}]}),t=g.materialManager.getProgram(c,t,k,"line",l.attributes);d=this._getVAO(h,l.bufferLayouts,l.attributes,d);l=1/a.pixelRatio;h.bindProgram(t);h.bindVAO(d);this._setSharedUniforms(t,a,b);c.textureBinding&&
g.textureManager.bindTextures(h,t,c);t.setUniform1f("u_zoomFactor",Math.pow(2,n-b.key.level)/a.pixelRatio);t.setUniform1f("u_blur",0+l);t.setUniform1f("u_antialiasing",l);c.vvSizeMinMaxValue&&t.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);c.vvSizeScaleStops&&t.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(t.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),t.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&
t.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);c.vvColor&&(t.setUniform1fv("u_vvColorValues",k.vvColorValues),t.setUniform4fv("u_vvColors",k.vvColors));c.vvOpacity&&(t.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),t.setUniform1fv("u_vvOpacities",k.vvOpacities));h.setFaceCullingEnabled(!0);h.setFrontFace(2305);h.setCullFace(1029);h.drawElements(4,y,5125,4*f);h.setFaceCullingEnabled(!1);h.bindVAO(null)};return d}(k.default);a.default=d})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/assignHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(d,a,c,g,b,e,k,m,h){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);b.prototype.dispose=function(){};b.prototype.getGeometryType=function(){return e.WGLGeometryType.MARKER};b.prototype.drawGeometry=function(a,b,c,e){var d=a.context,g=a.painter,m=a.rendererInfo,n=a.drawPhase,f=a.state,t=c.indexCount,l=c.indexFrom;c=h.MarkerMaterialKey.load(c.materialKey);var w=k.createProgramDescriptor(c.data,{geometry:[{location:0,
name:"a_pos",count:2,type:5122},{location:1,name:"a_vertexOffset",count:2,type:5122},{location:2,name:"a_texAndBitSet",count:4,type:5121},{location:3,name:"a_id",count:4,type:5121},{location:4,name:"a_color",count:4,type:5121,normalized:!0},{location:5,name:"a_outlineColor",count:4,type:5121,normalized:!0},{location:6,name:"a_sizeAndOutlineWidth",count:4,type:5121}]}),n=g.materialManager.getProgram(c,n,m,"icon",w.attributes);e=this._getVAO(d,w.bufferLayouts,w.attributes,e);d.bindProgram(n);d.bindVAO(e);
c.textureBinding&&g.textureManager.bindTextures(d,n,c,4);this._setSharedUniforms(n,a,b);n.setUniformMatrix3fv("u_displayMat3",c.vvRotation?f.displayViewMat3:f.displayMat3);c.vvSizeMinMaxValue&&n.setUniform4fv("u_vvSizeMinMaxValue",m.vvSizeMinMaxValue);c.vvSizeScaleStops&&n.setUniform1f("u_vvSizeScaleStopsValue",m.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(n.setUniform1fv("u_vvSizeFieldStopsValues",m.vvSizeFieldStopsValues),n.setUniform1fv("u_vvSizeFieldStopsSizes",m.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&
n.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",m.vvSizeUnitValueToPixelsRatio);c.vvColor&&(n.setUniform1fv("u_vvColorValues",m.vvColorValues),n.setUniform4fv("u_vvColors",m.vvColors));c.vvOpacity&&(n.setUniform1fv("u_vvOpacityValues",m.vvOpacityValues),n.setUniform1fv("u_vvOpacities",m.vvOpacities));c.vvRotation&&n.setUniform1f("u_vvRotationType","geographic"===m.vvMaterialParameters.vvRotationType?0:1);d.drawElements(4,t,5125,4*l);d.bindVAO(null)};return b}(m.default);a.default=d})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../webgl ../enums ../Utils ./WGLGeometryBrush ../materialKey/MaterialKey".split(" "),
function(d,a,c,g,b,e,k,m){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}c(d,a);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return b.WGLGeometryType.TEXT};d.prototype.drawGeometry=function(a,b,c,d){var h=a.context,g=a.painter,k=a.rendererInfo,n=a.drawPhase,t=a.state,f=c.indexCount,y=c.indexFrom;c=m.TextMaterialKey.load(c.materialKey);var l=e.createProgramDescriptor(c.data,{geometry:[{location:0,
name:"a_pos",count:2,type:5122},{location:1,name:"a_id",count:4,type:5121},{location:2,name:"a_color",count:4,type:5121,normalized:!0},{location:3,name:"a_vertexOffset",count:2,type:5122},{location:4,name:"a_texFontSize",count:4,type:5120},{location:5,name:"a_aux",count:4,type:5120}]}),n=g.materialManager.getProgram(c,n,k,"text",l.attributes);d=this._getVAO(h,l.bufferLayouts,l.attributes,d);h.bindProgram(n);h.bindVAO(d);this._setSharedUniforms(n,a,b);g.textureManager.bindTextures(h,n,c,4);n.setUniformMatrix3fv("u_displayMat3",
t.displayMat3);c.vvSizeMinMaxValue&&n.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue);c.vvSizeScaleStops&&n.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(n.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),n.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&n.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio);c.vvColor&&(n.setUniform1fv("u_vvColorValues",k.vvColorValues),
n.setUniform4fv("u_vvColors",k.vvColors));c.vvOpacity&&(n.setUniform1fv("u_vvOpacityValues",k.vvOpacityValues),n.setUniform1fv("u_vvOpacities",k.vvOpacities));c.vvRotation&&n.setUniform1f("u_vvRotationType","geographic"===k.vvMaterialParameters.vvRotationType?0:1);h.drawElements(4,f,5125,4*y);h.bindVAO(null)};return d}(k.default);a.default=d})},"esri/views/2d/engine/webgl/painter/WGLHighlightPainter":function(){define("require exports ../../../../../core/has ./highlight/HighlightGradient ./highlight/HighlightRenderer ./highlight/HighlightSurfaces".split(" "),
function(d,a,c,g,b,e){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._hlRenderer=new b.default;this._hlSurfaces=new e.default;this._hlGradient=new g.default;this._adjustedHeight=this._adjustedWidth=this._height=this._width=void 0}a.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._hlGradient&&this._hlGradient.destroy();this._boundFBO=null};a.prototype.setup=function(a,b,c){this._width=b;this._height=
c;var e=b%4,d=c%4;b+=2>e?-e:4-e;c+=2>d?-d:4-d;this._adjustedWidth=b;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();b=Math.round(.75*b);c=Math.round(.75*c);this._hlRenderer.setup(a,b,c);this._hlSurfaces.setup(a,b,c)};a.prototype.startMaskDraw=function(a){a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.setClearStencil(0);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT);a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight)};a.prototype.draw=
function(a){a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);a.setBlendingEnabled(!0);a.setViewport(0,0,this._width,this._height);
this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex,this._hlGradient);this._boundFBO=null};a.prototype.setHighlightOptions=function(a){this._hlGradient.setHighlightOptions(a)};return a}();a.default=d})},"esri/views/2d/engine/webgl/painter/highlight/HighlightGradient":function(){define("require exports ../../../../../../core/Logger ../../../../../webgl ../../definitions ./parameters".split(" "),function(d,a,c,g,b,e){function k(a,b){b.outlineColor[0]=b.fillColor[0]=a.color.r/255;b.outlineColor[1]=
b.fillColor[1]=a.color.g/255;b.outlineColor[2]=b.fillColor[2]=a.color.b/255;b.outlineColor[3]=b.fillColor[3]=a.color.a;b.fillColor[3]*=a.fillOpacity;b.outlineColor[3]*=a.haloOpacity;b.fillColor[0]*=b.fillColor[3];b.fillColor[1]*=b.fillColor[3];b.fillColor[2]*=b.fillColor[3];b.outlineColor[0]*=b.outlineColor[3];b.outlineColor[1]*=b.outlineColor[3];b.outlineColor[2]*=b.outlineColor[3];b.outlineWidth=e.HIGHLIGHT_SIZING.outlineWidth;b.outerHaloWidth=e.HIGHLIGHT_SIZING.outerHaloWidth;b.innerHaloWidth=
e.HIGHLIGHT_SIZING.innerHaloWidth;b.outlinePosition=e.HIGHLIGHT_SIZING.outlinePosition}Object.defineProperty(a,"__esModule",{value:!0});var m=c.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient"),h=[0,0,0,0];d=function(){function a(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:e.HIGHLIGHT_SIZING.outlinePosition,outlineWidth:e.HIGHLIGHT_SIZING.outlineWidth,innerHaloWidth:e.HIGHLIGHT_SIZING.innerHaloWidth,
outerHaloWidth:e.HIGHLIGHT_SIZING.outerHaloWidth};this.shadeTexChanged=!0;this.texelData=new Uint8Array(4*e.SHADE_TEXTURE_SIZE);this.minMaxDistance=[0,0]}a.prototype.setHighlightOptions=function(a){function b(a,b,c){u[0]=(1-c)*a[0]+c*b[0];u[1]=(1-c)*a[1]+c*b[1];u[2]=(1-c)*a[2]+c*b[2];u[3]=(1-c)*a[3]+c*b[3]}var c;k(a,this._convertedHighlightOptions);a=this._convertedHighlightOptions.outlinePosition-this._convertedHighlightOptions.outlineWidth/2-this._convertedHighlightOptions.outerHaloWidth;var d=
this._convertedHighlightOptions.outlinePosition-this._convertedHighlightOptions.outlineWidth/2,g=this._convertedHighlightOptions.outlinePosition+this._convertedHighlightOptions.outlineWidth/2,n=this._convertedHighlightOptions.outlinePosition+this._convertedHighlightOptions.outlineWidth/2+this._convertedHighlightOptions.innerHaloWidth,r=Math.sqrt(Math.PI/2)*e.SIGMAS[3],v=Math.abs(a)>r?Math.round(10*(Math.abs(a)-r))/10:0,r=Math.abs(n)>r?Math.round(10*(Math.abs(n)-r))/10:0;v&&!r?m.error("The outer rim of the highlight is "+
v+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!v&&r?m.error("The inner rim of the highlight is "+r+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):v&&r&&m.error("The highlight is "+Math.max(v,r)+"px away from the edge of the feature; consider reducing some width values.");for(var u=[void 0,void 0,void 0,
void 0],v=this.texelData,r=0;r<e.SHADE_TEXTURE_SIZE;++r)c=a+r/(e.SHADE_TEXTURE_SIZE-1)*(n-a),c<a?(u[4*r+0]=0,u[4*r+1]=0,u[4*r+2]=0,u[4*r+3]=0):c<d?b(h,this._convertedHighlightOptions.outlineColor,(c-a)/(d-a)):c<g?(c=this._convertedHighlightOptions.outlineColor,u[0]=c[0],u[1]=c[1],u[2]=c[2],u[3]=c[3]):c<n?b(this._convertedHighlightOptions.outlineColor,this._convertedHighlightOptions.fillColor,(c-g)/(n-g)):(c=this._convertedHighlightOptions.fillColor,u[4*r+0]=c[0],u[4*r+1]=c[1],u[4*r+2]=c[2],u[4*r+
3]=c[3]),v[4*r+0]=255*u[0],v[4*r+1]=255*u[1],v[4*r+2]=255*u[2],v[4*r+3]=255*u[3];this.minMaxDistance[0]=a;this.minMaxDistance[1]=n;this.shadeTexChanged=!0};a.prototype.applyHighlightOptions=function(a,c){this.shadeTex||(this.shadeTex=new g.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:e.SHADE_TEXTURE_SIZE,height:1,samplingMode:9729}));this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,e.SHADE_TEXTURE_SIZE,1,this.texelData),this.shadeTexChanged=!1);a.bindTexture(this.shadeTex,
b.TEXTURE_BINDING_HIGHLIGHT_1);c.setUniform2fv("u_minMaxDistance",this.minMaxDistance)};a.prototype.destroy=function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)};return a}();a.default=d})},"esri/views/2d/engine/webgl/painter/highlight/parameters":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.SIGMAS=[void 0,void 0,void 0,1];a.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1];a.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX=
[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.SHADE_TEXTURE_SIZE=256;a.HIGHLIGHT_SIZING={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0}})},"esri/views/2d/engine/webgl/painter/highlight/HighlightRenderer":function(){define("require exports ../../../../../webgl ../../definitions ./parameters ../../shaders/HighlightPrograms".split(" "),function(d,a,c,g,b,e){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=
function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)};a.prototype.preBlur=function(a,c){a.bindTexture(c,g.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",b.ALPHA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);
a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.finalBlur=function(a,c){a.bindTexture(c,g.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",b.RGBA_TO_RGBA_CHANNEL_SELECTOR_MATRIX);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.renderHighlight=function(a,b,c){a.bindTexture(b,
g.TEXTURE_BINDING_HIGHLIGHT_0);a.bindProgram(this._resources.highlightProgram);c.applyHighlightOptions(a,this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.setBlendingEnabled(!0);a.setBlendFunction(1,771);a.drawArrays(5,0,4);a.bindVAO()};a.prototype._initialize=function(a,d,k){this._width=d;this._height=k;d=new c.BufferObject(a,34962,35044,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);k=new c.VertexArrayObject(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",
count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:d});var h=c.createProgram(a,e.highlight);a=c.createProgram(a,e.blur);h.setUniform1i("u_texture",g.TEXTURE_BINDING_HIGHLIGHT_0);h.setUniform1i("u_shade",g.TEXTURE_BINDING_HIGHLIGHT_1);h.setUniform4fv("u_sigmas",b.SIGMAS);a.setUniform1i("u_texture",g.TEXTURE_BINDING_HIGHLIGHT_0);a.setUniform4fv("u_sigmas",b.SIGMAS);this._resources={quadGeometry:d,quadVAO:k,highlightProgram:h,
blurProgram:a}};a.prototype.setup=function(a,b,c){this._resources?(this._width=b,this._height=c):this._initialize(a,b,c)};return a}();a.default=d})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require","exports","./sources/resolver"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});a.highlight={name:"highlight",shaders:{vertexShader:c.resolveIncludes("highlight/textured.vert"),fragmentShader:c.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,
a_texcoord:1}};a.blur={name:"blur",shaders:{vertexShader:c.resolveIncludes("highlight/textured.vert"),fragmentShader:c.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/painter/highlight/HighlightSurfaces":function(){define(["require","exports","../../../../../webgl"],function(d,a,c){function g(a,e,d){e=new c.Texture(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:e,height:d,samplingMode:9729});a=c.FramebufferObject.createWithAttachments(a,
e,{colorTarget:0,depthStencilTarget:2});return[e,a]}Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};a.prototype._initialize=function(a,b,c){this._width=b;this._height=c;var e=g(a,b,c),d=
e[0],e=e[1];a=g(a,b,c);this._resources={sharedBlur1Tex:d,sharedBlur1Fbo:e,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};a.prototype.setup=function(a,b,c){!this._resources||this._width===b&&this._height===c||this.dispose();this._resources||this._initialize(a,b,c)};Object.defineProperty(a.prototype,"sharedBlur1Tex",{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});return a}();a.default=d})},"esri/views/2d/engine/webgl/shaders/RasterPrograms":function(){define(["require","exports","./sources/resolver"],function(d,a,c){Object.defineProperty(a,"__esModule",
{value:!0});a.transformTexture={name:"transform-texture",shaders:{vertexShader:c.resolveIncludes("raster/transform.vert"),fragmentShader:c.resolveIncludes("raster/texture.frag")},attributes:{a_position:0,a_texcoord:1}};a.transformSolid={name:"transform-solid",shaders:{vertexShader:c.resolveIncludes("raster/transform.vert"),fragmentShader:c.resolveIncludes("raster/solid.frag")},attributes:{a_position:0}}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require","exports",
"./sources/resolver"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});a.stencil={name:"stencil",shaders:{vertexShader:c.resolveIncludes("stencil/stencil.vert"),fragmentShader:c.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../webgl ./definitions ./Utils ./util/debug".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x){Object.defineProperty(a,"__esModule",{value:!0});var C=e.getLogger("esri.views.2d.engine.webgl.AttributeStoreView"),t=x.createDebugLogger(x.DEBUG_ATTR_UPDATES,C),w=function(){function a(a,b,c){this.texelSize=4;var f=u.getPixelArrayCtor(b);this.pixelType=b;this.size=c;this.data=new f(a);this._resetRange()}a.prototype.destroy=function(){k.andThen(this._texture,function(a){return a.dispose()})};a.prototype.setData=function(a,b,c){this.data[a*this.texelSize+b]=c;this.dirtyStart=
Math.min(this.dirtyStart,a);this.dirtyEnd=Math.max(this.dirtyEnd,a)};a.prototype.getData=function(a,b){return this.data[a*this.texelSize+b]};a.prototype.getTexture=function(a){var b=this;return k.unwrapOr(this._texture,function(){return b._initTexture(a)})};a.prototype.updateTexture=function(a){var c=this.dirtyStart,e=this.dirtyEnd;if(!(c>e)){this._resetRange();a=this.getTexture(a);var c=(c-c%this.size)/this.size,e=(e-e%this.size)/this.size,f=c*this.size*4,d=4*(this.size+e*this.size)-f,l=u.getPixelArrayCtor(this.pixelType),
f=new l(this.data.buffer,f*l.BYTES_PER_ELEMENT,d),d=this.size,e=e-c+1;e>this.size?C.error(new b("mapview-webgl","Out-of-bounds index when updating AttributeData")):a.updateData(0,0,c,d,e,f)}};a.prototype.update=function(a,b){a=b.data;var c=b.start,f=b.end;if(k.isSome(a))for(var e=this.data,l=c*this.texelSize,d=0;d<a.length;d++)b.layout&1<<d%this.texelSize&&(e[l+d]=a[d]);this.dirtyStart=Math.min(this.dirtyStart,c);this.dirtyEnd=Math.max(this.dirtyEnd,f)};a.prototype._resetRange=function(){this.dirtyStart=
this.data.length/4;this.dirtyEnd=0};a.prototype._initTexture=function(a){return this._texture=new h.Texture(a,{wrapMode:33071,pixelFormat:6408,dataType:this.pixelType,samplingMode:9728,width:this.size,height:this.size},this.data)};return a}();d=function(){function a(){this._initialized=!1}a.prototype.initialize=function(a){var b=a.blocks,c=a.size;this.shared=a.shared;this.size=c;k.andThen(this._data,function(a){return k.mapMany(a,function(a){return a.destroy()})});this._data=k.mapMany(b,function(a){return new w(a.buffer,
a.pixelType,c)});this._initialized=!0};a.prototype.destroy=function(){k.andThen(this._data,function(a){return k.mapMany(a,function(a){return a.destroy()})});k.andThen(this._defaultTexture,function(a){return a.dispose()})};a.prototype.setLabelMinZoom=function(a,b){this.setData(a,0,1,b)};a.prototype.getLabelMinZoom=function(a){return this.getData(a,0,1)};a.prototype.getFilterFlags=function(a){return this.getData(a,0,0)};a.prototype.getVVSize=function(a){return this.getData(a,1,0)};a.prototype.getData=
function(a,b,c){b=k.expect(this._data)[b];return k.isNone(b)?0:b.getData(a,c)};a.prototype.setData=function(a,b,c,f){b=k.expect(this._data)[b];k.expect(b).setData(a,c,f)};a.prototype.requestUpdate=function(a){return g(this,void 0,void 0,function(){var e;return c(this,function(c){if(this._pendingAttributeUpdate)return C.error(new b("mapview-webgl","Tried to update attribute data with a pending update")),[2];e=m.createResolver();this._pendingAttributeUpdate={data:a,resolver:e};return[2,e.promise]})})};
a.prototype.update=function(a){if(this._initialized&&k.isSome(this._pendingAttributeUpdate)){for(var b=this._pendingAttributeUpdate,c=b.data,b=b.resolver,f=k.expect(this._data),e=function(b){var e=c.blocks[b];k.andThen(f[b],function(c){return k.andThen(e,function(f){t("Updating block "+b,f);c.update(a,f)})})},l=0;l<c.blocks.length;l++)e(l);this._pendingAttributeUpdate=null;b()}};a.prototype.bindTextures=function(a){var b=this._getDefaultTexture(a);if(this._initialized){var c=k.expect(this._data);
k.forEachSome(c,function(b){return b.updateTexture(a)});a.bindTexture(k.mapOr(c[0],b,function(b){return b.getTexture(a)}),n.TEXTURE_BINDING_ATTRIBUTE_DATA_0);a.bindTexture(k.mapOr(c[1],b,function(b){return b.getTexture(a)}),n.TEXTURE_BINDING_ATTRIBUTE_DATA_1);a.bindTexture(k.mapOr(c[2],b,function(b){return b.getTexture(a)}),n.TEXTURE_BINDING_ATTRIBUTE_DATA_2)}else a.bindTexture(b,n.TEXTURE_BINDING_ATTRIBUTE_DATA_0),a.bindTexture(b,n.TEXTURE_BINDING_ATTRIBUTE_DATA_1),a.bindTexture(b,n.TEXTURE_BINDING_ATTRIBUTE_DATA_2)};
a.prototype._getDefaultTexture=function(a){k.isNone(this._defaultTexture)&&(this._defaultTexture=new h.Texture(a,{wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array(4)));return this._defaultTexture};return a}();a.AttributeStoreView=d})},"esri/views/2d/engine/webgl/util/debug":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.createDebugLogger=function(a,d){return a&&function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=
arguments[c];return d.warn.apply(d,["DEBUG:"].concat(a))}||function(){return null}};a.DEBUG_ATTR_UPDATES=!1})},"esri/views/2d/engine/webgl/collisions/CollisionGrid":function(){define(["require","exports","../definitions"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a){this._bucketSize=a;this._rowsLength=c.TILE_SIZE/a;this._colsLength=c.TILE_SIZE/a;this._grid=this._initGrid()}a.prototype.checkOverlap=function(a,c){a=Math.floor(a/this._bucketSize);c=Math.floor(c/
this._bucketSize);if(0>a||a>=this._rowsLength||0>c||c>=this._colsLength||this._grid[c][a])return!0;this._grid[c][a]=!0;return!1};a.prototype.reset=function(){this._grid=this._initGrid()};a.prototype._initGrid=function(){for(var a=[],c=0;c<this._rowsLength;c++)a.push(Array(this._colsLength));return a};return a}();a.CollisionGrid=d})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/iterator @dojo/framework/shim/Map ../../../../../core/mathUtils ../definitions ./CollisionBucket ./LayerCollisionInfo ../../../support/mathUtils".split(" "),
function(d,a,c,g,b,e,k,m,h,n){Object.defineProperty(a,"__esModule",{value:!0});var u=k.TILE_SIZE/k.COLLISION_BUCKET_SIZE;d=function(){function a(a){this._layers=new b.default;this._collisionBuckets=new b.default;this._tilingScheme=a}Object.defineProperty(a.prototype,"collisionInfos",{get:function(){var a=[];g.forOf(this._layers.values(),function(b){return a.push(b)});return a},enumerable:!0,configurable:!0});a.prototype.registerLayerView=function(a,b){if(!this._layers.has(a)){var c=h.default.create(a,
b,this.collisionInfos,this._tilingScheme);this._layers.set(a,c);this._collisionBuckets.forEach(function(a){return a.onRegisterLayer(c.index)})}};a.prototype.unregisterLayerView=function(a){var b=this;if(this._layers.has(a)){var c=this._layers.get(a);h.default.delete(c.index,this.collisionInfos);this._layers.delete(a);this._collisionBuckets.forEach(function(a,e){var d=a.getTile(c.index);d&&(a.onUnregisterLayer(c.index),a.canDelete()&&b._collisionBuckets.delete(e),d.reference&&(d.reference.isDirty=
!1))})}};a.prototype.addTile=function(a,b){var c=b.key.id;this._layers.has(a)&&(this._collisionBuckets.has(c)||this._collisionBuckets.set(c,new m.default(b.key,this._layers.size)),this._collisionBuckets.get(c).getTile(this._getIndex(a)).reference=b)};a.prototype.removeTile=function(a,b){this._layers.has(a)&&this._collisionBuckets.has(b)&&(a=this._collisionBuckets.get(b).getTile(this._getIndex(a)),a.dirty=!1,a.reference=null)};a.prototype.run=function(a,b){for(var e=c.from(this._collisionBuckets.values()).filter(function(a){return a.key.level===
b}).sort(function(a,b){return a.key.compareRowMajor(b.key)}),d=this._checkRotation(a.rotation),g=0;g<e.length;g++)for(var k=e[g],d=d||k.isDirty,n=0;n<this._layers.size;n++){var f=h.default.find(n,this.collisionInfos);k.computeNeighbors(this._collisionBuckets);k.reset(a,d,f)}for(a=0;a<this._layers.size;a++)for(f=h.default.find(a,this.collisionInfos),d=0,g=e;d<g.length;d++)k=g[d],this._run(k,f,b);for(f=0;f<e.length;f++)k=e[f],k.ready()};a.prototype._run=function(a,b,c){var e=a.getReference(b.index);
e&&e.isDirty&&e.hasData&&this._runVisibility(a,e,b,c)};a.prototype._checkLabelsVisible=function(a,b){var c=!b.effect||b.effect.excludedLabelsVisible||!!(a&k.EFFECT_FLAG_0);return(!b.filter||!!(a&k.FILTER_FLAG_0))&&c};a.prototype._runVisibility=function(a,b,c,e){for(var d=c.layerView.tileRenderer.featuresView.attributeView,h=0,g=b.displayObjects;h<g.length;h++){var f=g[h];if(f.metrics.length){for(var k=0,l=d.getFilterFlags(f.id),n=this._checkLabelsVisible(l,c.layerView),m=0;m<f.metrics.length;m++)l=
f.metrics[m],l=n?this._computeLabelVisibility(f,l,c.index,a,b,l.baseZoom,e):255,k=Math.max(l,k);d.setLabelMinZoom(f.id,k);n=0;for(f=f.metrics;n<f.length;n++)l=f[n],l.minZoom=k}}};a.prototype._computeLabelVisibility=function(a,b,c,e,d,h,g){for(var f=b.xBucket,k=b.yBucket,l=b.xOverflow,n=b.yOverflow,m=f-l,f=f+l+1,l=k+n+1,k=k-n;k<l;k++)for(n=m;n<f;n++)if(!(n<-u||k<-u||n>u||k>u))for(var t=0;t<=c;t++){var r=this._getRelativeSubBucket(t,e,d,n,k);if(r)for(var w=0;w<r.length;w++){var v=r[w];v.id!==a.id&&
(v=this._compareLabels(b,v,h,g),h=Math.max(v,h))}}return h};a.prototype._compareLabels=function(a,b,c,d){var h=10*(d+k.COLLISION_MAX_ZOOM_DELTA);if(-1===b.minZoom||b.minZoom>h||b.minZoom>Math.floor(10*d))return c;a=a.findCollisionDelta(b);d=e.clamp(Math.floor(10*(a+d)),0,255);return b.minZoom>=d?c:Math.max(c,d)};a.prototype._getNeighboringTile=function(a,b,c,e,d){return(b=b.neighbors[3*(1+d)+(1+e)])&&b.getTile(a)};a.prototype._getRelativeSubBucket=function(a,b,c,e,d){var h=n.sign(Math.floor(e/4)),
g=n.sign(Math.floor(d/4));return(a=this._getNeighboringTile(a,b,c,h,g))&&a.reference&&a.index&&a.reference.hasData?a.index[d-4*g][e-4*h]:null};a.prototype._checkRotation=function(a){if(!this._lastRotation)return this._lastRotation=a,!1;var b=a!==this._lastRotation;this._lastRotation=a;return b};a.prototype._getIndex=function(a){return this._layers.get(a).index};return a}();a.CollisionEngine=d})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require","exports","../../../tiling",
"./CollisionBucketEntry"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b){this.neighbors=Array(9);this._tiles=Array(b);for(var c=0;c<b;c++)this._tiles[c]=new g.default;this.key=a}Object.defineProperty(a.prototype,"isDirty",{get:function(){for(var a=0,b=this._tiles;a<b.length;a++)if(b[a].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._tiles.length},enumerable:!0,configurable:!0});
a.prototype.getTile=function(a){return this._tiles[a]};a.prototype.getReference=function(a){return(a=this._tiles[a])&&a.reference};a.prototype.onRegisterLayer=function(a){this.invalidateRange(a);this._add(a)};a.prototype.onUnregisterLayer=function(a){this.invalidateRange(a);this._remove(a)};a.prototype.onLabelsRendered=function(){};a.prototype.invalidateRange=function(a){for(;a<this._tiles.length;a++)this._tiles[a].dirty=!0};a.prototype.add=function(a){this._add(a)};a.prototype.remove=function(a){this._remove(a)};
a.prototype.canDelete=function(){return 0===this._tiles.length};a.prototype.ready=function(){for(var a=0,b=this._tiles;a<b.length;a++)b[a].dirty=!1};a.prototype.computeNeighbors=function(a){this.neighbors[0]=this._getNeighbor(a,-1,-1);this.neighbors[1]=this._getNeighbor(a,0,-1);this.neighbors[2]=this._getNeighbor(a,1,-1);this.neighbors[3]=this._getNeighbor(a,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(a,1,0);this.neighbors[6]=this._getNeighbor(a,-1,1);this.neighbors[7]=this._getNeighbor(a,
0,1);this.neighbors[8]=this._getNeighbor(a,1,1)};a.prototype.reset=function(a,b,c){for(var e=0,d=this._tiles;e<d.length;e++){var g=d[e];g&&g.reset(a,b,c)}};a.prototype._add=function(a){var b=[];if(a>=this._tiles.length)this._tiles.push(new g.default);else{for(var c=0;c<this._tiles.length;c++)c===a&&b.push(new g.default),b.push(this._tiles[c]);this._tiles=b}};a.prototype._remove=function(a){for(var b=[],c=0;c<this._tiles.length;c++)c!==a&&b.push(this._tiles[c]);this._tiles=b};a.prototype._getNeighbor=
function(a,b,d){var e=this.key;b=c.TileKey.getId(e.level,e.row+d,e.col+b,e.world);return a.has(b)?a.get(b):null};return a}();a.default=d})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._reference=null}Object.defineProperty(a.prototype,"dirty",{get:function(){return this.reference&&this.reference.isDirty},
set:function(a){this.reference&&this.reference.hasData&&(this.reference.isDirty=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"reference",{get:function(){return this._reference},set:function(a){this._reference=a},enumerable:!0,configurable:!0});a.prototype.reset=function(a,e,d){var b=d.layerView.tileRenderer,h=this.reference;if(!h||!h.hasData)return!1;
e&&(h.isDirty=!0);e=h.labelMat2d;for(var g=h.labelMat2d[4],k=h.labelMat2d[5],x=0,C=h.displayObjects;x<C.length;x++)for(var t=C[x],w=b.featuresView.attributeView.getVVSize(t.id),z=0,t=t.metrics;z<t.length;z++){var r=t[z];d.hasVV()&&r.computeOffset(w,d.vvEval);var v=r.bounds.center,B=r.bounds.centerT;h.isDirty&&(r.minZoom=-1);var f=c.vec2.copy(B,r.anchor);a.rotation?c.vec2.transformMat2d(f,f,e):(B[0]=f[0]+g,B[1]=f[1]+k);c.vec2.add(B,f,v);B[0]+=r.offsetX;B[1]+=r.offsetY;if(r.boxes)for(v=0,B=r.boxes;v<
B.length;v++){var f=B[v],y=f.centerT;c.vec2.add(y,r.anchor,f.center);a.rotation?c.vec2.transformMat2d(y,y,e):(y[0]+=g,y[1]+=k)}}return!0};return a}();a.default=d})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define("require exports ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/screenUtils ./visualVariableSimpleUtils".split(" "),function(d,a,c,g,b,e){function k(a){return function(c){return b.pt2px(e.getSizeForValueSimple(c,a))}}function m(a){if(!a)return null;
for(var b=0;b<a.length;b++){var c=a[b];if("size"===c.type)return k(c)}return null}Object.defineProperty(a,"__esModule",{value:!0});var h=function(a,b){return a.order-b.order},n=function(a,b){return a.index-b.index},u=c.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");a.createLabelVVEvaluator=m;d=function(){function a(a,b,c,e){var d=this;this._vvHandle=null;var h=a.layer,k=h.geometryType,f=h.labelingInfo,n=h.renderer;this.vvEval=m("visualVariables"in n&&n.visualVariables);this._vvHandle=
h.watch("visualVariables",function(a){d.vvEval=m(a)});h=f.map(function(a){var b=!!a.maxScale,c=!!a.minScale&&e.scaleToZoom(a.minScale)||0;a=b&&e.scaleToZoom(a.maxScale)||255;return{minZoom:g.clamp(Math.floor(10*c),0,255),maxZoom:g.clamp(Math.floor(10*a),0,255)}});this.layerView=a;this.geometryType=k;this.index=b;this.order=c;this.zoomRanges=h;this.layerView=a}a.prototype.hasVV=function(){return!!this.vvEval};a.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};a.prototype.destroy=
function(){this._vvHandle.remove()};a.create=function(b,c,e,d){e=e.sort(h);for(var g=!1,k=-1,n=0;n<e.length;n++){var f=e[n];!g&&f.order>c&&(k=f.index,g=!0);g&&f.index++}g||(k=e.length);return new a(b,k,c,d)};a.delete=function(a,b){for(var c=b.sort(n),e=a+1;e<c.length;e++)b[e].index--;b[a].destroy();b.splice(a,1)};a.find=function(a,b){for(var c=0;c<b.length;c++){var e=b[c];if(e.index===a)return e}u.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return a}();
a.default=d})},"esri/views/2d/engine/webgl/collisions/visualVariableSimpleUtils":function(){define(["require","exports","../../../../../core/mathUtils","../../../../../renderers/support/utils"],function(d,a,c,g){function b(a,b){switch(b.transformationType){case "additive":var d=e(b.minSize,a);return a+(d||b.minDataValue);case "constant":return d=(d=b.stops)&&d.length&&d[0].size,null==d&&(d=b.minSize),e(d,a);case "clamped-linear":var d=(a-b.minDataValue)/(b.maxDataValue-b.minDataValue),h=e(b.minSize,
a),n=e(b.maxSize,a);a=a<=b.minDataValue?h:a>=b.maxDataValue?n:h+d*(n-h);return a;case "proportional":return d=a/b.minDataValue,h=e(b.minSize,a),a=e(b.maxSize,a),c.clamp(d*h,h,a);case "stops":return h=k(a,b.cache.ipData),n=h[0],d=h[1],h=h[2],n===d?a=e(b.stops[n].size,a):(n=e(b.stops[n].size,a),a=e(b.stops[d].size,a),a=n+(a-n)*h),a;case "real-world-size":d=g.meterIn[b.valueUnit];h=e(b.minSize,a);n=e(b.maxSize,a);b=b.valueRepresentation;var t=null,t="area"===b?2*Math.sqrt(a/m)/d:"radius"===b||"distance"===
b?2*a/d:a/d;return c.clamp(t,h,n);case "identity":return a;case "unknown":return null}}function e(a,c){return"number"===typeof a?a:b(c,a)}function k(a,b){if(b){var c=0,e=b.length-1;b.some(function(b,d){if(a<b)return e=d,!0;c=d;return!1});return[c,e,(a-b[c])/(b[e]-b[c])]}}Object.defineProperty(a,"__esModule",{value:!0});var m=Math.PI;a.getSizeForValueSimple=b})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require","exports","@dojo/framework/shim/Map"],function(d,a,c){function g(a){return"esri.views.2d.layers.FeatureLayerView2D"===
a.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===a.declaredClass}Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b){this.registerLayer=a;this.unregisterLayer=b;this._layerViewState=new c.default}a.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(b){return b.uid===a.uid})};a.prototype.update=function(a){for(var b=a.added,c=0,e=a.removed;c<e.length;c++)a=e[c],g(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(c=0;c<b.length;c++){a=
b[c];if(e=g(a))a:switch(a.get("layer.renderer.type")){case "class-breaks":case "simple":case "unique-value":e=!0;break a;default:e=!1}e&&!this._layerViewState.has(a)&&this._createState(a)}this._recomputeOrder()};a.prototype.destroy=function(){this._layerViewState.forEach(function(a,b){return a.handle.remove()})};a.prototype._createState=function(a){var b={priority:-1,handle:null};b.handle=a.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(a,b);return b};a.prototype._deleteState=
function(a){if(this._layerViewState.has(a)){var b=this._layerViewState.get(a);b.handle.remove();-1!==b.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};a.prototype._recomputeOrder=function(){var a=this;this._layerViewState.forEach(function(b,c){var e=c.view.map.allLayers.findIndex(function(a){return a.uid===c.layer.uid}),d=c.layer,e=d.visible&&d.labelsVisible&&d.labelingInfo?4294967295-e:-1;e!==b.priority&&(b.priority=e,a.unregisterLayer(c),-1!==e&&a.registerLayer(c,e))})};return a}();
a.LayerViewSorter=d})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b){this.x=a;this.y=b}a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.equals=function(a,b){return a===this.x&&b===this.y};a.prototype.isEqual=function(a){return a.x===this.x&&a.y===this.y};a.prototype.setCoords=function(a,b){this.x=a;this.y=b};a.prototype.normalize=function(){var a=this.x,
b=this.y,a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a};a.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};a.prototype.move=function(a,b){this.x+=a;this.y+=b};a.prototype.assign=function(a){this.x=a.x;this.y=a.y};a.prototype.assignAdd=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y};a.prototype.assignSub=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y};a.prototype.rotate=function(a,b){var c=this.x,d=this.y;this.x=c*a-d*b;this.y=c*b+d*a};a.prototype.scale=function(a){this.x*=a;this.y*=
a};a.prototype.length=function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};a.distance=function(a,b){var c=b.x-a.x;a=b.y-a.y;return Math.sqrt(c*c+a*a)};a.add=function(c,b){return new a(c.x+b.x,c.y+b.y)};a.sub=function(c,b){return new a(c.x-b.x,c.y-b.y)};return a}();a.Point=d})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(d,a,c,g,b){Object.defineProperty(a,"__esModule",{value:!0});var e=function(){return function(a,
b,c){this.ratio=a;this.x=b;this.y=c}}();d=function(){function a(a,b,e,d,g){void 0===d&&(d=8);void 0===g&&(g=8);this.lines=[];this.starts=[];this.pixelRatio=d;this.pixelMargin=g;this.tileSize=c.TILE_SIZE*d;this.dz=a;this.yPos=b;this.xPos=e}a.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var b=this.pixelRatio*this.pixelMargin,b=b/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+
a+2*b};a.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};a.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new g.Point(a,b);this._firstPt=new g.Point(a,b);this._dist=0};a.prototype.lineTo=function(a,b){var c=this._isIn(a,b),d=new g.Point(a,b),h=g.Point.distance(this._prevPt,d),k,n,m;if(c)this._prevIsIn?this._lineTo(a,b,!0):(k=this._prevPt,n=d,a=this._intersect(n,k),this.start=
this._dist+h*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(n.x,n.y,!0));else if(this._prevIsIn)n=this._prevPt,k=d,a=this._intersect(n,k),this._lineTo(a.x,a.y,!0),this._lineTo(k.x,k.y,!1);else{var r=this._prevPt;if(!(r.x<=this.xmin&&d.x<=this.xmin||r.x>=this.xmax&&d.x>=this.xmax||r.y<=this.ymin&&d.y<=this.ymin||r.y>=this.ymax&&d.y>=this.ymax)){a=[];if(r.x<this.xmin&&d.x>this.xmin||r.x>this.xmin&&d.x<this.xmin)b=(this.xmin-r.x)/(d.x-r.x),m=r.y+b*(d.y-r.y),m<=this.ymin?n=!1:m>=this.ymax?n=!0:a.push(new e(b,
this.xmin,m));if(r.x<this.xmax&&d.x>this.xmax||r.x>this.xmax&&d.x<this.xmax)b=(this.xmax-r.x)/(d.x-r.x),m=r.y+b*(d.y-r.y),m<=this.ymin?n=!1:m>=this.ymax?n=!0:a.push(new e(b,this.xmax,m));if(r.y<this.ymin&&d.y>this.ymin||r.y>this.ymin&&d.y<this.ymin)b=(this.ymin-r.y)/(d.y-r.y),m=r.x+b*(d.x-r.x),m<=this.xmin?k=!1:m>=this.xmax?k=!0:a.push(new e(b,m,this.ymin));if(r.y<this.ymax&&d.y>this.ymax||r.y>this.ymax&&d.y<this.ymax)b=(this.ymax-r.y)/(d.y-r.y),m=r.x+b*(d.x-r.x),m<=this.xmin?k=!1:m>=this.xmax?k=
!0:a.push(new e(b,m,this.ymax));if(0===a.length)k?n?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):n?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this.start=this._dist+h*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+h*a[0].ratio,k=0;k<a.length;k++)this._lineTo(a[k].x,a[k].y,!0)}this._lineTo(d.x,d.y,!1)}this._dist+=h;this._prevIsIn=c;this._prevPt=
d};a.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};a.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&k.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};
a.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var c=[],d=0;d<b;d++)c.push({line:a[d],start:this.starts[d]||0});return c};a.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};a.prototype._intersect=function(a,b){var c,d,e;if(b.x>=this.xmin&&b.x<=this.xmax)d=b.y<=this.ymin?this.ymin:this.ymax,e=(d-a.y)/(b.y-a.y),c=a.x+e*(b.x-a.x);else if(b.y>=
this.ymin&&b.y<=this.ymax)c=b.x<=this.xmin?this.xmin:this.xmax,e=(c-a.x)/(b.x-a.x),d=a.y+e*(b.y-a.y);else{d=b.y<=this.ymin?this.ymin:this.ymax;c=b.x<=this.xmin?this.xmin:this.xmax;var h=(c-a.x)/(b.x-a.x),k=(d-a.y)/(b.y-a.y);h<k?(e=h,d=a.y+h*(b.y-a.y)):(e=k,c=a.x+k*(b.x-a.x))}this._r=e;return new g.Point(c,d)};a.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),
this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};a.prototype._moveTo=function(a,b,c){3!==this.type?c&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new g.Point(a,b))):(c||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*
this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new g.Point(a,b)),this._is_v=this._is_h=!1)};a.prototype._lineTo=function(a,b,c){if(3!==this.type)if(c){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(c=this.line[this.line.length-1],c.equals(a,b)))return;this.line.push(new g.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(c||(a<this.xmin&&(a=
this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){c=this.line[this.line.length-1];var d=c.x===a,e=c.y===b;d&&e||(this._is_h&&d?(c.x=a,c.y=b,c=this.line[this.line.length-2],c.x===a&&c.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(c=this.line[this.line.length-2],this._is_h=c.x===a,this._is_v=
c.y===b)):(this._is_h=c.x===a,this._is_v=c.y===b)):this._is_v&&e?(c.x=a,c.y=b,c=this.line[this.line.length-2],c.x===a&&c.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(c=this.line[this.line.length-2],this._is_h=c.x===a,this._is_v=c.y===b)):(this._is_h=c.x===a,this._is_v=c.y===b)):(this.line.push(new g.Point(a,b)),this._is_h=d,this._is_v=e))}else this.line.push(new g.Point(a,b))};return a}();a.TileClipper=d;d=function(){function a(){}a.prototype.setExtent=function(a){this._ratio=
4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var c=this._ratio;this.line.push(new g.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.lineTo=function(a,b){var c=this._ratio;this.line.push(new g.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=function(){this.line&&
this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&k.simplify(4096,64,this.lines);return this.lines};return a}();a.SimpleBuilder=d;var k=function(){function a(){}a.simplify=function(b,c,d){if(d){var e=-c,g=b+c,h=-c,k=b+c;b=[];c=[];for(var m=d.length,n=0;n<m;++n){var v=d[n];if(v&&!(2>v.length))for(var B=v[0],f=void 0,y=v.length,l=1;l<y;++l)f=v[l],B.x===f.x&&(B.x<=e&&(B.y>f.y?(b.push(n),b.push(l),b.push(0),b.push(-1)):(c.push(n),c.push(l),c.push(0),c.push(-1))),
B.x>=g&&(B.y<f.y?(b.push(n),b.push(l),b.push(1),b.push(-1)):(c.push(n),c.push(l),c.push(1),c.push(-1)))),B.y===f.y&&(B.y<=h&&(B.x<f.x?(b.push(n),b.push(l),b.push(2),b.push(-1)):(c.push(n),c.push(l),c.push(2),c.push(-1))),B.y>=k&&(B.x>f.x?(b.push(n),b.push(l),b.push(3),b.push(-1)):(c.push(n),c.push(l),c.push(3),c.push(-1)))),B=f}0!==b.length&&0!==c.length&&(a.fillParent(d,c,b),a.fillParent(d,b,c),e=[],a.calcDeltas(e,c,b),a.calcDeltas(e,b,c),a.addDeltas(e,d))}};a.fillParent=function(a,c,d){for(var e=
d.length,g=c.length,h=0;h<g;h+=4){for(var k=c[h],m=c[h+1],n=c[h+2],v=a[k][m-1],k=a[k][m],m=8092,B=-1,f=0;f<e;f+=4)if(d[f+2]===n){var y=d[f],l=d[f+1],D=a[y][l-1],y=a[y][l];switch(n){case 0:case 1:b.between(v.y,D.y,y.y)&&b.between(k.y,D.y,y.y)&&(D=Math.abs(y.y-D.y),D<m&&(m=D,B=f));break;case 2:case 3:b.between(v.x,D.x,y.x)&&b.between(k.x,D.x,y.x)&&(D=Math.abs(y.x-D.x),D<m&&(m=D,B=f))}}c[h+3]=B}};a.calcDeltas=function(b,c,d){for(var e=c.length,g=0;g<e;g+=4){var h=a.calcDelta(g,c,d,[]);b.push(c[g]);b.push(c[g+
1]);b.push(c[g+2]);b.push(h)}};a.calcDelta=function(b,c,d,e){b=c[b+3];if(-1===b)return 0;var g=e.length;if(1<g&&e[g-2]===b)return 0;e.push(b);return a.calcDelta(b,d,c,e)+1};a.addDeltas=function(a,b){for(var c=a.length,d=0,e=0;e<c;e+=4){var g=a[e+3];g>d&&(d=g)}for(e=0;e<c;e+=4){var h=b[a[e]],k=a[e+1],g=d-a[e+3];switch(a[e+2]){case 0:h[k-1].x-=g;h[k].x-=g;1===k&&(h[h.length-1].x-=g);k===h.length-1&&(h[0].x-=g);break;case 1:h[k-1].x+=g;h[k].x+=g;1===k&&(h[h.length-1].x+=g);k===h.length-1&&(h[0].x+=g);
break;case 2:h[k-1].y-=g;h[k].y-=g;1===k&&(h[h.length-1].y-=g);k===h.length-1&&(h[0].y-=g);break;case 3:h[k-1].y+=g,h[k].y+=g,1===k&&(h[h.length-1].y+=g),k===h.length-1&&(h[0].y+=g)}}};return a}()})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["require","exports","../../../../symbols/cim/enums","./mesh/templates/util"],function(d,a,c,g){function b(){if(f.cosine<x.innerBisectorAutoSplitThreshold){f.splitInner=!0;f.gapInner=!0;var a=Math.max(x.innerBisectorAutoSplitThreshold,f.cosine),
a=Math.sqrt(1-a*a)/a;f.leftInner.x=f.nextNormal.x+f.sign*a*f.outbound.x;f.leftInner.y=f.nextNormal.y+f.sign*a*f.outbound.y;f.rightInner.x=f.prevNormal.x-f.sign*a*f.inbound.x;f.rightInner.y=f.prevNormal.y-f.sign*a*f.inbound.y}else x.enableInnerBisectorSplit&&(f.splitInner=!0,f.gapInner=!1,f.leftInner.x=f.rightInner.x=f.bisector.x/f.cosine,f.leftInner.y=f.rightInner.y=f.bisector.y/f.cosine);f.cosine<x.outerBisectorAutoSplitThreshold?(f.splitOuter=!0,f.gapOuter=!0,a=Math.max(x.outerBisectorAutoSplitThreshold,
f.cosine),a=Math.sqrt(1-a*a)/a,f.leftOuter.x=f.prevNormal.x-f.sign*a*f.inbound.x,f.leftOuter.y=f.prevNormal.y-f.sign*a*f.inbound.y,f.rightOuter.x=f.nextNormal.x+f.sign*a*f.outbound.x,f.rightOuter.y=f.nextNormal.y+f.sign*a*f.outbound.y):x.enableOuterBisectorSplit&&(f.splitOuter=!0,f.gapOuter=!1,f.leftOuter.x=f.rightOuter.x=f.bisector.x/f.cosine,f.leftOuter.y=f.rightOuter.y=f.bisector.y/f.cosine)}function e(){if(r)f.distance=0,r=f.isCap=f.isFirstVertex=f.isLastVertex=!1;else{if(0===w)if(f.isFirstVertex=
0===t,B=u[t],0===t){if(w=0,f.closed){f.inbound.x=B.x-u[u.length-2].x;f.inbound.y=B.y-u[u.length-2].y;var a=Math.sqrt(f.inbound.x*f.inbound.x+f.inbound.y*f.inbound.y);f.inbound.x/=a;f.inbound.y/=a}}else f.inbound.x=B.x-v.x,f.inbound.y=B.y-v.y,w=Math.sqrt(f.inbound.x*f.inbound.x+f.inbound.y*f.inbound.y),f.inbound.x/=w,f.inbound.y/=w;f.distance+w-z<=x.wrapDistance?(t<u.length-1?(f.outbound.x=u[t+1].x-B.x,f.outbound.y=u[t+1].y-B.y,a=Math.sqrt(f.outbound.x*f.outbound.x+f.outbound.y*f.outbound.y),f.outbound.x/=
a,f.outbound.y/=a):f.closed?(f.outbound.x=u[1].x-B.x,f.outbound.y=u[1].y-B.y,a=Math.sqrt(f.outbound.x*f.outbound.x+f.outbound.y*f.outbound.y),f.outbound.x/=a,f.outbound.y/=a):(f.outbound.x=f.inbound.x,f.outbound.y=f.inbound.y),0!==t||f.closed||(f.inbound.x=f.outbound.x,f.inbound.y=f.outbound.y),++t,f.isLastVertex=t===u.length,f.isCap=!f.closed&&(f.isFirstVertex||f.isLastVertex),f.distance+=w-z,z=w=0,r=f.distance+w-z===x.wrapDistance,f.currentVertex.x=B.x,f.currentVertex.y=B.y,v=B,B=null):(f.outbound.x=
f.inbound.x,f.outbound.y=f.inbound.y,z+=x.wrapDistance-f.distance,f.distance=x.wrapDistance,r=!0,a=z/w,f.currentVertex.x=(1-a)*v.x+a*B.x,f.currentVertex.y=(1-a)*v.y+a*B.y)}}function k(){f.prevNormal.x=-f.inbound.y;f.prevNormal.y=f.inbound.x;f.nextNormal.x=-f.outbound.y;f.nextNormal.y=f.outbound.x}function m(){k();f.bisector.x=f.prevNormal.x+f.nextNormal.x;f.bisector.y=f.prevNormal.y+f.nextNormal.y;var a=Math.sqrt(f.bisector.x*f.bisector.x+f.bisector.y*f.bisector.y);.001>a?(f.bisector.x=void 0,f.bisector.y=
void 0,f.cosine=0,f.sign=void 0):(f.bisector.x/=a,f.bisector.y/=a,f.cosine=f.bisector.x*f.nextNormal.x+f.bisector.y*f.nextNormal.y,f.sign=0<=f.prevNormal.x*f.nextNormal.y-f.prevNormal.y*f.nextNormal.x?1:-1)}function h(a){C.vertex(f);1===a?(f.leftEntry0=f.entry0,f.leftEntry1=f.entry1,f.leftEntry2=f.entry2,f.leftExit0=f.exit0,f.leftExit1=f.exit1,f.leftExit2=f.exit2):2===a&&(f.rightEntry0=f.entry0,f.rightEntry1=f.entry1,f.rightEntry2=f.entry2,f.rightExit0=f.exit0,f.rightExit1=f.exit1,f.rightExit2=f.exit2)}
function n(a){C.vertex(f);1===a?(f.leftEntry0=f.entry0,f.leftEntry2=f.entry2,f.leftExit0=f.exit0,f.leftExit2=f.exit2):2===a&&(f.rightEntry0=f.entry0,f.rightEntry2=f.entry2,f.rightExit0=f.exit0,f.rightExit2=f.exit2)}Object.defineProperty(a,"__esModule",{value:!0});d=function(){return function(){this.isCap=this.isLastVertex=this.isFirstVertex=this.closed=void 0;this.currentVertex={x:void 0,y:void 0};this.inbound={x:void 0,y:void 0};this.outbound={x:void 0,y:void 0};this.prevNormal={x:void 0,y:void 0};
this.nextNormal={x:void 0,y:void 0};this.bisector={x:void 0,y:void 0};this.leftInner={x:void 0,y:void 0};this.rightInner={x:void 0,y:void 0};this.leftOuter={x:void 0,y:void 0};this.rightOuter={x:void 0,y:void 0}}}();a.TessellationState=d;a.tessellate=function(a,b,c){x.trackDistance=null!=b.trackDistance?b.trackDistance:!1;x.wrapDistance=null!=b.wrapDistance?b.wrapDistance:65535;x.thin=null!=b.thin?b.thin:!1;x.initialDistance=null!=b.initialDistance?b.initialDistance:0;x.enableOuterBisectorSplit=null!=
b.enableOuterBisectorSplit?b.enableOuterBisectorSplit:!1;x.outerBisectorAutoSplitThreshold=null!=b.outerBisectorAutoSplitThreshold?b.outerBisectorAutoSplitThreshold:0;x.enableInnerBisectorSplit=null!=b.enableOuterBisectorSplit?b.enableOuterBisectorSplit:!1;x.innerBisectorAutoSplitThreshold=null!=b.innerBisectorAutoSplitThreshold?b.innerBisectorAutoSplitThreshold:0;u=a;C=c;z=w=t=0;r=!1;B=v=null;f.currentVertex.x=null;f.currentVertex.y=null;f.distance=x.initialDistance;a=u[0];b=u[u.length-1];f.canSplit=
!1;f.closed=a.x===b.x&&a.y===b.y;if(!(2>u.length||2===u.length&&f.closed))if(x.thin)if(x.trackDistance)for(e(),k(),n(1);w-z>x.wrapDistance||t<u.length;)e(),k(),n(2),C.bridge(f),f.leftExit0=f.rightExit0,f.leftExit2=f.rightExit2;else for(;t<u.length;)0<t&&(f.inbound.x=f.outbound.x,f.inbound.y=f.outbound.y),t<u.length-1?(f.outbound.x=u[t+1].x-u[t].x,f.outbound.y=u[t+1].y-u[t].y,a=Math.sqrt(f.outbound.x*f.outbound.x+f.outbound.y*f.outbound.y),f.distance+=a,f.outbound.x/=a,f.outbound.y/=a):(f.outbound.x=
f.inbound.x,f.outbound.y=f.inbound.y),0===t&&(f.inbound.x=f.outbound.x,f.inbound.y=f.outbound.y),f.currentVertex.x=u[t].x,f.currentVertex.y=u[t].y,f.prevNormal.x=-f.inbound.y,f.prevNormal.y=f.inbound.x,f.nextNormal.x=-f.outbound.y,f.nextNormal.y=f.outbound.x,0===t?(C.vertex(f),f.leftEntry0=f.entry0,f.leftEntry2=f.entry2,f.leftExit0=f.exit0,f.leftExit2=f.exit2):(C.vertex(f),f.rightEntry0=f.entry0,f.rightEntry2=f.entry2,f.rightExit0=f.exit0,f.rightExit2=f.exit2,C.bridge(f),f.leftExit0=f.rightExit0,
f.leftExit2=f.rightExit2),++t;else{if(x.enableOuterBisectorSplit||0<x.outerBisectorAutoSplitThreshold||x.enableInnerBisectorSplit||0<x.innerBisectorAutoSplitThreshold)for(f.canSplit=!0,e(),m(),f.splitInner=f.gapInner=f.splitOuter=f.gapOuter=!1,h(1),f.closure0=f.leftEntry0,f.closure1=f.leftEntry1,f.closure2=f.leftEntry2;w-z>x.wrapDistance||t<u.length-1||t<u.length&&(!f.closed||x.trackDistance);)e(),m(),f.splitInner=f.gapInner=f.splitOuter=f.gapOuter=!1,h(2),C.bridge(f),f.leftExit0=f.rightExit0,f.leftExit1=
f.rightExit1,f.leftExit2=f.rightExit2;else for(e(),m(),h(1),f.closure0=f.leftEntry0,f.closure1=f.leftEntry1,f.closure2=f.leftEntry2;w-z>x.wrapDistance||t<u.length-1||t<u.length&&(!f.closed||x.trackDistance);)e(),m(),h(2),C.bridge(f),f.leftExit0=f.rightExit0,f.leftExit1=f.rightExit1,f.leftExit2=f.rightExit2;f.closed&&!x.trackDistance&&(f.rightEntry0=f.closure0,f.rightEntry1=f.closure1,f.rightEntry2=f.closure2,C.bridge(f),f.leftExit0=f.rightExit0,f.leftExit1=f.rightExit1,f.leftExit2=f.rightExit2)}};
a.splitVertex=b;var u,x={},C,t=void 0,w,z,r,v,B,f=new d;d=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b;this.capType=c.CapType.BUTT;this.joinType=c.JoinType.MITER;this.miterLimitCosine=g.getLimitCosine(2);this.roundLimitCosine=Math.cos(23*Math.PI/180);this.almostParallelCosine=.97;this.radsPerSlice=.8;this.textured=!1}a.prototype.vertex=function(a){var d=this.joinType===c.JoinType.MITER?this.miterLimitCosine:this.roundLimitCosine,e=a.isCap&&this.capType!==c.CapType.BUTT,f=!1;
a.cosine>this.almostParallelCosine?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):a.cosine<1-this.almostParallelCosine?(a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.canSplit?(b(),0<a.sign?(a.splitInner?(a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.leftInner.x,a.leftInner.y,0,-1,a.distance),a.entry0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,a.inbound.x,a.inbound.y,a.rightInner.x,a.rightInner.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<d?(f=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.splitOuter?
(f=f||a.gapOuter,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.leftOuter.x,-a.leftOuter.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,-a.rightOuter.x,-a.rightOuter.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.splitInner?(a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,
a.outbound.y,-a.leftInner.x,-a.leftInner.y,0,1,a.distance),a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,-a.rightInner.x,-a.rightInner.y,0,1,a.distance)):a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<d?(f=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.splitOuter?(f=f||a.gapOuter,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.leftOuter.x,a.leftOuter.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.outbound.x,a.outbound.y,a.rightOuter.x,a.rightOuter.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance))):
0<a.sign?(a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,a.inbound.x,a.inbound.y,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance),a.cosine<d?(f=!a.isCap,a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance),a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)):a.entry2=a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/
a.cosine,-a.bisector.y/a.cosine,0,1,a.distance)):(a.exit2=a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.bisector.x/a.cosine,-a.bisector.y/a.cosine,0,1,a.distance),a.cosine<d?(f=!a.isCap,a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance),a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,a.nextNormal.y,0,-1,a.distance)):a.exit0=a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,
0,0,a.bisector.x/a.cosine,a.bisector.y/a.cosine,0,-1,a.distance));d=a.canSplit&&(a.splitInner||a.splitOuter)||f||e?a.entry1=a.exit1=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,0,0,0,0,a.distance):a.entry1=a.exit1=null;if(f&&this.joinType!==c.JoinType.ROUND)this.writeTriangle(d,0<a.sign?a.exit2:a.entry0,0<a.sign?a.entry2:a.exit0);else if(e&&this.capType===c.CapType.ROUND||f&&this.joinType===c.JoinType.ROUND){var g=f=e=void 0,h=void 0,l=void 0,k=void 0;if(a.isCap){var m=Math.PI,l=Math.ceil(m/
this.radsPerSlice),k=m/l;a.isFirstVertex?(e=a.prevNormal.x,f=a.prevNormal.y,g=a.entry0,h=a.entry2):a.isLastVertex&&(e=-a.nextNormal.x,f=-a.nextNormal.y,g=a.exit2,h=a.exit0)}else m=2*Math.acos(a.cosine),l=Math.ceil(m/this.radsPerSlice),k=m/l,e=0<a.sign?-a.prevNormal.x:a.nextNormal.x,f=0<a.sign?-a.prevNormal.y:a.nextNormal.y,g=0<a.sign?a.entry2:a.exit0,h=0<a.sign?a.exit2:a.entry0;for(var m=Math.cos(k),k=Math.sin(k),n=k*e+m*f,e=m*e-k*f,f=n,r,n=void 0,t=0;t<l;++t)r=n,t<l-1&&(n=a.isCap?this.writeVertex(a.currentVertex.x,
a.currentVertex.y,0,0,e,f,a.isFirstVertex?-1:1,0,a.distance):this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,e,f,0,a.sign,a.distance)),this.writeTriangle(0===t?g:r,d,t===l-1?h:n),r=k*e+m*f,e=m*e-k*f,f=r}else e&&this.capType===c.CapType.SQUARE&&(e=a.isFirstVertex?1:-1,g=f=void 0,this.textured?(f=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-e*a.inbound.x,a.prevNormal.y-e*a.inbound.y,-e,-1,a.distance),g=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-
e*a.inbound.x,-a.prevNormal.y-e*a.inbound.y,-e,1,a.distance)):(f=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x-e*a.inbound.x,a.prevNormal.y-e*a.inbound.y,0,-1,a.distance),g=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x-e*a.inbound.x,-a.prevNormal.y-e*a.inbound.y,0,1,a.distance)),0<e?(this.writeTriangle(d,a.entry2,g),this.writeTriangle(d,g,f),this.writeTriangle(d,f,a.entry0)):(this.writeTriangle(d,g,a.exit2),this.writeTriangle(d,f,g),this.writeTriangle(d,
a.exit0,f)))};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,null!=a.leftExit1?a.leftExit1:a.leftExit2);this.writeTriangle(a.rightEntry0,null!=a.rightEntry1?a.rightEntry1:a.rightEntry2,null!=a.leftExit1?a.leftExit1:a.leftExit2);null!=a.leftExit1&&null!=a.rightEntry1?(this.writeTriangle(a.leftExit1,a.rightEntry1,a.leftExit2),this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)):null!=a.leftExit1?this.writeTriangle(a.leftExit1,a.rightEntry2,a.leftExit2):null!=a.rightEntry1&&
this.writeTriangle(a.rightEntry1,a.rightEntry2,a.leftExit2)};return a}();a.StandardTessellationCallbacks=d;d=function(){function a(a,b){this.writeVertex=a;this.writeTriangle=b}a.prototype.vertex=function(a){a.entry0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.prevNormal.x,a.prevNormal.y,0,-1,a.distance);a.entry2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.prevNormal.x,-a.prevNormal.y,0,1,a.distance);a.exit0=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,a.nextNormal.x,
a.nextNormal.y,0,-1,a.distance);a.exit2=this.writeVertex(a.currentVertex.x,a.currentVertex.y,0,0,-a.nextNormal.x,-a.nextNormal.y,0,1,a.distance)};a.prototype.bridge=function(a){this.writeTriangle(a.leftExit0,a.rightEntry0,a.leftExit2);this.writeTriangle(a.rightEntry0,a.rightEntry2,a.leftExit2)};return a}();a.ThinTessellationCallbacks=d})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define("require exports ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/Logger ../../util/Matcher".split(" "),
function(d,a,c,g,b,e,k){Object.defineProperty(a,"__esModule",{value:!0});var m=e.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");a.createMatcher=function(a,e,d){return g(this,void 0,void 0,function(){return c(this,function(c){switch(a.type){case "simple":case "dot-density":return[2,k.FeatureMatcher.fromBasicRenderer(a,e,d)];case "unique-value":return[2,k.MapMatcher.fromUVRenderer(a,e,d)];case "class-breaks":return[2,k.IntervalMatcher.fromCBRenderer(a,e,d)];case "dictionary":return[2,
k.DictionaryMatcher.fromDictionaryRenderer(a,e,d)];default:return m.error(new b("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),[2,null]}})})}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/asyncUtils ../../../../../core/Logger ../../../../../core/promiseUtils ../../../../../support/arcadeOnDemand ../../../../../symbols/support/cimSymbolUtils ../../../arcade/utils".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u){Object.defineProperty(a,"__esModule",{value:!0});var x=k.getLogger("esri/views/2d/engine/webgl/util/Matcher");d=function(){function a(){this._defaultResult=null}a.fromBasicRenderer=function(c,e,d){return b(this,void 0,void 0,function(){var b,h,k;return g(this,function(f){switch(f.label){case 0:return[4,n.expandSymbols(c.getSymbols(),n.constructUrlFn)];case 1:return b=f.sent(),h=new a,b.length&&(k=e.createTemplateGroup(b[0],null,c,d),h.setDefault(k)),[2,h]}})})};a.prototype.size=
function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=function(a,b,c,e,d){return this.getDefault()};a.prototype.analyze=function(a,c,e,d,h){return b(this,void 0,void 0,function(){return g(this,function(a){return[2]})})};return a}();a.FeatureMatcher=d;k=function(a){function e(b,c,e,d){var g=a.call(this)||this;g._intervals=[];g._isMaxInclusive=c;d?g._getValue=u.callWithFeature.bind(null,d):b&&b.length?
"function"===typeof b?(g._field=null,g._getValue=b):(g._field=b,g._normalizationInfo=e,g._getValue=g._getValueFromField.bind(g)):g._field=null;return g}c(e,a);e.fromCBRenderer=function(a,c,d){return b(this,void 0,void 0,function(){var b,k,f,m,l,r,t,w,E,u,L,z,x,C,M,H,S,J,P;return g(this,function(g){switch(g.label){case 0:return b=a.isMaxInclusive,k=a.normalizationField,f=a.normalizationTotal,m=a.normalizationType,l=a.field,r={normalizationField:k,normalizationTotal:f,normalizationType:m},(E=t=a.valueExpression)?
[4,h.createRendererExpression(t,d.spatialReference,d.fields)]:[3,2];case 1:E=g.sent(),g.label=2;case 2:return w=E,u=new e(l,b,r,w),[4,n.expandSymbol(a.backgroundFillSymbol,n.constructUrlFn)];case 3:L=g.sent(),z=0,x=a.classBreakInfos,g.label=4;case 4:if(!(z<x.length))return[3,7];C=x[z];return[4,n.expandSymbol(C.symbol,n.constructUrlFn)];case 5:M=g.sent(),H=c.createTemplateGroup(M,L,a,d),S={min:C.minValue,max:C.maxValue},u.add(S,H),g.label=6;case 6:return z++,[3,4];case 7:return[4,n.expandSymbol(a.defaultSymbol,
n.constructUrlFn)];case 8:if(J=g.sent())P=c.createTemplateGroup(J,L,a,d),u.setDefault(P);return[2,u]}})})};e.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};e.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};e.prototype.match=function(a,b,c,e,d){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:d},c,e);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();
for(b=0;b<this._intervals.length;b++)if(e=this._intervals[b],c=e.interval,e=e.result,d=this._isMaxInclusive?a<=c.max:a<c.max,a>=c.min&&d)return e;return this.getDefault()};e.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};e.prototype._getValueFromField=function(a){var b=a.attributes[this._field];if(!this._needsNormalization())return b;var c=this._normalizationInfo,e=c.normalizationField,d=c.normalizationTotal,
c=c.normalizationType;a=!!e&&a.attributes[e];if(c)switch(c){case "field":return(a||void 0)&&b/a;case "log":return Math.log(b)*Math.LOG10E;case "percent-of-total":return b/d*100;default:x.error("Found unknown normalization type: "+c)}else x.error("Normalization is required, but no type was set!")};return e}(d);a.IntervalMatcher=k;k=function(a){function e(b,c,e){var d=a.call(this)||this;d._resultsMap=new Map;e?d._getValue=u.callWithFeature.bind(null,e):b&&b.length?"function"===typeof b[0]?(d._fields=
null,d._getValue=b[0]):(d._fields=b,d._seperator=c||"",d._getValue=d._getValueFromFields.bind(d)):d._fields=null;return d}c(e,a);e.fromUVRenderer=function(a,c,d){return b(this,void 0,void 0,function(){var b,k,f,m,l,r,t,w,E,u,L,z,x,C,M;return g(this,function(g){switch(g.label){case 0:return b=a.uniqueValueInfos,k=a.fieldDelimiter,f=[a.field],m=a.valueExpression,a.field2&&f.push(a.field2),a.field3&&f.push(a.field3),[4,n.expandSymbol(a.backgroundFillSymbol,n.constructUrlFn)];case 1:return l=g.sent(),
(t=m)?[4,h.createRendererExpression(m,d.spatialReference,d.fields)]:[3,3];case 2:t=g.sent(),g.label=3;case 3:r=t,w=new e(f,k,r),E=0,u=b,g.label=4;case 4:if(!(E<u.length))return[3,7];L=u[E];return[4,n.expandSymbol(L.symbol,n.constructUrlFn)];case 5:z=g.sent(),x=c.createTemplateGroup(z,l,a,d),w.add(L.value,x),g.label=6;case 6:return E++,[3,4];case 7:return[4,n.expandSymbol(a.defaultSymbol,n.constructUrlFn)];case 8:if(C=g.sent())M=c.createTemplateGroup(a.defaultSymbol,l,a,d),w.setDefault(M);return[2,
w]}})})};e.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};e.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};e.prototype.match=function(a,b,c,e,d){if(!this._getValue)return this.getDefault();a=this._getValue(b,{$view:d},c,e);if(!a&&(null===a||void 0===a))return this.getDefault();a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};e.prototype._getValueFromFields=function(a){for(var b=[],c=0,e=this._fields;c<
e.length;c++)b.push(a.attributes[e[c]]);return b.join(this._seperator)};return e}(d);a.MapMatcher=k;d=function(a){function d(b,c,d){var e=a.call(this)||this;e._fidToAttributeHash=new Map;e._attributeHashToGroup=new Map;e._renderer=b;e._fieldMap=b.fieldMap;e._templates=c;e._info=d;return e}c(d,a);d.fromDictionaryRenderer=function(a,c,e){return b(this,void 0,void 0,function(){return g(this,function(b){a.fetchResources();return[2,new d(a,c,e)]})})};d.prototype.analyze=function(a,c,d,h,k){return b(this,
void 0,void 0,function(){var b,d,h,n,r,t,E=this;return g(this,function(f){switch(f.label){case 0:b=[];d=function(c){var d=c.attributes[a],f=h._fidToAttributeHash.get(d),g=h._hashAttributes(c);if(f===g)return"continue";h._fidToAttributeHash.set(d,g);h._attributeHashToGroup.has(g)||(c=e.safeCast(h._renderer.fetchSymbol(c,k)).then(function(a){a=E._templates.createTemplateGroup(a,null,E._renderer,E._info);E._attributeHashToGroup.set(g,a)}),b.push(c))};h=this;n=0;for(r=c;n<r.length;n++)t=r[n],d(t);return[4,
m.all(b)];case 1:return f.sent(),[2]}})})};d.prototype.match=function(a,b,c,d,e){a=this._fidToAttributeHash.get(b.attributes[a]);return this._attributeHashToGroup.get(a)};d.prototype._hashAttributes=function(a){var b="",c;for(c in this._fieldMap)b+=". "+a.attributes[this._fieldMap[c]];return b};return d}(d);a.DictionaryMatcher=d})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/Error ../../../../../../core/has ../../../../../../core/Logger ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/SpatialReference ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../MeshData ../VertexVector ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f,y,l){function D(a){var b=(a.attributes?Object.keys(a.attributes):[]).map(function(b){return{name:b,alias:b,type:"string"===typeof a.attributes[b]?"esriFieldTypeString":"esriFieldTypeDouble"}});return{geometryType:null!=a.centroid?"esriGeometryPolygon":x.getJsonType(a.geometry),spatialReference:u.fromJSON(a.geometry.spatialReference),fields:b}}Object.defineProperty(a,"__esModule",{value:!0});var A=m.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),
G={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};d=function(){function a(a,b,c,d,e,f){this._isDD=!1;this._labelsDebugTemplate=null;this._isDD=h.isSome(c)&&"dot-density"===c.type;this._geometryType=a;this._idField=b;this._templateStore=d;e&&this._validateLabelingInfo(e)&&
(this._labelTemplates=e.map(function(a){return B.default.fromLabelClass(c,a,f)}))}Object.defineProperty(a.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,configurable:!0});a.prototype.createMeshData=function(a){var b=Array(5),c=this._labelTemplates&&0<this._labelTemplates.length,e="esriGeometryPolyline"===this._geometryType?t.HEURISTIC_GLYPHS_PER_LINE:t.HEURISTIC_GLYPHS_PER_FEATURE;b[w.WGLGeometryType.MARKER]=new v.VertexVectors(w.WGLGeometryType.MARKER,a);b[w.WGLGeometryType.FILL]=
new v.VertexVectors(w.WGLGeometryType.FILL,a,this._isDD);b[w.WGLGeometryType.LINE]=new v.VertexVectors(w.WGLGeometryType.LINE,a);b[w.WGLGeometryType.TEXT]=new v.VertexVectors(w.WGLGeometryType.TEXT,a);b[w.WGLGeometryType.LABEL]=new v.VertexVectors(w.WGLGeometryType.LABEL,c?e:0);return new r.MeshData([],b)};a.prototype.analyze=function(a,c,e,d,f){return b(this,void 0,void 0,function(){var b,k,m,r,t,E,y,v,A,w;return g(this,function(g){switch(g.label){case 0:return b=a,n.isAborted(f)?[2,[]]:h.isSome(c)?
[4,c.analyze(this._idField,a,e,d,f)]:[3,2];case 1:g.sent(),g.label=2;case 2:k=0;for(m=b;k<m.length;k++){r=m[k];t=-1;"symbol"in r?null!=r.symbol?(E=null,"cim"===r.symbol.type&&(E=D(r)),t=this._templateStore.createTemplateGroup(r.symbol,null,null,E)):h.isSome(c)&&(t=c.match(this._idField,r,null,null,d)):h.isSome(c)&&(t=c.match(this._idField,r,this._geometryType,e,d));if(l.isDynamicId(t))for(y=this._templateStore.getDynamicTemplateGroup(t),v=0,A=y;v<A.length;v++)(w=A[v])&&w.analyze&&w.analyze(this._templateStore,
r,e,d);r.groupId=t}return[2,this._templateStore.finalize(f).then(function(){return b})]}})})};a.prototype.write=function(a,b,c,e,d,f,g){var h=this._templateStore.getTemplateGroup(b.groupId),k=b.localId;if(null!=k){var m=new z(k),n=!!f&&!!this._labelTemplates&&f.has(k);if(l.isDynamicId(b.groupId))for(var r=0;r<h.length;r++){var t=h[r];t.bindFeature(b,c,e)}if(h&&(b.geometry||b.centroid)){e=m.displayRecords;t=b.insertAfter;void 0!==t&&(m.insertAfter=t);(c=this._geometryType)||(c=null!=b.centroid?"esriGeometryPolygon":
x.getJsonType(b.geometry));for(r=0;r<h.length;r++){var t=h[r],E=a.get(t.geometryType);t.writeMesh(e,E,c,k,b)}n&&(h=this._getLabelReference(h),f=f.get(k),this._writeLabelMesh(m,a,k,b,g,f,h,d,c));a.pushDisplayObject(m)}}};a.prototype._hasBadLabelClass=function(a,b){var c=a.labelPlacement,d=G[b];if(!a.symbol)return A.warn("No LabelClass symbol specified."),!0;if(!d)return A.error(new e("mapview-labeling:unsupported-geometry-type","Unable to create labels for Feature Layer, "+b+" is not supported")),
!0;d.some(function(a){return a===c})||(d=d[0],c&&A.warn("Found invalid label placement type "+c+" for "+b+". Defaulting to "+d),a.labelPlacement=d);return!1};a.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,b._geometryType)})};a.prototype._getLabelReference=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c instanceof y.default)return c}return null};a.prototype._writeLabelMesh=function(a,b,c,d,e,f,g,h,k){for(var l=a.displayRecords,
m=[],n=0;n<f.length;n++){var r=f[n],E=r.text,y=r.rtl,r=this._labelTemplates[r.id],v=b.get(r.geometryType),A=e.get(r.symbolId).glyphMosaicItems;r.bindReferenceTemplate(g);r.bindTextInfo(A,E,y);r.writeMesh(l,v,k,c,d,h,m)}a.metrics=m;t.DEBUG_LABELS&&this._debugLabels(a,b)};a.prototype._debugLabels=function(a,b){var c=a.displayRecords,d=a.id,e=0;for(a=a.metrics;e<a.length;e++)for(var f=a[e],g=0,h=f.boxes?f.boxes.concat([f.bounds]):[f.bounds];g<h.length;g++){var k=h[g],k={geometry:{paths:[[[f.anchor[0]+
f.offsetX+k.center[0]-k.width/2,f.anchor[1]+f.offsetY+k.center[1]+k.height/2],[0,-k.height],[k.width,0],[0,k.height],[-k.width,0]]]},attributes:{}},l=this._getLabelDebugTemplate(),m=b.get(l.geometryType);l.writeMesh(c,m,"esriGeometryPolyline",d,k)}};a.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate());return this._labelsDebugTemplate};a.prototype._createLabelsDebugTemplate=function(){var a=new C({style:"solid",width:1,
color:[255,0,0,1]});return f.default.fromSimpleLine(null,!1,a,null)};return a}();a.WGLMeshFactory=d})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(d,a,c,g,b){return function(){function a(a){this.insertAfter=null;this.id=a;this.displayRecords=[];this.metrics=[]}a.prototype.copy=function(){var b=new a(this.id);b.set(this);return b};a.prototype.clone=function(){var b=new a(this.id);
b.displayRecords=this.displayRecords.map(function(a){return a.clone()});b.metrics=this.metrics.map(function(a){return a.clone()});b.insertAfter=this.insertAfter;return b};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=function(a){a.push(this.id);b.serializeList(a,this.metrics);b.serializeList(a,this.displayRecords);return a};a.deserialize=function(d){var e=d.readInt32(),h=new a(e),e={id:e},
k=b.deserializeList(d,g.default);k.length&&(h.metrics=k);h.displayRecords=b.deserializeList(d,c,e);return h};return a}()})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require","exports","../util/serializationUtils","../util/Writer"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a,b){this.displayObjects=a;this.vertexVectorsMap=b}Object.defineProperty(a.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap=
{};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});a.prototype.get=function(a){return this.vertexVectorsMap[a]};a.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};a.prototype.encode=function(a,b){var d=c.serializeList(new g.default(Uint32Array,this._guessSize()),this.displayObjects).buffer(),e={};b.push(d);for(var k=0;k<this.vertexVectorsMap.length;k++){var u=
this.vertexVectorsMap[k];e[k]={};u.transfer(e[k],b)}a.displayObjects=d;a.vertexBuffersMap=e;this.destroy()};a.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};a.prototype._guessSize=function(){for(var a=this.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};return a}();a.MeshData=d})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,
"__esModule",{value:!0});d=function(){function a(a,b){this._pos=0;b=b?this._roundToNearest(b,a.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(b);this._buffer=new a(this._array);this._ctor=a}Object.defineProperty(a.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});a.prototype._roundToNearest=function(a,b){a=Math.round(a);return a+(b-a%b)};a.prototype._ensureSize=function(a){if(this._pos+a>=this._buffer.length){a=this._roundToNearest(1.5*(this._array.byteLength+
a*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);a=new ArrayBuffer(a);var b=new this._ctor(a);b.set(this._buffer,0);this._array=a;this._buffer=b}};a.prototype.writeF32=function(a){this._ensureSize(1);var b=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=a;this._pos++;return b};a.prototype.push=function(a){this._ensureSize(1);var b=this._pos;this._buffer[this._pos++]=a;return b};a.prototype.writeRegion=function(a){this._ensureSize(a.length);var b=this._pos;this._buffer.set(a,
this._pos);this._pos+=a.length;return b};a.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};a.prototype.seek=function(a){this._pos=a};a.prototype.destroy=function(){this._buffer=this._array=null};return a}();a.default=d})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require","exports","../Utils","./VertexBuffer","../util/Writer"],function(d,a,c,g,b){Object.defineProperty(a,"__esModule",{value:!0});var e=function(){function a(a,b){this.data=
a;this.stride=b}Object.defineProperty(a.prototype,"vertexCount",{get:function(){return this.data.length/(this.stride/4)},enumerable:!0,configurable:!0});a.prototype.transfer=function(a,b){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;a.stride=this.stride;b.push(c)};return a}();a.default=e;d=function(){function a(a,d,g){void 0===g&&(g=!1);this.geometryType=a;this.indexVector=new b.default(Uint32Array,d);this.namedVectors={};a=c.getStrides(a,g);for(var h in a){g=a[h];var k=void 0;
switch(g%4){case 0:case 2:k=new b.default(Uint32Array,g/4*d);break;case 1:case 3:k=new b.default(Uint8Array,g*d)}this.namedVectors[h]=new e(k,g)}}a.prototype.get=function(a){return this.namedVectors[a].data};a.prototype.getVector=function(a){return this.namedVectors[a]};a.prototype.transfer=function(a,b){var c=this.indexVector.buffer(),d={};b.push(c);for(var e in this.namedVectors){var g=this.namedVectors[e];d[e]={};g.transfer(d[e],b)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=
d;this.destroy()};a.prototype.intoBuffers=function(){var a=g.VertexBuffers.fromVertexVectors(this);this.destroy();return a};a.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return a}();a.VertexVectors=d})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(d,a,c){Object.defineProperty(a,"__esModule",{value:!0});var g=function(){function a(a,b,c){this.data=a;this.stride=b;this.vertexCount=c}a.decode=function(b){var d=c.allocateTypedArrayBufferwithData(b.data,
b.stride);return new a(d,b.stride,b.vertexCount)};a.fromVertexVector=function(b){var d=c.allocateTypedArrayBufferwithData(b.data.buffer(),b.stride);return new a(d,b.stride,b.vertexCount)};return a}();a.default=g;d=function(){function a(a,b,c){this.geometryType=a;this.indexBuffer=new Uint32Array(b);this.namedBuffers=c}a.decode=function(b){var c=b.geometryType,d=b.indexBuffer,e={},n;for(n in b.namedBuffers)e[n]=g.decode(b.namedBuffers[n]);return new a(c,d,e)};a.fromVertexVectors=function(b){var c=b.geometryType,
d=b.indexVector.buffer(),e={},n;for(n in b.namedVectors)e[n]=g.fromVertexVector(b.namedVectors[n]);return new a(c,d,e)};return a}();a.VertexBuffers=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../Utils ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLMeshTemplate".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C){Object.defineProperty(a,"__esModule",{value:!0});var t=g.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");d=function(a){function d(b,c,d,e,g,h,k,m,t,E,w,z,x,C,O){var f=a.call(this)||this;b=n.LineMaterialKey.load(n.createMaterialKey(f.geometryType,b,x));c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding);f._capType=e;f._joinType=g;f._miterLimitCosine=u.getLimitCosine(h);f._fillColor=k;f._tl=m;f._br=t;f._hasPattern=E;f._isDashed=w;f._isColorLocked=
z;f._isOutline=x;f._zOrder=O;f._materialKey=b.data;f._bitset=z?1:0;f._halfWidth=.5*d;f._halfReferenceWidth=.5*C;f._initializeTessellator(!1);return f}c(d,a);d.fromCIMLine=function(a,c,g,f){var h=c.color,l=c.isDashed,n=c.cap;l&&n===e.CapType.ROUND&&(n=e.CapType.SQUARE);var r=c.join,t=b.pt2px(c.width),E=b.pt2px(c.referenceWidth),v=b.pt2px(c.miterLimit),h=h&&k.premultiplyAlphaRGBA(h)||0;if(!g)return new d(a,g,t,n,r,v,h,0,0,!1,l,c.colorLocked,f,E,c.zOrder);var w=g.rect,u=w.x+1+g.width,B=w.y+1+g.height,
w=m.i1616to32(w.x+1,w.y+1),u=m.i1616to32(u,B);return new d(a,g,t,n,r,v,h,w,u,!0,l,c.colorLocked,f,E,c.zOrder)};d.fromSimpleLine=function(a,c,e,f){var g=e.color,l="solid"!==e.style&&"none"!==e.style,n=h.getCapType(e.cap||"round",l),r=h.getJoinType(e.join||"round"),g=g&&"none"!==e.style&&k.premultiplyAlphaRGBA(g)||0;"none"===e.style&&(g=0);var t=b.pt2px(e.width);e=e.miterLimit;if(!f)return new d(a,f,t,n,r,e,g,0,0,!1,l,!1,c,t,0);var E=f.rect,v=E.x+1+f.width,w=E.y+1+f.height,E=m.i1616to32(E.x+1,E.y+1),
v=m.i1616to32(v,w);return new d(a,f,t,n,r,e,g,E,v,!0,l,!1,c,t,0)};d.fromPictureLineSymbol=function(a,b,c,d){t.error("PictureLineSymbol support does not exist!");return null};return d}(x.default(C.default));a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/has ../../../../../../core/Logger ../../definitions ../../enums ../../number ../../TileClipper ../../TurboLine ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x){Object.defineProperty(a,"__esModule",{value:!0});var C=b.getLogger("esri.views.2d.engine.webgl.WGLLineTemplateBase"),t=e.TILE_SIZE+8,w=1/3.8,z=new h.TileClipper(0,0,0,1,8);z.setExtent(e.TILE_SIZE);var r=new Uint32Array(9),v=new Uint32Array(36),B=new Uint32Array(3),f=new Uint32Array(6);a.default=function(a){return function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._tessellationOptions={};b.geometryType=k.WGLGeometryType.LINE;
return b}c(b,a);b.prototype.writeMesh=function(a,b,c,d,e){var f=b.indexVector,g=b.get("geometry"),h=new u(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;h.vertexFrom=b;h.indexFrom=f.length;switch(c){case "esriGeometryPolyline":c=this._clipLines(e.geometry.paths);if(0===c.length)break;this._write(h,f,g,b,d,c);a.push(h);break;case "esriGeometryPolygon":c=this._clipLines(e.geometry.rings);if(0===c.length)break;this._write(h,f,g,b,d,c);a.push(h);break;default:C.error("Unable to handle geometryType: "+
c)}};b.prototype._clipLines=function(a){for(var b=[],c=!1,d=0;d<a.length;){var e=[],f=a[d];z.reset(2);var g=f[0],h=g[0],g=g[1];if(c)z.moveTo(h,g);else{if(-8>h||h>t||-8>g||g>t){c=!0;continue}e.push({x:h,y:g})}for(var k=!1,l=f.length,m=1;m<l;++m)if(h+=f[m][0],g+=f[m][1],c)z.lineTo(h,g);else{if(-8>h||h>t||-8>g||g>t){k=!0;break}e.push({x:h,y:g})}if(k)c=!0;else{if(c){if(e=z.resultWithStarts())for(c=0;c<e.length;c++)b.push(e[c])}else b.push({line:e,start:0});d++;c=!1}}return b};b.prototype._write=function(a,
b,c,d,e,f){this.id=e;this.indexBuf=b;this.indexCount=0;this.geometryBuf=c;this.vertexCount=0;this.offset=d;for(b=0;b<f.length;b++)c=f[b],d=c.line,2>d.length||(this._tessellationOptions.initialDistance=c.start%65535,this._tessellationCallbacks instanceof n.StandardTessellationCallbacks&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),n.tessellate(d,this._tessellationOptions,this._tessellationCallbacks));a.vertexCount=this.vertexCount;a.indexCount=
this.indexCount;a.zOrder=this._zOrder};b.prototype._initializeTessellator=function(a){var b=x.LineMaterialKey.load(this._materialKey);this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern;this._tessellationOptions.thin=!a&&this._halfWidth<e.THIN_LINE_THRESHOLD/2&&!(b.vvSizeFieldStops||b.vvSizeMinMaxValue||b.vvSizeScaleStops||b.vvSizeUnitValue);this._tessellationOptions.wrapDistance=65535;this._tessellationOptions.outerBisectorAutoSplitThreshold=w;this._tessellationOptions.enableOuterBisectorSplit=
this._isDashed||this._hasPattern;this._tessellationOptions.innerBisectorAutoSplitThreshold=w;this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern;this._tessellationOptions.thin?this._tessellationCallbacks={vertex:this._thinVertex.bind(this),bridge:this._thinBridge.bind(this)}:(a=new n.StandardTessellationCallbacks(this._thickWriteVertex.bind(this),this._thickWriteTriangle.bind(this)),a.miterLimitCosine=this._miterLimitCosine,a.textured=this._isDashed||this._hasPattern,
this._tessellationCallbacks=a)};b.prototype._thinVertex=function(a){a.entry0=this.offset+this.vertexCount++;var b=m.i1616to32(a.distance,31*this._halfWidth),c=m.i8888to32(Math.round(31*a.prevNormal.x),Math.round(31*a.prevNormal.y),Math.round(0),Math.round(-31)),d=m.i8888to32(0,0,0,this._bitset);v[0]=m.i1616to32(a.currentVertex.x,a.currentVertex.y);v[1]=this.id;v[2]=this._fillColor;v[3]=c;v[4]=b;v[5]=this._tl;v[6]=this._br;v[7]=d;v[8]=m.i1616to32(31*this._halfReferenceWidth,0);a.entry2=this.offset+
this.vertexCount++;b=m.i1616to32(a.distance,31*this._halfWidth);c=m.i8888to32(Math.round(31*-a.prevNormal.x),Math.round(31*-a.prevNormal.y),Math.round(0),Math.round(31));d=m.i8888to32(0,0,0,this._bitset);v[9]=m.i1616to32(a.currentVertex.x,a.currentVertex.y);v[10]=this.id;v[11]=this._fillColor;v[12]=c;v[13]=b;v[14]=this._tl;v[15]=this._br;v[16]=d;v[17]=m.i1616to32(31*this._halfReferenceWidth,0);a.exit0=this.offset+this.vertexCount++;b=m.i1616to32(a.distance,31*this._halfWidth);c=m.i8888to32(Math.round(31*
a.nextNormal.x),Math.round(31*a.nextNormal.y),Math.round(0),Math.round(-31));d=m.i8888to32(0,0,0,this._bitset);v[18]=m.i1616to32(a.currentVertex.x,a.currentVertex.y);v[19]=this.id;v[20]=this._fillColor;v[21]=c;v[22]=b;v[23]=this._tl;v[24]=this._br;v[25]=d;v[26]=m.i1616to32(31*this._halfReferenceWidth,0);a.exit2=this.offset+this.vertexCount++;b=m.i1616to32(a.distance,31*this._halfWidth);c=m.i8888to32(Math.round(31*-a.nextNormal.x),Math.round(31*-a.nextNormal.y),Math.round(0),Math.round(31));d=m.i8888to32(0,
0,0,this._bitset);v[27]=m.i1616to32(a.currentVertex.x,a.currentVertex.y);v[28]=this.id;v[29]=this._fillColor;v[30]=c;v[31]=b;v[32]=this._tl;v[33]=this._br;v[34]=d;v[35]=m.i1616to32(31*this._halfReferenceWidth,0);this.geometryBuf.writeRegion(v)};b.prototype._thinBridge=function(a){f[0]=a.leftExit0;f[1]=a.rightEntry0;f[2]=a.leftExit2;f[3]=a.rightEntry0;f[4]=a.rightEntry2;f[5]=a.leftExit2;this.indexCount+=6;this.indexBuf.writeRegion(f)};b.prototype._thickWriteVertex=function(a,b,c,d,e,f,g,h,k){k=m.i1616to32(k,
31*this._halfWidth);e=m.i8888to32(Math.round(31*e),Math.round(31*f),Math.round(31*g),Math.round(31*h));c=m.i8888to32(31*c,31*d,0,this._bitset);r[0]=m.i1616to32(a,b);r[1]=this.id;r[2]=this._fillColor;r[3]=e;r[4]=k;r[5]=this._tl;r[6]=this._br;r[7]=c;r[8]=m.i1616to32(31*this._halfReferenceWidth,0);this.geometryBuf.writeRegion(r);return this.offset+this.vertexCount++};b.prototype._thickWriteTriangle=function(a,b,c){B[0]=a;B[1]=b;B[2]=c;this.indexCount+=3;this.indexBuf.writeRegion(B)};return b}(a)}})},
"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../definitions ../../number ../../materialKey/MaterialKey ./WGLBaseMarkerTemplate ./WGLMeshTemplate".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r){Object.defineProperty(a,"__esModule",{value:!0});var v=b.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate");d=function(a){function b(b,c,d,e,f,r,B,z,x,C,O,M,H,S,J,P,T,V){var l=a.call(this)||this;if(200<r||200<B)v.error(new g("mapview-oversized-resource","Marker size was clamped to the maximum allowed value of 200x200 pixels")),r>B?(B*=200/r,r=200):(r*=200/B,B=200);l.height=B;l.width=r;l.xOffset=c;l.yOffset=d;var E=n.vec2f32.create(),y=m.mat2df32.create();
O=(S===u.Alignment.MAP?1:0)|(O?1:0)<<1|(H?1:0)<<2|(M?1:0)<<3;M=J&&J.sdf;k.mat2d.translate(y,y,n.vec2f32.fromValues(c,-d));e&&k.mat2d.rotate(y,y,3.14159265359/180*e);b=w.MarkerMaterialKey.load(w.createMaterialKey(l.geometryType,b,!1));b.sdf=M;b.pattern=!0;b.textureBinding=J.textureBinding;l._materialKey=b.data;l._fillColor=f;l._outlineColor=x;l._sizeOutlineWidth=t.i8888to32(Math.round(Math.sqrt(256*r)),Math.round(Math.sqrt(256*B)),Math.round(Math.sqrt(256*C)),Math.round(Math.sqrt(256*z)));f=J.rect.x/
4;z=J.rect.y/4;x=f+J.rect.width/4;C=z+J.rect.height/4;P=.5-((.5+P)*J.width+1)/J.rect.width;T=.5-((.5+T)*J.height+1)/J.rect.height;b=Math.round(Math.min(64*V,255));r*=J.rect.width/J.width*V;B*=J.rect.height/J.height*V;J=(P-.5)*r;T=(T-.5)*B;h.vec2.set(E,J,T);h.vec2.transformMat2d(E,E,y);l._offsetUpperLeft=t.i1616to32(16*E[0],16*E[1]);l._texUpperLeft=t.i8888to32(f,z,O,b);h.vec2.set(E,J+r,T);h.vec2.transformMat2d(E,E,y);l._offsetUpperRight=t.i1616to32(16*E[0],16*E[1]);l._texUpperRight=t.i8888to32(x,z,
O,b);h.vec2.set(E,J,T+B);h.vec2.transformMat2d(E,E,y);l._offsetBottomLeft=t.i1616to32(16*E[0],16*E[1]);l._texBottomLeft=t.i8888to32(f,C,O,b);h.vec2.set(E,J+r,T+B);h.vec2.transformMat2d(E,E,y);l._offsetBottomRight=t.i1616to32(16*E[0],16*E[1]);l._texBottomRight=t.i8888to32(x,C,O,b);return l}c(b,a);b.fromCIMMarker=function(a,c,d){var f=c.size,g=(d&&d.width||1)/(d&&d.height||1)*c.scaleX,h=c.scaleSymbolsProportionally&&c.frameHeight?f/c.frameHeight:1,k=x.premultiplyAlphaRGBA(c.color),l=x.premultiplyAlphaRGBA(c.outlineColor),
m=e.pt2px(f),n=m*g,r=e.pt2px(c.offsetX||0),t=e.pt2px(c.offsetY||0),h=e.pt2px(c.outlineWidth||0)*h,y=c.alignment||u.Alignment.SCREEN,v=e.pt2px(c.referenceSize),w=c.rotation||0;c.rotateClockwise||(w=-w);var D=0,B=0,z=c.anchorPoint;z&&(c.isAbsoluteAnchorPoint?f&&(D=-z.x/(f*g),B=z.y/f):(D=z.x,B=z.y));return new b(a,r,t,w,k,n,m,v,l,h,c.colorLocked,c.scaleSymbolsProportionally,!1,y,d,D,B,c.sizeRatio)};b.fromPictureMarker=function(a,c,d){var f=Math.round(e.pt2px(c.width)),g=Math.round(e.pt2px(c.height)),
h=C.PICTURE_FILL_COLOR,k=Math.round(e.pt2px(c.xoffset||0)),l=Math.round(e.pt2px(c.yoffset||0));return new b(a,k,l,c.angle,h,f,g,g,0,0,!1,!1,!1,u.Alignment.SCREEN,d,0,0,1)};b.fromSimpleMarker=function(a,c,d){var f=x.premultiplyAlphaRGBA(c.color),g=Math.round(e.pt2px(c.size)),h=Math.round(e.pt2px(c.xoffset||0)),k=Math.round(e.pt2px(c.yoffset||0)),l=c.style,m=c.outline,n=(m&&m.color&&x.premultiplyAlphaRGBA(m.color))|0,m=(m&&m.width&&Math.round(e.pt2px(m.width)))|0;return new b(a,h,k,c.angle,f,g,g,g,
n,m,!1,!1,"cross"===l||"x"===l,u.Alignment.SCREEN,d,0,0,1.96875)};return b}(z.default(r.default));a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLBaseMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../enums ../../number ../../WGLDisplayRecord ../../materialKey/MaterialKey".split(" "),function(d,a,c,g,b,e,k,m){Object.defineProperty(a,"__esModule",{value:!0});var h=g.getLogger("esri.views.2d.engine.webgl.WGLMarkerTemplateBase");
a.default=function(a){return function(a){function d(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c=a.apply(this,c)||this;c.xOffset=0;c.yOffset=0;c.width=0;c.height=0;c.geometryType=b.WGLGeometryType.MARKER;return c}c(d,a);d.prototype.writeMesh=function(a,b,c,d,e){var g=m.MarkerMaterialKey.load(this._materialKey),n=b.indexVector,f=b.get("geometry"),r=new k(d,this.geometryType,this._materialKey);b=b.getVector("geometry").vertexCount;a.push(r);r.vertexFrom=b;r.indexFrom=n.length;switch(c){case "esriGeometryPoint":c=
e.geometry;a=c.x;c=c.y;this._writeVertices(r,f,d,this._getPos(a,c),g);this._writeIndices(r,n,b);break;case "esriGeometryPolyline":this._writeMany(r,n,f,b,d,e.geometry.paths[0],g);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(r,f,d,this._getPos(a,c),g),this._writeIndices(r,n,b)):h.error("Tried to render polygon geometries as markers, but found no centroid!");break;case "esriGeometryMultipoint":this._writeMany(r,n,f,b,d,e.geometry.points,g);break;default:h.error("Unable to handle geometryType: "+
c)}};d.prototype._getPos=function(a,b){return e.i1616to32(a,b)};d.prototype._writeMany=function(a,b,c,d,e,g,h){for(var f=0,k=0,l=0,m=0;m<g.length;m++){var n=g[m],r=n[0],n=n[1],t=this._getPos(r+f,n+k);this._writeVertices(a,c,e,t,h);this._writeIndices(a,b,d+l);f+=r;k+=n;l+=4}};d.prototype._writeVertices=function(a,b,c,d,e){b.push(d);b.push(this._offsetUpperLeft);b.push(this._texUpperLeft);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetUpperRight);
b.push(this._texUpperRight);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomLeft);b.push(this._texBottomLeft);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);b.push(d);b.push(this._offsetBottomRight);b.push(this._texBottomRight);b.push(c);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);a.vertexCount+=4};d.prototype._writeIndices=function(a,b,
c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return d}(a)}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../core/asyncUtils ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ../../../../../../symbols/support/defaults ./WGLDynamicLineTemplate ./WGLDynamicMarkerTemplate ./WGLDynamicTextTemplate ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/BidiText ../../util/Lock ../../util/Result".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f){function y(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}function l(a){return!!(a&1)}Object.defineProperty(a,"__esModule",{value:!0});var D=k.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),A=[];a.isDynamicId=l;d=function(){function a(a){this._templateIdCounter=this._idCounter=0;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._cimTemplateCache=
new Map;this._cimAnalyses=[];this._lock=new B.default;this._fetchResource=a}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"_textError",{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c,d){this._initErrorTemplates();var e=this._hashSymbol(a);if(!this._symbolToTemplate.has(e)){var f=[];b&&this._createMeshTemplates(f,b,c,d,!0);this._createMeshTemplates(f,a,c,d,!1);a=this._createGroupId("cim"===a.type);this._idToTemplateGroup.set(a,f);this._symbolToTemplate.set(e,a)}return this._symbolToTemplate.get(e)};a.prototype.getCIMMosaicItem=function(a,
b){var c=this,d=this._createTemplateId(),e=m.create(function(a){return c._idToResolver.set(d,a)});this._fetchQueue.push({symbol:a,id:d,glyphIds:b});return e};a.prototype.getTemplateGroup=function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):A};a.prototype.getDynamicTemplateGroup=function(a){if(!this._idToTemplateGroup.has(a))return A;l(a)||D.error("mapview-template-store","Id "+a+" does not refer to a dynamic template");return this._idToTemplateGroup.get(a)};a.prototype.finalize=
function(a){return this._fetchQueue.length||this._lock.isHeld()?B.withLock(this._lock,this._fetchAllQueuedResources.bind(this),a):m.resolve()};a.prototype._initErrorTemplates=function(){if(!this._errorTemplates){var a=this._createMeshTemplates([],n.errorPolygonSymbol2D,null,null,!1),b=this._createMeshTemplates([],n.errorPointSymbol2D,null,null,!1),c=this._createMeshTemplates([],n.errorPolylineSymbol2D,null,null,!1);this._errorTemplates={fill:a,marker:b,line:c}}};a.prototype._fetchAllQueuedResources=
function(a){var b=this;if(!this._fetchQueue.length)return m.resolve();var c=this._fetchQueue,d=this._cimAnalyses;this._fetchQueue=[];this._cimAnalyses=[];return m.all(d).then(function(){return b._fetchResource(c,a).then(function(a){for(var c=0;c<a.length;c++){var d=a[c],e=d.id,d=d.mosaicItem;b._idToResolver.get(e)(d);b._idToResolver.delete(e)}})}).catch(function(a){m.isAbortError(a)?b._fetchQueue=b._fetchQueue.concat(c):D.error(new e("mapview-template-store","Unable to fetch requested texture resources",
a))})};a.prototype._createGroupId=function(a){return this._idCounter++<<1|(a?1:0)};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._getCodepoints=function(a){a=v.bidiText(a.text)[0];for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b};a.prototype._getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d="text"===a.type&&this._getCodepoints(a),e=m.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a.toJSON(),
id:c,glyphIds:d});return e};a.prototype._hashSymbol=function(a){return a.id?a.id:JSON.stringify(a)};a.prototype._createSMS=function(a,b){return c(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,f.ok(c,D)?[2,z.default.fromSimpleMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b){return c(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,
this._getMosaicItem(a)];case 1:return c=d.sent().spriteMosaicItem,f.ok(c,D)?[2,z.default.fromPictureMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createSFS=function(a,b,d){return c(this,void 0,void 0,function(){var c,e;return g(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=g.sent().spriteMosaicItem,e=a,f.ok(c,D)?[2,t.default.fromSimpleFill(b,e,c,d)]:[2,this._fillError]}})})};a.prototype._createPFS=function(a,b,d){return c(this,void 0,void 0,function(){var c,
e;return g(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=g.sent().spriteMosaicItem,e=a,f.ok(c,D)?[2,t.default.fromPictureFill(b,e,c,d)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,d){return c(this,void 0,void 0,function(){var c,e;return g(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=g.sent().spriteMosaicItem,e=a,f.ok(c,D)?[2,w.default.fromSimpleLine(b,d,e,c)]:[2,this._lineError]}})})};a.prototype._createTS=
function(a,b){return c(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return[4,this._getMosaicItem(a)];case 1:return c=d.sent().glyphMosaicItems,[2,r.default.fromText(b,a,c)]}})})};a.prototype._createCIMText=function(a,b){return c(this,void 0,void 0,function(){var c,d,e,h,k,l;return g(this,function(g){switch(g.label){case 0:if("function"===typeof a.materialHash)return[2,m.resolve(C.default.fromCIMText(b,a))];c=[];if(d=a.text)for(e=d.length,h=0;h<e;h++)k=d.charCodeAt(h),
c.push(k);a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim,c)];case 1:return l=g.sent().glyphMosaicItems,f.ok(l,D)?[2,r.default.fromCIMText(b,a,l)]:[2,this._textError]}})})};a.prototype._createCIMFill=function(a,b){return c(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:return a.cim.mosaicHash=a.materialHash,[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,f.ok(c,D)?[2,t.default.fromCIMFill(b,a,c,!1)]:[2,this._fillError]}})})};
a.prototype._createCIMLine=function(a,b){return c(this,void 0,void 0,function(){var c;return g(this,function(d){switch(d.label){case 0:if("function"===typeof a.materialHash)return[2,m.resolve(u.default.fromCIMLine(b,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,f.ok(c,D)?[2,w.default.fromCIMLine(b,a,c,!1)]:[2,this._lineError]}})})};a.prototype._createCIMMarker=function(a,b){return c(this,void 0,void 0,function(){var c;return g(this,
function(d){switch(d.label){case 0:if("function"===typeof a.materialHash)return[2,m.resolve(x.default.fromCIMMarker(b,a))];a.cim.mosaicHash=a.materialHash;return[4,this.getCIMMosaicItem(a.cim)];case 1:return c=d.sent().spriteMosaicItem,f.ok(c,D)?[2,z.default.fromCIMMarker(b,a,c)]:[2,this._markerError]}})})};a.prototype._createCIM=function(a,b){return c(this,void 0,void 0,function(){var c,d,e=this;return g(this,function(f){c=a.templateHash;if(this._cimTemplateCache.has(c))return[2,this._cimTemplateCache.get(c)];
switch(a.type){case "marker":d=this._createCIMMarker(a,b);break;case "line":d=this._createCIMLine(a,b);break;case "fill":d=this._createCIMFill(a,b);break;case "text":d=this._createCIMText(a,b)}d.then(function(a){return e._cimTemplateCache.set(c,a)});return[2,d]})})};a.prototype._getCIMSymbolLayers=function(a,b,d){return c(this,void 0,void 0,function(){var c,e,f,k,l;return g(this,function(g){switch(g.label){case 0:c=[];e=[];if(Array.isArray(a.data))for(f=0,k=a.data;f<k.length;f++)l=k[f],c.push(h.analyzeCIMSymbol(l,
b,d,e));else c.push(h.analyzeCIMSymbol(a.data,b,d,e));return[4,m.all(c)];case 1:return g.sent(),[2,e]}})})};a.prototype._createCIMMeshTemplates=function(a,c,d,e){var f=this;c=this._getCIMSymbolLayers(c,d?d.fieldMap:null,e);this._cimAnalyses.push(b.safeCast(c.then(function(b){for(var c=0;c<b.length;c++)y(a,f._createCIM(b[c],d))})))};a.prototype._createMeshTemplates=function(a,b,c,d,e){if(-1!==b.type.indexOf("3d"))return D.error("3D symbols are not supported with MapView"),a;switch(b.type){case "cim":return this._createCIMMeshTemplates(a,
b,c,d),a;case "simple-marker":return y(a,this._createSMS(b,c));case "picture-marker":return y(a,this._createPMS(b,c));case "simple-fill":return y(a,this._createSFS(b,c,e)),b.outline&&y(a,this._createSLS(b.outline,c,!0)),a;case "picture-fill":return y(a,this._createPFS(b,c,e)),b.outline&&y(a,this._createSLS(b.outline,c,!0)),a;case "simple-line":return y(a,this._createSLS(b,c,!1));case "text":return y(a,this._createTS(b,c));default:return D.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),
a}};return a}();a.WGLTemplateStore=d})},"esri/symbols/cim/cimAnalyzer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../core/Logger ../../core/promiseUtils ../../support/arcadeOnDemand ./CIMSymbolHelper ./enums ./SDFHelper ./utils ../../views/2d/arcade/utils".split(" "),function(d,a,c,g,b,e,k,m,h,n,u,x,C){function t(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/255}:{r:0,g:0,b:0,a:0}}function w(a){switch(a){case "Butt":return n.CapType.BUTT;
case "Square":return n.CapType.SQUARE;default:return n.CapType.ROUND}}function z(a){switch(a){case "Bevel":return n.JoinType.BEVEL;case "Miter":return n.JoinType.MITER;default:return n.JoinType.ROUND}}function r(a){switch(a){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"justify"}}function v(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}}function B(a,b,d,e,k){return g(this,
void 0,void 0,function(){var g,m,r,t,v,w,u;return c(this,function(c){switch(c.label){case 0:if(!a)return[2];g=a.symbolLayers;if(!g)return[2];r=h.CIMSymbolHelper.getSize(a);"CIMPointSymbol"===a.type&&"Map"===a.angleAlignment&&(m=n.Alignment.MAP);t=g.length;c.label=1;case 1:if(!t--)return[3,23];v=g[t];if(!v||!1===v.enable)return[3,1];w=[];h.OverrideHelper.findApplicableOverrides(v,b,w);u=v.type;switch(u){case "CIMSolidFill":return[3,2];case "CIMPictureFill":return[3,4];case "CIMHatchFill":return[3,
6];case "CIMGradientFill":return[3,8];case "CIMSolidStroke":return[3,10];case "CIMPictureStroke":return[3,12];case "CIMGradientStroke":return[3,14];case "CIMCharacterMarker":return[3,16];case "CIMPictureMarker":return[3,17];case "CIMVectorMarker":return[3,19]}return[3,21];case 2:return[4,f(v,w,e,k)];case 3:return c.sent(),[3,22];case 4:return[4,y(v,w,e,k)];case 5:return c.sent(),[3,22];case 6:return[4,l(v,w,e,k)];case 7:return c.sent(),[3,22];case 8:return[4,D(v,w,e,k)];case 9:return c.sent(),[3,
22];case 10:return[4,A(v,w,e,k,"CIMPolygonSymbol"===a.type,r)];case 11:return c.sent(),[3,22];case 12:return[4,G(v,w,e,k,"CIMPolygonSymbol"===a.type,r)];case 13:return c.sent(),[3,22];case 14:return[4,E(v,w,e,k,"CIMPolygonSymbol"===a.type,r)];case 15:return c.sent(),[3,22];case 16:return[3,22];case 17:return[4,N(v,w,e,k,m,r)];case 18:return c.sent(),[3,22];case 19:return[4,L(v,w,d,e,k,m,r)];case 20:return c.sent(),[3,22];case 21:T.error("Cannot analyze CIM layer",v.type),c.label=22;case 22:return[3,
1];case 23:return[2]}})})}function f(a,b,d,e){return g(this,void 0,void 0,function(){var f,g,h,k,l,m;return c(this,function(c){switch(c.label){case 0:return f=a.primitiveName,g=t(a.color),h=x.hashString(JSON.stringify(a)).toString(),l=(k=e).push,m={type:"fill",templateHash:h,materialHash:0===b.length?h:function(a,b,c){return h},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,H(f,"Color",b,d,g,M)];case 1:return l.apply(k,[(m.color=c.sent(),m.height=0,m.angle=0,m.offsetX=0,m.offsetY=0,m.scaleX=
1,m)]),[2]}})})}function y(a,b,d,e){return g(this,void 0,void 0,function(){var f,g,h,k,l,m,n;return c(this,function(c){switch(c.label){case 0:return f=a.primitiveName,g=t(a.tintColor),h=x.hashString(JSON.stringify(a)).toString(),k=x.hashString(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),m=(l=e).push,n={type:"fill",templateHash:h,materialHash:0===b.length?k:function(a,b,c){return k},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,H(f,"TintColor",b,d,g,M)];case 1:return n.color=
c.sent(),[4,H(f,"Height",b,d,a.height)];case 2:return n.height=c.sent(),[4,H(f,"ScaleX",b,d,a.scaleX)];case 3:return n.scaleX=c.sent(),[4,H(f,"Rotation",b,d,a.rotation)];case 4:return n.angle=c.sent(),[4,H(f,"OffsetX",b,d,a.offsetX)];case 5:return n.offsetX=c.sent(),[4,H(f,"OffsetY",b,d,a.offsetY)];case 6:return m.apply(l,[(n.offsetY=c.sent(),n)]),[2]}})})}function l(a,b,d,e){return g(this,void 0,void 0,function(){var f,g,h,k,l,m,n,r;return c(this,function(c){switch(c.label){case 0:f=["Rotation",
"OffsetX","OffsetY"];g=b.filter(function(b){return b.primitiveName!==a.primitiveName&&-1===f.indexOf(b.propertyName)});h=a.primitiveName;k=x.hashString(JSON.stringify(a)).toString();m=(l=e).push;n={type:"fill",templateHash:k};if(0!==b.length)return[3,1];r=k;return[3,3];case 1:return[4,P(k,g,d)];case 2:r=c.sent(),c.label=3;case 3:return n.materialHash=r,n.cim=a,n.materialOverrides=g,n.colorLocked=a.colorLocked,n.color={r:128,g:128,b:128,a:1},n.height=0,n.scaleX=1,[4,H(h,"Rotation",b,d,a.rotation)];
case 4:return n.angle=c.sent(),[4,H(h,"OffsetX",b,d,a.offsetX)];case 5:return n.offsetX=c.sent(),[4,H(h,"OffsetY",b,d,a.offsetY)];case 6:return m.apply(l,[(n.offsetY=c.sent(),n)]),[2]}})})}function D(a,b,d,e){return g(this,void 0,void 0,function(){var f,g,h,k,l;return c(this,function(c){switch(c.label){case 0:f=x.hashString(JSON.stringify(a)).toString();h=(g=e).push;k={type:"fill",templateHash:f};if(0!==b.length)return[3,1];l=f;return[3,3];case 1:return[4,P(f,b,d)];case 2:l=c.sent(),c.label=3;case 3:return h.apply(g,
[(k.materialHash=l,k.cim=a,k.materialOverrides=null,k.colorLocked=a.colorLocked,k.color={r:128,g:128,b:128,a:1},k.height=0,k.angle=0,k.offsetX=0,k.offsetY=0,k.scaleX=1,k)]),[2]}})})}function A(a,b,d,e,f,h){return g(this,void 0,void 0,function(){var g,k,l,m,n,r,y,v,E,A;return c(this,function(c){switch(c.label){case 0:return g=x.hashString(JSON.stringify(a)).toString(),k=a.primitiveName,l=t(a.color),m=void 0!==a.width?a.width:4,n=w(a.capStyle),r=z(a.joinStyle),y=a.miterLimit,E=(v=e).push,A={type:"line",
templateHash:g,materialHash:0===b.length?g:function(a,b,c){return g},cim:a,materialOverrides:null,isOutline:f,colorLocked:a.colorLocked},[4,H(k,"Color",b,d,l,M)];case 1:return A.color=c.sent(),[4,H(k,"Width",b,d,m)];case 2:return A.width=c.sent(),[4,H(k,"CapStyle",b,d,n)];case 3:return A.cap=c.sent(),[4,H(k,"JoinStyle",b,d,r)];case 4:return A.join=c.sent(),[4,H(k,"MiterLimit",b,d,y)];case 5:return E.apply(v,[(A.miterLimit=c.sent(),A.referenceWidth=h,A.zOrder=O(a.name),A.isDashed=!1,A)]),[2]}})})}
function G(a,b,d,e,f,h){return g(this,void 0,void 0,function(){var g,k,l,m,n,r,y,v,E,A,D;return c(this,function(c){switch(c.label){case 0:return g=x.hashString(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),k=a.primitiveName,l=t(a.tintColor),m=void 0!==a.width?a.width:4,n=w(a.capStyle),r=z(a.joinStyle),y=a.miterLimit,v=x.hashString(JSON.stringify(a)).toString(),A=(E=e).push,D={type:"line",templateHash:v,materialHash:0===b.length?g:function(a,b,c){return g},cim:a,materialOverrides:null,
isOutline:f,colorLocked:a.colorLocked},[4,H(k,"TintColor",b,d,l,M)];case 1:return D.color=c.sent(),[4,H(k,"Width",b,d,m)];case 2:return D.width=c.sent(),[4,H(k,"CapStyle",b,d,n)];case 3:return D.cap=c.sent(),[4,H(k,"JoinStyle",b,d,r)];case 4:return D.join=c.sent(),[4,H(k,"MiterLimit",b,d,y)];case 5:return A.apply(E,[(D.miterLimit=c.sent(),D.referenceWidth=h,D.zOrder=O(a.name),D.isDashed=!1,D)]),[2]}})})}function E(a,b,d,e,f,h){return g(this,void 0,void 0,function(){var g,k,l,m,n,r,t,y,v,E;return c(this,
function(c){switch(c.label){case 0:g=a.primitiveName;k=void 0!==a.width?a.width:4;l=w(a.capStyle);m=z(a.joinStyle);n=a.miterLimit;r=x.hashString(JSON.stringify(a)).toString();y=(t=e).push;v={type:"line",templateHash:r};if(0!==b.length)return[3,1];E=r;return[3,3];case 1:return[4,P(r,b,d)];case 2:E=c.sent(),c.label=3;case 3:return v.materialHash=E,v.cim=a,v.materialOverrides=null,v.isOutline=f,v.colorLocked=a.colorLocked,v.color={r:128,g:128,b:128,a:1},[4,H(g,"Width",b,d,k)];case 4:return v.width=c.sent(),
[4,H(g,"CapStyle",b,d,l)];case 5:return v.cap=c.sent(),[4,H(g,"JoinStyle",b,d,m)];case 6:return v.join=c.sent(),[4,H(g,"MiterLimit",b,d,n)];case 7:return y.apply(t,[(v.miterLimit=c.sent(),v.referenceWidth=h,v.zOrder=O(a.name),v.isDashed=!1,v)]),[2]}})})}function N(a,b,d,e,f,h){return g(this,void 0,void 0,function(){var g,k,l,m,n,r,v,y,E,A,D;return c(this,function(c){switch(c.label){case 0:return g=a.primitiveName,k=a.size,l=a.scaleX,m=a.rotation,n=a.offsetX,r=a.offsetY,v=t(a.tintColor),y=x.hashString(""+
a.url+JSON.stringify(a.colorSubstitutions)).toString(),A=(E=e).push,D={type:"marker",templateHash:x.hashString(JSON.stringify(a)).toString(),materialHash:0===b.length?y:function(a,b,c){return y},cim:a,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:!1,alignment:f,anchorPoint:a.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits},[4,H(g,"Size",b,d,k)];case 1:return D.size=c.sent(),[4,H(g,"ScaleX",b,d,l)];case 2:return D.scaleX=c.sent(),[4,H(g,"Rotation",b,
d,m)];case 3:return D.rotation=c.sent(),[4,H(g,"OffsetX",b,d,n)];case 4:return D.offsetX=c.sent(),[4,H(g,"OffsetY",b,d,r)];case 5:return D.offsetY=c.sent(),[4,H(g,"TintColor",b,d,v,M)];case 6:return A.apply(E,[(D.color=c.sent(),D.outlineColor={r:0,g:0,b:0,a:0},D.outlineWidth=0,D.frameHeight=0,D.rotateClockwise=a.rotateClockwise,D.referenceSize=h,D.sizeRatio=1,D)]),[2]}})})}function L(a,b,d,e,f,h,l){return g(this,void 0,void 0,function(){var g,m,n,r,t,v,y,E;return c(this,function(c){switch(c.label){case 0:g=
a.markerGraphics;if(!g)return[2];m=0;a.scaleSymbolsProportionally&&(n=a.frame)&&(m=n.ymax-n.ymin);r=[];t=0;for(v=g;t<v.length;t++)if(y=v[t])if(E=y.symbol)switch(E.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":r.push(R(a,y,b,e,f,h,l,m));break;case "CIMTextSymbol":r.push(Q(a,y,b,d,e,f,h,l,m))}return[4,k.all(r)];case 1:return c.sent(),[2]}})})}function Q(a,b,d,e,f,k,l,m,n){return g(this,void 0,void 0,function(){var g,y,E,D,A,w,u,B,z,G,C,p,L,N,q,O,R,F,Q,M,V,P;return c(this,
function(c){switch(c.label){case 0:g=[];h.OverrideHelper.findApplicableOverrides(b,d,g);y=b.geometry;if(void 0===y.x||void 0===y.y)return[2];E=b.symbol;E.font={family:E.fontFamilyName};D=a.frame;A=y.x-.5*(D.xmin+D.xmax);w=y.y-.5*(D.ymin+D.ymax);u=a.size/n;B=a.primitiveName;z=(E.height||0)*u;G=E.angle||0;C=((E.offsetX||0)+A)*u;p=((E.offsetY||0)+w)*u;L=t(h.CIMSymbolHelper.getFillColor(E));N=t(h.CIMSymbolHelper.getStrokeColor(E));q=h.CIMSymbolHelper.getStrokeWidth(E);q||(N=t(h.CIMSymbolHelper.getFillColor(E.haloSymbol)),
q=E.haloSize*u);O="";R=0;for(F=d;R<F.length;R++)Q=F[R],Q.primitiveName===B&&void 0!==Q.value&&(O+="|"+Q.primitiveName+"|"+Q.propertyName+"|"+JSON.stringify(Q.value));V=(M=k).push;P={type:"text",templateHash:x.hashString(JSON.stringify(b)+O).toString(),materialHash:function(a,b,c){return E.fontFamilyName},cim:E,materialOverrides:null,colorLocked:a.colorLocked,alignment:l,anchorPoint:{x:a.anchorPoint?a.anchorPoint.x:0,y:a.anchorPoint?a.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,
fontName:E.fontFamilyName,decoration:"none"};return[4,H(B,"Height",d,f,z)];case 1:return P.size=c.sent(),[4,H(B,"Rotation",d,f,G)];case 2:return P.angle=c.sent(),[4,H(B,"OffsetX",d,f,C)];case 3:return P.offsetX=c.sent(),[4,H(B,"OffsetY",d,f,p)];case 4:return V.apply(M,[(P.offsetY=c.sent(),P.horizontalAlignment=r(E.horizontalAlignment),P.verticalAlignment=v(E.verticalAlignment),P.text=J(e,f,b.textString,E.textCase),P.color=L,P.outlineColor=N,P.outlineSize=q,P.referenceSize=m,P.sizeRatio=1,P)]),[2]}})})}
function R(a,b,d,e,f,k,l,m){return g(this,void 0,void 0,function(){var g,n,r,y,v,E;return c(this,function(D){switch(D.label){case 0:g=b.symbol;n=b.geometry;if(!n)return[2];r=u.getExtent(n);y=g.symbolLayers;if(!y)return[2];v=y.length;E=function(){var g,E,D,A,w,p,B,z,q,G,C,F,L,N,O,R,Q,V,J,S,T,ea,ca,W,X,da,Z,aa,ga,fa,ja,ma,ia,na,ka,ra,sa,U,pa;return c(this,function(c){switch(c.label){case 0:g=y[v];if(!g||!1===g.enable)return[2,"continue"];E=g.type;switch(E){case "CIMSolidFill":return[3,1];case "CIMSolidStroke":return[3,
1]}return[3,13];case 1:D=u.getSDFMetrics(r,a.frame,a.size,a.anchorPoint,"Relative"!==a.anchorPointUnits);A=D[0];w=D[1];p=D[2];B="CIMSolidFill"===g.type;z={type:"sdf",geom:n,asFill:B};q=a.primitiveName;G=a.size;C=a.rotation;F=a.offsetX;L=a.offsetY;N=g.primitiveName;O=B?t(h.CIMSymbolHelper.getFillColor(g)):t(h.CIMSymbolHelper.getStrokeColor(g));R=B?{r:0,g:0,b:0,a:0}:t(h.CIMSymbolHelper.getStrokeColor(g));Q=h.CIMSymbolHelper.getStrokeWidth(g);if(!B&&!Q)return[3,20];V=!1;J="";S=0;for(T=d;S<T.length;S++)if(ea=
T[S],ea.primitiveName===N||ea.primitiveName===q)void 0!==ea.value?J+="|"+ea.primitiveName+"|"+ea.propertyName+"|"+JSON.stringify(ea.value):ea.valueExpressionInfo&&(V=!0);ca=x.hashString(JSON.stringify(z)).toString();W=x.hashString(JSON.stringify(g)+JSON.stringify(b)+J).toString();da=(X=f).push;Z={type:"marker",templateHash:W,materialHash:V?function(a,b,c){return ca}:ca,cim:z,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:a.scaleSymbolsProportionally,alignment:k,anchorPoint:{x:w,
y:p},isAbsoluteAnchorPoint:!1};return[4,H(q,"Size",d,e,G)];case 2:return Z.size=c.sent(),Z.scaleX=1,[4,H(q,"Rotation",d,e,C)];case 3:return Z.rotation=c.sent(),[4,H(q,"OffsetX",d,e,F)];case 4:return Z.offsetX=c.sent(),[4,H(q,"OffsetY",d,e,L)];case 5:return Z.offsetY=c.sent(),[4,H(N,"Color",d,e,O,M)];case 6:Z.color=c.sent();if(!B)return[3,7];aa={r:0,g:0,b:0,a:0};return[3,9];case 7:return[4,H(N,"Color",d,e,R,M)];case 8:aa=c.sent(),c.label=9;case 9:Z.outlineColor=aa;if(!B)return[3,10];ga=0;return[3,
12];case 10:return[4,H(N,"Width",d,e,Q)];case 11:ga=c.sent(),c.label=12;case 12:return da.apply(X,[(Z.outlineWidth=ga,Z.frameHeight=m,Z.rotateClockwise=a.rotateClockwise,Z.referenceSize=l,Z.sizeRatio=A,Z)]),[3,20];case 13:fa={type:a.type,enable:!0,name:a.name,colorLocked:a.colorLocked,primitiveName:a.primitiveName,anchorPoint:a.anchorPoint,anchorPointUnits:a.anchorPointUnits,offsetX:a.offsetX,offsetY:a.offsetY,rotateClockwise:a.rotateClockwise,rotation:a.rotation,size:a.size,billboardMode3D:a.billboardMode3D,
depth3D:a.depth3D,frame:a.frame,markerGraphics:[b],scaleSymbolsProportionally:a.scaleSymbolsProportionally,respectFrame:a.respectFrame,clippingPath:a.clippingPath};ja=[];ma=["Color","Size","Rotation","OffsetX","OffsetY"];ja=d.filter(function(b){return b.primitiveName!==a.primitiveName&&-1===ma.indexOf(b.propertyName)});ia=h.CIMSymbolHelper.getTextureAnchor(fa);w=ia[0];p=ia[1];na=JSON.stringify(fa);ka=a.primitiveName;C=a.rotation;F=a.offsetX;L=a.offsetY;W=x.hashString(JSON.stringify(fa)).toString();
sa=(ra=f).push;U={type:"marker",templateHash:W};if(0!==ja.length)return[3,14];pa=W;return[3,16];case 14:return[4,P(na,ja,e)];case 15:pa=c.sent(),c.label=16;case 16:return U.materialHash=pa,U.cim=fa,U.materialOverrides=ja,U.colorLocked=a.colorLocked,U.scaleSymbolsProportionally=a.scaleSymbolsProportionally,U.alignment=k,U.anchorPoint={x:w,y:p},U.isAbsoluteAnchorPoint=!1,U.size=a.size,U.scaleX=1,[4,H(ka,"Rotation",d,e,C)];case 17:return U.rotation=c.sent(),[4,H(ka,"OffsetX",d,e,F)];case 18:return U.offsetX=
c.sent(),[4,H(ka,"OffsetY",d,e,L)];case 19:return sa.apply(ra,[(U.offsetY=c.sent(),U.color={r:0,g:0,b:0,a:0},U.outlineColor={r:0,g:0,b:0,a:0},U.outlineWidth=0,U.frameHeight=m,U.rotateClockwise=a.rotateClockwise,U.referenceSize=l,U.sizeRatio=1,U)]),[3,20];case 20:return[2]}})};D.label=1;case 1:return v--?[5,E()]:[3,3];case 2:return D.sent(),[3,1];case 3:return[2]}})})}function O(a){return a&&0===a.indexOf("Level_")?parseInt(a.substr(6),10):0}function M(a){if(!a||0===a.length)return null;a=(new b(a)).toRgba();
return{r:a[0],g:a[1],b:a[2],a:a[3]}}function H(a,b,d,e,f,h){return g(this,void 0,void 0,function(){var g,k,l,n,r;return c(this,function(t){switch(t.label){case 0:if(!a)return[3,4];g=function(d){var g,k,l;return c(this,function(c){switch(c.label){case 0:if(d.primitiveName!==a||d.propertyName!==b)return[3,2];if(void 0!==d.value)return[2,{value:d.value}];g=d.valueExpressionInfo;if(!g)return[3,2];k=g.expression;return[4,m.createRendererExpression(k,e.spatialReference,e.fields)];case 1:return l=c.sent(),
[2,{value:function(a,b,c){a=C.callWithFeature(l,a,{$view:c},e.geometryType,b);null!==a&&h&&(a=h(a));return null!==a?a:f}}];case 2:return[2]}})};k=0;l=d;t.label=1;case 1:if(!(k<l.length))return[3,4];n=l[k];return[5,g(n)];case 2:r=t.sent();if("object"===typeof r)return[2,r.value];t.label=3;case 3:return k++,[3,1];case 4:return[2,f]}})})}function S(a,b){switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function J(a,b,c,d){if(!a||-1===c.indexOf("["))return S(c,
d);b=function(a){for(var b=a.length;b--;)if(-1===" /-,\n".indexOf(a.charAt(b)))return!1;return!0};var e=[],f=0,g=-1;do g=c.indexOf("[",f),g>=f&&(g>f&&(f=c.substr(f,g-f),e.push([f,null,b(f)])),f=g+1,g=c.indexOf("]",f),g>=f&&(g>f&&(f=c.substr(f,g-f),(f=a[f])&&e.push([null,f,!1])),f=g+1));while(-1!==g);f<c.length-1&&(f=c.substr(f),e.push([f,null,b(f)]));return function(a,b,c){b="";c=null;for(var f=0;f<e.length;f++){var g=e[f],h=g[0],k=g[1],g=g[2];if(h)g?c=h:(c&&(b+=c,c=null),b+=h);else if(h=a.attributes[k])c&&
(b+=c,c=null),b+=h}return S(b,d)}}function P(a,b,d){return g(this,void 0,void 0,function(){var e,f,g,k;return c(this,function(l){switch(l.label){case 0:e=function(a){var b,e,f;return c(this,function(c){switch(c.label){case 0:b=a.valueExpressionInfo;if(!b)return[3,2];e=b.expression;return[4,m.createRendererExpression(e,d.spatialReference,d.fields)];case 1:f=c.sent(),a.fn=function(a,b,c){return C.callWithFeature(f,a,{$view:c},d.geometryType,b)},c.label=2;case 2:return[2]}})},f=0,g=b,l.label=1;case 1:if(!(f<
g.length))return[3,4];k=g[f];return[5,e(k)];case 2:l.sent(),l.label=3;case 3:return f++,[3,1];case 4:return[2,function(c,d,e){for(var f=0;f<b.length;f++){var g=b[f];g.value=g.fn?g.fn(c,d,e):void 0}return x.hashString(a+h.OverrideHelper.buildOverrideKey(b)).toString()}]}})})}Object.defineProperty(a,"__esModule",{value:!0});var T=e.getLogger("esri.symbols.cim.cimAnalyzer");a.analyzeCIMSymbol=function(a,b,d,e){return g(this,void 0,void 0,function(){var f,g,h,k;return c(this,function(c){switch(c.label){case 0:f=
e?e:[];if(!a)return[2,f];"CIMSymbolReference"===a.type?(g=a.symbol,h=a.primitiveOverrides):(g=a,h=null);k=g.type;switch(k){case "CIMPointSymbol":return[3,1];case "CIMLineSymbol":return[3,1];case "CIMPolygonSymbol":return[3,1];case "CIMTextSymbol":return[3,3]}return[3,4];case 1:return[4,B(g,h,b,d,f)];case 2:return c.sent(),[3,4];case 3:return[3,4];case 4:return[2,f]}})})};a.analyzeCIMResource=function(a,b,c){if(!c||0===c.length)return b;a=JSON.parse(JSON.stringify(b));h.OverrideHelper.applyOverrides(a,
c);return a}})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});a.evaluateValueOrFunction=function(a,d,b,e){return"function"===typeof a?a(d,b,e):a};a.hashString=function(a){for(var c=0,b=0;b<a.length;b++)c=(c<<5)-c+a.charCodeAt(b),c|=0;return c}})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseLineTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x){Object.defineProperty(a,"__esModule",{value:!0});d=function(a){function d(c,d){var k=a.call(this,d)||this;k._cimLineLayer=d;var n=0;h.isFunction(d.width)||(n=.5*g.pt2px(d.width));k._dynamicPropertyMap.set("_halfWidth",function(a,b,c){return h.isFunction(d.width)?.5*g.pt2px(d.width(a,b,c)):n});var t=b.CapType.ROUND;h.isFunction(d.cap)||(t=d.cap);k._dynamicPropertyMap.set("_capType",function(a,b,c){return h.isFunction(d.cap)?d.cap(a,b,c):t});var f;h.isFunction(d.join)||
(f=d.join);k._dynamicPropertyMap.set("_joinType",function(a,b,c){return h.isFunction(d.join)?d.join(a,b,c):f});var y;if(!h.isFunction(d.color)){var l=d.color;y=l&&e.premultiplyAlphaRGBA(l)||0}k._dynamicPropertyMap.set("_fillColor",function(a,b,c){return h.isFunction(d.color)?(a=d.color(a,b,c))&&e.premultiplyAlphaRGBA(a)||0:y});var D;h.isFunction(d.miterLimit)||(D=h.getLimitCosine(d.miterLimit));k._dynamicPropertyMap.set("_miterLimitCosine",function(a,b,c){return h.isFunction(d.miterLimit)?h.getLimitCosine(d.miterLimit(a,
b,c)):D});k._isDashed=d.isDashed;k._bitset=d.colorLocked?1:0;k._materialKey=m.createMaterialKey(k.geometryType,c,d.isOutline);k._initializeTessellator(!0);return k}c(d,a);d.fromCIMLine=function(a,b){return new d(a,b)};d.prototype.bindFeature=function(a,b,c){var d=this,e=this._dynamicPropertyMap;e&&e.forEach(function(e,f){d[f]=e(a,b,c)});var e=this._materialCache,f=this._cimLineLayer.materialHash,f=f(a,b,c),f=e.get(f),e=null;f&&x.ok(f.spriteMosaicItem)&&(e=f.spriteMosaicItem);if(e){this._hasPattern=
!0;var f=e.rect,g=f.x+1+e.width,h=f.y+1+e.height;this._tl=k.i1616to32(f.x+1,f.y+1);this._br=k.i1616to32(g,h)}else this._hasPattern=!1,this._br=this._tl=0;this._halfReferenceWidth=this._halfWidth;f=m.LineMaterialKey.load(this._materialKey);e&&(f.sdf=e.sdf,f.pattern=!0,f.textureBinding=e.textureBinding);this._materialKey=f.data};return d}(n.default(u.default));a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMeshTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../../../../../symbols/cim/cimAnalyzer ./WGLMeshTemplate".split(" "),
function(d,a,c,g,b,e,k){Object.defineProperty(a,"__esModule",{value:!0});var m=g.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");d=function(a){function d(b){var c=a.call(this)||this;c._materialCache=new Map;c._dynamicPropertyMap=new Map;c._cimLayer=b;return c}c(d,a);d.prototype.analyze=function(a,c,d,g){var h=this._materialCache,k=this._cimLayer.materialHash;if(!k)return m.error("A Dynamic mesh template must have a material hash function!"),b.reject(null);var n=k(c,d,g);if(h.has(n))return a=
h.get(n),b.resolve(a);c=e.analyzeCIMResource(c,this._cimLayer.cim,this._cimLayer.materialOverrides);c.mosaicHash=n;return a.getCIMMosaicItem(c).then(function(a){h.set(n,a);return a})};return d}(k.default);a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/mat2d ../../../../../../core/libs/gl-matrix-2/mat2df32 ../../../../../../core/libs/gl-matrix-2/vec2 ../../../../../../core/libs/gl-matrix-2/vec2f32 ../../../../../../symbols/cim/enums ../../color ../../number ../../materialKey/MaterialKey ./util ./WGLBaseMarkerTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v){Object.defineProperty(a,"__esModule",{value:!0});var B=3.14159265359/180,f=n.vec2f32.create(),y=m.mat2df32.create(),l=b.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");d=function(a){function b(b,c){var d=a.call(this,c)||this;d._cimMarkerLayer=c;var f=0;w.isFunction(c.color)||(f=x.premultiplyAlphaRGBA(c.color));d._dynamicPropertyMap.set("_fillColor",function(a,b,d){return w.isFunction(c.color)?x.premultiplyAlphaRGBA(c.color(a,b,d)):f});
var g=0;w.isFunction(c.outlineColor)||(g=x.premultiplyAlphaRGBA(c.outlineColor));d._dynamicPropertyMap.set("_outlineColor",function(a,b,d){return w.isFunction(c.outlineColor)?x.premultiplyAlphaRGBA(c.outlineColor(a,b,d)):g});var h;w.isFunction(c.size)||(h=e.pt2px(c.size));d._dynamicPropertyMap.set("_size",function(a,b,d){return w.isFunction(c.size)?e.pt2px(c.size(a,b,d)):h});var k;w.isFunction(c.scaleX)||(k=c.scaleX);d._dynamicPropertyMap.set("_scaleX",function(a,b,d){return w.isFunction(c.scaleX)?
c.scaleX(a,b,d):k});var l;w.isFunction(c.offsetX)||(l=e.pt2px(c.offsetX));d._dynamicPropertyMap.set("xOffset",function(a,b,d){return w.isFunction(c.offsetX)?e.pt2px(c.offsetX(a,b,d)):l});var m;w.isFunction(c.offsetY)||(m=e.pt2px(c.offsetY));d._dynamicPropertyMap.set("yOffset",function(a,b,d){return w.isFunction(c.offsetY)?e.pt2px(c.offsetY(a,b,d)):m});var n;w.isFunction(c.outlineWidth)||(n=e.pt2px(c.outlineWidth));d._dynamicPropertyMap.set("_outlineWidth",function(a,b,d){return w.isFunction(c.outlineWidth)?
e.pt2px(c.outlineWidth(a,b,d)):n});var r;w.isFunction(c.rotation)||(r=c.rotation);d._dynamicPropertyMap.set("_angle",function(a,b,d){return w.isFunction(c.rotation)?c.rotation(a,b,d):r});d._bitSet=(c.alignment===u.Alignment.MAP?1:0)|(c.colorLocked?1:0)<<1|(c.scaleSymbolsProportionally?1:0)<<3;d._materialKey=t.createMaterialKey(d.geometryType,b,!1);return d}c(b,a);b.fromCIMMarker=function(a,c){return new b(a,c)};b.prototype.bindFeature=function(a,b,c){var d=this,m=this._dynamicPropertyMap;m&&m.forEach(function(e,
f){d[f]=e(a,b,c)});m=this._cimMarkerLayer.materialHash;m=m(a,b,c);if((m=this._materialCache.get(m))&&v.ok(m.spriteMosaicItem)&&m.spriteMosaicItem){var m=m.spriteMosaicItem,r=this._cimMarkerLayer.sizeRatio,D=m.width/m.height*this._scaleX,A=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,w=this._size,E=w*D,u=this.xOffset,z=this.yOffset,x=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/e.pt2px(this._cimMarkerLayer.frameHeight):1,G=this._outlineWidth*
x,N=e.pt2px(this._cimMarkerLayer.referenceSize),ca=0,x=0,da=this._cimMarkerLayer.anchorPoint;da&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(ca=-da.x/(this._size*D),x=da.y/this._size):(ca=da.x,x=da.y));this._sizeOutlineWidth=C.i8888to32(Math.round(Math.sqrt(256*E)),Math.round(Math.sqrt(256*w)),Math.round(Math.sqrt(256*G)),Math.round(Math.sqrt(256*N)));k.mat2d.identity(y);k.mat2d.translate(y,y,n.vec2f32.fromValues(u,-z));A&&k.mat2d.rotate(y,y,B*A);D=m.rect.x/4;A=m.rect.y/4;u=D+m.rect.width/
4;z=A+m.rect.height/4;ca=.5-((.5+ca)*m.width+1)/m.rect.width;x=.5-((.5+x)*m.height+1)/m.rect.height;G=Math.round(64*r);E*=m.rect.width/m.width*r;w*=m.rect.height/m.height*r;r=(ca-.5)*E;x=(x-.5)*w;h.vec2.set(f,r,x);h.vec2.transformMat2d(f,f,y);this._offsetUpperLeft=C.i1616to32(16*f[0],16*f[1]);this._texUpperLeft=C.i8888to32(D,A,this._bitSet,G);h.vec2.set(f,r+E,x);h.vec2.transformMat2d(f,f,y);this._offsetUpperRight=C.i1616to32(16*f[0],16*f[1]);this._texUpperRight=C.i8888to32(u,A,this._bitSet,G);h.vec2.set(f,
r,x+w);h.vec2.transformMat2d(f,f,y);this._offsetBottomLeft=C.i1616to32(16*f[0],16*f[1]);this._texBottomLeft=C.i8888to32(D,z,this._bitSet,G);h.vec2.set(f,r+E,x+w);h.vec2.transformMat2d(f,f,y);this._offsetBottomRight=C.i1616to32(16*f[0],16*f[1]);this._texBottomRight=C.i8888to32(u,z,this._bitSet,G);w=t.MarkerMaterialKey.load(this._materialKey);w.sdf=m.sdf;w.pattern=!0;w.textureBinding=m.textureBinding;this._materialKey=w.data}else l.error(new g("mapview-cim","Encountered an error when binding feature"))};
return b}(z.default(r.default));a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLDynamicTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/screenUtils ../../alignmentUtils ../../color ../../fontUtils ../../materialKey/MaterialKey ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../util/BidiText".split(" "),function(d,a,c,g,b,e,k,m,h,n,u,x){Object.defineProperty(a,"__esModule",{value:!0});var C=new Set;d=function(a){function d(b,
c){var d=a.call(this,c)||this;d._horizontalAlignment="center";d._verticalAlignment="middle";d._glyphs=[];d._cimTextLayer=c;var n=d._bitset=0;h.isFunction(c.color)||(n=e.premultiplyAlphaRGBA(c.color));d._dynamicPropertyMap.set("_color",function(a,b,d){return h.isFunction(c.color)?e.premultiplyAlphaRGBA(c.color(a,b,d)):n});var f=0;h.isFunction(c.color)||(f=e.premultiplyAlphaRGBA(c.outlineColor));d._dynamicPropertyMap.set("_haloColor",function(a,b,d){return h.isFunction(c.outlineColor)?e.premultiplyAlphaRGBA(c.outlineColor(a,
b,d)):f});var r;h.isFunction(c.size)||(r=Math.min(Math.round(g.pt2px(c.size*c.sizeRatio)),127));d._dynamicPropertyMap.set("_size",function(a,b,d){return h.isFunction(c.size)?Math.min(Math.round(g.pt2px(c.size(a,b,d)*c.sizeRatio)),127):r});var l;h.isFunction(c.outlineSize)||(l=Math.min(Math.floor(5*g.pt2px(c.outlineSize*c.sizeRatio)),127));d._dynamicPropertyMap.set("_haloSize",function(a,b,d){return h.isFunction(c.outlineSize)?Math.min(Math.floor(5*g.pt2px(c.outlineSize(a,b,d)*c.sizeRatio)),127):l});
var t;h.isFunction(c.offsetX)||(t=Math.round(g.pt2px(c.offsetX*c.sizeRatio)));d._dynamicPropertyMap.set("_xOffset",function(a,b,d){return h.isFunction(c.offsetX)?Math.round(g.pt2px(c.offsetX(a,b,d)*c.sizeRatio)):t});var A;h.isFunction(c.offsetY)||(A=Math.round(g.pt2px(c.offsetY*c.sizeRatio)));d._dynamicPropertyMap.set("_yOffset",function(a,b,d){return h.isFunction(c.offsetY)?Math.round(g.pt2px(c.offsetY(a,b,d)*c.sizeRatio)):A});var w;h.isFunction(c.decoration)||(w=k.getFontDecorationTop(c.decoration));
d._dynamicPropertyMap.set("_decorationTop",function(a,b,d){return h.isFunction(c.decoration)?k.getFontDecorationTop(c.decoration(a,b,d)):w});var E;h.isFunction(c.angle)||(E=c.angle);d._dynamicPropertyMap.set("_angle",function(a,b,d){return h.isFunction(c.angle)?c.angle(a,b,d):E});var u;h.isFunction(c.horizontalAlignment)||(u=c.horizontalAlignment);d._dynamicPropertyMap.set("_horizontalAlignment",function(a,b,d){return h.isFunction(c.horizontalAlignment)?c.horizontalAlignment(a,b,d):u});var x;h.isFunction(c.verticalAlignment)||
(x=c.verticalAlignment);d._dynamicPropertyMap.set("_verticalAlignment",function(a,b,d){return h.isFunction(c.verticalAlignment)?c.verticalAlignment(a,b,d):x});var z;h.isFunction(c.text)||(z=c.text);d._dynamicPropertyMap.set("_text",function(a,b,d){return h.isFunction(c.text)?c.text(a,b,d):z});d._materialKey=m.createMaterialKey(d.geometryType,b,!1);b=m.TextMaterialKey.load(d._materialKey);b.sdf=!0;d._materialKey=b.data;return d}c(d,a);d.fromCIMText=function(a,b){return new d(a,b)};d.prototype.analyze=
function(a,b,c,d){var e=this._cimTextLayer;b="string"===typeof e.text?e.text:"function"===typeof e.text?e.text(b,c,d):"";var g=this._glyphs;C.clear();for(c=0;c<b.length;c++)C.add(b.charCodeAt(c));var h=[];C.forEach(function(a){if(g.length<a||void 0===g[a])h[a]=a});return a.getCIMMosaicItem(e.cim,h).then(function(a){if(a.glyphMosaicItems&&0<a.glyphMosaicItems.length)for(var b=a.glyphMosaicItems,c=0;c<b.length;c++)void 0!==b[c]&&(g[c]=b[c]);return a})};d.prototype.bindFeature=function(a,c,d){var e=
this,f=this._dynamicPropertyMap;f&&f.forEach(function(b,f){e[f]=b(a,c,d)});if(this._text&&0!==this._text.length){this._scale=this._size/24;this._justify=b.getJustification(this._horizontalAlignment||"center");this._xAlignD=b.getXAnchorDirection(this._horizontalAlignment||"center");this._yAlignD=-b.getYAnchorDirection(this._verticalAlignment||"baseline");this._baseline="baseline"===(this._verticalAlignment||"baseline");for(var f=this._glyphs,g=x.bidiText(this._text),h=g[0],g=g[1],k=[],m=0;m<h.length;m++)k[h.charCodeAt(m)]=
f[h.charCodeAt(m)];this.bindTextInfo(k,h,g);this._computeGlyphs(this._shapedGlyphs,this._shapedBox)}else this._shapedBox=this._shapedGlyphs=this._computedGlyphs=null};return d}(n.default(u.default));a.default=d})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../../materialKey/MaterialKey ../Tesselator ./WGLMeshTemplate".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w){Object.defineProperty(a,"__esModule",{value:!0});var z=g.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),r=[],v=[];d=function(a){function d(b,c,d,e,f,g,k,n,r){var l=a.call(this)||this;l.fillColor=d;l.tl=e;l.br=f;l.aux1=g;l.aux2=k;l.aux3=n;l.isBFS=r;l.geometryType=h.WGLGeometryType.FILL;l.forceLibtess=!1;b=C.FillMaterialKey.load(C.createMaterialKey(l.geometryType,b,!1));c&&(b.sdf=c.sdf,b.pattern=!0,b.textureBinding=c.textureBinding);l._materialKey=
b.data;l._tesselator=new t.default;l._tileClipper=new u.TileClipper(0,0,0,1,8);l._tileClipper.setExtent(m.TILE_SIZE);return l}c(d,a);d.fromCIMFill=function(a,c,e,f){void 0===f&&(f=!1);var g=c.color,g=g&&k.premultiplyAlphaRGBA(g)||0,h=n.i8888to32(0,0,0,c.colorLocked?1:0);if(!e)return new d(a,null,g,0,0,0,0,h,f);var h=e.rect,l=e.width,m=e.height,r=h.x+1,t=h.y+1,y=r+l,v=t+m,h=n.nextHighestPowerOfTwo(b.pt2px(c.height||0));255<h?h=255:0>=h&&(h=n.nextHighestPowerOfTwo(v-t));l=n.nextHighestPowerOfTwo(b.pt2px(c.height/
m*l||0));255<l?l=255:0>=l&&(l=n.nextHighestPowerOfTwo(y-r));m=b.pt2px(c.offsetX||0)+128;255<m&&(m=255);var D=b.pt2px(-c.offsetY||0)+128;255<D&&(D=255);c=c.scaleX||1;r=n.i1616to32(r,t);y=n.i1616to32(y,v);h=n.i8888to32(l,h,m,D);c=n.i1616to32(128*c,128);return new d(a,e,g,r,y,h,c,0,f)};d.fromSimpleFill=function(a,b,c,e){void 0===e&&(e=!1);var f=b.color;b=f&&"none"!==b.style&&k.premultiplyAlphaRGBA(f)||0;f=n.i8888to32(0,0,0,e?255:0);if(!c)return new d(a,null,b,0,0,0,0,f,e);var g=c.rect,h=g.x+1,l=g.y+
1,m=g.x+1+c.width,r=g.y+1+c.height,g=n.i1616to32(h,l),t=n.i1616to32(m,r),h=n.i8888to32(n.nextHighestPowerOfTwo(m-h),n.nextHighestPowerOfTwo(r-l),0,0),l=n.i1616to32(128,128);return new d(a,c,b,g,t,h,l,f,e)};d.fromPictureFill=function(a,c,e,f){void 0===f&&(f=!1);var g=m.PICTURE_FILL_COLOR,h=e.rect,k=h.x+1,l=h.y+1,h=k+e.width,r=l+e.height,k=n.i1616to32(k,l),h=n.i1616to32(h,r),r=n.nextHighestPowerOfTwo(b.pt2px(c.width));255<r&&(r=255);l=n.nextHighestPowerOfTwo(b.pt2px(c.height));255<l&&(l=255);var t=
b.pt2px(c.xoffset)+128;255<t&&(t=255);var y=b.pt2px(-c.yoffset)+128;255<y&&(y=255);r=n.i8888to32(r,l,t,y);c=n.i1616to32(128*c.xscale,128*c.yscale);l=n.i8888to32(0,0,0,f?255:0);return new d(a,e,g,k,h,r,c,l,f)};d.prototype.writeMesh=function(a,b,c,d,e){r.length=0;if("esriGeometryPolygon"!==c)z.error("Unable to handle geometryType: "+c);else{var f=e.geometry;c=C.FillMaterialKey.load(this._materialKey);var g=(e=this._isClippingRequired(f))?this._clip(f,!1):f.rings;if(c.dotDensity){for(var f=f.rings,h=
0,k=0;k<f.length;k++)for(var l=f[k],m=l[0],n=m[0],m=m[1],t=1;t<l.length;t++)var y=l[t],v=n+y[0],y=m+y[1],h=h-(v-n)*(y+m)/2,n=v,m=y;f=h}else f=0;this.forceLibtess?this._writeMeshLibtess(a,b,d,g,e,c,f):this._writeMeshEarcut(a,b,d,g,e,c,f)||this._writeMeshLibtess(a,b,d,g,e,c,f)}};d.prototype._isClippingRequired=function(a){var b=m.TILE_SIZE+8,c=0;for(a=a.rings;c<a.length;c++){var d=a[c],e=d.length;if(!(3>e)){var f=d[0][0],g=d[0][1];if(-8>f||f>b||-8>g||g>b)return!0;for(var h=1;h<e;++h)if(f+=d[h][0],g+=
d[h][1],-8>f||f>b||-8>g||g>b)return!0}}return!1};d.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;if(!(3>g)){a=f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};d.prototype._writeMeshLibtess=function(a,b,c,d,e,f,g){if(d&&d.length){var h=[],k=b.indexVector;b=b.getVector("geometry");var l=new x(c,
this.geometryType,this._materialKey),m=b.vertexCount;l.vertexFrom=m;l.indexFrom=k.length;this._tesselator.beginPolygon(r,h);for(var n=0;n<d.length;n++){var t=d[n];if(!(3>t.length)){this._tesselator.beginContour();var y=void 0,v=void 0;e?(y=t[0].x,v=t[0].y):(y=t[0][0],v=t[0][1]);var w=[y,v,0];this._tesselator.addVertex(w,w);for(w=1;w<t.length-1;w++){var u=void 0,D=void 0;e?(y=t[w].x,v=t[w].y):(u=t[w][0],D=t[w][1],y+=u,v+=D);u=[y,v,0];this._tesselator.addVertex(u,u)}this._tesselator.endContour()}}this._tesselator.endPolygon();
this._writeVerticesLibTess(l,b,c,r,f,g);this._writeIndicesLibTess(l,k,m,h);0<l.indexCount&&a.push(l)}};d.prototype._writeMeshEarcut=function(a,b,c,d,e,f,g){if(d&&d.length){var h=b.indexVector;b=b.getVector("geometry");var k=new x(c,this.geometryType,this._materialKey),l=h.length,m=b.data.length;k.vertexFrom=b.vertexCount;k.indexFrom=h.length;for(var n=0,t=0,y=0;y<d.length;y++){var w=d[y],u=t,D=void 0,A=void 0;e?(D=w[0].x,A=w[0].y):(D=w[0][0],A=w[0][1]);r[t++]=D;r[t++]=A;for(var B=0,E=1;E<w.length;++E){var z=
void 0,C=void 0;e?(z=D,C=A,D=w[E].x,A=w[E].y,z=D-z,C=A-C):(z=w[E][0],C=w[E][1],D+=z,A+=C);B-=z*(A+A-C);r[t++]=D;r[t++]=A}if(0<B){if(0<u-n){if(!this._write(k,h,b,c,r,v,n,u,f,g))return h.seek(l),b.data.seek(m),r.length=v.length=0,!1;n=u}v.length=0}else 0>B?0<u-n?v.push(.5*(u-n)):t=u:t=u}if(0<t-n&&!this._write(k,h,b,c,r,v,n,t,f,g))return h.seek(l),b.data.seek(m),r.length=v.length=0,!1;r.length=v.length=0;a.push(k);return!0}};d.prototype._write=function(a,b,c,d,f,g,h,k,m,n){f=f.slice(h,k);h=e(f,g,2);
if(e.deviation(f,g,2,h))return!1;if(h.length)return g=c.vertexCount,this._writeVertices(a,c,d,f,m,n),this._writeIndices(a,b,g,h),!0};d.prototype._writeVertices=function(a,b,c,d,e,f){for(var g=0;g<d.length;g+=2){var h=n.i1616to32(d[g],d[g+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/f):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};d.prototype._writeIndices=function(a,
b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};d.prototype._writeVerticesLibTess=function(a,b,c,d,e,f){for(var g=0;g<d.length;g+=2){var h=n.i1616to32(d[g],d[g+1]);b.data.push(h);b.data.push(c);e.dotDensity?b.data.writeF32(1/f):(b.data.push(this.fillColor),b.data.push(this.tl),b.data.push(this.br),b.data.push(this.aux1),b.data.push(this.aux2),b.data.push(this.aux3));a.vertexCount++}};d.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=
0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};return d}(w.default);a.default=d})},"esri/core/libs/earcut/earcut":function(){define([],function(){function d(b,d,l){l=l||2;var f=d&&d.length,m=f?d[0]*l:b.length,n=a(b,0,m,l,!0),r=[];if(!n||n.next===n.prev)return r;var t,v,y,u;if(f){var B=l,f=[],x,z,C;u=0;for(x=d.length;u<x;u++)z=d[u]*B,C=u<x-1?d[u+1]*B:b.length,z=a(b,z,C,B,!1),z===z.next&&(z.steiner=!0),f.push(h(z));f.sort(e);for(u=0;u<f.length;u++){d=f[u];B=n;if(B=k(d,B))d=w(B,d),c(d,d.next);n=c(n,
n.next)}}if(b.length>80*l){t=y=b[0];v=f=b[1];for(B=l;B<m;B+=l)u=b[B],d=b[B+1],u<t&&(t=u),d<v&&(v=d),u>y&&(y=u),d>f&&(f=d);y=Math.max(y-t,f-v);y=0!==y?1/y:0}g(n,r,l,t,v,y);return r}function a(a,b,c,d,e){var f;if(e===0<B(a,b,c,d))for(e=b;e<c;e+=d)f=z(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=z(e,a[e],a[e+1],f);f&&x(f,f.next)&&(r(f),f=f.next);return f}function c(a,b){if(!a)return a;b||(b=a);var c;do if(c=!1,a.steiner||!x(a,a.next)&&0!==u(a.prev,a,a.next))a=a.next;else{r(a);a=b=a.prev;if(a===a.next)break;
c=!0}while(c||a!==b);return b}function g(a,d,e,h,k,v,B){if(a){if(!B&&v){var f=a,l=f;do null===l.z&&(l.z=m(l.x,l.y,h,k,v)),l.prevZ=l.prev,l=l.nextZ=l.next;while(l!==f);l.prevZ.nextZ=null;l.prevZ=null;var f=l,y,D,A,E,z,G,J=1;do{l=f;A=f=null;for(E=0;l;){E++;D=l;for(y=z=0;y<J&&(z++,D=D.nextZ,D);y++);for(G=J;0<z||0<G&&D;)0!==z&&(0===G||!D||l.z<=D.z)?(y=l,l=l.nextZ,z--):(y=D,D=D.nextZ,G--),A?A.nextZ=y:f=y,y.prevZ=A,A=y;l=D}A.nextZ=null;J*=2}while(1<E)}for(f=a;a.prev!==a.next;){l=a.prev;D=a.next;if(v)A=
b(a,h,k,v);else a:if(A=a,E=A.prev,z=A,J=A.next,0<=u(E,z,J))A=!1;else{for(y=A.next.next;y!==A.prev;){if(n(E.x,E.y,z.x,z.y,J.x,J.y,y.x,y.y)&&0<=u(y.prev,y,y.next)){A=!1;break a}y=y.next}A=!0}if(A)d.push(l.i/e),d.push(a.i/e),d.push(D.i/e),r(a),f=a=D.next;else if(a=D,a===f){if(!B)g(c(a),d,e,h,k,v,1);else if(1===B){B=d;f=e;l=a;do D=l.prev,A=l.next.next,!x(D,A)&&C(D,l,l.next,A)&&t(D,A)&&t(A,D)&&(B.push(D.i/f),B.push(l.i/f),B.push(A.i/f),r(l),r(l.next),l=a=A),l=l.next;while(l!==a);a=l;g(a,d,e,h,k,v,2)}else if(2===
B)a:{B=a;do{for(f=B.next.next;f!==B.prev;){if(l=B.i!==f.i){l=B;D=f;A=void 0;if(A=l.next.i!==D.i&&l.prev.i!==D.i){A=void 0;b:{A=l;do{if(A.i!==l.i&&A.next.i!==l.i&&A.i!==D.i&&A.next.i!==D.i&&C(A,A.next,l,D)){A=!0;break b}A=A.next}while(A!==l);A=!1}A=!A}E=void 0;if(E=A&&t(l,D)&&t(D,l)){A=l;E=!1;z=(l.x+D.x)/2;D=(l.y+D.y)/2;do A.y>D!==A.next.y>D&&A.next.y!==A.y&&z<(A.next.x-A.x)*(D-A.y)/(A.next.y-A.y)+A.x&&(E=!E),A=A.next;while(A!==l)}l=E}if(l){a=w(B,f);B=c(B,B.next);a=c(a,a.next);g(B,d,e,h,k,v);g(a,d,
e,h,k,v);break a}f=f.next}B=B.next}while(B!==a)}break}}}}function b(a,b,c,d){var e=a.prev,f=a.next;if(0<=u(e,a,f))return!1;var g=e.x>a.x?e.x>f.x?e.x:f.x:a.x>f.x?a.x:f.x,h=e.y>a.y?e.y>f.y?e.y:f.y:a.y>f.y?a.y:f.y,k=m(e.x<a.x?e.x<f.x?e.x:f.x:a.x<f.x?a.x:f.x,e.y<a.y?e.y<f.y?e.y:f.y:a.y<f.y?a.y:f.y,b,c,d);b=m(g,h,b,c,d);c=a.prevZ;for(d=a.nextZ;c&&c.z>=k&&d&&d.z<=b;){if(c!==a.prev&&c!==a.next&&n(e.x,e.y,a.x,a.y,f.x,f.y,c.x,c.y)&&0<=u(c.prev,c,c.next))return!1;c=c.prevZ;if(d!==a.prev&&d!==a.next&&n(e.x,
e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=u(d.prev,d,d.next))return!1;d=d.nextZ}for(;c&&c.z>=k;){if(c!==a.prev&&c!==a.next&&n(e.x,e.y,a.x,a.y,f.x,f.y,c.x,c.y)&&0<=u(c.prev,c,c.next))return!1;c=c.prevZ}for(;d&&d.z<=b;){if(d!==a.prev&&d!==a.next&&n(e.x,e.y,a.x,a.y,f.x,f.y,d.x,d.y)&&0<=u(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function e(a,b){return a.x-b.x}function k(a,b){var c=b,d=a.x,e=a.y,f=-Infinity,g;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var h=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(h<=d&&
h>f){f=h;if(h===d){if(e===c.y)return c;if(e===c.next.y)return c.next}g=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!g)return null;if(d===f)return g.prev;b=g;for(var h=g.x,k=g.y,m=Infinity,r,c=g.next;c!==b;)d>=c.x&&c.x>=h&&d!==c.x&&n(e<k?d:f,e,h,k,e<k?f:d,e,c.x,c.y)&&(r=Math.abs(e-c.y)/(d-c.x),(r<m||r===m&&c.x>g.x)&&t(c,a)&&(g=c,m=r)),c=c.next;return g}function m(a,b,c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<
4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function h(a){var b=a,c=a;do{if(b.x<c.x||b.x===c.x&&b.y<c.y)c=b;b=b.next}while(b!==a);return c}function n(a,b,c,d,e,g,h,k){return 0<=(e-h)*(b-k)-(a-h)*(g-k)&&0<=(a-h)*(d-k)-(c-h)*(b-k)&&0<=(c-h)*(g-k)-(e-h)*(d-k)}function u(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function x(a,b){return a.x===b.x&&a.y===b.y}function C(a,b,c,d){return x(a,b)&&x(c,d)||x(a,d)&&x(c,b)?!0:0<u(a,b,c)!==0<u(a,b,d)&&0<u(c,d,a)!==
0<u(c,d,b)}function t(a,b){return 0>u(a.prev,a,a.next)?0<=u(a,b,a.next)&&0<=u(a,a.prev,b):0>u(a,b,a.prev)||0>u(a,a.next,b)}function w(a,b){var c=new v(a.i,a.x,a.y),d=new v(b.i,b.x,b.y),e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function z(a,b,c,d){a=new v(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function r(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=
a.prevZ)}function v(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function B(a,b,c,d){for(var e=0,f=c-d;b<c;b+=d)e+=(a[f]-a[b])*(a[b+1]+a[f+1]),f=b;return e}d.deviation=function(a,b,c,d){var e=b&&b.length,f=Math.abs(B(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,g=b.length;e<g;e++)f-=Math.abs(B(a,b[e]*c,e<g-1?b[e+1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var g=d[e]*c,h=d[e+1]*c,k=d[e+2]*c;b+=Math.abs((a[g]-a[k])*(a[h+1]-a[g+1])-(a[g]-a[h])*
(a[k+1]-a[g+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)};d.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;g<b;g++)c.vertices.push(a[e][f][g]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c};return d})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(d,a,c,g){Object.defineProperty(a,
"__esModule",{value:!0});var b=c.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");d=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new g.GluTesselator;this.glu.gluTessCallback(g.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_COMBINE,
this._combinecallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(g.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));this.glu.gluTessProperty(g.gluEnum.GLU_TESS_WINDING_RULE,g.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=
b};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};a.prototype.addVertex=function(a,b){this.glu.gluTessVertex(a,b)};a.prototype._vertexCallback=function(a,b){b[b.length]=a[0];b[b.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),
this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){b.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a,b,c){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=
function(a){};return a}();a.default=d})},"esri/core/libs/libtess/libtess":function(){define([],function(){var d={DEBUG:!1,assert:function(a,c){if(d.DEBUG&&!a)throw Error("Assertion failed"+(c?": "+c:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,
GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,
GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};d.geom.vertEq=function(a,c){return a.s===c.s&&a.t===c.t};d.geom.vertLeq=function(a,c){return a.s<c.s||a.s===c.s&&a.t<=c.t};d.geom.edgeEval=function(a,c,g){d.assert(d.geom.vertLeq(a,c)&&d.geom.vertLeq(c,g));var b=c.s-a.s,e=g.s-c.s;return 0<b+e?b<e?c.t-a.t+b/(b+e)*(a.t-g.t):c.t-
g.t+e/(b+e)*(g.t-a.t):0};d.geom.edgeSign=function(a,c,g){d.assert(d.geom.vertLeq(a,c)&&d.geom.vertLeq(c,g));var b=c.s-a.s,e=g.s-c.s;return 0<b+e?(c.t-g.t)*b+(c.t-a.t)*e:0};d.geom.transLeq=function(a,c){return a.t<c.t||a.t===c.t&&a.s<=c.s};d.geom.transEval=function(a,c,g){d.assert(d.geom.transLeq(a,c)&&d.geom.transLeq(c,g));var b=c.t-a.t,e=g.t-c.t;return 0<b+e?b<e?c.s-a.s+b/(b+e)*(a.s-g.s):c.s-g.s+e/(b+e)*(g.s-a.s):0};d.geom.transSign=function(a,c,g){d.assert(d.geom.transLeq(a,c)&&d.geom.transLeq(c,
g));var b=c.t-a.t,e=g.t-c.t;return 0<b+e?(c.s-g.s)*b+(c.s-a.s)*e:0};d.geom.edgeGoesLeft=function(a){return d.geom.vertLeq(a.dst(),a.org)};d.geom.edgeGoesRight=function(a){return d.geom.vertLeq(a.org,a.dst())};d.geom.vertL1dist=function(a,c){return Math.abs(a.s-c.s)+Math.abs(a.t-c.t)};d.geom.vertCCW=function(a,c,d){return 0<=a.s*(c.t-d.t)+c.s*(d.t-a.t)+d.s*(a.t-c.t)};d.geom.interpolate_=function(a,c,d,b){a=0>a?0:a;d=0>d?0:d;return a<=d?0===d?(c+b)/2:c+a/(a+d)*(b-c):b+d/(a+d)*(c-b)};d.geom.edgeIntersect=
function(a,c,g,b,e){var k,m;d.geom.vertLeq(a,c)||(k=a,a=c,c=k);d.geom.vertLeq(g,b)||(k=g,g=b,b=k);d.geom.vertLeq(a,g)||(k=a,a=g,g=k,k=c,c=b,b=k);d.geom.vertLeq(g,c)?d.geom.vertLeq(c,b)?(k=d.geom.edgeEval(a,g,c),m=d.geom.edgeEval(g,c,b),0>k+m&&(k=-k,m=-m),e.s=d.geom.interpolate_(k,g.s,m,c.s)):(k=d.geom.edgeSign(a,g,c),m=-d.geom.edgeSign(a,b,c),0>k+m&&(k=-k,m=-m),e.s=d.geom.interpolate_(k,g.s,m,b.s)):e.s=(g.s+c.s)/2;d.geom.transLeq(a,c)||(k=a,a=c,c=k);d.geom.transLeq(g,b)||(k=g,g=b,b=k);d.geom.transLeq(a,
g)||(k=a,a=g,g=k,k=c,c=b,b=k);d.geom.transLeq(g,c)?d.geom.transLeq(c,b)?(k=d.geom.transEval(a,g,c),m=d.geom.transEval(g,c,b),0>k+m&&(k=-k,m=-m),e.t=d.geom.interpolate_(k,g.t,m,c.t)):(k=d.geom.transSign(a,g,c),m=-d.geom.transSign(a,b,c),0>k+m&&(k=-k,m=-m),e.t=d.geom.interpolate_(k,g.t,m,b.t)):e.t=(g.t+c.t)/2};d.mesh={};d.mesh.makeEdge=function(a){var c=d.mesh.makeEdgePair_(a.eHead);d.mesh.makeVertex_(c,a.vHead);d.mesh.makeVertex_(c.sym,a.vHead);d.mesh.makeFace_(c,a.fHead);return c};d.mesh.meshSplice=
function(a,c){var g=!1,b=!1;a!==c&&(c.org!==a.org&&(b=!0,d.mesh.killVertex_(c.org,a.org)),c.lFace!==a.lFace&&(g=!0,d.mesh.killFace_(c.lFace,a.lFace)),d.mesh.splice_(c,a),b||(d.mesh.makeVertex_(c,a.org),a.org.anEdge=a),g||(d.mesh.makeFace_(c,a.lFace),a.lFace.anEdge=a))};d.mesh.deleteEdge=function(a){var c=a.sym,g=!1;a.lFace!==a.rFace()&&(g=!0,d.mesh.killFace_(a.lFace,a.rFace()));a.oNext===a?d.mesh.killVertex_(a.org,null):(a.rFace().anEdge=a.oPrev(),a.org.anEdge=a.oNext,d.mesh.splice_(a,a.oPrev()),
g||d.mesh.makeFace_(a,a.lFace));c.oNext===c?(d.mesh.killVertex_(c.org,null),d.mesh.killFace_(c.lFace,null)):(a.lFace.anEdge=c.oPrev(),c.org.anEdge=c.oNext,d.mesh.splice_(c,c.oPrev()));d.mesh.killEdge_(a)};d.mesh.addEdgeVertex=function(a){var c=d.mesh.makeEdgePair_(a),g=c.sym;d.mesh.splice_(c,a.lNext);c.org=a.dst();d.mesh.makeVertex_(g,c.org);c.lFace=g.lFace=a.lFace;return c};d.mesh.splitEdge=function(a){var c=d.mesh.addEdgeVertex(a).sym;d.mesh.splice_(a.sym,a.sym.oPrev());d.mesh.splice_(a.sym,c);
a.sym.org=c.org;c.dst().anEdge=c.sym;c.sym.lFace=a.rFace();c.winding=a.winding;c.sym.winding=a.sym.winding;return c};d.mesh.connect=function(a,c){var g=!1,b=d.mesh.makeEdgePair_(a),e=b.sym;c.lFace!==a.lFace&&(g=!0,d.mesh.killFace_(c.lFace,a.lFace));d.mesh.splice_(b,a.lNext);d.mesh.splice_(e,c);b.org=a.dst();e.org=c.org;b.lFace=e.lFace=a.lFace;a.lFace.anEdge=e;g||d.mesh.makeFace_(b,a.lFace);return b};d.mesh.zapFace=function(a){var c=a.anEdge,g=c.lNext,b;do if(b=g,g=b.lNext,b.lFace=null,null===b.rFace()){b.oNext===
b?d.mesh.killVertex_(b.org,null):(b.org.anEdge=b.oNext,d.mesh.splice_(b,b.oPrev()));var e=b.sym;e.oNext===e?d.mesh.killVertex_(e.org,null):(e.org.anEdge=e.oNext,d.mesh.splice_(e,e.oPrev()));d.mesh.killEdge_(b)}while(b!==c);c=a.prev;a=a.next;a.prev=c;c.next=a};d.mesh.meshUnion=function(a,c){var d=a.fHead,b=a.vHead,e=a.eHead,k=c.fHead,m=c.vHead;c=c.eHead;k.next!==k&&(d.prev.next=k.next,k.next.prev=d.prev,k.prev.next=d,d.prev=k.prev);m.next!==m&&(b.prev.next=m.next,m.next.prev=b.prev,m.prev.next=b,b.prev=
m.prev);c.next!==c&&(e.sym.next.sym.next=c.next,c.next.sym.next=e.sym.next,c.sym.next.sym.next=e,e.sym.next=c.sym.next);return a};d.mesh.deleteMesh=function(a){};d.mesh.makeEdgePair_=function(a){var c=new d.GluHalfEdge,g=new d.GluHalfEdge,b=a.sym.next;g.next=b;b.sym.next=c;c.next=a;a.sym.next=g;c.sym=g;c.oNext=c;c.lNext=g;g.sym=c;g.oNext=g;return g.lNext=c};d.mesh.splice_=function(a,c){var d=a.oNext,b=c.oNext;d.sym.lNext=c;b.sym.lNext=a;a.oNext=b;c.oNext=d};d.mesh.makeVertex_=function(a,c){var g=
c.prev,b=new d.GluVertex(c,g);g.next=b;c.prev=b;c=b.anEdge=a;do c.org=b,c=c.oNext;while(c!==a)};d.mesh.makeFace_=function(a,c){var g=c.prev,b=new d.GluFace(c,g);g.next=b;c.prev=b;b.anEdge=a;b.inside=c.inside;c=a;do c.lFace=b,c=c.lNext;while(c!==a)};d.mesh.killEdge_=function(a){var c=a.next;a=a.sym.next;c.sym.next=a;a.sym.next=c};d.mesh.killVertex_=function(a,c){var d=a.anEdge,b=d;do b.org=c,b=b.oNext;while(b!==d);c=a.prev;a=a.next;a.prev=c;c.next=a};d.mesh.killFace_=function(a,c){var d=a.anEdge,b=
d;do b.lFace=c,b=b.lNext;while(b!==d);c=a.prev;a=a.next;a.prev=c;c.next=a};d.normal={};d.normal.S_UNIT_X_=1;d.normal.S_UNIT_Y_=0;d.normal.projectPolygon=function(a,c,g,b){var e=!1,k=[c,g,b];0===c&&0===g&&0===b&&(d.normal.computeNormal_(a,k),e=!0);g=d.normal.longAxis_(k);c=a.mesh.vHead;if(d.TRUE_PROJECT){d.normal.normalize_(k);b=[0,0,0];var m=[0,0,0];b[g]=0;b[(g+1)%3]=d.normal.S_UNIT_X_;b[(g+2)%3]=d.normal.S_UNIT_Y_;g=d.normal.dot_(b,k);b[0]-=g*k[0];b[1]-=g*k[1];b[2]-=g*k[2];d.normal.normalize_(b);
m[0]=k[1]*b[2]-k[2]*b[1];m[1]=k[2]*b[0]-k[0]*b[2];m[2]=k[0]*b[1]-k[1]*b[0];d.normal.normalize_(m);for(k=c.next;k!==c;k=k.next)k.s=d.normal.dot_(k.coords,b),k.t=d.normal.dot_(k.coords,m)}else for(b=(g+1)%3,m=(g+2)%3,g=0<k[g]?1:-1,k=c.next;k!==c;k=k.next)k.s=k.coords[b],k.t=g*k.coords[m];e&&d.normal.checkOrientation_(a)};d.normal.dot_=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};d.normal.normalize_=function(a){var c=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];d.assert(0<c);c=Math.sqrt(c);a[0]/=c;a[1]/=c;a[2]/=
c};d.normal.longAxis_=function(a){var c=0;Math.abs(a[1])>Math.abs(a[0])&&(c=1);Math.abs(a[2])>Math.abs(a[c])&&(c=2);return c};d.normal.computeNormal_=function(a,c){var g=[-2*d.GLU_TESS_MAX_COORD,-2*d.GLU_TESS_MAX_COORD,-2*d.GLU_TESS_MAX_COORD],b=[2*d.GLU_TESS_MAX_COORD,2*d.GLU_TESS_MAX_COORD,2*d.GLU_TESS_MAX_COORD],e=[],k=[],m;a=a.mesh.vHead;for(m=a.next;m!==a;m=m.next)for(var h=0;3>h;++h){var n=m.coords[h];n<b[h]&&(b[h]=n,k[h]=m);n>g[h]&&(g[h]=n,e[h]=m)}m=0;g[1]-b[1]>g[0]-b[0]&&(m=1);g[2]-b[2]>g[m]-
b[m]&&(m=2);if(b[m]>=g[m])c[0]=0,c[1]=0,c[2]=1;else{g=0;b=k[m];e=e[m];k=[0,0,0];b=[b.coords[0]-e.coords[0],b.coords[1]-e.coords[1],b.coords[2]-e.coords[2]];h=[0,0,0];for(m=a.next;m!==a;m=m.next)h[0]=m.coords[0]-e.coords[0],h[1]=m.coords[1]-e.coords[1],h[2]=m.coords[2]-e.coords[2],k[0]=b[1]*h[2]-b[2]*h[1],k[1]=b[2]*h[0]-b[0]*h[2],k[2]=b[0]*h[1]-b[1]*h[0],n=k[0]*k[0]+k[1]*k[1]+k[2]*k[2],n>g&&(g=n,c[0]=k[0],c[1]=k[1],c[2]=k[2]);0>=g&&(c[0]=c[1]=c[2]=0,c[d.normal.longAxis_(b)]=1)}};d.normal.checkOrientation_=
function(a){for(var c=0,d=a.mesh.fHead,b=d.next;b!==d;b=b.next){var e=b.anEdge;if(!(0>=e.winding)){do c+=(e.org.s-e.dst().s)*(e.org.t+e.dst().t),e=e.lNext;while(e!==b.anEdge)}}if(0>c)for(a=a.mesh.vHead,c=a.next;c!==a;c=c.next)c.t=-c.t};d.render={};d.render.renderMesh=function(a,c,g){for(var b=!1,e=-1,k=c.fHead.prev;k!==c.fHead;k=k.prev)if(k.inside){b||(a.callBeginCallback(d.primitiveType.GL_TRIANGLES),b=!0);var m=k.anEdge;d.assert(m.lNext.lNext.lNext===m,"renderMesh called with non-triangulated mesh");
do{if(g){var h=m.rFace().inside?0:1;e!==h&&(e=h,a.callEdgeFlagCallback(!!e))}a.callVertexCallback(m.org.data);m=m.lNext}while(m!==k.anEdge)}b&&a.callEndCallback()};d.render.renderBoundary=function(a,c){for(var g=c.fHead.next;g!==c.fHead;g=g.next)if(g.inside){a.callBeginCallback(d.primitiveType.GL_LINE_LOOP);var b=g.anEdge;do a.callVertexCallback(b.org.data),b=b.lNext;while(b!==g.anEdge);a.callEndCallback()}};d.sweep={};d.sweep.SENTINEL_COORD_=4*d.GLU_TESS_MAX_COORD;d.sweep.TOLERANCE_NONZERO_=!1;d.sweep.computeInterior=
function(a){a.fatalError=!1;d.sweep.removeDegenerateEdges_(a);d.sweep.initPriorityQ_(a);d.sweep.initEdgeDict_(a);for(var c;null!==(c=a.pq.extractMin());){for(;;){var g=a.pq.minimum();if(null===g||!d.geom.vertEq(g,c))break;g=a.pq.extractMin();d.sweep.spliceMergeVertices_(a,c.anEdge,g.anEdge)}d.sweep.sweepEvent_(a,c)}c=a.dict.getMin().getKey();a.event=c.eUp.org;d.sweep.doneEdgeDict_(a);d.sweep.donePriorityQ_(a);d.sweep.removeDegenerateFaces_(a.mesh);a.mesh.checkMesh()};d.sweep.addWinding_=function(a,
c){a.winding+=c.winding;a.sym.winding+=c.sym.winding};d.sweep.edgeLeq_=function(a,c,g){a=a.event;c=c.eUp;g=g.eUp;if(c.dst()===a)return g.dst()===a?d.geom.vertLeq(c.org,g.org)?0>=d.geom.edgeSign(g.dst(),c.org,g.org):0<=d.geom.edgeSign(c.dst(),g.org,c.org):0>=d.geom.edgeSign(g.dst(),a,g.org);if(g.dst()===a)return 0<=d.geom.edgeSign(c.dst(),a,c.org);c=d.geom.edgeEval(c.dst(),a,c.org);a=d.geom.edgeEval(g.dst(),a,g.org);return c>=a};d.sweep.deleteRegion_=function(a,c){c.fixUpperEdge&&d.assert(0===c.eUp.winding);
c.eUp.activeRegion=null;a.dict.deleteNode(c.nodeUp);c.nodeUp=null};d.sweep.fixUpperEdge_=function(a,c){d.assert(a.fixUpperEdge);d.mesh.deleteEdge(a.eUp);a.fixUpperEdge=!1;a.eUp=c;c.activeRegion=a};d.sweep.topLeftRegion_=function(a){var c=a.eUp.org;do a=a.regionAbove();while(a.eUp.org===c);a.fixUpperEdge&&(c=d.mesh.connect(a.regionBelow().eUp.sym,a.eUp.lNext),d.sweep.fixUpperEdge_(a,c),a=a.regionAbove());return a};d.sweep.topRightRegion_=function(a){var c=a.eUp.dst();do a=a.regionAbove();while(a.eUp.dst()===
c);return a};d.sweep.addRegionBelow_=function(a,c,g){var b=new d.ActiveRegion;b.eUp=g;b.nodeUp=a.dict.insertBefore(c.nodeUp,b);return g.activeRegion=b};d.sweep.isWindingInside_=function(a,c){switch(a.windingRule){case d.windingRule.GLU_TESS_WINDING_ODD:return 0!==(c&1);case d.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==c;case d.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<c;case d.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>c;case d.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=c||-2>=
c}d.assert(!1);return!1};d.sweep.computeWinding_=function(a,c){c.windingNumber=c.regionAbove().windingNumber+c.eUp.winding;c.inside=d.sweep.isWindingInside_(a,c.windingNumber)};d.sweep.finishRegion_=function(a,c){var g=c.eUp,b=g.lFace;b.inside=c.inside;b.anEdge=g;d.sweep.deleteRegion_(a,c)};d.sweep.finishLeftRegions_=function(a,c,g){var b=c;for(c=c.eUp;b!==g;){b.fixUpperEdge=!1;var e=b.regionBelow(),k=e.eUp;if(k.org!==c.org){if(!e.fixUpperEdge){d.sweep.finishRegion_(a,b);break}k=d.mesh.connect(c.lPrev(),
k.sym);d.sweep.fixUpperEdge_(e,k)}c.oNext!==k&&(d.mesh.meshSplice(k.oPrev(),k),d.mesh.meshSplice(c,k));d.sweep.finishRegion_(a,b);c=e.eUp;b=e}return c};d.sweep.addRightEdges_=function(a,c,g,b,e,k){var m=!0;do d.assert(d.geom.vertLeq(g.org,g.dst())),d.sweep.addRegionBelow_(a,c,g.sym),g=g.oNext;while(g!==b);for(null===e&&(e=c.regionBelow().eUp.rPrev());;){b=c.regionBelow();g=b.eUp.sym;if(g.org!==e.org)break;g.oNext!==e&&(d.mesh.meshSplice(g.oPrev(),g),d.mesh.meshSplice(e.oPrev(),g));b.windingNumber=
c.windingNumber-g.winding;b.inside=d.sweep.isWindingInside_(a,b.windingNumber);c.dirty=!0;!m&&d.sweep.checkForRightSplice_(a,c)&&(d.sweep.addWinding_(g,e),d.sweep.deleteRegion_(a,c),d.mesh.deleteEdge(e));m=!1;c=b;e=g}c.dirty=!0;d.assert(c.windingNumber-g.winding===b.windingNumber);k&&d.sweep.walkDirtyRegions_(a,c)};d.sweep.callCombine_=function(a,c,g,b,e){var k=[c.coords[0],c.coords[1],c.coords[2]];c.data=null;c.data=a.callCombineCallback(k,g,b);null===c.data&&(e?a.fatalError||(a.callErrorCallback(d.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),
a.fatalError=!0):c.data=g[0])};d.sweep.spliceMergeVertices_=function(a,c,g){var b=[null,null,null,null];b[0]=c.org.data;b[1]=g.org.data;d.sweep.callCombine_(a,c.org,b,[.5,.5,0,0],!1);d.mesh.meshSplice(c,g)};d.sweep.vertexWeights_=function(a,c,g,b,e){var k=d.geom.vertL1dist(c,a),m=d.geom.vertL1dist(g,a),h=e+1;b[e]=.5*m/(k+m);b[h]=.5*k/(k+m);a.coords[0]+=b[e]*c.coords[0]+b[h]*g.coords[0];a.coords[1]+=b[e]*c.coords[1]+b[h]*g.coords[1];a.coords[2]+=b[e]*c.coords[2]+b[h]*g.coords[2]};d.sweep.getIntersectData_=
function(a,c,g,b,e,k){var m=[0,0,0,0],h=[g.data,b.data,e.data,k.data];c.coords[0]=c.coords[1]=c.coords[2]=0;d.sweep.vertexWeights_(c,g,b,m,0);d.sweep.vertexWeights_(c,e,k,m,2);d.sweep.callCombine_(a,c,h,m,!0)};d.sweep.checkForRightSplice_=function(a,c){var g=c.regionBelow(),b=c.eUp,e=g.eUp;if(d.geom.vertLeq(b.org,e.org)){if(0<d.geom.edgeSign(e.dst(),b.org,e.org))return!1;d.geom.vertEq(b.org,e.org)?b.org!==e.org&&(a.pq.remove(b.org.pqHandle),d.sweep.spliceMergeVertices_(a,e.oPrev(),b)):(d.mesh.splitEdge(e.sym),
d.mesh.meshSplice(b,e.oPrev()),c.dirty=g.dirty=!0)}else{if(0>d.geom.edgeSign(b.dst(),e.org,b.org))return!1;c.regionAbove().dirty=c.dirty=!0;d.mesh.splitEdge(b.sym);d.mesh.meshSplice(e.oPrev(),b)}return!0};d.sweep.checkForLeftSplice_=function(a,c){var g=c.regionBelow();a=c.eUp;var b=g.eUp;d.assert(!d.geom.vertEq(a.dst(),b.dst()));if(d.geom.vertLeq(a.dst(),b.dst())){if(0>d.geom.edgeSign(a.dst(),b.dst(),a.org))return!1;c.regionAbove().dirty=c.dirty=!0;g=d.mesh.splitEdge(a);d.mesh.meshSplice(b.sym,g);
g.lFace.inside=c.inside}else{if(0<d.geom.edgeSign(b.dst(),a.dst(),b.org))return!1;c.dirty=g.dirty=!0;g=d.mesh.splitEdge(b);d.mesh.meshSplice(a.lNext,b.sym);g.rFace().inside=c.inside}return!0};d.sweep.checkForIntersect_=function(a,c){var g=c.regionBelow(),b=c.eUp,e=g.eUp,k=b.org,m=e.org,h=b.dst(),n=e.dst(),u=new d.GluVertex;d.assert(!d.geom.vertEq(n,h));d.assert(0>=d.geom.edgeSign(h,a.event,k));d.assert(0<=d.geom.edgeSign(n,a.event,m));d.assert(k!==a.event&&m!==a.event);d.assert(!c.fixUpperEdge&&!g.fixUpperEdge);
if(k===m||Math.min(k.t,h.t)>Math.max(m.t,n.t))return!1;if(d.geom.vertLeq(k,m)){if(0<d.geom.edgeSign(n,k,m))return!1}else if(0>d.geom.edgeSign(h,m,k))return!1;d.geom.edgeIntersect(h,k,n,m,u);d.assert(Math.min(k.t,h.t)<=u.t);d.assert(u.t<=Math.max(m.t,n.t));d.assert(Math.min(n.s,h.s)<=u.s);d.assert(u.s<=Math.max(m.s,k.s));d.geom.vertLeq(u,a.event)&&(u.s=a.event.s,u.t=a.event.t);var x=d.geom.vertLeq(k,m)?k:m;d.geom.vertLeq(x,u)&&(u.s=x.s,u.t=x.t);if(d.geom.vertEq(u,k)||d.geom.vertEq(u,m))return d.sweep.checkForRightSplice_(a,
c),!1;if(!d.geom.vertEq(h,a.event)&&0<=d.geom.edgeSign(h,a.event,u)||!d.geom.vertEq(n,a.event)&&0>=d.geom.edgeSign(n,a.event,u)){if(n===a.event)return d.mesh.splitEdge(b.sym),d.mesh.meshSplice(e.sym,b),c=d.sweep.topLeftRegion_(c),b=c.regionBelow().eUp,d.sweep.finishLeftRegions_(a,c.regionBelow(),g),d.sweep.addRightEdges_(a,c,b.oPrev(),b,b,!0),!0;if(h===a.event)return d.mesh.splitEdge(e.sym),d.mesh.meshSplice(b.lNext,e.oPrev()),g=c,c=d.sweep.topRightRegion_(c),k=c.regionBelow().eUp.rPrev(),g.eUp=e.oPrev(),
e=d.sweep.finishLeftRegions_(a,g,null),d.sweep.addRightEdges_(a,c,e.oNext,b.rPrev(),k,!0),!0;0<=d.geom.edgeSign(h,a.event,u)&&(c.regionAbove().dirty=c.dirty=!0,d.mesh.splitEdge(b.sym),b.org.s=a.event.s,b.org.t=a.event.t);0>=d.geom.edgeSign(n,a.event,u)&&(c.dirty=g.dirty=!0,d.mesh.splitEdge(e.sym),e.org.s=a.event.s,e.org.t=a.event.t);return!1}d.mesh.splitEdge(b.sym);d.mesh.splitEdge(e.sym);d.mesh.meshSplice(e.oPrev(),b);b.org.s=u.s;b.org.t=u.t;b.org.pqHandle=a.pq.insert(b.org);d.sweep.getIntersectData_(a,
b.org,k,h,m,n);c.regionAbove().dirty=c.dirty=g.dirty=!0;return!1};d.sweep.walkDirtyRegions_=function(a,c){for(var g=c.regionBelow();;){for(;g.dirty;)c=g,g=g.regionBelow();if(!c.dirty&&(g=c,c=c.regionAbove(),null===c||!c.dirty))break;c.dirty=!1;var b=c.eUp,e=g.eUp;b.dst()!==e.dst()&&d.sweep.checkForLeftSplice_(a,c)&&(g.fixUpperEdge?(d.sweep.deleteRegion_(a,g),d.mesh.deleteEdge(e),g=c.regionBelow(),e=g.eUp):c.fixUpperEdge&&(d.sweep.deleteRegion_(a,c),d.mesh.deleteEdge(b),c=g.regionAbove(),b=c.eUp));
if(b.org!==e.org)if(b.dst()===e.dst()||c.fixUpperEdge||g.fixUpperEdge||b.dst()!==a.event&&e.dst()!==a.event)d.sweep.checkForRightSplice_(a,c);else if(d.sweep.checkForIntersect_(a,c))break;b.org===e.org&&b.dst()===e.dst()&&(d.sweep.addWinding_(e,b),d.sweep.deleteRegion_(a,c),d.mesh.deleteEdge(b),c=g.regionAbove())}};d.sweep.connectRightVertex_=function(a,c,g){var b=g.oNext,e=c.regionBelow(),k=c.eUp,m=e.eUp,h=!1;k.dst()!==m.dst()&&d.sweep.checkForIntersect_(a,c);d.geom.vertEq(k.org,a.event)&&(d.mesh.meshSplice(b.oPrev(),
k),c=d.sweep.topLeftRegion_(c),b=c.regionBelow().eUp,d.sweep.finishLeftRegions_(a,c.regionBelow(),e),h=!0);d.geom.vertEq(m.org,a.event)&&(d.mesh.meshSplice(g,m.oPrev()),g=d.sweep.finishLeftRegions_(a,e,null),h=!0);h?d.sweep.addRightEdges_(a,c,g.oNext,b,b,!0):(b=d.geom.vertLeq(m.org,k.org)?m.oPrev():k,b=d.mesh.connect(g.lPrev(),b),d.sweep.addRightEdges_(a,c,b,b.oNext,b.oNext,!1),b.sym.activeRegion.fixUpperEdge=!0,d.sweep.walkDirtyRegions_(a,c))};d.sweep.connectLeftDegenerate_=function(a,c,g){var b=
c.eUp;if(d.geom.vertEq(b.org,g))d.assert(d.sweep.TOLERANCE_NONZERO_),d.sweep.TOLERANCE_NONZERO_&&d.sweep.spliceMergeVertices_(a,b,g.anEdge);else if(d.geom.vertEq(b.dst(),g)){if(d.assert(d.sweep.TOLERANCE_NONZERO_),d.sweep.TOLERANCE_NONZERO_){c=d.sweep.topRightRegion_(c);var b=c.regionBelow(),e=b.eUp.sym,k=e.oNext,m=k;b.fixUpperEdge&&(d.assert(k!==e),d.sweep.deleteRegion_(a,b),d.mesh.deleteEdge(e),e=k.oPrev());d.mesh.meshSplice(g.anEdge,e);d.geom.edgeGoesLeft(k)||(k=null);d.sweep.addRightEdges_(a,
c,e.oNext,m,k,!0)}}else d.mesh.splitEdge(b.sym),c.fixUpperEdge&&(d.mesh.deleteEdge(b.oNext),c.fixUpperEdge=!1),d.mesh.meshSplice(g.anEdge,b),d.sweep.sweepEvent_(a,g)};d.sweep.connectLeftVertex_=function(a,c){var g=new d.ActiveRegion;g.eUp=c.anEdge.sym;var g=a.dict.search(g).getKey(),b=g.regionBelow(),e=g.eUp,k=b.eUp;0===d.geom.edgeSign(e.dst(),c,e.org)?d.sweep.connectLeftDegenerate_(a,g,c):(b=d.geom.vertLeq(k.dst(),e.dst())?g:b,g.inside||b.fixUpperEdge?(e=b===g?d.mesh.connect(c.anEdge.sym,e.lNext):
d.mesh.connect(k.dNext(),c.anEdge).sym,b.fixUpperEdge?d.sweep.fixUpperEdge_(b,e):d.sweep.computeWinding_(a,d.sweep.addRegionBelow_(a,g,e)),d.sweep.sweepEvent_(a,c)):d.sweep.addRightEdges_(a,g,c.anEdge,c.anEdge,null,!0))};d.sweep.sweepEvent_=function(a,c){a.event=c;for(var g=c.anEdge;null===g.activeRegion;)if(g=g.oNext,g===c.anEdge){d.sweep.connectLeftVertex_(a,c);return}c=d.sweep.topLeftRegion_(g.activeRegion);var b=c.regionBelow(),g=b.eUp,b=d.sweep.finishLeftRegions_(a,b,null);b.oNext===g?d.sweep.connectRightVertex_(a,
c,b):d.sweep.addRightEdges_(a,c,b.oNext,g,g,!0)};d.sweep.addSentinel_=function(a,c){var g=new d.ActiveRegion,b=d.mesh.makeEdge(a.mesh);b.org.s=d.sweep.SENTINEL_COORD_;b.org.t=c;b.dst().s=-d.sweep.SENTINEL_COORD_;b.dst().t=c;a.event=b.dst();g.eUp=b;g.windingNumber=0;g.inside=!1;g.fixUpperEdge=!1;g.sentinel=!0;g.dirty=!1;g.nodeUp=a.dict.insert(g)};d.sweep.initEdgeDict_=function(a){a.dict=new d.Dict(a,d.sweep.edgeLeq_);d.sweep.addSentinel_(a,-d.sweep.SENTINEL_COORD_);d.sweep.addSentinel_(a,d.sweep.SENTINEL_COORD_)};
d.sweep.doneEdgeDict_=function(a){for(var c=0,g;null!==(g=a.dict.getMin().getKey());)g.sentinel||(d.assert(g.fixUpperEdge),d.assert(1===++c)),d.assert(0===g.windingNumber),d.sweep.deleteRegion_(a,g);a.dict=null};d.sweep.removeDegenerateEdges_=function(a){for(var c=a.mesh.eHead,g,b=c.next;b!==c;b=g){g=b.next;var e=b.lNext;d.geom.vertEq(b.org,b.dst())&&b.lNext.lNext!==b&&(d.sweep.spliceMergeVertices_(a,e,b),d.mesh.deleteEdge(b),b=e,e=b.lNext);if(e.lNext===b){if(e!==b){if(e===g||e===g.sym)g=g.next;d.mesh.deleteEdge(e)}if(b===
g||b===g.sym)g=g.next;d.mesh.deleteEdge(b)}}};d.sweep.initPriorityQ_=function(a){var c=new d.PriorityQ;a.pq=c;a=a.mesh.vHead;var g;for(g=a.next;g!==a;g=g.next)g.pqHandle=c.insert(g);c.init()};d.sweep.donePriorityQ_=function(a){a.pq.deleteQ();a.pq=null};d.sweep.removeDegenerateFaces_=function(a){for(var c,g=a.fHead.next;g!==a.fHead;g=c)c=g.next,g=g.anEdge,d.assert(g.lNext!==g),g.lNext.lNext===g&&(d.sweep.addWinding_(g.oNext,g),d.mesh.deleteEdge(g))};d.tessmono={};d.tessmono.tessellateMonoRegion_=function(a){a=
a.anEdge;for(d.assert(a.lNext!==a&&a.lNext.lNext!==a);d.geom.vertLeq(a.dst(),a.org);a=a.lPrev());for(;d.geom.vertLeq(a.org,a.dst());a=a.lNext);for(var c=a.lPrev(),g;a.lNext!==c;)if(d.geom.vertLeq(a.dst(),c.org)){for(;c.lNext!==a&&(d.geom.edgeGoesLeft(c.lNext)||0>=d.geom.edgeSign(c.org,c.dst(),c.lNext.dst()));)g=d.mesh.connect(c.lNext,c),c=g.sym;c=c.lPrev()}else{for(;c.lNext!==a&&(d.geom.edgeGoesRight(a.lPrev())||0<=d.geom.edgeSign(a.dst(),a.org,a.lPrev().org));)g=d.mesh.connect(a,a.lPrev()),a=g.sym;
a=a.lNext}for(d.assert(c.lNext!==a);c.lNext.lNext!==a;)g=d.mesh.connect(c.lNext,c),c=g.sym};d.tessmono.tessellateInterior=function(a){for(var c,g=a.fHead.next;g!==a.fHead;g=c)c=g.next,g.inside&&d.tessmono.tessellateMonoRegion_(g)};d.tessmono.discardExterior=function(a){for(var c,g=a.fHead.next;g!==a.fHead;g=c)c=g.next,g.inside||d.mesh.zapFace(g)};d.tessmono.setWindingNumber=function(a,c,g){for(var b,e=a.eHead.next;e!==a.eHead;e=b)b=e.next,e.rFace().inside!==e.lFace.inside?e.winding=e.lFace.inside?
c:-c:g?d.mesh.deleteEdge(e):e.winding=0};d.Dict=function(a,c){this.head_=new d.DictNode;this.frame_=a;this.leq_=c};d.Dict.prototype.deleteDict_=function(){};d.Dict.prototype.insertBefore=function(a,c){do a=a.prev;while(null!==a.key&&!this.leq_(this.frame_,a.key,c));c=new d.DictNode(c,a.next,a);a.next.prev=c;return a.next=c};d.Dict.prototype.insert=function(a){return this.insertBefore(this.head_,a)};d.Dict.prototype.deleteNode=function(a){a.next.prev=a.prev;a.prev.next=a.next};d.Dict.prototype.search=
function(a){var c=this.head_;do c=c.next;while(null!==c.key&&!this.leq_(this.frame_,a,c.key));return c};d.Dict.prototype.getMin=function(){return this.head_.next};d.Dict.prototype.getMax=function(){return this.head_.prev};d.DictNode=function(a,c,d){this.key=a||null;this.next=c||this;this.prev=d||this};d.DictNode.prototype.getKey=function(){return this.key};d.DictNode.prototype.getSuccessor=function(){return this.next};d.DictNode.prototype.getPredecessor=function(){return this.prev};d.GluTesselator=
function(){this.state_=d.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=d.windingRule.GLU_TESS_WINDING_ODD;this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};d.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};d.GluTesselator.prototype.gluDeleteTess=
function(){this.requireState_(d.GluTesselator.tessState_.T_DORMANT)};d.GluTesselator.prototype.gluTessProperty=function(a,c){switch(a){case d.gluEnum.GLU_TESS_TOLERANCE:return;case d.gluEnum.GLU_TESS_WINDING_RULE:switch(c){case d.windingRule.GLU_TESS_WINDING_ODD:case d.windingRule.GLU_TESS_WINDING_NONZERO:case d.windingRule.GLU_TESS_WINDING_POSITIVE:case d.windingRule.GLU_TESS_WINDING_NEGATIVE:case d.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=c;return}break;case d.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=
!!c;return;default:this.callErrorCallback(d.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(d.gluEnum.GLU_INVALID_VALUE)};d.GluTesselator.prototype.gluGetTessProperty=function(a){switch(a){case d.gluEnum.GLU_TESS_TOLERANCE:return 0;case d.gluEnum.GLU_TESS_WINDING_RULE:return a=this.windingRule,d.assert(a===d.windingRule.GLU_TESS_WINDING_ODD||a===d.windingRule.GLU_TESS_WINDING_NONZERO||a===d.windingRule.GLU_TESS_WINDING_POSITIVE||a===d.windingRule.GLU_TESS_WINDING_NEGATIVE||a===d.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),
a;case d.gluEnum.GLU_TESS_BOUNDARY_ONLY:return d.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(d.gluEnum.GLU_INVALID_ENUM)}return!1};d.GluTesselator.prototype.gluTessNormal=function(a,c,d){this.normal_[0]=a;this.normal_[1]=c;this.normal_[2]=d};d.GluTesselator.prototype.gluTessCallback=function(a,c){c=c?c:null;switch(a){case d.gluEnum.GLU_TESS_BEGIN:case d.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=c;break;case d.gluEnum.GLU_TESS_EDGE_FLAG:case d.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=
c;break;case d.gluEnum.GLU_TESS_VERTEX:case d.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=c;break;case d.gluEnum.GLU_TESS_END:case d.gluEnum.GLU_TESS_END_DATA:this.endCallback_=c;break;case d.gluEnum.GLU_TESS_ERROR:case d.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=c;break;case d.gluEnum.GLU_TESS_COMBINE:case d.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=c;break;case d.gluEnum.GLU_TESS_MESH:this.meshCallback_=c;break;default:this.callErrorCallback(d.gluEnum.GLU_INVALID_ENUM)}};d.GluTesselator.prototype.gluTessVertex=
function(a,c){var g=!1,b=[0,0,0];this.requireState_(d.GluTesselator.tessState_.T_IN_CONTOUR);for(var e=0;3>e;++e){var k=a[e];k<-d.GLU_TESS_MAX_COORD&&(k=-d.GLU_TESS_MAX_COORD,g=!0);k>d.GLU_TESS_MAX_COORD&&(k=d.GLU_TESS_MAX_COORD,g=!0);b[e]=k}g&&this.callErrorCallback(d.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(b,c)};d.GluTesselator.prototype.gluTessBeginPolygon=function(a){this.requireState_(d.GluTesselator.tessState_.T_DORMANT);this.state_=d.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=
new d.GluMesh;this.polygonData_=a};d.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(d.GluTesselator.tessState_.T_IN_POLYGON);this.state_=d.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};d.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(d.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=d.GluTesselator.tessState_.T_IN_POLYGON};d.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(d.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=d.GluTesselator.tessState_.T_DORMANT;d.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);d.sweep.computeInterior(this);if(!this.fatalError){var a=this.mesh;this.boundaryOnly_?d.tessmono.setWindingNumber(a,1,!0):d.tessmono.tessellateInterior(a);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?d.render.renderBoundary(this,this.mesh):d.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);
if(this.meshCallback_){d.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}d.mesh.deleteMesh(this.mesh);this.mesh=this.polygonData_=null};d.GluTesselator.prototype.requireState_=function(a){this.state_!==a&&this.gotoState_(a)};d.GluTesselator.prototype.gotoState_=function(a){for(;this.state_!==a;)if(this.state_<a)switch(this.state_){case d.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(d.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);
this.gluTessBeginPolygon(null);break;case d.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(d.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case d.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(d.errorType.GLU_TESS_MISSING_END_CONTOUR);this.gluTessEndContour();break;case d.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(d.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};d.GluTesselator.prototype.addVertex_=
function(a,c){var g=this.lastEdge_;null===g?(g=d.mesh.makeEdge(this.mesh),d.mesh.meshSplice(g,g.sym)):(d.mesh.splitEdge(g),g=g.lNext);g.org.data=c;g.org.coords[0]=a[0];g.org.coords[1]=a[1];g.org.coords[2]=a[2];g.winding=1;g.sym.winding=-1;this.lastEdge_=g};d.GluTesselator.prototype.callBeginCallback=function(a){this.beginCallback_&&this.beginCallback_(a,this.polygonData_)};d.GluTesselator.prototype.callVertexCallback=function(a){this.vertexCallback_&&this.vertexCallback_(a,this.polygonData_)};d.GluTesselator.prototype.callEdgeFlagCallback=
function(a){this.edgeFlagCallback_&&this.edgeFlagCallback_(a,this.polygonData_)};d.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};d.GluTesselator.prototype.callCombineCallback=function(a,c,d){return this.combineCallback_?this.combineCallback_(a,c,d,this.polygonData_)||null:null};d.GluTesselator.prototype.callErrorCallback=function(a){this.errorCallback_&&this.errorCallback_(a,this.polygonData_)};d.GluFace=function(a,c){this.next=a||this;
this.prev=c||this;this.anEdge=null;this.inside=!1};d.GluHalfEdge=function(a){this.next=a||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};d.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};d.GluHalfEdge.prototype.dst=function(){return this.sym.org};d.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};d.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};d.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};
d.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};d.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};d.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};d.GluMesh=function(){this.vHead=new d.GluVertex;this.fHead=new d.GluFace;this.eHead=new d.GluHalfEdge;this.eHeadSym=new d.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};d.GluMesh.prototype.checkMesh=function(){if(d.DEBUG){var a=this.fHead,c=this.vHead,g=this.eHead,b,e;for(b=b=a;(e=
b.next)!==a;b=e){d.assert(e.prev===b);b=e.anEdge;do d.assert(b.sym!==b),d.assert(b.sym.sym===b),d.assert(b.lNext.oNext.sym===b),d.assert(b.oNext.sym.lNext===b),d.assert(b.lFace===e),b=b.lNext;while(b!==e.anEdge)}d.assert(e.prev===b&&null===e.anEdge);for(b=b=c;(a=b.next)!==c;b=a){d.assert(a.prev===b);b=a.anEdge;do d.assert(b.sym!==b),d.assert(b.sym.sym===b),d.assert(b.lNext.oNext.sym===b),d.assert(b.oNext.sym.lNext===b),d.assert(b.org===a),b=b.oNext;while(b!==a.anEdge)}d.assert(a.prev===b&&null===
a.anEdge&&null===a.data);for(c=c=g;(b=c.next)!==g;c=b)d.assert(b.sym.next===c.sym),d.assert(b.sym!==b),d.assert(b.sym.sym===b),d.assert(null!==b.org),d.assert(null!==b.dst()),d.assert(b.lNext.oNext.sym===b),d.assert(b.oNext.sym.lNext===b);d.assert(b.sym.next===c.sym&&b.sym===this.eHeadSym&&b.sym.sym===b&&null===b.org&&null===b.dst()&&null===b.lFace&&null===b.rFace())}};d.GluVertex=function(a,c){this.next=a||this;this.prev=c||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=
this.s=0};d.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new d.PriorityQHeap};d.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};d.PriorityQ.prototype.init=function(){this.order_=[];for(var a=0;a<this.size_;a++)this.order_[a]=a;a=function(a){return function(b,c){return d.geom.vertLeq(a[b],a[c])?1:-1}}(this.verts_);this.order_.sort(a);this.initialized_=!0;this.heap_.init();if(d.DEBUG)for(var c=0+this.size_-1,a=0;a<
c;++a)d.assert(d.geom.vertLeq(this.verts_[this.order_[a+1]],this.verts_[this.order_[a]]))};d.PriorityQ.prototype.insert=function(a){if(this.initialized_)return this.heap_.insert(a);var c=this.size_++;this.verts_[c]=a;return-(c+1)};d.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var c=this.heap_.minimum();if(d.geom.vertLeq(c,a))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&
null===this.verts_[this.order_[this.size_-1]]);return a};d.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var c=this.heap_.minimum();if(d.geom.vertLeq(c,a))return c}return a};d.PriorityQ.prototype.remove=function(a){if(0<=a)this.heap_.remove(a);else for(a=-(a+1),d.assert(a<this.verts_.length&&null!==this.verts_[a]),this.verts_[a]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-
1]];)--this.size_};d.PriorityQHeap=function(){this.heap_=d.PriorityQHeap.reallocNumeric_([0],d.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=d.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};d.PriorityQHeap.INIT_SIZE_=32;d.PriorityQHeap.reallocNumeric_=function(a,c){for(var d=Array(c),b=0;b<a.length;b++)d[b]=a[b];for(;b<c;b++)d[b]=0;return d};d.PriorityQHeap.prototype.init=function(){for(var a=this.size_;1<=a;--a)this.floatDown_(a);
this.initialized_=!0};d.PriorityQHeap.prototype.insert=function(a){var c=++this.size_;2*c>this.max_&&(this.max_*=2,this.handles_=d.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var g;0===this.freeList_?g=c:(g=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[g]=a;this.handles_[g]=c;this.heap_[c]=g;this.initialized_&&this.floatUp_(c);return g};d.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};d.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};
d.PriorityQHeap.prototype.extractMin=function(){var a=this.heap_,c=this.verts_,d=this.handles_,b=a[1],e=c[b];0<this.size_&&(a[1]=a[this.size_],d[a[1]]=1,c[b]=null,d[b]=this.freeList_,this.freeList_=b,0<--this.size_&&this.floatDown_(1));return e};d.PriorityQHeap.prototype.remove=function(a){var c=this.heap_,g=this.verts_,b=this.handles_;d.assert(1<=a&&a<=this.max_&&null!==g[a]);var e=b[a];c[e]=c[this.size_];b[c[e]]=e;e<=--this.size_&&(1>=e?this.floatDown_(e):d.geom.vertLeq(g[c[e>>1]],g[c[e]])?this.floatDown_(e):
this.floatUp_(e));g[a]=null;b[a]=this.freeList_;this.freeList_=a};d.PriorityQHeap.prototype.floatDown_=function(a){for(var c=this.heap_,g=this.verts_,b=this.handles_,e=c[a];;){var k=a<<1;k<this.size_&&d.geom.vertLeq(g[c[k+1]],g[c[k]])&&(k+=1);d.assert(k<=this.max_);var m=c[k];if(k>this.size_||d.geom.vertLeq(g[e],g[m])){c[a]=e;b[e]=a;break}c[a]=m;b[m]=a;a=k}};d.PriorityQHeap.prototype.floatUp_=function(a){for(var c=this.heap_,g=this.verts_,b=this.handles_,e=c[a];;){var k=a>>1,m=c[k];if(0===k||d.geom.vertLeq(g[m],
g[e])){c[a]=e;b[e]=a;break}c[a]=m;b[m]=a;a=k}};d.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};d.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};d.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return d})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(d,
a,c){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._resolver=null}a.prototype.isHeld=function(){return!!this._resolver};a.prototype.acquire=function(){var a=this;return this._resolver?this._resolver.promise.then(function(){return a.acquire()}):(this._resolver=c.createResolver(),c.resolve())};a.prototype.release=function(){var a=this._resolver;this._resolver=null;a.resolve()};return a}();a.default=d;a.withLock=function(a,b,c){return a.acquire().then(function(){return b(c)}).then(function(){return a.release()}).catch(function(b){a.release();
throw b;})}})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),function(d,a,c,g,b,e,k,m,h,n,u,x,C){Object.defineProperty(a,"__esModule",{value:!0});var t=new c.default,w=new c.default;d=function(){function a(){this.tileBufferData=this.tileDisplayData=null}a.prototype.reshuffle=function(){t.reset();
for(var c=b.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),d=0;d<c.length;d++)for(var h=c[d],f=0,m=h;f<m.length;f++){var l=m[f];l&&t.needMore(l.geometryType,l.meshData?l.meshData.vertexCount:l.vertexCount,l.meshData?l.meshData.indexData.length:l.indexCount)}f=c.length;d=new g;for(m=0;m<f;++m){d.geometries[m].indexBuffer=new Uint32Array(Math.round(1.15*t.indicesFor(m)));var l=[],n;for(n in this.tileBufferData.geometries[m].vertexBuffer)l.push(this.tileBufferData.geometries[m].vertexBuffer[n].stride);
var l=a._computeVertexAlignment(l),h=Math.round(1.15*t.verticesFor(m)),l=a._align(h,l),u;for(u in this.tileBufferData.geometries[m].vertexBuffer)h=this.tileBufferData.geometries[m].vertexBuffer[u].stride,d.geometries[m].vertexBuffer[u]={stride:h,data:k.allocateTypedArrayBuffer(l,h)}}w.reset();this.tileDisplayData.displayList.clear();for(m=0;m<f;++m){h=c[m];n=0;for(u=h;n<u.length;n++){l=u[n];if(l.meshData)l.writeMeshDataToBuffers(w.verticesFor(m),d.geometries[m].vertexBuffer,w.indicesFor(m),d.geometries[m].indexBuffer),
l.meshData=null;else{var x=this.tileBufferData.geometries[m].vertexBuffer,z=this.tileBufferData.geometries[m].indexBuffer,C=d.geometries[m].vertexBuffer,L=d.geometries[m].indexBuffer,Q=w.verticesFor(m),R=w.indicesFor(m);e.copyMeshData(Q,R,C,L,l,x,z);l.vertexFrom=Q;l.indexFrom=R}w.needMore(m,l.vertexCount,l.indexCount)}this.tileDisplayData.displayList.unified||this.tileDisplayData.displayList.addToList(h)}if(this.tileDisplayData.displayList.unified)for(c=0,f=this.tileDisplayData.displayObjects;c<f.length;c++)this.tileDisplayData.displayList.addToList(f[c].displayRecords);
this.tileBufferData=d};a.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var d in c.vertexBuffer)a[b][d]=c.vertexBuffer[d].stride}return a};a.prototype.clone=function(){var b=new a;b.tileBufferData=this.tileBufferData.clone();b.tileDisplayData=this.tileDisplayData.clone();return b};a.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,b=Math.min(a.length,4),c=0,d=0;d<b;d++)c=
Math.max(c,a[d].displayRecords.length);return 2*(12*a.length+a.length*c*40)};a.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new C.default(Int32Array,this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};a.decode=function(b){var c=x.deserializeList(new u.default(b.displayObjects),m),d={},e;for(e in b.vertexBuffersMap)d[e]=n.VertexBuffers.decode(b.vertexBuffersMap[e]);
return a.fromMeshData({displayObjects:c,vertexBuffersMap:d})};a.fromMeshData=function(c){var d=new a,e=new b.default,f=new g;e.displayObjects=c.displayObjects;for(var h in c.vertexBuffersMap){var k=c.vertexBuffersMap[h];f.geometries[h].indexBuffer=k.indexBuffer;f.geometries[h].vertexBuffer=k.namedBuffers}d.tileDisplayData=e;d.tileBufferData=f;return d};a.bind=function(b,c){var d=new a;d.tileDisplayData=b;d.tileBufferData=c;return d};a.create=function(c,d){var e=new a;e.tileDisplayData=new b.default;
e.tileDisplayData.displayObjects=c;for(var f=[0,0,0,0,0],m=[0,0,0,0,0],l=[[],[],[],[],[]],n=0;n<c.length;n++)for(var t=0,r=c[n].displayRecords;t<r.length;t++){var v=r[t];l[v.geometryType].push(v);f[v.geometryType]+=v.meshData.vertexCount;m[v.geometryType]+=v.meshData.indexData.length}c=new g;d=[d.fill||{},d.line||{},d.icon||{},d.text||{},d.label||{}];for(n=0;5>n;n++){var t=new Uint32Array(m[n]),r=d[n],v=f[n],u={},w=void 0;for(w in r){var x={data:k.allocateTypedArrayBuffer(v,r[w]),stride:r[w]};u[w]=
x}r=u;h.writeAllMeshDataToBuffers(l[n],r,t);c.geometries[n]={indexBuffer:t,vertexBuffer:r}}e.tileBufferData=c;return e};a._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};a._computeVertexAlignment=function(a){for(var b=!1,c=!1,d=0;d<a.length;d++){var e=a[d];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return a}();a.TileData=d})},"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._byGeometryType=
null}Object.defineProperty(a.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._byGeometryType=null};a.prototype.verticesFor=function(a){return this._byGeometryType?this._byGeometryType[a].vertices:0};a.prototype.indicesFor=function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};a.prototype.needMore=function(a,b,c){if(b||c)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,
indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=b,a.indices+=c};return a}();a.default=d})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports","./Utils"],function(d,a,c){return function(){function a(){this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}
a.prototype.clone=function(){for(var b=new a,c=0;c<this.geometries.length;c++){var d=this.geometries[c],g=b.geometries[c];g.indexBuffer=d.indexBuffer.slice();g.vertexBuffer={};for(var h in d.vertexBuffer){var n=d.vertexBuffer[h],u=n.stride;g.vertexBuffer[h]={data:n.data.slice(),stride:u}}}return b};a.deserialize=function(b){for(var d=new a,g=0;5>g;++g){d.geometries[g].indexBuffer=new Uint32Array(b.geometries[g].indexBuffer);d.geometries[g].vertexBuffer={};for(var m in b.geometries[g].vertexBuffer)d.geometries[g].vertexBuffer[m]=
{data:c.allocateTypedArrayBufferwithData(b.geometries[g].vertexBuffer[m].data,b.geometries[g].vertexBuffer[m].stride),stride:b.geometries[g].vertexBuffer[m].stride}}return d};a.prototype.serialize=function(){for(var a={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},
{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},c=0;5>c;++c)for(var d in this.geometries[c].vertexBuffer)a.geometries[c].vertexBuffer[d]={data:this.geometries[c].vertexBuffer[d].data.buffer,stride:this.geometries[c].vertexBuffer[d].stride};return a};a.prototype.getBuffers=function(){for(var a=[],c=0;5>c;++c){a.push(this.geometries[c].indexBuffer.buffer);for(var d in this.geometries[c].vertexBuffer)a.push(this.geometries[c].vertexBuffer[d].data.buffer)}return a};return a}()})},
"esri/views/2d/engine/webgl/TileDisplayData":function(){define(["require","exports","./WGLDisplayList","./WGLDisplayObject","./util/serializationUtils"],function(d,a,c,g,b){function e(a){for(var b=[[],[],[],[],[]],c=0;c<a.length;c++)for(var d=0,e=a[c].displayRecords;d<e.length;d++){var g=e[d];b[g.geometryType].push(g)}return b}Object.defineProperty(a,"__esModule",{value:!0});a.groupRecordsByGeometryType=e;d=function(){function a(){}Object.defineProperty(a.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=
new Map;for(var a=0,b=this.displayObjects;a<b.length;a++){var c=b[a];this._displayObjectRegistry.set(c.id,c)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});a.prototype.computeDisplayList=function(a){this._displayList=new c(a);if(a){a=0;for(var b=this.displayObjects;a<b.length;a++)for(var d=0,g=b[a].displayRecords;d<g.length;d++)this._displayList.addToList(g[d])}else for(a=
e(this.displayObjects),b=a.length,d=0;d<b;++d)this._displayList.addToList(a[d])};a.prototype.clone=function(){var b=new a;this.displayObjects&&(b.displayObjects=this.displayObjects.map(function(a){return a.clone()}));return b};a.prototype.serialize=function(a){b.serializeList(a,this.displayObjects);return a};a.prototype._deserializeObjects=function(a){for(var b=a.readInt32(),b=Array(b),c=new Map,d=0;d<b.length;++d){var e=g.deserialize(a);b[d]=e;c.set(e.id,e)}this.displayObjects=b;this._displayList=
null;this._displayObjectRegistry=c};a.deserialize=function(b){var c=new a;c._deserializeObjects(b);return c};return a}();a.default=d})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/Logger","./enums"],function(d,a,c,g,b){function e(a,b,c){for(var d=[],e=3;e<arguments.length;e++)d[e-3]=arguments[e];b<a.length?a.splice.apply(a,[b,c].concat(d)):a.push.apply(a,d)}var k=g.getLogger("esri.views.2d.engine.webgl.WGLDisplayList"),
m=new Map;m.set(b.WGLDrawPhase.MAP,[b.WGLGeometryType.FILL,b.WGLGeometryType.LINE,b.WGLGeometryType.MARKER,b.WGLGeometryType.TEXT]);m.set(b.WGLDrawPhase.LABEL,[b.WGLGeometryType.LABEL]);m.set(b.WGLDrawPhase.LABEL_ALPHA,[b.WGLGeometryType.LABEL]);d=function(){function a(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}a.prototype.replay=function(a,b){if(this.unified)for(var c=0,d=this.symbolLevels;c<d.length;c++)for(var e=0,g=d[c].zLevels;e<g.length;e++){var f=g[e].geometryDPInfo,h;for(h in f)if(f[h])for(var k=
0,n=f[h];k<n.length;k++){var t=n[k],u=a.painter.getGeometryBrush(t.geometryType),w=b.getGeometry(t.geometryType);u.drawGeometry(a,b,t,w)}}else for(var c=function(c){var d=a.painter.getGeometryBrush(c),e=b.getGeometry(c);x.byType(c,function(c){d.drawGeometry(a,b,c,e)})},x=this,d=0,e=m.get(a.drawPhase);d<e.length;d++)c(e[d])};Object.defineProperty(a.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.symbolLevels.length=
0};a.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};a.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};a.prototype.byType=function(a,b){for(var c=0,d=this.symbolLevels;c<d.length;c++)for(var e=0,g=d[c].zLevels;e<g.length;e++){var f=g[e].geometryDPInfo,h=this.getDPInfoType(a);if(f[h])for(var k=0,f=f[h];k<f.length;k++)b(f[k])}};a.prototype.clone=
function(){for(var b=new a(this.unified),c=0,d=this.symbolLevels;c<d.length;c++)b.symbolLevels.push(d[c].clone());return b};a.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=a.indexFrom+a.indexCount,e=0;e<c;++e){var g=b[e];if(g.geometryType===a.geometryType&&d>g.indexFrom&&d<=g.indexFrom+g.indexCount)return d<g.indexFrom+g.indexCount&&(a=new h,a.geometryType=g.geometryType,a.materialKey=g.materialKey,a.indexFrom=d,a.indexCount=g.indexFrom+
g.indexCount-d,b.splice(e+1,0,a),g.indexCount=d-g.indexFrom),e}};a.prototype._addToList=function(a,b){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);b=null!=b?b:c.length-1;var d=0<=b&&b<c.length?c[b]:null;null===d||d.materialKey!==a.materialKey||d.indexFrom+d.indexCount!==a.indexFrom||this.unified&&d.geometryType!==a.geometryType?(d=new h,d.indexFrom=a.indexFrom,d.indexCount=a.indexCount,d.materialKey=a.materialKey,d.geometryType=a.geometryType,e(c,b+1,0,d)):d.indexCount+=a.indexCount};
a.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,d=void 0,g=0;g<c;++g){var k=b[g];if(a.indexFrom+a.indexCount>k.indexFrom&&a.indexFrom<k.indexFrom+k.indexCount&&(!this.unified||k.geometryType===a.geometryType)){d=g;break}}if(void 0!==d){k=b[d];if(a.indexFrom===k.indexFrom)return k.indexCount-=a.indexCount,k.indexFrom+=a.indexCount,0===k.indexCount&&e(b,d,1),d-1;if(a.indexFrom+a.indexCount===k.indexFrom+k.indexCount)return k.indexCount-=
a.indexCount,0===k.indexCount?(e(b,d,1),d-1):d;var c=k.indexFrom,g=a.indexFrom-k.indexFrom,f=a.indexCount;a=k.indexFrom+k.indexCount-(a.indexFrom+a.indexCount);k.indexCount=g;var m=new h;m.geometryType=k.geometryType;m.materialKey=k.materialKey;m.indexFrom=c+g+f;m.indexCount=a;e(b,d+1,0,m);return d}return null};a.prototype._getDisplayList=function(a,c,d){for(var e,g=this.symbolLevels.length,h=0;h<g;h++)if(this.symbolLevels[h].symbolLevel===a){e=this.symbolLevels[h];break}e||(e=new x,e.symbolLevel=
a,this.symbolLevels.push(e));var f;a=e.zLevels.length;for(g=0;g<a;g++)if(e.zLevels[g].zLevel===c){f=e.zLevels[g];break}f||(f=new u,f.geometryDPInfo=new n,f.zLevel=c,e.zLevels.push(f));var k;if(this.unified)f.geometryDPInfo.unified||(f.geometryDPInfo.unified=[]),k=f.geometryDPInfo.unified;else switch(d){case b.WGLGeometryType.FILL:f.geometryDPInfo.fill||(f.geometryDPInfo.fill=[]);k=f.geometryDPInfo.fill;break;case b.WGLGeometryType.LINE:f.geometryDPInfo.line||(f.geometryDPInfo.line=[]);k=f.geometryDPInfo.line;
break;case b.WGLGeometryType.MARKER:f.geometryDPInfo.marker||(f.geometryDPInfo.marker=[]);k=f.geometryDPInfo.marker;break;case b.WGLGeometryType.TEXT:f.geometryDPInfo.text||(f.geometryDPInfo.text=[]);k=f.geometryDPInfo.text;break;case b.WGLGeometryType.LABEL:f.geometryDPInfo.label||(f.geometryDPInfo.label=[]);k=f.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+d+"'.")}return k};a.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case b.WGLGeometryType.FILL:return"fill";
case b.WGLGeometryType.LINE:return"line";case b.WGLGeometryType.MARKER:return"marker";case b.WGLGeometryType.TEXT:return"text";case b.WGLGeometryType.LABEL:return"label";default:k.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return a}();var h=function(){function a(){this.materialKey=null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialKey=this.materialKey;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;
return b};return a}(),n=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&
this.unified.map(function(a){return a.clone()});return b};return a}(),u=function(){function a(){this.geometryDPInfo=new n}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();return b};return a}(),x=function(){function a(){this.zLevels=[]}a.prototype.clone=function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,d=this.zLevels;c<d.length;c++)b.zLevels.push(d[c].clone());return b};return a}();return d})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require",
"exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a){this._pos=0;this._buffer=a;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}a.prototype.readInt32=function(){return this._i32View[this._pos++]};a.prototype.readF32=function(){return this._f32View[this._pos++]};return a}();a.default=d})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../renderers/support/utils ./definitions ./Utils".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x){function C(a,b){var c=b.length;if(a<b[0].value||1===c)return b[0].size;for(var d=1;d<c;d++)if(a<b[d].value)return b[d-1].size+(a-b[d-1].value)/(b[d].value-b[d-1].value)*(b[d].size-b[d-1].size);return b[c-1].size}function t(a,b,c){void 0===c&&(c=0);var d=b.g,e=b.b,g=b.a;a[c+0]=b.r*g/255;a[c+1]=d*g/255;a[c+2]=e*g/255;a[c+3]=g}Object.defineProperty(a,"__esModule",{value:!0});var w=function(a,b,c){for(var d=c*=16,e=0;d<Math.min(c+16,a.length);d++,e++)a[d]=b[e]},z=h.mat4f32.create();
d=function(){function a(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this.ddColors=new Float32Array(32);this.ddBackgroundColor=new Float32Array(4);this.ddActiveDots=new Float32Array(8);this.insideEffect=new Float32Array(16*u.MAX_FILTERS);
this.insideOpacity=1;this.outsideEffect=new Float32Array(16*u.MAX_FILTERS);this.outsideOpacity=1;this.effectCount=0;this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this._buf0=new Float32Array(2);this._buf1=new Float32Array(2);this.symbolLevels.push(0);for(var a=0;a<u.MAX_FILTERS;a++)w(this.insideEffect,z,a),w(this.outsideEffect,z,a)}Object.defineProperty(a.prototype,"insideOpacities",{get:function(){this._buf0[0]=
1;this._buf0[1]=this.insideOpacity;return this._buf0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"outsideOpacities",{get:function(){this._buf1[0]=0;this._buf1[1]=this.outsideOpacity;return this._buf1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});a.prototype.update=function(a,b,c,d){var f=this;e.isSome(d)?(d.forEach(function(a,b){return f._updateEffects(b,
a)}),this.effectCount=d.length):this.effectCount=0;c&&this._updateVisualVariables(c,a);switch(b.type){case "dot-density":this._updateDotDensityInfo(b)}};a.prototype.getVariation=function(){return{ddDotBlending:this.ddDotBlending,outsideLabelsVisible:this.outsideLabelsVisible,effectCount:this.effectCount,oesTextureFloat:b("esri-webgl-texture-float")}};a.prototype.getVariationHash=function(){return(this.ddDotBlending?1:0)|(this.outsideLabelsVisible?1:0)<<1|this.effectCount<<2};a.prototype._updateEffects=
function(a,b){a+=1;if(e.isSome(b)&&b.filter&&b.filter.enabled){this.outsideLabelsVisible=b.excludedLabelsVisible;var c=b.parsedIncludedEffect;b=b.parsedExcludedEffect;e.isSome(c)?(w(this.insideEffect,c.getColorMatrix(),a),this.insideOpacity=c.getOpacity()):(w(this.insideEffect,z,a),this.insideOpacity=1);e.isSome(b)?(w(this.outsideEffect,b.getColorMatrix(),a),this.outsideOpacity=b.getOpacity()):(w(this.outsideEffect,z,a),this.outsideOpacity=1)}else w(this.insideEffect,z,a),w(this.outsideEffect,z,a),
this.outsideOpacity=this.insideOpacity=1};a.prototype._updateVisualVariables=function(a,b){var c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=!1;c.vvRotationEnabled=!1;if(a){var d=a.size;if(d){c.vvSizeEnabled=!0;if(d.minMaxValue){var e=d.minMaxValue,g=void 0,h=void 0;x.isDefined(e.minSize)&&x.isDefined(e.maxSize)&&(x.isNumber(e.minSize)&&x.isNumber(e.maxSize)?(g=k.pt2px(e.minSize),h=k.pt2px(e.maxSize)):(h=b.scale,g=k.pt2px(C(h,e.minSize.stops)),h=k.pt2px(C(h,
e.maxSize.stops))));this.vvSizeMinMaxValue.set([e.minDataValue,e.maxDataValue,g,h])}d.scaleStops&&(this.vvSizeScaleStopsValue=k.pt2px(C(b.scale,d.scaleStops.stops)));d.unitValue&&(this.vvSizeUnitValueToPixelsRatio=m.getMetersPerUnitForSR(b.spatialReference)/n.meterIn[d.unitValue.unit]/b.resolution);d.fieldStops&&(this.vvSizeFieldStopsValues.set(d.fieldStops.values),this.vvSizeFieldStopsSizes.set(d.fieldStops.sizes))}if(b=a.color)c.vvColorEnabled=!0,this.vvColorValues.set(b.values),this.vvColors.set(b.colors);
if(b=a.opacity)c.vvOpacityEnabled=!0,this.vvOpacityValues.set(b.values),this.vvOpacities.set(b.opacities);if(a=a.rotation)c.vvRotationEnabled=!0,c.vvRotationType=a.type}};a.prototype._updateDotDensityInfo=function(a){var b=a.attributes;this.ddDotValue=a.dotValue;this.ddDotScale=a.referenceScale;this.ddDotSize=a.dotSize;this.ddDotBlending=a.dotBlendingEnabled;this.ddSeed=a.seed;for(var c=0;c<u.DOT_DENSITY_MAX_FIELDS;c++){var d=c>=b.length?new g([0,0,0,0]):b[c].color;t(this.ddColors,d,4*c)}for(c=0;8>
c;c++)this.ddActiveDots[c]=c<a.attributes.length?1:0;t(this.ddBackgroundColor,a.backgroundColor)};return a}();a.WGLRendererInfo=d})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../DisplayObject ./definitions ./DirtyMap ./DisplayRecordStore ./enums ./Fader ./WGLBuffers ./WGLDisplayList ../../tiling/TileKey".split(" "),
function(d,a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v){function B(a,b){return a.sortKey-b.sortKey}Object.defineProperty(a,"__esModule",{value:!0});var f=new Set;d=function(a){function d(c,d,e){void 0===e&&(e=!1);var f=a.call(this)||this;f._data=null;f.hlDisplayList=null;f._displayList=null;f._wglBuffers=null;f._dirtyMap=new x.default;f.coords=[0,0];f.bounds=[0,0,0,0];f.dvsMat3=k.mat3f32.create();f.tileMat3=k.mat3f32.create();f.labelMat2d=b.mat2df32.create();f._labelIndex=null;f._dirty=!0;f.fader=new w.default;
f.key=v.pool.acquire(c);f.coords[0]=d[0];f.coords[1]=d[3];f.bounds=d;f._ensureCorrectZOrder=e;return f}c(d,a);Object.defineProperty(d.prototype,"displayObjects",{get:function(){return this._data.tileDisplayData.displayObjects},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||
this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"labelIndex",{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});d.prototype.getGeometry=function(a){return this._wglBuffers&&this._wglBuffers.has(a)?this._wglBuffers.get(a):null};d.prototype.getDisplayList=function(a){switch(a){case t.WGLDrawPhase.HIGHLIGHT:return this.hlDisplayList;
default:return this._data&&this._displayList}};Object.defineProperty(d.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});d.prototype.setData=function(a,b,c){var d=a.addOrUpdate,e=a.remove;this.fader.reset();!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:d,remove:e},b,c):(d.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new x.default,this._dispRecStore=C.default.fromTileData(d,
this._dirtyMap),this._data=d,this._readyTileIfNoLabels(b,c),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=d.tileDisplayData.displayList.clone())):(this.clear(),this.ready());this.emit("change")};d.prototype.commitChanges=function(a){this.isDirty&&this._wglBuffers||(this._wglBuffers||(this._wglBuffers=new z.default(this.stage.context)),this._displayList=this._data.tileDisplayData.displayList.clone(),this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._dirtyMap.markAllClean())};
d.prototype.setTransform=function(a,b){var c=this.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);e.mat3.set(this.tileMat3,b,0,0,0,b,0,d[0],d[1],1);e.mat3.multiply(this.dvsMat3,a.displayViewMat3,c)};d.prototype.setLabelTransform=function(a,b){var c=this.labelMat2d;b=a.getScreenTransform(c,b);var d=h.vec2f32.create();m.vec2.transformMat2d(d,this.coords,b);g.mat2d.identity(c);g.mat2d.translate(c,c,d);g.mat2d.multiply(c,a.viewMat2d,c)};d.prototype.clear=function(){this._dispRecStore=this._displayList=
this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null);this.hlDisplayList&&(this.hlDisplayList=null)};d.prototype.attach=function(){return!0};d.prototype.dispose=function(){this.clear()};d.prototype.doRender=function(a){if(this.isReady&&this.hasData){this.commitChanges(a);this.stage.context.setStencilFunction(514,this.stencilRef,255);if(a.drawPhase===t.WGLDrawPhase.MAP||a.drawPhase===t.WGLDrawPhase.LABEL||a.drawPhase===t.WGLDrawPhase.LABEL_ALPHA)this._displayList.replay(a,
this);else for(var b=0,c=this.stage.painter.getBrushes(a.drawPhase);b<c.length;b++)c[b].draw(a,this);this.fader.step()||this.requestRender()}};d.prototype.buildHLList=function(a){if(this.data&&(this.hlDisplayList&&this.hlDisplayList.clear(),!a.isEmpty)){this.hlDisplayList||(this.hlDisplayList=new r);for(var b=0,c=this.data.tileDisplayData.displayObjects;b<c.length;b++){var d=c[b];if(a.has(d.id)){for(var e=[],f=0,d=d.displayRecords;f<d.length;f++){var g=d[f].copy();g.meshData=null;g.symbolLevel=0;
g.zOrder=0;e.push(g)}e.sort(B);this.hlDisplayList.addToList(e)}}}this.requestRender()};d.prototype._readyTileIfNoLabels=function(a,b){a&&b?(this._rebuildLabelIndex(),this.isDirty=!0):this.isDirty=!1};d.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=C.default.fromTileData(this._data,this._dirtyMap));this._readyTileIfNoLabels(b,c);this.requestRender()};d.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();
for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,d=b[a].metrics;c<d.length;c++)this._insertIntoLabelIndex(d[c])};d.prototype._insertIntoLabelIndex=function(a){-1!==a.xBucket&&this.labelIndex[a.yBucket][a.xBucket].push(a)};d.prototype._initLabelIndex=function(){for(var a=[],b=0;b<u.TILE_SIZE/u.COLLISION_BUCKET_SIZE;b++){a.push([]);for(var c=0;c<u.TILE_SIZE/u.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};d.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&
a.addOrUpdate.tileDisplayData.displayObjects||[],d=(a.remove||[]).slice(),e=0;e<c.length;e++){var g=c[e];null!=g.insertAfter&&d.push(g.id)}for(g=0;g<d.length;g++){var h=d[g];if(e=this._data.tileDisplayData.displayObjectRegistry.get(h)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var k=0,m=e.displayRecords;k<m.length;k++)this._dispRecStore.delete(m[k]);this._data.tileDisplayData.displayObjectRegistry.delete(h);e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,
1)}}for(d=0;d<c.length;d++){g=c[d];e=this._data.tileDisplayData.displayObjectRegistry.get(g.id);h=void 0;if(e){k=e.displayRecords;e.set(g);e.displayRecords=k;k=e.displayRecords.length;for(m=0;m<k;++m){var l=e.displayRecords[m],n=g.displayRecords[m];if(m>=g.displayRecords.length||l.geometryType!==n.geometryType||l.symbolLevel!==n.symbolLevel||l.zOrder!==n.zOrder||l.materialKey!==n.materialKey)this._dispRecStore.delete(e.displayRecords[m]),m<g.displayRecords.length&&(e.displayRecords[m]=void 0)}e.displayRecords.length=
g.displayRecords.length;e.metrics=g.metrics}else if(e=g.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(g.id,e),m=void 0,l=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(h={},0<=e.insertAfter?(k=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?(m=l.indexOf(k)+1,m<l.length?l.splice(m,0,e):(l.push(e),m=l.length)):(l.push(e),m=l.length):(l.unshift(e),m=0)):(l.push(e),m=l.length),h){n=void 0;if(this._data.tileDisplayData.displayList.unified)n=
0<g.displayRecords.length?1:0;else{f.clear();for(var n=0,r=g.displayRecords;n<r.length;n++)k=this._data.tileDisplayData.displayList.getDPInfoType(r[n].geometryType),f.add(k);n=f.size}r=0;for(--m;0<=m&&r<n;--m)for(var t=l[m].displayRecords.length-1;0<=t&&r<n;--t){var u=l[m].displayRecords[t],k=this._data.tileDisplayData.displayList.getDPInfoType(u.geometryType);h[k]||(h[k]=u,++r)}}r=g.displayRecords.length;for(m=0;m<r;++m){n=g.displayRecords[m];(l=e.displayRecords[m])?(l.meshData=n.meshData,l.materialKey=
n.materialKey):(l=n.copy(),l.vertexFrom=void 0,l.indexFrom=void 0,e.displayRecords[m]=l);var t=n.geometryType,k=this._data.tileDisplayData.displayList.getDPInfoType(t),u=a.addOrUpdate.tileBufferData.geometries[t],t=u.vertexBuffer,u=u.indexBuffer,v=void 0;h&&(v=h[k]?this._data.tileDisplayData.displayList.splitAfter(h[k]):-1);b=this._dispRecStore.setMeshData(l,n,t,u,v)&&b;h&&null!=l.indexFrom&&null!=l.indexFrom&&(h[k]=l)}}return b};return d}(n.DisplayObject);a.WGLTile=d})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require",
"exports","./Utils"],function(d,a,c){function g(a,c,d){if(!a.allDirty)if(null!=a.from&&null!=a.count){var b=Math.min(a.from,c);c=Math.max(a.from+a.count,c+d)-b;a.from=b;a.count=c}else a.from=c,a.count=d}Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(){this._dirties=c.createGeometryData(function(a){return{indices:{from:null,count:null,allDirty:!1}}},function(a,b){return{vertices:{from:null,count:null,allDirty:!1}}})}a.prototype.markAllClean=function(){for(var a=0,b=this._dirties;a<
b.length;a++){var c=b[a];c.data.indices.from=null;c.data.indices.count=null;c.data.indices.allDirty=!1;for(var d in c.buffers)c.buffers[d].data.vertices.from=null,c.buffers[d].data.vertices.count=null,c.buffers[d].data.vertices.allDirty=!1}};a.prototype.markAllDirty=function(){for(var a=0,b=this._dirties;a<b.length;a++){var c=b[a];c.data.indices.allDirty=!0;for(var d in c.buffers)c.buffers[d].data.vertices.allDirty=!0}};a.prototype.forEach=function(a){for(var b=0;b<this._dirties.length;++b){var c=
this._dirties[b],d={},e;for(e in c.buffers){var g=c.buffers[e].data.vertices;if(g.allDirty||null!=g.from&&null!=g.count&&0<g.count)d[e]=g}c=c.data.indices;g=void 0;g=c.allDirty||null!=c.from&&null!=c.count&&0<c.count?{indices:c,vertices:d}:{indices:null,vertices:d};(g.indices||0<Object.keys(g).length)&&a(g,b)}};a.prototype.markDirtyIndices=function(a,b,c){g(this._dirties[a].data.indices,b,c)};a.prototype.markDirtyVertices=function(a,b,c,d){g(this._dirties[a].buffers[b].data.vertices,c,d)};return a}();
a.default=d})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(d,a,c,g,b){function e(a){a=a.getStrides();var b={},c;for(c in a)b[k[c]]=a[c];return b}Object.defineProperty(a,"__esModule",{value:!0});var k=["FILL","LINE","MARKER","TEXT","LABEL"];d=function(){function a(a,c,d,e){this._strides=a;this._displayList=c;this._freeListsAndStorage={};this._dirtyMap=null;this._dirtyMap=d;for(var h in a){this._freeListsAndStorage[h]=
{vtxFreeList:e?new g.FreeList(e):null,idxFreeList:e?new g.FreeList(e):null,vertexBuffers:{},indexBuffer:e?new Uint32Array(e):null};for(var k in a[h])this._freeListsAndStorage[h].vertexBuffers[k]={data:e?b.allocateTypedArrayBuffer(e,a[h][k]):null,stride:a[h][k]}}}a.fromTileData=function(c,d){var h=e(c),m=[0,0,0,0,0],n=[0,0,0,0,0],t=[];c.tileDisplayData.displayObjectRegistry.forEach(function(a){t.push(a)});for(var w=0;w<t.length;w++)for(var z=0,r=t[w].displayRecords;z<r.length;z++){var v=r[z];m[v.geometryType]=
Math.max(m[v.geometryType],v.vertexFrom+v.vertexCount);n[v.geometryType]=Math.max(n[v.geometryType],v.indexFrom+v.indexCount)}d=new a(h,c.tileDisplayData.displayList,d,null);for(h=0;h<c.tileBufferData.geometries.length;++h){var w=m[h],r=n[h],v=c.tileBufferData.geometries[h],z=d._storageFor(k[h]),B=c.tileBufferData.geometries[h].indexBuffer;z.indexBuffer=B;z.idxFreeList=new g.FreeList(B.length);z.idxFreeList.allocate(r);var r=void 0,f;for(f in v.vertexBuffer)v=c.tileBufferData.geometries[h].vertexBuffer[f],
z.vertexBuffers[f].data=v.data,z.vertexBuffers[f].stride=v.stride,B=b.strideToPackingFactor(v.stride),v=v.data.length*B/v.stride,r||(r=v);z.vtxFreeList=new g.FreeList(r);z.vtxFreeList.allocate(w)}return d};a.prototype.delete=function(a){var b=k[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=void 0};a.prototype.setMeshData=function(a,c,d,e,g){var h=k[a.geometryType];a.meshData=
null;var m=void 0,n=void 0;void 0===a.vertexFrom?(n=c.vertexCount,m=this._allocateVertices(h,n)):c.vertexCount>a.vertexCount?(this._freeVertices(h,a.vertexFrom,a.vertexCount),n=c.vertexCount,m=this._allocateVertices(h,n)):c.vertexCount===a.vertexCount?(m=a.vertexFrom,n=a.vertexCount):(this._freeVertices(h,a.vertexFrom+c.vertexCount,a.vertexCount-c.vertexCount),m=a.vertexFrom,n=c.vertexCount);var r=!0,u=void 0,x=void 0,f=void 0;void 0===a.indexFrom?(u=g,f=c.indexCount,x=this._allocateIndices(h,f)):
c.indexCount>a.indexCount?(u=this._displayList.removeFromList(a),this._freeIndices(h,a.indexFrom,a.indexCount),f=c.indexCount,x=this._allocateIndices(h,f)):c.indexCount===a.indexCount?(r=!1,x=a.indexFrom,f=a.indexCount):(u=this._displayList.removeFromList(a),this._freeIndices(h,a.indexFrom+c.indexCount,a.indexCount-c.indexCount),x=a.indexFrom,f=c.indexCount);if(-1!==m&&-1!==x){g=this._storageFor(h);b.copyMeshData(m,x,g.vertexBuffers,g.indexBuffer,c,d,e);a.vertexFrom=m;a.indexFrom=x;a.vertexCount=
c.vertexCount;a.indexCount=c.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var y in d)this._dirtyMap.markDirtyVertices(a.geometryType,y,a.vertexFrom,a.vertexCount)}r&&this._displayList.addToList(a,u);return!0}-1!==m&&this._freeVertices(h,m,n);-1!==x&&this._freeIndices(h,x,f);a.setMeshDataFromBuffers(c,d,e);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;a.indexCount=0;return!1};a.prototype._allocateVertices=function(a,b){a=this._storageFor(a);
b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?-1:b};a.prototype._freeVertices=function(a,b,c){this._storageFor(a).vtxFreeList.free(b,c)};a.prototype._freeIndices=function(a,b,c){this._storageFor(a).idxFreeList.free(b,c)};a.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:b};a.prototype._storageFor=function(a){return this._freeListsAndStorage[a]};a.prototype._stridesFor=function(a,b){return this._strides[a][b]};
return a}();a.default=d})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(a){this._largestRange=null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=
a};a.prototype.rangeResized=function(a,c,d){if(a===this._largestRange)a.count<d&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=function(a){for(var b=this._parent._freeHead,c=null;null!==b;)b.count>=a&&(!c||b.count-a<c.count-a)&&(c=b),b=b.next;return c};a.prototype.findAdjacentRanges=function(a,c){for(var b=!0,d=!1,e=null,g=this._parent._freeHead;b&&!d;){var u=null!==g?g.from:this._parent._size;a>=(null!==e?
e.from+e.count:0)&&a+c<=u?(b=!1,d=!0):null!==g?(e=g,g=g.next):b=!1}return[e,g]};a.prototype._updateLargestRange=function(){for(var a=null,c=this._parent._freeHead;null!==c;){if(!a||c.count>a.count)a=c;c=c.next}this._largestRange=a};return a}();d=function(){function a(a,d){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=d||new c(this);this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(b){var c=this._bookKeeper.findBestRange(b);
if(null===c)return-1;var d=c.from,g=c.count;c.from+=b;c.count-=b;this._bookKeeper.rangeResized(c,d,g);this._allocated+=b;0===c.count&&(b=null!==c.prev?this._freeHead:c.next,a._removeRange(c),this._freeHead=b);return d};a.prototype.free=function(b,c){var d=this._bookKeeper.findAdjacentRanges(b,c),e=d[0],d=d[1];b={from:b,count:c,prev:e,next:d};null!==e&&(e.next=b);null!==d&&(d.prev=b);this._bookKeeper.rangeCreated(b);this._allocated-=c;if(null!==d&&b.from+b.count===d.from){c=b.from;var g=b.count;a._fuse(b,
d);a._removeRange(d);this._bookKeeper.rangeResized(b,c,g);this._bookKeeper.rangeResized(d,void 0,0)}null!==e&&e.from+e.count===b.from&&(c=e.from,g=e.count,a._fuse(e,b),a._removeRange(b),this._bookKeeper.rangeResized(e,c,g),this._bookKeeper.rangeResized(b,void 0,0));this._freeHead=null!==b.prev?this._freeHead:b};Object.defineProperty(a.prototype,"fragmentation",{get:function(){var a=this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=
function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,c){a.count+=c.count;a.next=c.next;c.from+=c.count;c.count=0;null!==c.next&&(c.next.prev=a)};return a}();a.FreeList=d})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(d,a){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a){void 0===a&&(a=400);this.duration=a;this._value=this._elapsed=this._lastTime=
0;this._finished=!1}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._value=this._elapsed=this._lastTime=0};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=a-this._lastTime;this._lastTime=a;this._value=Math.min(this._elapsed/this.duration,1);return!1};return a}();a.default=d})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require",
"exports","../../../webgl","./Utils"],function(d,a,c,g){Object.defineProperty(a,"__esModule",{value:!0});d=function(){function a(a){this.geometryMap=g.createGeometryData(function(b){return{indexBuffer:c.BufferObject.createIndex(a,35044),vao:null}},function(b,d){return{vertexBuffer:c.BufferObject.createVertex(a,g.C_VBO_INFO[d])}})}a.prototype.dispose=function(){for(var a=0;5>a;a++){var b=this.geometryMap[a];if(b){b.data.vao&&b.data.vao.dispose(!1);b.data.indexBuffer&&b.data.indexBuffer.dispose();for(var c in b.buffers)b.buffers[c]&&
b.buffers[c].data.vertexBuffer.dispose()}}};a.prototype.get=function(a){var b=this.geometryMap[a];a={};for(var c in b.buffers)a[c]=b.buffers[c].data.vertexBuffer;return{indexBuffer:b.data.indexBuffer,get vao(){return b.data.vao},set vao(a){b.data.vao=a},vertexBufferMap:a}};a.prototype.has=function(a){return null!=this.geometryMap[a]};a.prototype.upload=function(a,b){var c=this;b.forEach(function(b,d){c._upload(b,d,a)})};a.prototype._upload=function(a,b,c){a.indices&&(a.indices.allDirty?this._uploadIndices(c,
b):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(c,b,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;for(var d in a){var e=a[d];e.allDirty?this._uploadVertices(c,b,d):null!=e.from&&null!=e.count&&this._uploadVertices(c,b,d,e.from,e.count)}}};a.prototype._uploadVertices=function(a,b,c,d,g){var e=this.geometryMap[b];e&&(b=a.geometries[b].vertexBuffer[c])&&(a=b.stride,b=b.data.buffer,e.buffers[c]&&0<b.byteLength&&(null!=d&&null!=g?e.buffers[c].data.vertexBuffer.setSubData(b,
d*a,d*a,(d+g)*a):e.buffers[c].data.vertexBuffer.setData(b)))};a.prototype._uploadIndices=function(a,b,c,d){var e=this.geometryMap[b];e&&(a=a.geometries[b].indexBuffer.buffer,e.data.indexBuffer&&0<a.byteLength&&(null!=c&&null!=d?e.data.indexBuffer.setSubData(a,4*c,4*c,4*(c+d)):e.data.indexBuffer.setData(a)))};return a}();a.default=d})},"esri/views/2d/engine/webgl/shaders/MagnifierPrograms":function(){define(["require","exports","../../../../webgl","./sources/resolver"],function(d,a,c,g){Object.defineProperty(a,
"__esModule",{value:!0});a.magnifier={name:"magnifier",shaders:{vertexShader:g.resolveIncludes("magnifier/magnifier.vert"),fragmentShader:g.resolveIncludes("magnifier/magnifier.frag")},attributes:{a_pos:0}};a.createMagnifierProgram=function(b){return c.createProgram(b,a.magnifier)}})},"*noref":1}});
define("require exports ./engine/Bitmap ./engine/BitmapContainer ./engine/BitmapTile ./engine/Container ./engine/DisplayObject ./engine/Stage ./engine/webgl/AttributeStoreView ./engine/webgl/collisions/CollisionGrid ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./engine/webgl/Geometry ./engine/webgl/alignmentUtils ./engine/webgl/color ./engine/webgl/definitions ./engine/webgl/enums ./engine/webgl/fontUtils ./engine/webgl/Utils ./engine/webgl/util/debug ./engine/webgl/TileClipper ./engine/webgl/TurboLine ./engine/webgl/mesh/factories/matcherUtils ./engine/webgl/mesh/factories/WGLMeshFactory ./engine/webgl/mesh/MeshData ./engine/webgl/mesh/templates/WGLTemplateStore ./engine/webgl/Painter ./engine/webgl/TextShaping ./engine/webgl/TextShapingNew ./engine/webgl/TileData ./engine/webgl/util/BidiText ./engine/webgl/util/Matcher ./engine/webgl/util/vvFlagUtils ./engine/webgl/visualVariablesUtils ./engine/webgl/WGLRendererInfo ./engine/webgl/WGLTile ./engine/webgl/BitBlitRenderer ./engine/webgl/shaders/MagnifierPrograms ../../symbols/cim/CIMSymbolHelper ./engine/webgl/Rect ./engine/webgl/mesh/templates/util".split(" "),function(d,
a,c,g,b,e,k,m,h,n,u,x,C,t,w,z,r,v,B,f,y,l,D,A,G,E,N,L,Q,R,O,M,H,S,J,P,T,V,W,ca,da){Object.defineProperty(a,"__esModule",{value:!0});a.Bitmap=c.Bitmap;a.BitmapContainer=g.BitmapContainer;a.BitmapTile=b.BitmapTile;a.Container=e.Container;a.DisplayObject=k.DisplayObject;a.Stage=m.Stage;a.AttributeStoreView=h.AttributeStoreView;a.CollisionGrid=n.CollisionGrid;a.CollisionEngine=u.CollisionEngine;a.LayerViewSorter=x.LayerViewSorter;a.Point=C.Point;a.alignmentUtils=t;a.color=w;a.definitions=z;a.enums=r;
a.fontUtils=v;a.Utils=B;a.debug=f;a.TileClipper=y.TileClipper;a.SimpleBuilder=y.SimpleBuilder;a.tessellate=l.tessellate;a.TessellationState=l.TessellationState;a.splitVertex=l.splitVertex;a.createMatcher=D.createMatcher;a.WGLMeshFactory=A.WGLMeshFactory;a.MeshData=G.MeshData;a.WGLTemplateStore=E.WGLTemplateStore;a.PainterOptions=N.PainterOptions;a.TextShaping=L.TextShaping;a.TextShapingNew=Q.TextShaping;a.TileData=R.TileData;a.bidiText=O.bidiText;a.FeatureMatcher=M.FeatureMatcher;a.getVVFlags=H.getVVFlags;
a.getTypeOfSizeVisualVariable=S.getTypeOfSizeVisualVariable;a.WGLRendererInfo=J.WGLRendererInfo;a.WGLTile=P.WGLTile;a.BitBlitRenderer=T.BitBlitRenderer;a.createMagnifierProgram=V.createMagnifierProgram;a.magnifier=V.magnifier;a.CIMSymbolHelper=W.CIMSymbolHelper;a.Rect=ca.default;a.getLimitCosine=da.getLimitCosine});