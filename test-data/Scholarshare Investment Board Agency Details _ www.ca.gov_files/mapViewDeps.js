// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/LabelManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/HandleOwner ../../core/throttle ../../core/accessorSupport/decorators ./engine".split(" "),function(y,a,v,f,t,q,k,p,m){Object.defineProperty(a,"__esModule",{value:!0});y=function(a){function e(e){e=a.call(this)||this;e._applyVisivilityPassThrottled=k.throttle(e._applyVisivilityPass,64,e);e._previousResolution=Number.POSITIVE_INFINITY;
e.lastUpdateId=-1;e.updateRequested=!1;e.view=null;return e}v(e,a);e.prototype.initialize=function(){var a=this;this.collisionEngine=new m.CollisionEngine(this.view.featuresTilingScheme);this._layerViewSorter=new m.LayerViewSorter(function(e,c){a.collisionEngine.registerLayerView(e,c);(c=e.tileRenderer)&&c.forEachTile(function(c){c.isDirty=!0;a.addTile(e,c)});a.requestUpdate()},function(e){a.collisionEngine.unregisterLayerView(e);a.requestUpdate()});this.handles.add(this.view.allLayerViews.on("change",
function(e){a._layerViewSorter.update(e)}))};e.prototype.destroy=function(){this._layerViewSorter.destroy();this.collisionEngine=this._layerViewSorter=null;this._applyVisivilityPassThrottled.remove()};Object.defineProperty(e.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!0,configurable:!0});e.prototype.update=function(a){var e=this._previousResolution,c=a.state.resolution;this._previousResolution=c;c===e&&this._applyVisivilityPassThrottled(a)};e.prototype.viewChange=
function(){this.requestUpdate()};e.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};e.prototype.processUpdate=function(a){this._set("updateParameters",a);this.updateRequested&&(this.update(a),this.updateRequested=!1)};e.prototype.addTile=function(a,e){this.collisionEngine.addTile(a,e)};e.prototype.removeTile=function(a,e){this.collisionEngine.removeTile(a,e)};e.prototype._applyVisivilityPass=function(a){var e=this.view.featuresTilingScheme.getClosestInfoForScale(a.state.scale).level;
this.collisionEngine.run(a.state,e)};f([p.property()],e.prototype,"updateRequested",void 0);f([p.property({readOnly:!0})],e.prototype,"updateParameters",void 0);f([p.property({dependsOn:["updateRequested"]})],e.prototype,"updating",null);f([p.property()],e.prototype,"view",void 0);return e=f([p.subclass("esri.views.2d.layers.labels.LabelManager")],e)}(p.declared(t,q));a.default=y})},"esri/core/throttle":function(){define(["require","exports"],function(y,a){function v(a,t,q,k){var f=null,m=1E3;"number"===
typeof t?(m=t,k=q):(f=t,m=q);var l=0,e,u=function(){l=0;a.apply(k,e)};t=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];f&&f.apply(k,a);e=a;m?l||(l=setTimeout(u,m)):u()};t.remove=function(){l&&(clearTimeout(l),l=0)};t.forceUpdate=function(){l&&(clearTimeout(l),u())};t.hasPendingUpdates=function(){return!!l};return t}Object.defineProperty(a,"__esModule",{value:!0});a.throttle=v;a.default=v})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/HandleOwner ../../../../core/Identifiable ../../../../core/MapPool ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/data/projectionSupport ../../../../symbols/support/cimSymbolUtils ../../../../symbols/support/defaults ../../engine ../features/support/AttributeStore ../features/support/TileStore ./GraphicContainer ./GraphicProcessingQueue ./GraphicStore ./graphicsUtils ../../../layers/GraphicsView".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w,c,d,n,b,g,x,h,A,z,G,D,K,I,E,F,H,C,r){function J(b,a,c){if(c.has(b))return c.get(b);a={tile:a,addedOrModified:[],removed:[]};c.set(b,a);return a}Object.defineProperty(a,"__esModule",{value:!0});y=function(a){function r(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._tiles=new Map;b._graphicStoreUpdate=!1;b._graphicsSet=new Set;b._matcher=w.resolve(null);b._tileUpdateSet=new Set;b._tilesToUpdate=new Map;b._graphicIdToAbortController=
new Map;b._pendingUpdates=0;b._attached=!1;b.lastUpdateId=-1;b.updateRequested=!1;b.graphicUpdateHandler=b.graphicUpdateHandler.bind(b);b.addOrUpdateGraphic=b.addOrUpdateGraphic.bind(b);b._processAnalyzedGraphics=b._processAnalyzedGraphics.bind(b);b._graphicsChangeHandler=b._graphicsChangeHandler.bind(b);return b}v(r,a);r.prototype.initialize=function(){var b=this;this._tileStore=new I.default(this.view.featuresTilingScheme);this.container=new E.default({tileInfoView:this.view.featuresTilingScheme,
localToGlobalId:function(a){return b._attributeStore.getFeatureId(a)}});this._attributeStore=new K.default({type:"local",initialize:function(a){return w.resolve(b.container.attributeView.initialize(a))},update:function(a){return p.safeCast(b.container.attributeView.requestUpdate(a))},render:function(){return b.container.requestRender()}});this._graphicStore=new H.default(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,function(a){var c=b._attributeStore.createLocalId(a.uid);
b._attributeStore.setData(c,0,0,a.visible?1:0)},function(a){b._attributeStore.freeLocalId(a.uid)});this._graphicProcessingQueue=new F.default({process:this.addOrUpdateGraphic});var a=new D.WGLTemplateStore(this.container.getMaterialItems),c=this._tileStore.tileScheme.tileInfo;this.renderer&&(this._matcher=D.createMatcher(this.renderer,a,null));this._meshFactory=new D.WGLMeshFactory(null,this.uid,null,a,null,c);this.watch("renderer",function(c){c&&(b._matcher=D.createMatcher(b.renderer,a,null))});
this._tileStore.on("update",this._onTileUpdate.bind(this));this.container.on("attach",function(){0<b.graphics.items.length&&b._graphicsChangeHandler({target:b.graphics,added:b.graphics.items,removed:[],moved:[]});b.handles.add(b.graphics.on("change",b._graphicsChangeHandler),"graphics");b._attached=!0;b.notifyChange("updating")});this.container.on("detach",function(){b._graphicProcessingQueue&&b._graphicProcessingQueue.clear()})};r.prototype.destroy=function(){this.container.dispose();this._set("graphics",
null);this._graphicProcessingQueue&&(this._graphicProcessingQueue.destroy(),this._graphicProcessingQueue=null);this._graphicStore.clear();this._tileStore.destroy();this._attributeStore=null};Object.defineProperty(r.prototype,"updating",{get:function(){return!this._attached||0!==this._pendingUpdates||this._graphicProcessingQueue.updating||0<this._tileUpdateSet.size||0<this._tilesToUpdate.size},enumerable:!0,configurable:!0});r.prototype.install=function(b){b.addChild(this.container)};r.prototype.uninstall=
function(b){b.removeChild(this.container)};r.prototype.hitTest=function(b,a){if(!this.view||!this.view.position)return w.resolve();b=this.view.toMap(d.createScreenPoint(b,a));return this.searchFeatures(b).then(function(b){return b&&b.length?b[0]:null})};r.prototype.searchFeatures=function(b,a){var c=this;void 0===a&&(a=2);return w.create(function(g){g(c._graphicStore.hitTest(b.x,b.y,a,c.view.state.resolution,c.view.state.rotation))})};r.prototype.update=function(b){b=b.state;var a=this.view.featuresTilingScheme.getClosestInfoForScale(b.scale).level;
this._graphicStore.updateLevel(a);this._tileStore.setViewState(b);this._graphicStoreUpdate=!0;this.updateRequested=!1};r.prototype.viewChange=function(){this.requestUpdate()};r.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};r.prototype.processUpdate=function(b){this.updateRequested&&(this.updateRequested=!1,this.update(b))};r.prototype.graphicUpdateHandler=function(b){var a=b.newValue,c=b.graphic;switch(b.property){case "geometry":case "symbol":this._graphicProcessingQueue.push(c,
"update");break;case "visible":this._setVisible(c.uid,a),this._attributeStore.sendUpdates()}};r.prototype.highlight=function(b){return this.container.highlight(b)};r.prototype._getIntersectingTiles=function(b){return(b=this._graphicStore.getBounds(b))&&0!==g.width(b)&&0!==g.height(b)?this._tileStore.boundsIntersections(b):[]};r.prototype._updateTile=function(b){var a=this,c=b.tile,g=this._getGraphicsData(c,b.addedOrModified);return p.safeCast(this._processGraphics(c.key,g)).then(function(g){a._patchTile(c.key,
{addOrUpdate:g,remove:b.removed});return g})};r.prototype._graphicsChangeHandler=function(b){var a=this;this._pendingUpdates++;this.notifyChange("updating");if(!this._graphicStoreUpdate){var c=this.view.state,g=this.view.featuresTilingScheme.getClosestInfoForScale(c.scale).level;this._graphicStore.updateLevel(g);this._tileStore.setViewState(c)}var h=b.added,g=b.removed;b=b.moved;for(var x=this._tilesToUpdate,d,c=[],z=Array(h.length),r=0;r<h.length;r++){var e=h[r];z[r]=e;this._graphicsSet.add(e);c.push(this.addGraphic(e))}for(r=
0;r<g.length;r++){e=g[r];this._abortProcessingGraphic(e.uid);for(var h=this._getIntersectingTiles(e),n=0,A=h;n<A.length;n++)h=A[n],d=h.key.id,h=J(d,h,x),h.removed.push(this._attributeStore.getLocalId(e.uid));this._graphicsSet.delete(e);this._graphicStore.remove(e)}for(g=0;g<b.length;g++)for(r=b[g],h=this._getIntersectingTiles(r),e=0,n=h;e<n.length;e++)h=n[e],d=h.key.id,h=J(d,h,x),h.addedOrModified.push(r);w.all(c).then(function(){for(var b,c=0;c<z.length;c++){b=z[c];for(var h=0,g=a._getIntersectingTiles(b);h<
g.length;h++){var r=g[h];d=r.key.id;J(d,r,x).addedOrModified.push(b)}}a._graphicStore.updateZ();var e=[];x.forEach(function(b){return e.push(a._updateTile(b))});return w.all(e).then(function(){x.clear();a._pendingUpdates--;a.notifyChange("updating")})}).catch(function(){x.clear();a._pendingUpdates--;a.notifyChange("updating")})};r.prototype._getSymbolResources=function(b,a){return k(this,void 0,void 0,function(){var c,h,g,x,d,r,e,n;return q(this,function(A){switch(A.label){case 0:return this.container.attached?
(c=u.isSome(b.symbol)?b.symbol:null)?[3,3]:this.renderer?[4,this.renderer.getSymbolAsync(b,{scale:this.view.scale})]:[3,2]:[2,w.resolve(null)];case 1:return c=A.sent(),[3,3];case 2:c=this._getNullSymbol(b),A.label=3;case 3:return[4,z.expandSymbol(c,z.constructUrlFn,a)];case 4:c=A.sent();h=[];if("text"===c.type){g=new Set;x=c;d=x.text;for(r=0;r<d.length;r++)g.add(d.charCodeAt(r));e=[];g.forEach(function(b){return e.push(b)});h.push({symbol:x.toJSON(),id:0,glyphIds:e})}else h.push({symbol:c.toJSON(),
id:b.uid,glyphIds:null});return[4,this.container.getMaterialItems(h,a).then(function(b){return b&&0<b.length?b[0].mosaicItem:null})];case 5:return n=A.sent(),[2,{symbol:c,mosaicItem:n}]}})})};r.prototype._projectAndNormalizeGeometry=function(a){return k(this,void 0,void 0,function(){var c,h,g,d=this;return q(this,function(r){if(u.isNone(a.geometry))return[2,w.resolve(null)];c=a.geometry;x.isPolygon(c)?(h=c.rings,c.rings=h):x.isPolyline(c)?(g=c.paths,c.paths=g):x.isExtent(c)&&(c=b.fromExtent(c));return[2,
A.checkProjectionSupport(c.spatialReference,this.view.spatialReference).then(function(){var b=C.normalizeCentralMeridian(c),b=A.project(b,c.spatialReference,d.view.spatialReference);C.ensureClosedRings(b);return b})]})})};r.prototype._onTileUpdate=function(b){var a=h.getInfo(this.view.spatialReference);if(b.added&&0<b.added.length)for(var c=0,g=b.added;c<g.length;c++)this._addNewTile(g[c],a);if(b.removed&&0<b.removed.length)for(a=0,b=b.removed;a<b.length;a++)this._removeTile(b[a].key)};r.prototype.addOrUpdateGraphic=
function(b,a,c){return this._addOrUpdateGraphic(b,a,c)};r.prototype.addGraphic=function(b){var a=this;this._abortProcessingGraphic(b.uid);var g=c.createAbortController();this._graphicIdToAbortController.set(b.uid,g);return this._addOrUpdateGraphic(b,"add",{signal:g.signal}).then(function(){a._graphicIdToAbortController.delete(b.uid)}).catch(function(c){a._graphicIdToAbortController.delete(b.uid);if(!w.isAbortError(c))throw c;})};r.prototype._addOrUpdateGraphic=function(b,a,c){var g=this,h=this._projectAndNormalizeGeometry(b),
x=this._getSymbolResources(b,c);return w.all([h,x]).then(function(h){var x=h[0];h=h[1];return"add"===a?g._addProjectedGraphic(b,h,x):g._updateGraphic(b,h,x,c)})};r.prototype._addProjectedGraphic=function(b,a,c){this._graphicsSet.has(b)&&this._graphicStore.add(b,a,c)};r.prototype._updateGraphic=function(b,a,c,h){var x=this;if(!this._graphicStore.has(b)||w.isAborted(h))return w.resolve();c=this._graphicStore.update(b,a,c);a=c.oldBounds;c=c.newBounds;var d=0===g.width(a)&&0===g.height(a),r=0===g.width(c)&&
0===g.height(c),d=d?[]:this._tileStore.boundsIntersections(a);a=r?[]:this._tileStore.boundsIntersections(c);c=e.acquire();for(var z=0;z<d.length;z++)r=d[z],c.set(r.key,{addOrUpdate:null,remove:[this._attributeStore.getLocalId(b.uid)]});for(d=0;d<a.length;d++)r=a[d],z=this._getGraphicData(r,b),c.has(r.key)?(r=c.get(r.key),r.remove.length=0,r.addOrUpdate=z):c.set(r.key,{addOrUpdate:z,remove:null});var n=[];c.forEach(function(b,a){var c=p.safeCast(x._processGraphics(a,b.addOrUpdate,h)).then(function(c){x._patchTile(a,
{addOrUpdate:c,remove:b.remove})});n.push(c)});e.release(c);return w.all(n).then(function(){})};r.prototype._addTile=function(b,a){var c=g.create();this.view.featuresTilingScheme.getTileBounds(c,b);c=new D.WGLTile(b,c,!0);a={clear:!0,addOrUpdate:a,remove:[]};this._tiles.set(b,c);this.container.addChild(c);c.setData(a,!1,!1)};r.prototype._addNewTile=function(b,c){var a=this,h=this._graphicStore.queryTileData(b);if(c){c=Math.round((c.valid[1]-c.valid[0])/b.resolution);for(var g=0;g<h.length;g++){var d=
h[g];d.geometry&&x.isPoint(d.geometry)&&this._wrapPoints(d,c)}}var r=b.key;this._tileUpdateSet.add(b.key);this.notifyChange("updating");this._processGraphics(r,h).then(function(b){a._addTile(r,b);a._tileUpdateSet.delete(r);a.notifyChange("updating")}).catch(function(b){a._tileUpdateSet.delete(r);a.notifyChange("updating");if(!w.isAbortError(b))throw b;})};r.prototype._removeTile=function(b){this._tiles.has(b)&&(b=this._tiles.get(b),this.container.removeChild(b))};r.prototype._patchTile=function(b,
c){this._tiles.has(b)&&(this._tiles.get(b).setData(c,!1,!1),this.container.requestRender())};r.prototype._setVisible=function(b,c){b=this._attributeStore.getLocalId(b);this._attributeStore.setData(b,0,0,c?1:0)};r.prototype._getGraphicsData=function(b,c){var a=h.getInfo(this.view.spatialReference);c=this._graphicStore.getGraphicsData(b,c);if(a)for(b=Math.round((a.valid[1]-a.valid[0])/b.resolution),a=0;a<c.length;a++){var g=c[a];g.geometry&&x.isPoint(g.geometry)&&this._wrapPoints(g,b)}c.sort(function(b,
c){return b.insertAfter-c.insertAfter});return c};r.prototype._getGraphicData=function(b,c){c=this._graphicStore.getGraphicData(b,c);var a=[c],g=h.getInfo(this.view.spatialReference);g&&(b=Math.round((g.valid[1]-g.valid[0])/b.resolution),c.geometry&&x.isPoint(c.geometry)&&this._wrapPoints(c,b));return a};r.prototype._wrapPoints=function(b,c){var a=b.geometry;512===c?20>a.x?b.geometry={points:[[a.x,a.y],[c,0]]}:492<a.x&&(b.geometry={points:[[a.x,a.y],[-c,0]]}):-20>a.x?b.geometry={points:[[a.x,a.y],
[c,0]]}:532<a.x&&(b.geometry={points:[[a.x,a.y],[-c,0]]})};r.prototype._processGraphics=function(b,c,a){return k(this,void 0,void 0,function(){var g,h,d;return q(this,function(x){switch(x.label){case 0:g=c&&c.length;if(!g||!this._meshFactory)return[2,null];h=this._meshFactory;return[4,p.safeCast(this._matcher.then(function(b){return h.analyze(c,b,null,null,a)}))];case 1:return d=x.sent(),this._attributeStore.sendUpdates(),[2,this._processAnalyzedGraphics(b,d)]}})})};r.prototype._processAnalyzedGraphics=
function(b,c){for(var a=this._meshFactory,g=a.createMeshData(c.length),h=this._attributeStore,d=0;d<c.length;d++){var x=c[d];x.insertAfter=-1===x.insertAfter?-1:h.getLocalId(x.insertAfter);x.localId=h.getLocalId(x.attributes[this.uid]);a.write(g,x,null,null,b.level)}return D.TileData.fromMeshData(g)};r.prototype._abortProcessingGraphic=function(b){this._graphicIdToAbortController.has(b)&&this._graphicIdToAbortController.get(b).abort()};r.prototype._getNullSymbol=function(b){b=b.geometry;return x.isPolyline(b)?
G.errorPolylineSymbol2D:x.isPolygon(b)||x.isExtent(b)?G.errorPolygonSymbol2D:G.errorPointSymbol2D};f([n.property()],r.prototype,"_graphicProcessingQueue",void 0);f([n.property({constructOnly:!0})],r.prototype,"graphics",void 0);f([n.property({dependsOn:["_graphicProcessingQueue.updating"]})],r.prototype,"updating",null);f([n.property()],r.prototype,"view",void 0);f([n.property()],r.prototype,"updateRequested",void 0);return r=f([n.subclass("esri.views.2d.layers.support.GraphicsView2D")],r)}(n.declared(r,
m,l.Identifiable));a.default=y})},"esri/core/MapPool":function(){define(["require","exports","./ObjectPool"],function(y,a,v){y=function(){function a(a,f){void 0===a&&(a=50);void 0===f&&(f=50);this._pool=new v(Map,!1,function(a){return a.clear()},f,a)}a.prototype.acquire=function(){return this._pool.acquire()};a.prototype.release=function(a){this._pool.release(a)};a.acquire=function(){return f.acquire()};a.release=function(a){return f.release(a)};return a}();var f=new y(100);return y})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(y,a,v,f,t,q,k,p,m){function l(b,a){var h;if(!a)return null;if("x"in a){var g={x:0,y:0};b=b(a.x,a.y,c);g.x=b[0];g.y=b[1];null!=a.z&&(g.z=a.z);null!=a.m&&(g.m=a.m);return g}if("xmin"in a)return g={xmin:0,ymin:0,xmax:0,ymax:0},h=b(a.xmin,a.ymin,c),g.xmin=h[0],g.ymin=h[1],b=b(a.xmax,a.ymax,c),g.xmax=b[0],g.ymax=b[1],a.hasZ&&(g.zmin=a.zmin,g.zmax=a.zmax,g.hasZ=!0),a.hasM&&(g.mmin=a.mmin,g.mmax=a.mmax,g.hasM=!0),g;if("rings"in a)return{rings:e(a.rings,b),hasM:a.hasM,hasZ:a.hasZ};if("paths"in a)return{paths:e(a.paths,
b),hasM:a.hasM,hasZ:a.hasZ};if("points"in a)return{points:u(a.points,b),hasM:a.hasM,hasZ:a.hasZ}}function e(b,a){for(var c=[],g=0;g<b.length;g++)c.push(u(b[g],a));return c}function u(b,a){for(var c=[],g=0;g<b.length;g++){var d=b[g],x=a(d[0],d[1],[0,0]);c.push(x);2<d.length&&x.push(d[2]);3<d.length&&x.push(d[3])}return c}function w(b,a){return!p.isValid(b)||!p.isValid(a)||p.equals(b,a)||m.canProject(b,a)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var c=[0,0];a.checkProjectionSupport=function(b,
a){return f(this,void 0,void 0,function(){var c,g,d;return v(this,function(h){if(!a)return[2];if(Array.isArray(b)){c=0;for(g=b;c<g.length;c++)if(d=g[c],w(d.geometry&&d.geometry.spatialReference,a)){if(k.isSupported())return[2,k.load()];throw new t("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:a});}return[2]}if(!w(b,a))return[2];if(k.isSupported())return[2,k.load()];throw new t("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,
outSpatialReference:a});})})};var d=l.bind(null,m.lngLatToXY),n=l.bind(null,m.xyToLngLat);a.project=function(b,a,c){c||(c=a,a=b.spatialReference);return p.isValid(a)&&p.isValid(c)&&!p.equals(a,c)?m.canProject(a,c)?p.isWebMercator(c)?d(b):n(b):k.projectMany([b],a,c,null,!0)[0]:b};var b=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=function(b,a,c){return f(this,void 0,void 0,function(){var g,h=this;return v(this,function(d){b&&b.length&&
a&&c&&!p.equals(a,c)||q.resolve(b);g={geometries:b,inSpatialReference:a,outSpatialReference:c,resolve:null};this._jobs.push(g);return[2,q.create(function(b){g.resolve=b;null===h._timer&&(h._timer=setTimeout(h._process,10))},function(){var b=h._jobs.indexOf(g);-1<b&&h._jobs.splice(b,1)})]})})};b.prototype._process=function(){this._timer=null;var b=this._jobs.shift();if(b){var a=b.geometries,c=b.inSpatialReference,g=b.outSpatialReference,b=b.resolve;m.canProject(c,g)?p.isWebMercator(g)?b(a.map(d)):
b(a.map(n)):b(k.projectMany(a,c,g,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());a.projectMany=function(a,c,h){return f(this,void 0,void 0,function(){return v(this,function(g){return[2,b.push(a,c,h)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),function(y,a,v,f,t,q){function k(a,l,c,d,n){void 0===d&&(d=null);void 0===n&&(n=!1);if(null===d){var b=
q.cacheKey(l,c);void 0!==e[b]?d=e[b]:(d=p(l,c,null),null===d&&(d=new q),e[b]=d)}return m._project(a,l,c instanceof t||!1===n?c:new t(c),d,n)}function p(a,e,c){void 0===c&&(c=null);a=m._getTransformation(a,e,c);return null!==a?q.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var m=null;a.isLoaded=function(){return!!m&&f.isLoaded()};a.isSupported=function(){return f.isSupported()};var l=null;a.load=function(){return l?l:l=v.create(function(a,e){var c=f.load();y(["./geometryEngine"],
function(d){m=d;c.then(function(){m._enableProjection(f);a()},function(a){e(a)})})})};a.project=function(a,e,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:k(a,a[0].spatialReference,e,c):k([a],a.spatialReference,e,c)[0]};var e={};a.projectMany=k;a.getTransformation=p;a.getTransformations=function(a,e,c){void 0===c&&(c=null);a=m._getTransformationBySuitability(a,e,c);if(null!==a){e=[];for(c=0;c<a.length;c++)e.push(q.fromGE(a[c]));return e}return[]}})},"esri/geometry/pe":function(){define(["require",
"exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(y,a,v,f,t){function q(b){function g(b,a,c){b[a]=c(b[a])}a._pe=b;u.init();w.init();c.init();d.init();n.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}v(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var e=0,h=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,
a._pe.PeUnit];e<h.length;e++)b=h[e],g(b.prototype,"getName",function(b){return function(){return b.call(this,Array(u.PE_NAME_MAX))}});e=0;for(h=[a._pe.PeGeogtran,a._pe.PeProjcs];e<h.length;e++)b=h[e],g(b.prototype,"getParameters",function(b){return function(){for(var c=Array(u.PE_PARM_MAX),g=b.call(this),h=0;h<c.length;h++){var d=a._pe.getValue(g,"*");c[h]=d?a._pe.wrapPointer(d,a._pe.PeParameter):null;g+=Int32Array.BYTES_PER_ELEMENT}return c}});g(a._pe.PeHorizon.prototype,"getCoord",function(b){return function(){var a=
this.getSize();if(!a)return null;var c=[],g=b.call(this);l(c,a,g);return c}});g(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var g=null,h=b.call(this);if(!a._pe.compare(h,a._pe.NULL)){var g=[h],d=this.getSteps();if(1<d)for(var h=a._pe.getPointer(h),e=1;e<d;e++)g.push(a._pe.wrapPointer(h+c*e,a._pe.PeGTlistExtendedGTs))}return g}});var A=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||
(this._cache=c=new Map);if(c.has(b))return c.get(b);var g=null,h=b.call(this);if(!a._pe.compare(h,a._pe.NULL)){var g=[h],d=h.getNump();if(1<d)for(var h=a._pe.getPointer(h),e=1;e<d;e++)g.push(a._pe.wrapPointer(h+A*e,a._pe.PeHorizon))}c.set(b,g);return g}};g(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);g(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=function(b){void 0===b&&(b=u.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),g=a._pe.ensureInt8(Array(u.PE_BUFFER_MAX));
return a._pe.UTF8ToString(a._pe._pe_object_to_string_ext(c,b,g))}}function k(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function p(b,c){var g=[];c=Array(c);for(var h=0;h<b;h++)g.push(a._pe.ensureInt8(c));return g}function m(b){var a;Array.isArray(b[0])?(a=[],b.forEach(function(b){a.push(b[0],b[1])})):a=b;return a}function l(b,c,d,h){void 0===h&&(h=!1);if(h)for(h=0;h<2*c;h++)b[h]=a._pe.getValue(d+h*Float64Array.BYTES_PER_ELEMENT,"double");else{var g=
0===b.length;for(h=0;h<c;h++)g&&(b[h]=Array(2)),b[h][0]=a._pe.getValue(d,"double"),b[h][1]=a._pe.getValue(d+Float64Array.BYTES_PER_ELEMENT,"double"),d+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var e;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!f("esri-wasm")};a.load=function(){return e?e:e=t.create(function(b,a){y(["./support/pe-wasm"],function(c){c({locateFile:function(b){return y.toUrl("./support/"+b)},onAbort:function(b){a(Error(b))}}).then(function(a){q(a);
b()})})})};(function(b){function c(b,c,g){a._pe.ensureCache.prepare();var h=m(g),d=g===h,h=a._pe.ensureFloat64(h);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),c,h))&&l(g,c,h,d);return b}function d(b,a,c){return h(b,a,c,0)}function h(b,c,g,h){a._pe.ensureCache.prepare();var d=m(g),e=g===d,d=a._pe.ensureFloat64(d);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),c,d,h))&&l(g,c,d,e);return b}b.geogToProj=c;b.projGeog=function(b,a,g,h){switch(h){case u.PE_TRANSFORM_P_TO_G:return d(b,a,g);case u.PE_TRANSFORM_G_TO_P:return c(b,
a,g)}return 0};b.projToGeog=d;b.projToGeogCenter=h})(a.PeCSTransformations||(a.PeCSTransformations={}));var u;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;
b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=
a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;
b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(u=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var g=null,e=h[b];e||(e={},h[b]=e);e.hasOwnProperty(String(c))?g=e[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,c),a._pe.compare(b,a._pe.NULL)||(g=b,e[c]=g));return g=d(g)}function d(b){if(b){var c=b.getType();switch(c){case u.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);
break;case u.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case u.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&u.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var h={},e={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(b){return c(u.PE_TYPE_COORDSYS,b)};b.factoryByType=c;b.fromString=function(b,c){var g=null,h=e[b];h||(h={},e[b]=h);h.hasOwnProperty(c)?g=h[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),
a._pe.compare(b,a._pe.NULL)||(g=b,h[c]=g));return g=d(g)};b.geogcs=function(b){return c(u.PE_TYPE_GEOGCS,b)};b.geogtran=function(b){return c(u.PE_TYPE_GEOGTRAN,b)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(b){return c(u.PE_TYPE_PROJCS,b)};b.unit=function(b){return c(u.PE_TYPE_UNIT,b)}})(a.PeFactory||(a.PeFactory={}));a.PeGCSExtent=null;var w;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;
c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,g,d,e,n,l){var h=null,x=new a._pe.PeInteger(l);try{var m=a._pe.PeGTlistExtended.prototype.getGTlist(b,g,d,e,n,x);if(l=x.val)if(h=[m],1<l){var f=a._pe.getPointer(m);for(b=1;b<l;b++)h.push(a._pe.wrapPointer(f+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(x)}return h}})(w=a.PeGTlistExtended||(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var g=b[c];k(g);g.getEntries().forEach(function(b){k(b);
b=b.getGeogtran();k(b);b.getParameters().forEach(k);[b.getGeogcs1(),b.getGeogcs2()].forEach(function(b){k(b);var a=b.getDatum();k(a);k(a.getSpheroid());k(b.getPrimem());k(b.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,c,h,d,e){a._pe.ensureCache.prepare();var g=m(h),n=h===g,g=a._pe.ensureFloat64(g),x=0;d&&(x=a._pe.ensureFloat64(d));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),c,g,x,
e))&&l(h,c,g,n);return b}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(b){function c(b,c,g,d,e,n){a._pe.ensureCache.prepare();var h,l;switch(b){case "dd":h=a._pe._pe_geog_to_dd;l=u.PE_DD_MAX;break;case "ddm":h=a._pe._pe_geog_to_ddm;l=u.PE_DDM_MAX;break;case "dms":h=a._pe._pe_geog_to_dms,l=u.PE_DMS_MAX}b=0;c&&(b=a._pe.getPointer(c));c=m(d);c=a._pe.ensureFloat64(c);l=p(g,l);d=a._pe.ensureInt32(l);if(e=h(b,g,c,e,d))for(h=0;h<g;h++)n[h]=a._pe.UTF8ToString(l[h]);return e}function d(b,
c,g,d,e){a._pe.ensureCache.prepare();var h;switch(b){case "dd":h=a._pe._pe_dd_to_geog;break;case "ddm":h=a._pe._pe_ddm_to_geog;break;case "dms":h=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*g));(h=h(b,g,d,c))&&l(e,g,c);return h}b.geog_to_dms=function(b,a,g,d,e){return c("dms",b,a,g,d,e)};b.dms_to_geog=function(b,c,a,g){return d("dms",b,c,a,g)};b.geog_to_ddm=function(b,a,g,d,e){return c("ddm",
b,a,g,d,e)};b.ddm_to_geog=function(b,c,a,g){return d("ddm",b,c,a,g)};b.geog_to_dd=function(b,a,g,d,e){return c("dd",b,a,g,d,e)};b.dd_to_geog=function(b,c,a,g){return d("dd",b,c,a,g)}})(a.PeNotationDms||(a.PeNotationDms={}));var c;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;
b.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,c,d,e,n,l,f){a._pe.ensureCache.prepare();var g=0;b&&(g=a._pe.getPointer(b));b=m(d);d=a._pe.ensureFloat64(b);b=p(c,u.PE_MGRS_MAX);var h=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_mgrs_extended(g,c,d,e,n,l,h))for(n=0;n<c;n++)f[n]=a._pe.UTF8ToString(b[n]);return e};b.mgrs_to_geog_extended=function(b,c,d,e,n){a._pe.ensureCache.prepare();var g=0;b&&(g=a._pe.getPointer(b));b=d.map(function(b){return a._pe.ensureString(b)});
d=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(e=a._pe._pe_mgrs_to_geog_extended(g,c,d,e,b))&&l(n,c,b);return e}})(c=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,c,d,e,n,l,f){a._pe.ensureCache.prepare();var g=0;b&&(g=a._pe.getPointer(b));b=m(d);d=a._pe.ensureFloat64(b);b=p(c,u.PE_MGRS_MAX);var h=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_usng(g,c,d,e,n,l,h))for(n=0;n<c;n++)f[n]=a._pe.UTF8ToString(b[n]);return e};b.usng_to_geog=function(b,c,d,e){a._pe.ensureCache.prepare();
var g=0;b&&(g=a._pe.getPointer(b));b=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(g=a._pe._pe_usng_to_geog(g,c,d,b))&&l(e,c,b);return g}})(a.PeNotationUsng||(a.PeNotationUsng={}));var d;(function(b){b.init=function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,
c,d,e,n){a._pe.ensureCache.prepare();var g=0;b&&(g=a._pe.getPointer(b));b=m(d);d=a._pe.ensureFloat64(b);b=p(c,u.PE_UTM_MAX);var h=a._pe.ensureInt32(b);if(e=a._pe._pe_geog_to_utm(g,c,d,e,h))for(g=0;g<c;g++)n[g]=a._pe.UTF8ToString(b[g]);return e};b.utm_to_geog=function(b,c,d,e,n){a._pe.ensureCache.prepare();var g=0;b&&(g=a._pe.getPointer(b));b=d.map(function(b){return a._pe.ensureString(b)});d=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(e=a._pe._pe_utm_to_geog(g,c,d,e,b))&&l(n,c,b);return e}})(d=
a.PeNotationUtm||(a.PeNotationUtm={}));var n;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(d,g){void 0===g&&(g=b.PE_PCSINFO_OPTION_DOMAIN);var e,h;c.has(d)&&(h=c.get(d),h[g]&&(e=h[g]));e||(e=a._pe.PePCSInfo.prototype.generate(d,
g),h||(h=[],c.set(d,h)),h[g]=e);return e}})(n=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=q})},"esri/geometry/support/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],function(y,a,v){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var f=0;for(a=a.steps;f<
a.length;f++){var k=a[f];k instanceof v?this.steps.push(k):this.steps.push(new v({wkid:k.wkid,wkt:k.wkt,isInverse:k.isInverse}))}}}a.cacheKey=function(a,f){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==f.wkid&&null!==f.wkid?f.wkid.toString():"-1",void 0!==f.wkt&&null!==f.wkt?f.wkt.toString():""].join()};a.fromGE=function(f){var t=new a,k="",p=0;for(f=f.steps;p<f.length;p++){var m=v.fromGE(f[p]);t.steps.push(m);k+=m.uid.toString()+
","}t._cached_projection={};t._gtlistentry=null;t._chain=k;return t};a.prototype.getInverse=function(){var f=new a;f.steps=[];for(var q=this.steps.length-1;0<=q;q--)f.steps.push(this.steps[q].getInverse());return f};a.prototype.getGTListEntry=function(){for(var a="",f=0,k=this.steps;f<k.length;f++)a+=k[f].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(f,q,k){this._cached_projection[a.cacheKey(f,
q)]=k};a.prototype.getCachedGeTransformation=function(f,q){for(var k="",p=0,m=this.steps;p<m.length;p++)k+=m[p].uid.toString()+",";k!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=k);f=this._cached_projection[a.cacheKey(f,q)];return void 0===f?null:f};return a}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(y,a){var v=0;return function(){function a(a){void 0===a&&(a=null);this.uid=v++;a?(this._wkt=void 0!==
a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(f){var q=new a;q._wkt=f.wkt;q._wkid=f.wkid;q._isInverse=f.isInverse;return q};Object.defineProperty(a.prototype,"wkt",{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=
a;this.uid=v++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=v++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var f=new a;f._wkt=this.wkt;f._wkid=this._wkid;f._isInverse=!this.isInverse;return f};return a}()})},"esri/views/2d/layers/features/support/AttributeStore":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Error ../../../../../core/has ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../layers/support/FieldsIndex ../../../../../support/arcadeOnDemand ../../../../webgl ../../../engine ../../../arcade/utils ../tileRenderers/support/visualVariablesUtils @dojo/framework/shim/Map @dojo/framework/shim/Promise".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w,c,d,n){Object.defineProperty(a,"__esModule",{value:!0});var b=k.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=c.debug.createDebugLogger(c.debug.DEBUG_ATTR_UPDATES,b),x=function(b,a){return function(c,d,g){var e;try{e=a(c,d,g)}catch(C){e=NaN}return(null===e||isNaN(e)||Infinity===e)&&b||e}},h=q("esri-shared-array-buffer"),A=q("esri-webgl-texture-float"),z=q("esri-webgl-max-texture-size"),G=function(){function a(b,a,c,d){this.texelSize=4;this.descriptors=
[];var g=d.pixelType;d=d.layout;this.data=this._initData(g,c,b,a);this.pixelType=g;this.layout=d;this._resetRange();this._shared=b;this._ctype=a}Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});a.prototype.getData=function(b,a){return this.data[b*this.texelSize+a]};a.prototype.setData=function(a,c,d){0===(this.layout&1<<c)?b.error("mapview-attributes-store","Tried to set a value for a texel's readonly component"):(this.data[a*this.texelSize+
c]=d,this.dirtyStart=Math.min(this.dirtyStart,a),this.dirtyEnd=Math.max(this.dirtyEnd,a))};a.prototype.expand=function(b){b=this._initData(this.pixelType,b,this._shared,this._ctype);b.set(this.data);this.data=b};a.prototype.toMessage=function(){var b=this.dirtyStart,a=this.dirtyEnd,d=this.texelSize;if(b>a)return null;this._resetRange();var g=!this._shared&&"local"!==this._ctype,e=this.pixelType,h=this.layout;if(!this.data.slice){if(!g)return{start:b,end:a,data:null,pixelType:e,layout:h};d=new (c.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,
b*d,(a+1)*d));return{start:b,end:a,data:d,pixelType:e,layout:h}}d=g&&this.data.slice(b*d,(a+1)*d)||null;return{start:b,end:a,data:d,pixelType:e,layout:h}};a.prototype._initData=function(b,a,d,g){d=d&&"local"!==g?SharedArrayBuffer:ArrayBuffer;b=c.Utils.getPixelArrayCtor(b);a=new b(new d(a*a*4*b.BYTES_PER_ELEMENT));for(b=0;b<a.length;b+=4)a[b+1]=255;return a};a.prototype._resetRange=function(){this.dirtyStart=this.data.length/4;this.dirtyEnd=0};return a}();q=function(){function a(b){this._attributeComputeMap=
new Map;this._blocks=[];this._idMap=new Map;this._localToObjectId=new Map;this._filters=Array(c.definitions.MAX_FILTERS);this._freeList=[];this._abortController=l.createAbortController();this._hasScaleExpr=!1;this._size=32;this._idCounter=0;var a=A?5126:5121;g("Creating AttributeStore "+(h?"with":"without")+" shared memory");this._client=b;this._blockDescriptors=[{pixelType:5121,layout:7},{pixelType:a,layout:15},{pixelType:a,layout:15}];this._blocks=this._blockDescriptors.map(function(b){return null})}
a.prototype.destroy=function(){this._abortController.abort()};Object.defineProperty(a.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0});a.prototype.createLocalId=function(b){if(!this._idMap.has(b)){var a=this._getFreeId();this._idMap.set(b,-1===a?0:a);this._localToObjectId.set(a,b)}return this._idMap.get(b)};a.prototype.freeLocalId=
function(b){var a=this._idMap.get(b);this._idMap.delete(b);this._localToObjectId.delete(a);this._freeList.push(a)};a.prototype.getFeatureId=function(b){return this._localToObjectId.get(b)};a.prototype.getLocalId=function(b){return this._idMap.has(b)?this._idMap.get(b):null};a.prototype.updateFilters=function(b){return f(this,void 0,void 0,function(){var a,c,d,g,e,h,n=this;return v(this,function(r){switch(r.label){case 0:return a=b.config,c=b.service,d=b.spatialReference,g=a.filters,e=a.definitionExpression,
h=g.map(function(a,g){return n._updateFilter(b,a,g,c,e,d)}),[4,l.all(h)];case 1:return r.sent(),[2]}})})};a.prototype.setAttributeBindings=function(a,c){return f(this,void 0,void 0,function(){return v(this,function(d){this._hasScaleExpr=!1;switch(a.type){case "simple":case "class-breaks":case "unique-value":case "dictionary":return[2,this._bindVVEvaluators(a.visualVariables,c)];case "dot-density":return[2,this._bindDDEvaluators(a.attributes,c)];case "heatmap":break;default:b.error(new t("attribute-store",
"Found invalid renderer type: "+a))}return[2]})})};a.prototype.setData=function(b,a,c,d){this._getBlock(a).setData(b,c,d)};a.prototype.setAttributeData=function(b,a,d,g){var e=this;this._getBlock(0).setData(b,0,this._getFilterFlags(a));var h=A?1:2;this._attributeComputeMap.forEach(function(r,n){var l=n*h%4;n=e._getBlock(Math.floor(n*h/4)+1);r=r(a,{$view:g},d);if(A)n.setData(b,l,r);else if(r===c.definitions.NAN_MAGIC_NUMBER)n.setData(b,l,255),n.setData(b,l+1,255);else{r=p.clamp(Math.round(r),-32767,
32766)+32768;var f=(r&65280)>>8;n.setData(b,l,r&255);n.setData(b,l+1,f)}})};a.prototype.sendUpdates=function(){var b=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=l.createResolver(),this._nextUpdate.promise;var a={blocks:this._blocks.map(function(b){return m.isSome(b)?b.toMessage():null})};return this._currUpdate=this._createResources().then(function(){var c=b._client.update(a,b._signal).then(function(){b._currUpdate=null;if(b._nextUpdate){var a=
b._nextUpdate;b._nextUpdate=null;b.sendUpdates().then(function(){return a.resolve()})}});b._client.render();return c})};a.prototype._createResources=function(){var b=this;if(m.isSome(this._createResourcesPromise))return this._createResourcesPromise;g("Initializing AttributeStore");var a={shared:h||"local"===this._client.type,size:this._size,blocks:m.mapMany(this._blocks,function(b){return{buffer:b.buffer,pixelType:b.pixelType}})};this._createResourcesPromise=a=this._client.initialize(a,this._signal);
a.then(function(){if(m.isNone(b._createResourcesPromise))return b._createResources()});return a};a.prototype._getBlock=function(b){var a=this._blocks[b];if(m.isSome(a))return a;g("Initializing AttributeBlock at index "+b);a=new G(h,this._client.type,this._size,this._blockDescriptors[b]);this._blocks[b]=a;this._createResourcesPromise=null;return a};a.prototype._expand=function(){if(this._size<z){var a=this._size<<=1;g("Expanding block size to",a,this._blocks);m.forEachSome(this._blocks,function(b){return b.expand(a)});
this._createResourcesPromise=null;this._size=a;return 0}b.error(new t("mapview-limitations","Maximum number of onscreen features exceeded."));return-1};a.prototype._getFreeId=function(){return this._freeList.length?this._freeList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++};a.prototype._updateFilter=function(b,a,c,d,g,e){return f(this,void 0,void 0,function(){var h,n,l,f,x,k,u,p,w,z=this;return v(this,function(r){switch(r.label){case 0:h=this._filters[c];n=m.isSome(h)&&
h.hash;if(n===JSON.stringify(a))return[2];l=1<<c;return m.isNone(a)?(this._filters[c]=null,this._idMap.forEach(function(b){var a=z._getBlock(0).getData(b,0);z._getBlock(0).setData(b,0,a|l)}),[2]):[4,b.queryObjectIds(a)];case 1:return f=r.sent(),a.hiddenIds&&a.hiddenIds.length&&(f=f.filter(function(b){return-1===a.hiddenIds.indexOf(b)})),x=f.map(function(b){return z._idMap.get(b)}),[4,this._getFilter(c,d)];case 2:k=r.sent();k.update(a,g,e);this._idMap.forEach(function(b){var a=z._getBlock(0).getData(b,
0);z._getBlock(0).setData(b,0,a&~l)});for(u=0;u<x.length;u++)p=x[u],null!=p&&(w=this._getBlock(0).getData(p,0),this._getBlock(0).setData(p,0,w|l));return[2]}})})};a.prototype._getFilter=function(b,a){return f(this,void 0,void 0,function(){var c,d,g;return v(this,function(h){switch(h.label){case 0:return c=this._filters[b],m.isSome(c)?[2,c]:[4,new Promise(function(b,a){y(["../../../../../layers/graphics/data/FeatureFilter"],b,a)})];case 1:return d=h.sent().default,g=new d({geometryType:a.geometryType,
hasM:!1,hasZ:!1,timeInfo:a.timeInfo,fieldsIndex:new e(a.fields)}),this._filters[b]=g,[2,g]}})})};a.prototype._getFilterFlags=function(b){for(var a=0,c=0;c<this._filters.length;c++)var d=this._filters[c],d=m.isNone(d)||d.check(b),a=a|(d?1:0)<<c;return a};a.prototype._bindVVEvaluators=function(b,a){return f(this,void 0,void 0,function(){var d,g=this;return v(this,function(e){switch(e.label){case 0:this._attributeComputeMap.clear();if(!m.isSome(b))return[3,2];d=l.all(b.map(function(b){return f(g,void 0,
void 0,function(){var d,g;return v(this,function(e){switch(e.label){case 0:return d=c.Utils.getVVType(b.type),[4,this._createGetValueFunction(b,a)];case 1:return g=e.sent(),m.isSome(g)&&this._attributeComputeMap.set(d,g),[2]}})})}));return[4,d];case 1:e.sent(),e.label=2;case 2:return[2]}})})};a.prototype._bindDDEvaluators=function(a,d){return f(this,void 0,void 0,function(){var g,e,h,n=this;return v(this,function(r){switch(r.label){case 0:return this._attributeComputeMap.clear(),a.length>c.definitions.DOT_DENSITY_MAX_FIELDS&&
b.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+c.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+a.length),[4,l.all(a.map(function(b){return n._createNormalizedFunction(b,d)}))];case 1:g=r.sent().map(function(b){return x(0,b)});for(e=0;e<c.definitions.DOT_DENSITY_MAX_FIELDS;e++)(h=e<a.length&&g[e])?this._attributeComputeMap.set(e,h):this._attributeComputeMap.has(e)&&this._attributeComputeMap.delete(e);return[2]}})})};a.prototype._createGetValueFunction=function(b,
a){return f(this,void 0,void 0,function(){var d,g,e,h,r,l,f;return v(this,function(m){switch(m.label){case 0:if("size"!==b.type)return[3,2];d=c.getTypeOfSizeVisualVariable(b);if(d===c.enums.WGLVVFlag.SIZE_SCALE_STOPS)return[2,null];e=(g=d===c.enums.WGLVVFlag.SIZE_UNIT_VALUE)&&function(a){return n.getVisualVariableSizeValueRepresentationRatio(a,b.valueRepresentation)};h=x;r=[c.definitions.NAN_MAGIC_NUMBER];return[4,this._createNormalizedFunction(b,a,e)];case 1:return[2,h.apply(void 0,r.concat([m.sent()]))];
case 2:return l=x,f=[c.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(b,a)];case 3:return[2,l.apply(void 0,f.concat([m.sent()]))]}})})};a.prototype._createNormalizedFunction=function(a,c,g){return f(this,void 0,void 0,function(){var e,h,n;return v(this,function(r){switch(r.label){case 0:if(e=a.field){if("string"===typeof e)return(h=a.normalizationField)?[2,function(b){if(b.attributes[e]&&b.attributes[h])return b=b.attributes[e]/b.attributes[h],g?g(b):b}]:[2,g?function(b){return g(b.attributes[e])}:
function(b){return b.attributes[e]}];b.error(new t("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof e));return[2,function(b){}]}if(!a.valueExpression)return[3,2];this._hasScaleExpr=this._hasScaleExpr||-1!==a.valueExpression.indexOf("scale");return[4,u.createVVExpression(a.valueExpression,c.spatialReference,c.fields)];case 1:return n=r.sent(),[2,d.callWithOptimizedFeature.bind(null,n)];case 2:return b.error("Unable to create a normalized function for visual variable: "+
a),[2,function(b){}]}})})};return a}();a.default=q})},"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":function(){define(["require","exports","../../../../../../core/screenUtils","../../../../engine","../../../../../3d/layers/support/FastSymbolUpdates"],function(y,a,v,f,t){function q(a){return{value:a.value,size:v.toPt(a.size)}}function k(a){return a.map(function(a){return q(a)})}function p(a){return"string"===typeof a||"number"===typeof a?v.toPt(a):{type:"size",expression:a.expression,
stops:k(a.stops)}}function m(a){var e={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(f.Utils.isString(a.field))if(a.stops){if(8<a.stops.length)return null;var l=a.stops;for(a=0;8>a;++a){var c=l[Math.min(a,l.length-1)];e.values[a]=c.value;e.opacities[a]=c.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(l=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)e.values[a]=Infinity,e.opacities[a]=l;else return null;return e}Object.defineProperty(a,"__esModule",{value:!0});
var l=f.enums.WGLVVFlag;a.getVisualVariableSizeValueRepresentationRatio=function(a,l){if(!a||!l)return a;switch(l){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};a.stopToSizeStop=q;a.normalizeSizeStops=k;a.normalizeSizeElement=p;a.getVisualVariablesFields=function(a){var e=a&&0<a.length?{}:null;e&&a.forEach(function(a){var c=a.type;a.field&&(e[c]=a.field)});return e};a.convertVisualVariables=function(a){var e=a&&0<a.length?{}:null,w=e?{}:null;if(!e)return{vvFields:e,
vvRanges:w};for(var c=0;c<a.length;c++){var d=a[c],n=d.type;d.field&&(e[n]=d.field);if("size"===n){w.size||(w.size={});var b=d;switch(f.getTypeOfSizeVisualVariable(b)){case l.SIZE_MINMAX_VALUE:w.size.minMaxValue={minDataValue:b.minDataValue,maxDataValue:b.maxDataValue,minSize:p(b.minSize),maxSize:p(b.maxSize)};break;case l.SIZE_SCALE_STOPS:w.size.scaleStops={stops:k(b.stops)};break;case l.SIZE_FIELD_STOPS:for(var d=[],n=[],b=k(b.stops),g=b.length,x=0;6>x;x++){var h=b[Math.min(x,g-1)];d.push(h.value);
n.push(v.pt2px(h.size))}w.size.fieldStops={values:d,sizes:n};break;case l.SIZE_UNIT_VALUE:w.size.unitValue={unit:b.valueUnit,valueRepresentation:b.valueRepresentation}}}else if("color"===n)for(d=t.convertVisualVariables([d],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),w.color=d.color,x=0;32>x;x+=4)f.color.premultiplyAlpha(w.color.colors,x,!0);else"opacity"===n?w.opacity=m(d):"rotation"===n&&(w.rotation={type:d.rotationType})}return{vvFields:e,vvRanges:w}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u){function w(b){return null!==b&&void 0!==b}function c(b){return"number"===typeof b}function d(b){return"string"===typeof b}function n(b,a){b&&b.push(a)}function b(b,a,d,h,l){var r=b.minSize,f=b.maxSize;if(b.expression)return n(l,"Could not convert size info: expression not supported"),!1;if(b.useSymbolValue)return b=h.symbolSize[d],a.minSize[d]=b,a.maxSize[d]=b,a.offset[d]=a.minSize[d],a.factor[d]=0,a.type[d]=1,!0;if(w(b.field)){if(w(b.stops)){if(2===b.stops.length&&
c(b.stops[0].size)&&c(b.stops[1].size))return g(b.stops[0].size,b.stops[1].size,b.stops[0].value,b.stops[1].value,a,d),a.type[d]=1,!0;n(l,"Could not convert size info: stops only supported with 2 elements");return!1}if(c(r)&&c(f)&&w(b.minDataValue)&&w(b.maxDataValue))return g(r,f,b.minDataValue,b.maxDataValue,a,d),a.type[d]=1,!0;if(null!=e.meterIn[b.valueUnit])return a.minSize[d]=-Infinity,a.maxSize[d]=Infinity,a.offset[d]=0,a.factor[d]=1/e.meterIn[b.valueUnit],a.type[d]=1,!0;if("unknown"===b.valueUnit)return n(l,
"Could not convert size info: proportional size not supported"),!1;n(l,"Could not convert size info: scale-dependent size not supported");return!1}if(!w(b.field)){if(b.stops&&b.stops[0]&&c(b.stops[0].size))return a.minSize[d]=b.stops[0].size,a.maxSize[d]=b.stops[0].size,a.offset[d]=a.minSize[d],a.factor[d]=0,a.type[d]=1,!0;if(c(r))return a.minSize[d]=r,a.maxSize[d]=r,a.offset[d]=r,a.factor[d]=0,a.type[d]=1,!0}n(l,"Could not convert size info: unsupported variant of sizeInfo");return!1}function g(b,
a,c,d,g,h){d=0<Math.abs(d-c)?(a-b)/(d-c):0;g.minSize[h]=0<d?b:a;g.maxSize[h]=0<d?a:b;g.offset[h]=b-c*d;g.factor[h]=d}function x(a,c,g,h){if(a.normalizationField||a.valueRepresentation)return n(h,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!d(e))return n(h,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!c.size.field)c.size.field=
a.field;else if(a.field!==c.size.field)return n(h,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=b(a,c.size,0,g,h))?c:null;case "height":return(e=b(a,c.size,2,g,h))?c:null;case "depth":return(e=b(a,c.size,1,g,h))?c:null;case "width-and-depth":return(e=b(a,c.size,0,g,h))&&b(a,c.size,1,g,h),e?c:null;case null:case void 0:case "all":return(e=(e=(e=b(a,c.size,0,g,h))&&b(a,c.size,1,g,h))&&b(a,c.size,2,g,h))?c:null;default:return n(h,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function h(b,a,c){for(var d=0;3>d;++d){var g=a.unitInMeters;1===b.type[d]&&(g*=a.modelSize[d],b.type[d]=2);b.minSize[d]/=g;b.maxSize[d]/=g;b.offset[d]/=g;b.factor[d]/=g}if(0!==b.type[0])a=0;else if(0!==b.type[1])a=1;else if(0!==b.type[2])a=2;else return n(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===b.type[d]&&(b.minSize[d]=b.minSize[a],b.maxSize[d]=b.maxSize[a],b.offset[d]=b.offset[a],b.factor[d]=b.factor[a],b.type[d]=b.type[a]);return!0}function A(b,
a,c){b[4*a+0]=c.r/255;b[4*a+1]=c.g/255;b[4*a+2]=c.b/255;b[4*a+3]=c.a}function z(b,a,c){if(b.normalizationField)return n(c,"Could not convert color info: unsupported property"),null;if(d(b.field))if(b.stops){if(8<b.stops.length)return n(c,"Could not convert color info: too many color stops"),null;a.color={field:b.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=b.stops;for(b=0;8>b;++b){var g=c[Math.min(b,c.length-1)];a.color.values[b]=g.value;
A(a.color.colors,b,g.color)}}else return n(c,"Could not convert color info: missing stops or colors"),null;else if(b.stops&&0<=b.stops.length)for(c=b.stops&&0<=b.stops.length&&b.stops[0].color,a.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},b=0;8>b;b++)a.color.values[b]=Infinity,A(a.color.colors,b,c);else return n(c,"Could not convert color info: no field and no colors/stops"),null;return a}function G(b,a,c){if(b.normalizationField)return n(c,
"Could not convert opacity info: unsupported property"),null;if(d(b.field))if(b.stops){if(8<b.stops.length)return n(c,"Could not convert opacity info: too many opacity stops"),null;a.opacity={field:b.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=b.stops;for(b=0;8>b;++b){var g=c[Math.min(b,c.length-1)];a.opacity.values[b]=g.value;a.opacity.opacityValues[b]=g.opacity}}else return n(c,"Could not convert opacity info: missing stops or opacities"),null;else if(b.stops&&0<=b.stops.length)for(c=
b.stops&&0<=b.stops.length&&b.stops[0].opacity,a.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},b=0;8>b;b++)a.opacity.values[b]=Infinity,a.opacity.opacityValues[b]=c;else return n(c,"Could not convert opacity info: no field and no opacities/stops"),null;return a}function D(b,a,c,d){b=2===c&&"arithmetic"===b.rotationType;a.offset[c]=b?90:0;a.factor[c]=b?-1:1;a.type[c]=1}function K(b,a,c){if(!d(b.field))return n(c,"Could not convert rotation info: field is not a string"),
null;if(!a.rotation)a.rotation={field:b.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(b.field)if(!a.rotation.field)a.rotation.field=b.field;else if(b.field!==a.rotation.field)return n(c,"Could not convert rotation info: multiple fields in use"),null;switch(b.axis){case "tilt":return D(b,a.rotation,0,c),a;case "roll":return D(b,a.rotation,1,c),a;case null:case void 0:case "heading":return D(b,a.rotation,2,c),a;default:return n(c,'Could not convert rotation info: unknown axis "'+b.axis+
'""'),null}}function I(b,a,c){if(!b)return null;var d=!a.supportedTypes||!!a.supportedTypes.size,g=!a.supportedTypes||!!a.supportedTypes.color,e=!a.supportedTypes||!!a.supportedTypes.rotation,l=!!a.supportedTypes&&!!a.supportedTypes.opacity,f=b.reduce(function(b,h){if(!b)return b;if(h.valueExpression)return n(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return d?x(h,b,a,c):b;case "color":return g?z(h,b,c):b;case "opacity":return l?G(h,b,
c):b;case "rotation":return e?K(h,b,c):b;default:return v.neverReached(h),null}},{size:null,color:null,opacity:null,rotation:null});return 0<b.length&&f&&!f.size&&!f.color&&!f.opacity&&!f.rotation||f&&f.size&&!h(f.size,a,c)?null:f}function E(b,a,c){if(!!b!==!!a||b&&b.field!==a.field)return!1;if(b&&"rotation"===c)for(c=0;3>c;c++)if(b.type[c]!==a.type[c]||b.offset[c]!==a.offset[c]||b.factor[c]!==a.factor[c])return!1;return!0}function F(b,a){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},d=b&&null!=b.size;b&&b.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=b.size.minSize,c.vvSizeMaxSize=b.size.maxSize,c.vvSizeOffset=b.size.offset,c.vvSizeFactor=b.size.factor):b&&d&&(c.vvSizeValue=a.transformation.scale);if(b&&d){c.vvSymbolAnchor=a.transformation.anchor;c.vvSymbolRotationMatrix=
q.mat3f64.create();k.mat4.identity(C);var g=a.transformation.rotation[2],d=a.transformation.rotation[0],h=a.transformation.rotation[1];a=C;void 0===a&&(a=p.mat4f64.create());g=g||0;d=d||0;h=h||0;0!==g&&k.mat4.rotateZ(a,a,-g/180*Math.PI);0!==d&&k.mat4.rotateX(a,a,d/180*Math.PI);0!==h&&k.mat4.rotateY(a,a,h/180*Math.PI);t.mat3.fromMat4(c.vvSymbolRotationMatrix,C)}b&&b.color&&(c.vvColorEnabled=!0,c.vvColorValues=b.color.values,c.vvColorColors=b.color.colors);b&&b.opacity&&(c.vvOpacityEnabled=!0,c.vvOpacityValues=
b.opacity.values,c.vvOpacityOpacities=b.opacity.opacityValues);return c}Object.defineProperty(a,"__esModule",{value:!0});a.convertVisualVariables=I;a.initFastSymbolUpdatesState=function(b,a){return!b||u.DISABLE_FAST_UPDATES?{enabled:!1}:(b=I(b.visualVariables,a))?{enabled:!0,visualVariables:b,materialParameters:F(b,a),requiresShaderTransformation:b&&null!=b.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(b,a,c){if(!a||!b.enabled)return!1;var d=b.visualVariables;a=I(a.visualVariables,c);
if(!(a&&E(d.size,a.size,"size")&&E(d.color,a.color,"color")&&E(d.rotation,a.rotation,"rotation")))return!1;b.visualVariables=a;b.materialParameters=F(a,c);b.requiresShaderTransformation=a&&null!=a.size;return!0};a.getMaterialParams=F;var H;(function(b){var a=p.mat4f64.create(),c=l.vec3f64.create();b.evaluateModelTransform=function(b,d,g){if(!b.vvSizeEnabled)return g;k.mat4.copy(a,g);g=b.vvSymbolRotationMatrix;k.mat4.set(C,g[0],g[1],g[2],0,g[3],g[4],g[5],0,g[6],g[7],g[8],0,0,0,0,1);k.mat4.multiply(a,
a,C);for(g=0;3>g;++g)c[g]=f.clamp(b.vvSizeOffset[g]+d[0]*b.vvSizeFactor[g],b.vvSizeMinSize[g],b.vvSizeMaxSize[g]);k.mat4.scale(a,a,c);k.mat4.translate(a,a,b.vvSymbolAnchor);return a};b.evaluateModelTransformScale=function(b,a,c){if(!a.vvSizeEnabled)return m.vec3.set(b,1,1,1);for(var d=0;3>d;++d)b[d]=f.clamp(a.vvSizeOffset[d]+c[0]*a.vvSizeFactor[d],a.vvSizeMinSize[d],a.vvSizeMaxSize[d]);return b}})(H||(H={}));var C=p.mat4f64.create();a.evaluateModelTransform=H.evaluateModelTransform;a.evaluateModelTransformScale=
H.evaluateModelTransformScale})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(y,a,v){Object.defineProperty(a,"__esModule",{value:!0});a.mat3f64=v})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(y,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,0,1,0,0,0,1]};a.clone=function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]};a.fromValues=function(a,
f,t,q,k,p,m,l,e){return[a,f,t,q,k,p,m,l,e]};a.createView=function(a,f){return new Float64Array(a,f,9)}})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(y,a,v){Object.defineProperty(a,"__esModule",{value:!0});a.mat4f64=v})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(y,a){Object.defineProperty(a,"__esModule",{value:!0});a.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.clone=
function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]};a.fromValues=function(a,f,t,q,k,p,m,l,e,u,w,c,d,n,b,g){return[a,f,t,q,k,p,m,l,e,u,w,c,d,n,b,g]};a.createView=function(a,f){return new Float64Array(a,f,16)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(y,
a,v,f,t,q){return new (function(a){function k(){var f=null!==a&&a.apply(this,arguments)||this;f.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;f.SCENEVIEW_LOCKING_LOG=!1;f.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;f.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;f.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;f.DECONFLICTOR_SHOW_OUTLINES=!1;f.DECONFLICTOR_SHOW_GRID=!1;f.LABELS_SHOW_BORDER=!1;f.OVERLAY_DRAW_TEST_TEXTURE=!1;f.OVERLAY_SHOW_CENTER=!1;f.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;f.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;f.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;f.DRAW_MESH_GEOMETRY_NORMALS=!1;f.FEATURE_TILE_FETCH_SHOW_TILES=!1;f.FEATURE_TILE_TREE_SHOW_TILES=!1;f.ENABLE_PROFILE_DEPTH_RANGE=!1;f.DISABLE_FAST_UPDATES=!1;f.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;f.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;return f}v(k,a);f([q.property()],k.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);f([q.property()],k.prototype,"SCENEVIEW_LOCKING_LOG",void 0);f([q.property()],k.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",
void 0);f([q.property()],k.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);f([q.property()],k.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);f([q.property()],k.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);f([q.property()],k.prototype,"DECONFLICTOR_SHOW_GRID",void 0);f([q.property()],k.prototype,"LABELS_SHOW_BORDER",void 0);f([q.property()],k.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);f([q.property()],k.prototype,"OVERLAY_SHOW_CENTER",void 0);f([q.property()],k.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",
void 0);f([q.property()],k.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);f([q.property()],k.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);f([q.property()],k.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);f([q.property()],k.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);f([q.property()],k.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);f([q.property()],k.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);f([q.property()],k.prototype,"DISABLE_FAST_UPDATES",void 0);f([q.property()],
k.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);f([q.property()],k.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);return k=f([q.subclass("esri.views.3d.support.DebugFlags")],k)}(q.declared(t)))})},"esri/views/2d/layers/features/support/TileStore":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper @dojo/framework/shim/Set ../../../../../core/Evented ../../../../../core/has ../../../../../core/libs/rbush/rbush ./Tile ../../../tiling/TileKey".split(" "),
function(y,a,v,f,t,q,k,p,m,l){Object.defineProperty(a,"__esModule",{value:!0});var e={added:[],removed:[]},u=new t.default,w=new l(0,0,0,0);y=function(a){function c(c){var b=a.call(this)||this;b._tiles=new Map;b._index=p(9,k("csp-restrictions")?function(b){return{minX:b.bounds[0],minY:b.bounds[1],maxX:b.bounds[2],maxY:b.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);b.tiles=[];b.tileScheme=c;return b}v(c,a);c.prototype.destroy=function(){this._tiles.clear()};c.prototype.has=function(a){return this._tiles.has(a)};
c.prototype.get=function(a){return this._tiles.get(a)};c.prototype.findByKey=function(a){return this._tiles.get(a.id)};c.prototype.intersections=function(a,b){var c="string"===typeof a?this.get(a):a;if(!c)return[];var d=b*c.resolution;b=c.bounds[0]-d;a=c.bounds[1]-d;for(var h=c.bounds[2]+d,c=c.bounds[3]+d,d=[],e=0,n=this._index.search({minX:b,minY:a,maxX:h,maxY:c});e<n.length;e++){var l=n[e],f=l.bounds.slice();f[0]=Math.max(f[0],b);f[1]=Math.max(f[1],a);f[2]=Math.min(f[2],h);f[3]=Math.min(f[3],c);
0<f[2]-f[0]&&0<f[3]-f[1]&&d.push({bounds:f,tile:l})}return d};c.prototype.boundsIntersections=function(a){return this._index.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]})};c.prototype.setViewState=function(a){var b=this.tileScheme.getTileCoverage(a,0);if(b){a=b.spans;var b=b.lodInfo,c=b.level;if(0<a.length)for(var d=0;d<a.length;d++)for(var h=a[d],n=h.row,f=h.colTo,l=h.colFrom;l<=f;l++){var k=w.set(c,n,b.normalizeCol(l),b.getWorldForColumn(l)).id;u.add(k);this.has(k)||(h=new m.default(this.tileScheme,
k),this._tiles.set(k,h),this._index.insert(h),this.tiles.push(h),e.added.push(h))}for(a=this.tiles.length-1;0<=a;a--)h=this.tiles[a],u.has(h.id)||(this._tiles.delete(h.id),this.tiles.splice(a,1),this._index.remove(h),e.removed.push(h));(e.added.length||e.removed.length)&&this.emit("update",e);u.clear();e.added.length=0;e.removed.length=0}};return c}(q);a.default=y})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(y){function a(c,d){if(!(this instanceof a))return new a(c,
d);this._maxEntries=Math.max(4,c||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));d&&("function"===typeof d?this.toBBox=d:this._initFormat(d));this.clear()}function v(a,d){f(a,0,a.children.length,d,a)}function f(a,d,e,b,g){g||(g=u(null));g.minX=Infinity;g.minY=Infinity;g.maxX=-Infinity;g.maxY=-Infinity;for(var c;d<e;d++)c=a.children[d],t(g,a.leaf?b(c):c);return g}function t(a,d){a.minX=Math.min(a.minX,d.minX);a.minY=Math.min(a.minY,d.minY);a.maxX=Math.max(a.maxX,d.maxX);a.maxY=Math.max(a.maxY,
d.maxY);return a}function q(a,d){return a.minX-d.minX}function k(a,d){return a.minY-d.minY}function p(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function m(a){return a.maxX-a.minX+(a.maxY-a.minY)}function l(a,d){return a.minX<=d.minX&&a.minY<=d.minY&&d.maxX<=a.maxX&&d.maxY<=a.maxY}function e(a,d){return d.minX<=a.maxX&&d.minY<=a.maxY&&d.maxX>=a.minX&&d.maxY>=a.minY}function u(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function w(a,d,e,b,g){for(var c=
[d,e],h;c.length;)e=c.pop(),d=c.pop(),e-d<=b||(h=d+Math.ceil((e-d)/b/2)*b,y(a,h,d,e,g),c.push(d,h,h,e))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var c=this.data,f=[],b=this.toBBox;if(!e(a,c))return f;for(var g=[],k,h,m,u;c;){k=0;for(h=c.children.length;k<h;k++)m=c.children[k],u=c.leaf?b(m):m,e(a,u)&&(c.leaf?f.push(m):l(a,u)?this._all(m,f):g.push(m));c=g.pop()}return f},collides:function(a){var c=this.data,f=this.toBBox;if(!e(a,c))return!1;for(var b=[],g,k,h,m;c;){g=
0;for(k=c.children.length;g<k;g++)if(h=c.children[g],m=c.leaf?f(h):h,e(a,m)){if(c.leaf||l(a,m))return!0;b.push(h)}c=b.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var c=0,e=a.length;c<e;c++)this.insert(a[c]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=
a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=u([]);return this},remove:function(a,d){if(!a)return this;for(var c=this.data,b=this.toBBox(a),g=[],e=[],h,f,k,m;c||g.length;){c||(c=g.pop(),f=g[g.length-1],h=e.pop(),m=!0);if(c.leaf){a:{k=a;var u=c.children,p=d;if(p){for(var w=0;w<u.length;w++)if(p(k,u[w])){k=w;break a}k=-1}else k=u.indexOf(k)}if(-1!==k){c.children.splice(k,1);g.push(c);this._condense(g);break}}m||c.leaf||!l(c,b)?f?(h++,
c=f.children[h],m=!1):c=null:(g.push(c),e.push(h),h=0,f=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:q,compareMinY:k,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,d){for(var c=[];a;)a.leaf?d.push.apply(d,a.children):c.push.apply(c,a.children),a=c.pop();return d},_build:function(a,d,e,b){var c=e-d+1,f=this._maxEntries,h;if(c<=f)return h=u(a.slice(d,e+1)),v(h,this.toBBox),h;b||(b=Math.ceil(Math.log(c)/Math.log(f)),f=Math.ceil(c/
Math.pow(f,b-1)));h=u([]);h.leaf=!1;h.height=b;var c=Math.ceil(c/f),f=c*Math.ceil(Math.sqrt(f)),l,n,k;for(w(a,d,e,f,this.compareMinX);d<=e;d+=f)for(n=Math.min(d+f-1,e),w(a,d,n,c,this.compareMinY),l=d;l<=n;l+=c)k=Math.min(l+c-1,n),h.children.push(this._build(a,l,k,b-1));v(h,this.toBBox);return h},_chooseSubtree:function(a,d,e,b){for(var c,f,h,l,n,k,m,u;;){b.push(d);if(d.leaf||b.length-1===e)break;m=u=Infinity;c=0;for(f=d.children.length;c<f;c++)h=d.children[c],n=p(h),k=(Math.max(h.maxX,a.maxX)-Math.min(h.minX,
a.minX))*(Math.max(h.maxY,a.maxY)-Math.min(h.minY,a.minY))-n,k<u?(u=k,m=n<m?n:m,l=h):k===u&&n<m&&(m=n,l=h);d=l||d.children[0]}return d},_insert:function(a,d,e){var b=this.toBBox;e=e?a:b(a);var b=[],c=this._chooseSubtree(e,this.data,d,b);c.children.push(a);for(t(c,e);0<=d;)if(b[d].children.length>this._maxEntries)this._split(b,d),d--;else break;this._adjustParentBBoxes(e,b,d)},_split:function(a,d){var c=a[d],b=c.children.length,g=this._minEntries;this._chooseSplitAxis(c,g,b);b=this._chooseSplitIndex(c,
g,b);b=u(c.children.splice(b,c.children.length-b));b.height=c.height;b.leaf=c.leaf;v(c,this.toBBox);v(b,this.toBBox);d?a[d-1].children.push(b):this._splitRoot(c,b)},_splitRoot:function(a,d){this.data=u([a,d]);this.data.height=a.height+1;this.data.leaf=!1;v(this.data,this.toBBox)},_chooseSplitIndex:function(a,d,e){var b,c,l,h,k,n,m;k=n=Infinity;for(b=d;b<=e-d;b++)c=f(a,0,b,this.toBBox),l=f(a,b,e,this.toBBox),h=Math.max(0,Math.min(c.maxX,l.maxX)-Math.max(c.minX,l.minX))*Math.max(0,Math.min(c.maxY,l.maxY)-
Math.max(c.minY,l.minY)),c=p(c)+p(l),h<k?(k=h,m=b,n=c<n?c:n):h===k&&c<n&&(n=c,m=b);return m},_chooseSplitAxis:function(a,d,e){var b=a.leaf?this.compareMinX:q,c=a.leaf?this.compareMinY:k,f=this._allDistMargin(a,d,e,b);d=this._allDistMargin(a,d,e,c);f<d&&a.children.sort(b)},_allDistMargin:function(a,d,e,b){a.children.sort(b);b=this.toBBox;var c=f(a,0,d,b),l=f(a,e-d,e,b),h=m(c)+m(l),k,n;for(k=d;k<e-d;k++)n=a.children[k],t(c,a.leaf?b(n):n),h+=m(c);for(k=e-d-1;k>=d;k--)n=a.children[k],t(l,a.leaf?b(n):
n),h+=m(l);return h},_adjustParentBBoxes:function(a,d,e){for(;0<=e;e--)t(d[e],a)},_condense:function(a){for(var c=a.length-1,e;0<=c;c--)0===a[c].children.length?0<c?(e=a[c-1].children,e.splice(e.indexOf(a[c]),1)):this.clear():v(a[c],this.toBBox)},_initFormat:function(a){var c=["return a"," - b",";"];this.compareMinX=new Function("a","b",c.join(a[0]));this.compareMinY=new Function("a","b",c.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+
a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function y(f,t,q,k,p){for(;k>q;){if(600<k-q){var m=k-q+1,l=t-q+1,e=Math.log(m),u=.5*Math.exp(2*e/3),e=.5*Math.sqrt(e*u*(m-u)/m)*(0>l-m/2?-1:1);y(f,t,Math.max(q,Math.floor(t-l*u/m+e)),Math.min(k,Math.floor(t+(m-l)*u/m+e)),p)}m=f[t];l=q;u=k;a(f,q,t);for(0<p(f[k],m)&&a(f,q,k);l<u;){a(f,l,u);l++;for(u--;0>p(f[l],m);)l++;for(;0<p(f[u],m);)u--}0===p(f[q],m)?a(f,q,u):(u++,a(f,u,k));u<=t&&(q=u+1);t<=u&&(k=u-
1)}}function a(a,t,q){var f=a[t];a[t]=a[q];a[q]=f}function v(a,t){return a<t?-1:a>t?1:0}return function(a,t,q,k,p){y(a,t,q||0,k||a.length-1,p||v)}})},"esri/views/2d/layers/features/support/Tile":function(){define("require exports @dojo/framework/shim/Set ../../../../../core/ArrayPool ../../../../../geometry/Extent ../../../../../geometry/support/aaBoundingRect ../../../../../tasks/support/QuantizationParameters ../../../tiling/TileKey".split(" "),function(y,a,v,f,t,q,k,p){function m(a,e){var f=a.bounds,
l=e.bounds;return a.key.id!==e.key.id&&a.key.world===e.key.world&&f[0]<=l[0]&&f[1]<=l[1]&&f[2]>=l[2]&&f[3]>=l[3]}Object.defineProperty(a,"__esModule",{value:!0});a.isParentOf=m;a.isChildOf=function(a,e){return m(e,a)};y=function(){function a(a,f){this.bounds=q.create();this.key=new p(0,0,0,0);this.objectIds=new v.default;this.key.set(f);f=a.getLODInfoAt(this.key);this.tileInfoView=a;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=f.resolution;this.scale=f.scale;this.level=
f.level;this.needsClear=!0}Object.defineProperty(a.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"extent",{get:function(){return t.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transform",{get:function(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}},enumerable:!0,configurable:!0});
a.prototype.clone=function(){return new a(this.tileInfoView,this.id)};a.prototype.createChildTiles=function(){for(var e=this.key.getChildKeys(),l=f.acquire(),k=0;k<e.length;k++)l[k]=new a(this.tileInfoView,e[k]);return l};a.prototype.getQuantizationParameters=function(){return k.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})};
return a}();a.Tile=y;a.default=y})},"esri/views/2d/layers/graphics/GraphicContainer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Evented ../../../../core/Handles ../../../../core/promiseUtils ../../engine".split(" "),function(y,a,v,f,t,q,k,p,m,l){Object.defineProperty(a,"__esModule",{value:!0});var e=function(a){function e(c){var d=
a.call(this)||this;d._highlightMap=new Map;d._localToGlobalId=c;return d}f(e,a);Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this._highlightMap.size},enumerable:!0,configurable:!0});e.prototype.has=function(a){a=this._localToGlobalId(a);return this._highlightMap.has(a)};e.prototype.create=function(a){for(var c=this,e={objectIds:a,objectIdSet:new Set,remove:function(){return c._delete(e)}},b=0;b<a.length;b++){var g=a[b];e.objectIdSet.add(g);this._highlightMap.has(g)||this._highlightMap.set(g,
new Set);this._highlightMap.get(g).add(e)}this.emit("change");return e};e.prototype._delete=function(a){for(var c=0,e=a.objectIds;c<e.length;c++){var b=e[c],g=this._highlightMap.get(b);g.delete(a);0===g.size&&this._highlightMap.delete(b)}this.emit("change")};return e}(k);y=function(a){function k(c){var d=a.call(this)||this;d._displayHeight=0;d._displayWidth=0;d._rendererInfo=new l.WGLRendererInfo;d._tileDataChangeHandles=new p;d.attributeView=new l.AttributeStoreView;d._tileDataChangeHandler=function(a){a.target.buildHLList(d._highlightManager)};
d._highlightManagerChangeHandler=function(){for(var a=0,b=d.children;a<b.length;a++)b[a].buildHLList(d._highlightManager)};d.tileInfoView=c.tileInfoView;d.getMaterialItems=d.getMaterialItems.bind(d);d._highlightManager=new e(c.localToGlobalId);d._highlightManagerChangeHandle=d._highlightManager.on("change",d._highlightManagerChangeHandler.bind(d));return d}f(k,a);k.prototype.dispose=function(){this.removeAllChildren();for(var a=0,d=this.children;a<d.length;a++)d[a].dispose();this._tileDataChangeHandles.removeAll();
this._highlightManagerChangeHandle.remove();this.attributeView.destroy()};k.prototype.disposeWebGLResources=function(){for(var a=0,d=this.children;a<d.length;a++)d[a].clear()};k.prototype.highlight=function(a){return this._highlightManager.create(a)};k.prototype.displayWidth=function(){return this._displayWidth};Object.defineProperty(k.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});k.prototype.setVisibility=function(a,d){};k.prototype.getMaterialItems=
function(a,d){if(!a||0===a.length)return null;for(var c=[],b=this.stage.painter.textureManager,e=0;e<a.length;e++){var f=a[e];c.push(b.rasterizeItem(f.symbol,f.glyphIds,d))}return m.all(c).then(function(b){return b.map(function(b,c){return{id:a[c].id,mosaicItem:b}})})};k.prototype.addChild=function(c){a.prototype.addChild.call(this,c);var d=c.on("change",this._tileDataChangeHandler);this._tileDataChangeHandles.add(d,c);return c};k.prototype.removeChild=function(c){a.prototype.removeChild.call(this,
c);this._tileDataChangeHandles.remove(c);return c};k.prototype.renderChildren=function(a){var c=this.stage.painter;this._updateTilesTransform(a.state,this.tileInfoView.getClosestInfoForScale(a.state.scale).level);if(a.drawPhase===l.enums.WGLDrawPhase.MAP){this.attributeView.update(this.stage.context);this.attributeView.bindTextures(this.stage.context);var e=this.tileInfoView.getClosestInfoForScale(a.state.scale).level,b=this.tileInfoView.tileInfo.scaleToZoom(a.state.scale);a=v({},a,{rendererInfo:this._rendererInfo,
requiredLevel:e,displayLevel:b,context:this.stage.context,painter:c,attributeView:this.attributeView});this.sortChildren(function(a,b){return 0!==a.key.level-b.key.level?a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col});c.draw(a,this.children,a.drawPhase,null);this._highlightManager.isEmpty||c.highlight(a,this.children)}};k.prototype._updateTilesTransform=function(a,d){d=0;for(var c=this.children;d<c.length;d++){var b=c[d];b.setTransform(a,this.tileInfoView.tileInfo.lods[b.key.level].resolution/
(a.resolution*a.pixelRatio))}};return k}(l.Container);a.default=y})},"esri/views/2d/layers/graphics/GraphicProcessingQueue":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators".split(" "),function(y,a,v,f,t,q,k,p){Object.defineProperty(a,"__esModule",{value:!0});y=function(a){function l(e){e=a.call(this,
e)||this;e._queue=new Map;e._queueArray=[];e._onGoingGraphic=null;e._onGoingPromise=null;e._scheduledNextHandle=null;e._next=e._next.bind(e);e._finalize=e._finalize.bind(e);return e}v(l,a);Object.defineProperty(l.prototype,"length",{get:function(){return this._queueArray.length},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"updating",{get:function(){return 0<this._queueArray.length||null!==this._onGoingPromise},enumerable:!0,configurable:!0});l.prototype.cancel=function(a){this._onGoingGraphic&&
this._onGoingGraphic.graphic===a&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null);if(this._queue.has(a)){var e=this._queue.get(a);this._queue.delete(a);a=this._queueArray.indexOf(e);this._queueArray.slice(a,1)}this._scheduleNext();this.notifyChange("updating")};l.prototype.clear=function(){this._queue.clear();this._queueArray.length=0;this._onGoingPromise&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null);this._cancelNext();
this.notifyChange("updating")};l.prototype.has=function(a){return this._queue.has(a)};l.prototype.isOngoing=function(a){return this._onGoingGraphic&&this._onGoingGraphic.graphic===a};l.prototype.push=function(a,f){this._queue.has(a)||(f={graphic:a,addOrUpdate:f},this._queueArray.push(f),this._queue.set(a,f),this._scheduleNext(),this.notifyChange("updating"))};l.prototype.refresh=function(){this.reset()};l.prototype.reset=function(){var a=this._onGoingGraphic;a&&this.push(a.graphic,a.addOrUpdate)};
l.prototype._finalize=function(){this._onGoingPromise=this._ongoingAbortController=this._onGoingGraphic=null;this.notifyChange("updating");this._scheduleNext()};l.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)};l.prototype._scheduleNext=function(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=k.schedule(this._next))};l.prototype._next=function(){if(null==this._scheduledNextHandle||
0===this._queue.size||this._onGoingGraphic)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var a=this._peek(),f=a.graphic,l=a.addOrUpdate,c=q.createAbortController();this._queue.delete(f);this._onGoingGraphic=a;this._onGoingPromise=this.process(f,l,{signal:c.signal});this._ongoingAbortController=c;this._onGoingPromise.then(this._finalize,this._finalize);this.notifyChange("updating")}};l.prototype._peek=function(){return 0===this._queueArray.length?null:this._queueArray.pop()};f([p.property({readOnly:!0})],
l.prototype,"length",null);f([p.property({readOnly:!0})],l.prototype,"updating",null);f([p.property({constructOnly:!0})],l.prototype,"process",void 0);return l=f([p.subclass("esri.views.2d.layers.graphics.GraphicProcessingQueue")],l)}(p.declared(t));a.default=y})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("require exports ../../../../core/tsSupport/assignHelper @dojo/framework/shim/iterator @dojo/framework/shim/Map ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/rbush/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/contains ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ./GraphicStoreItem ./graphicsUtils".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w,c){function d(a,b,c,d,e){n.minX=b;n.minY=c;n.maxX=d;n.maxY=e;return a.search(n)}Object.defineProperty(a,"__esModule",{value:!0});var n={minX:0,minY:0,maxX:0,maxY:0},b=m.create(),g=[];y=function(){function a(a,b,c,d,e,g){this._graphics=d;this._onAdd=e;this._onRemove=g;this._index=p(9,q("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);this._itemByGraphic=new t.default;this._currentLevel=
-Infinity;this._tileInfoView=a;this._uidFieldName=c;if(a=a.getClosestInfoForScale(b))this._currentLevel=a.level,this._resolution=this._tileInfoView.getTileResolution(a.level)}a.prototype.hitTest=function(a,g,f,n,p){a=u.normalizeMapX(a,this._tileInfoView.spatialReference);var h=.5*n*f;b[0]=a-h;b[1]=g-h;b[2]=a+h;b[3]=g+h;f=.5*n*(f+50);f=d(this._index,a-f,g-f,a+f,g+f);if(!f||0===f.length)return[];for(var h={x:a,y:g},q=[],x,t=0;t<f.length;t++){var w=f[t];if(w.graphic.visible)switch(e.getJsonType(w.geometry)){case "esriGeometryPoint":x=
w.symbol;if(!x)continue;var v=w.geometry,r=void 0;switch(x.type){case "text":r=c.getTextSymbolBounds(v.x,v.y,x,w.size,this._resolution,p);break;case "cim":r=c.getCIMMarkerBounds(v.x,v.y,x,this._resolution,p);break;default:r=c.getMarkerSymbolBounds(v.x,v.y,x,this._resolution,p)}l.polygonContainsPoint(r,h)&&q.push(w);break;case "esriGeometryPolyline":x=w.symbol;if(!x)continue;x=1.5*n*window.devicePixelRatio*k.pt2px(x.width);c.isPointOnPolyline(w.geometry,a,g,x)&&q.push(w);break;case "esriGeometryEnvelope":x=
w.geometry;x=m.fromValues(x.xmin,x.ymin,x.xmax,x.ymax);m.intersects(x,b)&&q.push(w);break;case "esriGeometryPolygon":l.polygonContainsPoint(w.geometry,h)&&q.push(w);break;case "esriGeometryMultipoint":if(x=w.symbol)for(var v=w.geometry.points,r=void 0,z=0;z<v.length;z++)if(r="text"===x.type?c.getTextSymbolBounds(v[z][0],v[z][1],x,w.size,this._resolution,p):c.getMarkerSymbolBounds(v[z][0],v[z][1],x,this._resolution,p),l.polygonContainsPoint(r,h)){q.push(w);break}}}q.sort(function(a,b){var d=c.graphicGeometryToNumber(a.graphic),
e=c.graphicGeometryToNumber(b.graphic);return d===e?b.zorder-a.zorder:d-e});return q.map(function(a){return a.graphic})};a.prototype.getGraphicsData=function(a,b){var c=d(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);if(0===c.length||0===b.length)return[];c.sort(function(a,b){return a.zorder-b.zorder});c[0].insertAfter=-1;for(var e=1;e<c.length;e++)c[e].insertAfter=c[e-1].graphic.uid;c.sort(function(a,b){return a.graphic.uid-b.graphic.uid});b.sort(function(a,b){return a.uid-b.uid});
var g=e=0,h,f=[];a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]};for(var l=0;l<b.length;l++){for(var k=b[l],g=-2;e<c.length;)if(h=c[e],e++,k.uid===h.graphic.uid){g=h.insertAfter;break}if(h.geometry&&-2!==g){var n=h.getGeometryQuantized(a),m=v({},h.graphic.attributes);m[this._uidFieldName]=k.uid;f.push({centroid:w.default.getCentroidQuantized(h,a,this._scale),geometry:n,attributes:m,symbol:h.symbol,insertAfter:g})}}return f};a.prototype.getGraphicData=
function(a,b){var c=this._itemByGraphic.get(b);if(!c)return null;var e=d(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);e.sort(function(a,b){return a.zorder-b.zorder});var g=e.indexOf(c),e=0===g||-1===g?-1:e[g-1].graphic.uid;a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]};var g=c.getGeometryQuantized(a),h=v({},c.graphic.attributes);h[this._uidFieldName]=b.uid;return{centroid:w.default.getCentroidQuantized(c,a,this._scale),geometry:g,
attributes:h,symbol:c.symbol,insertAfter:e}};a.prototype.queryTileData=function(a){var b=m.pad(a.bounds,50*a.resolution,m.create()),b=d(this._index,b[0],b[1],b[2],b[3]),c=[];this._createTileGraphics(c,b,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});return c};a.prototype.has=function(a){return this._itemByGraphic.has(a)};a.prototype.getBounds=function(a){return this._itemByGraphic.has(a)?this._itemByGraphic.get(a).bounds:null};a.prototype.add=function(a,
b,c){if(a)return this._onAdd(a),b=w.default.acquire(a,b,c,this._resolution,this._scale,this._tileInfoView.spatialReference),this._itemByGraphic.set(a,b),c&&this._index.insert(b),b.bounds};a.prototype.remove=function(a){if(this._itemByGraphic.has(a)){this._onRemove(a);var b=this._itemByGraphic.get(a);this._index.remove(b);this._itemByGraphic.delete(a)}};a.prototype.updateZ=function(){for(var a=this._graphics.items,b,c=0;c<a.length;c++)if(b=a[c],b=this._itemByGraphic.get(b))b.zorder=c};a.prototype.update=
function(a,b,c){var d=this._itemByGraphic.get(a),e=m.clone(d.bounds);d.size[0]=d.size[1]=0;this._index.remove(d);d.set(a,b,c,this._resolution,this._scale,this._tileInfoView.spatialReference);c&&this._index.insert(d);return{oldBounds:e,newBounds:d.bounds}};a.prototype.updateLevel=function(a){var b=this;this._currentLevel!==a&&(this._currentLevel=a,this._resolution=this._tileInfoView.getTileResolution(a),this._scale=this._tileInfoView.getTileScale({level:a,row:0,col:0,world:0}),this._index.clear(),
a=this._itemByGraphic.values(),g.length=0,f.forOf(a,function(a){a.updateBounds(a.symbol,b._resolution,b._scale,b._tileInfoView.spatialReference);a.geometry&&g.push(a)}),this._index.load(g))};a.prototype.clear=function(){this._itemByGraphic.clear();this._index.clear()};a.prototype._createTileGraphics=function(a,b,c){var d=this._uidFieldName;b.sort(function(a,b){return a.zorder-b.zorder});for(var e,g,h,f,l=0;l<b.length;l++){h=b[l];e=h.graphic;g=h.getGeometryQuantized(c);f=0===l?-1:b[l-1].graphic.uid;
var k=v({},h.graphic.attributes);k[d]=e.uid;a.push({centroid:w.default.getCentroidQuantized(h,c,this._scale),geometry:g,attributes:k,symbol:h.symbol,insertAfter:f})}};return a}();a.default=y})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("require exports ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ./graphicsUtils".split(" "),function(y,
a,v,f,t,q,k,p){Object.defineProperty(a,"__esModule",{value:!0});y=function(){function a(){this.bounds=f.create();this.graphic=null;this.size=[0,0,0,0]}a.acquire=function(f,e,k,m,c,d){void 0===f&&(f=null);var l;0===a._pool.length?l=new a:(l=a._pool.pop(),this._set.delete(l));l.acquire(f,e,k,m,c,d);return l};a.release=function(a){a&&!this._set.has(a)&&(a.release(),this._pool.push(a),this._set.add(a))};a.getCentroidQuantized=function(a,e,f){if(q.isPolygon(a.geometry)){f=a.symbol;if(v.isNone(f))return null;
if(p.isMarkerSymbol(f.type))return a=t.polygonCentroid(a.geometry),k.quantizePoint(e,{},{x:a[0],y:a[1]},!1,!1)}return null};a.prototype.acquire=function(a,e,f,k,c,d){void 0===a&&(a=null);a&&this.set(a,e,f,k,c,d)};a.prototype.release=function(){this.geometry=this.symbol=this.graphic=null};a.prototype.set=function(a,e,f,k,c,d){this.graphic=a;this.geometry=f;this.symbol=e.symbol;p.getBounds(this.bounds,this.size,e.symbol,f,e.mosaicItem,k,c,d)};a.prototype.updateBounds=function(a,e,f,k){p.getBounds(this.bounds,
this.size,a,this.geometry,null,e,f,k)};a.prototype.getGeometryQuantized=function(a){if(q.isPolygon(this.geometry)){var e=this.geometry.rings;if(1===e.length&&2===e[0].length)return k.quantizeGeometry(a,{paths:[[e[0][0],e[0][1]]]})}return k.quantizeGeometry(a,this.geometry)};a._pool=[];a._set=new Set;return a}();a.default=y})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat2d ../../../../core/libs/gl-matrix-2/mat2df32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/boundsUtils ../../../../geometry/support/intersects ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/spatialReferenceUtils ../../engine".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w,c,d,n,b){function g(a,b,c,d,e){var g,h,l=f.pt2px(c.xoffset),n=f.pt2px(c.yoffset),m=C*c.angle;e*=C;switch(c.type){case "simple-marker":g=h=f.pt2px(c.size);break;case "picture-marker":g=f.pt2px(c.width),h=f.pt2px(c.height)}c=t.mat2d.identity(O);t.mat2d.translate(c,c,k.vec2.set(B,a,b));t.mat2d.rotate(c,c,e-m);t.mat2d.scale(c,c,k.vec2.set(B,d,-d));t.mat2d.translate(c,c,k.vec2.set(B,l,-n));a=[0,0];k.vec2.transformMat2d(a,k.vec2.set(B,-.5*g,-.5*h),c);b=[0,0];k.vec2.transformMat2d(b,
k.vec2.set(B,-.5*g,.5*h),c);d=[0,0];k.vec2.transformMat2d(d,k.vec2.set(B,.5*g,-.5*h),c);l=[0,0];k.vec2.transformMat2d(l,k.vec2.set(B,.5*g,.5*h),c);return{rings:[[a,d,l,b,a]]}}function x(a,c,d,e,g){var h=b.CIMSymbolHelper.getEnvelope(d.data);if(!h)return null;d=f.pt2px(h.width);var l=f.pt2px(h.height),n=f.pt2px(h.x),h=f.pt2px(h.y),m=0*C,p=C*g;g=t.mat2d.identity(O);t.mat2d.translate(g,g,k.vec2.set(B,a,c));t.mat2d.rotate(g,g,p-m);t.mat2d.scale(g,g,k.vec2.set(B,e,-e));t.mat2d.translate(g,g,k.vec2.set(B,
n,-h));a=[0,0];k.vec2.transformMat2d(a,k.vec2.set(B,-.5*d,-.5*l),g);c=[0,0];k.vec2.transformMat2d(c,k.vec2.set(B,-.5*d,.5*l),g);e=[0,0];k.vec2.transformMat2d(e,k.vec2.set(B,.5*d,-.5*l),g);n=[0,0];k.vec2.transformMat2d(n,k.vec2.set(B,.5*d,.5*l),g);return{rings:[[a,e,n,c,a]]}}function h(a,c,d,e,g,h){var l=b.alignmentUtils.getYAnchorDirection(d.verticalAlignment||"baseline"),n="baseline"===(d.verticalAlignment||"baseline"),m=f.pt2px(d.xoffset),p=f.pt2px(d.yoffset),u=f.pt2px(d.font.size)/24,x=4*u,l=n?
25*u:e[1]+(1+l)*e[3]*.5;d=C*d.angle;n=C*h;h=t.mat2d.identity(O);t.mat2d.translate(h,h,k.vec2.set(B,a,c));t.mat2d.rotate(h,h,n-d);t.mat2d.scale(h,h,k.vec2.set(B,g,-g));t.mat2d.translate(h,h,k.vec2.set(B,m,-p));t.mat2d.translate(h,h,k.vec2.set(B,-x,-x-l));a=[0,0];k.vec2.transformMat2d(a,k.vec2.set(B,e[0],e[1]),h);c=[0,0];k.vec2.transformMat2d(c,k.vec2.set(B,e[0],e[1]+e[3]),h);g=[0,0];k.vec2.transformMat2d(g,k.vec2.set(B,e[0]+e[2],e[1]),h);m=[0,0];k.vec2.transformMat2d(m,k.vec2.set(B,e[0]+e[2],e[1]+
e[3]),h);return{rings:[[a,g,m,c,a]]}}function A(a,c,d){if(!d||0===d.glyphMosaicItems.length)return a;var e=b.bidiText(c.text),g=e[0],e=e[1],h=b.alignmentUtils.getJustification(c.horizontalAlignment||"center"),l=b.alignmentUtils.getXAnchorDirection(c.horizontalAlignment||"center");d=(new b.TextShapingNew([d.glyphMosaicItems],b.definitions.TEXT_MAX_WIDTH,b.definitions.TEXT_LINE_HEIGHT,b.definitions.TEXT_SPACING,[0,.5*-J],.5*(1-l),0,h)).getShaping(g,e);g=b.fontUtils.getFontDecorationTop(c.font.decoration);
isNaN(g)||b.TextShapingNew.addDecoration(d,g);d=b.TextShapingNew.getBox(d);c=f.pt2px(c.font.size)/V;a[0]=c*d.x;a[1]=c*d.y;a[2]=c*d.width;a[3]=c*d.height;return a}function z(a,b){return Math.ceil((a-b)/(2*b))}function G(a,b){var c;c=w.isPolygon(a)?a.rings:a.paths;for(var d=0;d<c.length;d++)for(var e=0,g=c[d];e<g.length;e++)g[e][0]+=b;return a}function D(a,b){if(!b)return a;var c=K(a,b).map(function(a){return a.extent});return 2>c.length?c[0]||a:2<c.length?(a.xmin=b.valid[0],a.xmax=b.valid[1],a):{rings:c.map(function(a){return[[a.xmin,
a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]})}}function K(a,b){var c=[],d=a.ymin,e=a.ymax,g=a.xmax-a.xmin,h=a.xmin,f=a.xmax,l,k=b.valid,n=k[0],m=k[1];l=I(a.xmin,b);var p=l.x,k=l.frameId;l=I(a.xmax,b);b=l.x;a=l.frameId;l=p===b&&0<g;if(g>2*m){g={xmin:h<f?p:b,ymin:d,xmax:m,ymax:e};h={xmin:n,ymin:d,xmax:h<f?b:p,ymax:e};f={xmin:0,ymin:d,xmax:m,ymax:e};d={xmin:n,ymin:d,xmax:0,ymax:e};e=[];n=[];E(g,f)&&e.push(k);E(g,d)&&n.push(k);E(h,f)&&e.push(a);E(h,d)&&n.push(a);for(m=k+1;m<
a;m++)e.push(m),n.push(m);c.push({extent:g,frameIds:[k]},{extent:h,frameIds:[a]},{extent:f,frameIds:e},{extent:d,frameIds:n})}else p>b||l?c.push({extent:{xmin:p,ymin:d,xmax:m,ymax:e},frameIds:[k]},{extent:{xmin:n,ymin:d,xmax:b,ymax:e},frameIds:[a]}):c.push({extent:{xmin:p,ymin:d,xmax:b,ymax:e},frameIds:[k]});return c}function I(a,b){var c=b.valid;b=c[0];var d=c[1],c=2*d,e=0;a>d?(b=Math.ceil(Math.abs(a-d)/c),a-=b*c,e=b):a<b&&(b=Math.ceil(Math.abs(a-b)/c),a+=b*c,e=-b);return{x:a,frameId:e}}function E(a,
b){var c=b.xmin,d=b.ymin,e=b.xmax;b=b.ymax;return F(a,c,d)&&F(a,c,b)&&F(a,e,b)&&F(a,e,d)}function F(a,b,c){return b>=a.xmin&&b<=a.xmax&&c>=a.ymin&&c<=a.ymax?!0:!1}function H(a,b,c){if(Array.isArray(a)){var d=a[0];if(d>b){var e=z(d,b);a[0]=d+-2*e*b}else d<c&&(e=z(d,c),a[0]=d+-2*e*c)}else d=a.x,d>b?(e=z(d,b),a.x+=-2*e*b):d<c&&(e=z(d,c),a.x+=-2*e*c);return a}Object.defineProperty(a,"__esModule",{value:!0});var C=Math.PI/180,r=b.definitions.TEXT_MAX_WIDTH,J=b.definitions.TEXT_LINE_HEIGHT,W=b.definitions.TEXT_SPACING,
O=q.mat2df32.create(),B=p.vec2f32.create(),L=l.create();a.ensureClosedRings=function(a){if(w.isPolygon(a)){var b=0;for(a=a.rings;b<a.length;b++){var c=a[b];3>c.length||c[0][0]===c[c.length-1][0]&&c[0][1]===c[c.length-1][1]||c.push(c[0])}}};a.getBounds=function(a,d,f,l,k,m,p,u){if(!l||!f)return a[0]=a[1]=a[2]=a[3]=0,d[0]=d[1]=d[2]=d[3]=0,a;if(w.isPoint(l)){p=l.x;l=l.y;"text"===f.type&&0===d[2]&&0===d[3]&&A(d,f,k);var q;switch(f.type){case "simple-marker":case "picture-marker":q=g(p,l,f,m,0);break;
case "text":q=h(p,l,f,d,m,0);break;case "cim":q=x(p,l,f,m,0)}for(m=d=0;m<q.rings[0].length-1;m++)f=q.rings[0][m],f=(p-f[0])*(p-f[0])+(l-f[1])*(l-f[1]),d=Math.max(d,f);d=Math.sqrt(d);m=c.normalizeMapX(p-d,u);p=c.normalizeMapX(p+d,u);m>p&&(u=n.getInfo(u))&&(m=u.valid,u=m[1],m=m[0],p=u);a[0]=m;a[1]=l-d;a[2]=p;a[3]=l+d}else{e.getBoundsXY(a,l);l=d[0];if(0===l){a:switch(l=0,f.type){case "simple-fill":case "picture-fill":l=f.outline;if(!l){l=0;break a}l=l.width;break;case "simple-line":l=f.width;break;case "simple-marker":l=
f.size;break;case "picture-marker":l=Math.max(f.width,f.height);break;case "text":l=[0,0,0,0];A(l,f,k);l=Math.max(l[0],l[1]);break;case "cim":l=b.CIMSymbolHelper.getEnvelope(f.data),l=Math.sqrt(l.width*l.width+l.height*l.height)}d[0]=l}l=m*l/2;a[0]-=l;a[1]-=l;a[2]+=l;a[3]+=l}return a};a.isMarkerSymbol=function(a){return"simple-marker"===a||"picture-marker"===a||"text"===a};a.graphicGeometryToNumber=function(a){switch(v.expect(a.geometry).type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};
var P=p.vec2f32.create(),S=p.vec2f32.create(),T=p.vec2f32.create(),M=p.vec2f32.create(),Q=p.vec2f32.create(),U=p.vec2f32.create(),R=p.vec2f32.create();a.isPointOnPolyline=function(a,b,c,d){k.vec2.set(T,b,c);a=a.paths;for(var e,g,h,f,l,m,n,p,u=Infinity,x=0;x<a.length;x++){var q=a[x];if(!(2>q.length))for(var w=1;w<q.length;w++)e=q[w-1][0],h=q[w-1][1],g=q[w][0],f=q[w][1],l=Math.min(e,g)-d,m=Math.min(h,f)-d,n=Math.max(e,g)+d,p=Math.max(h,f)+d,b<l||b>n||c<m||c>p||(k.vec2.set(P,e,h),k.vec2.set(S,g,f),k.vec2.subtract(M,
S,P),k.vec2.subtract(Q,P,T),k.vec2.scale(U,M,k.vec2.dot(M,Q)/k.vec2.dot(M,M)),k.vec2.subtract(R,Q,U),e=k.vec2.dot(R,R),u>e&&(u=e))}return Math.sqrt(u)<=d};a.getMarkerSymbolBounds=g;a.getCIMMarkerBounds=x;a.getTextSymbolBounds=h;a.normalizeCentralMeridian=function(a){var b,c,g,h,f,l=null;if(!a)return null;b=a.spatialReference;c=d.getInfo(b);f=b.isWebMercator?102100:4326;g=N[f].maxX;h=N[f].minX;b=N[f].plus180Line;f=N[f].minus180Line;var k,m=a.toJSON();if(!c)return m;"mesh"===a.type?k=m:w.isPoint(m)?
k=H(m,g,h):w.isMultipoint(m)?(m.points=m.points.map(function(a){return H(a,g,h)}),k=m):w.isExtent(m)?k=D(m,c):w.isPolygon(m)||w.isPolyline(m)?(e.getBoundsXY(L,m),a={xmin:L[0],ymin:L[1],xmax:L[2],ymax:L[3]},c=2*z(a.xmin,h)*g,m=0===c?m:G(m,c),a.xmin+=c,a.xmax+=c,u.extentIntersectsPolyline(a,b)&&a.xmax!==g?l=m:u.extentIntersectsPolyline(a,f)&&a.xmin!==h?l=m:k=m):k=a.clone();return null!==l?(new X).cut(l,g):k};var V=24;a.getTextSymbolSize=A;a.getTextSymbolEstimatedSize=function(a,c,d){var e=b.bidiText(c.text),
g=e[0],e=e[1],h=b.alignmentUtils.getJustification(c.horizontalAlignment||"center"),l=b.alignmentUtils.getXAnchorDirection(c.horizontalAlignment||"center");d=(new b.TextShapingNew([],r,J,W,[0,.5*-J],.5*(1-l),0,h)).getEstimatedShaping(g,e,d);d=b.TextShapingNew.getBox(d);c=f.pt2px(c.font.size)/V;a[0]=c*d.x;a[1]=c*d.y;a[2]=c*d.width;a[3]=c*d.height;return a};var N={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,plus180Line:{paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,
2.0037508342788905E7]]],spatialReference:m.WebMercator},minus180Line:{paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:m.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:m.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:m.WGS84}}},X=function(){function a(){}a.prototype.cut=function(a,b){var c;if(a.rings)this.closed=!0,c=a.rings,this.minPts=4;else if(a.paths)this.closed=
!1,c=a.paths,this.minPts=2;else return null;var d=c.length;b*=-2;for(var e=0;e<d;e++){var g=c[e];if(g&&g.length>=this.minPts){for(var h=[],f=0;f<g.length;f++){var l=g[f];h.push([l[0]+b,l[1]])}c.push(h)}}this.closed?a.rings=c:a.paths=c;return a};return a}()})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(y,a,v,f,t,q){return function(a){function k(){var f=
null!==a&&a.apply(this,arguments)||this;f.graphics=null;f.renderer=null;f.view=null;return f}v(k,a);f([q.property()],k.prototype,"graphics",void 0);f([q.property()],k.prototype,"renderer",void 0);f([q.property()],k.prototype,"updating",void 0);f([q.property()],k.prototype,"view",void 0);return k=f([q.subclass("esri.views.layers.GraphicsView")],k)}(q.declared(t))})},"esri/views/2d/navigation/MapViewNavigation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Viewpoint ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w){Object.defineProperty(a,"__esModule",{value:!0});var c=new t({targetGeometry:new p}),d=[0,0];y=function(a){function b(b){b=a.call(this)||this;b._endTimer=null;b.animationManager=null;return b}v(b,a);b.prototype.initialize=function(){this.pan=new e({navigation:this});this.rotate=new w({navigation:this});this.pinch=new u({navigation:this});this.zoomBox=new l({view:this.view,navigation:this})};b.prototype.destroy=function(){this.zoomBox.destroy();this.animationManager=
this.zoomBox=null};Object.defineProperty(b.prototype,"momentumEnabled",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.begin=function(){this._set("interacting",!0)};b.prototype.end=function(){var a=this;this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0);this._endTimer=setTimeout(function(){a._set("interacting",!1)},0)};b.prototype.zoom=function(a,b){void 0===b&&(b=this._getDefaultAnchor());this.stop();this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>
a?this.zoomIn(b):this.zoomOut(b);this.setViewpoint(b,a,0,[0,0])};b.prototype.zoomIn=function(a){void 0===a&&(a=this._getDefaultAnchor());var b=this.view,d=b.scale,e=b.constraints.snapToNextScale(d);return b.goTo(this._scaleAndRotateViewpoint(c,a,e/d,0),{animate:this.momentumEnabled})};b.prototype.zoomOut=function(a){void 0===a&&(a=this._getDefaultAnchor());var b=this.view,d=b.scale,e=b.constraints.snapToPreviousScale(d);return b.goTo(this._scaleAndRotateViewpoint(c,a,e/d,0),{animate:this.momentumEnabled})};
b.prototype.setViewpoint=function(a,b,c,d){this.begin();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,a,b,c,d);this.end()};b.prototype.continousRotateClockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){m.rotateBy(a,a,-1)})};b.prototype.continousRotateCounterclockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){m.rotateBy(a,a,1)})};b.prototype.resetRotation=
function(){this.view.rotation=0};b.prototype.continousPanLeft=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){m.translateBy(a,a,[-10,0])})};b.prototype.continousPanRight=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){m.translateBy(a,a,[10,0])})};b.prototype.continousPanUp=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){m.translateBy(a,a,[0,10])})};b.prototype.continousPanDown=
function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){m.translateBy(a,a,[0,-10])})};b.prototype.stop=function(){this.pan.stopMomentumNavigation();this.animationManager.stop();this.end();this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0,this._set("interacting",!1))};b.prototype._getDefaultAnchor=function(){var a=this.view.size;d[0]=.5*a[0];d[1]=.5*a[1];return d};b.prototype._scaleAndRotateViewpoint=function(a,b,c,d){var e=this.view,g=e.size,h=
e.padding,f=e.constraints,l=e.viewpoint,k=e.scale*c,e=f.canZoomInTo(k),f=f.canZoomOutTo(k);return 1>c&&!e||1<c&&!f?l:m.padAndScaleAndRotateBy(a,l,c,d,b,g,h)};b.prototype._scaleRotateTranslateViewpoint=function(a,b,c,d,e){var g=this.view,f=g.size,h=g.padding,l=g.constraints,k=g.viewpoint,n=g.scale*c,g=l.canZoomInTo(n),l=l.canZoomOutTo(n);if(1>c&&!g||1<c&&!l)c=1;m.translateBy(k,k,e);return m.padAndScaleAndRotateBy(a,k,c,d,b,f,h)};f([k.property()],b.prototype,"animationManager",void 0);f([k.property({type:Boolean,
readOnly:!0})],b.prototype,"interacting",void 0);f([k.property()],b.prototype,"pan",void 0);f([k.property()],b.prototype,"pinch",void 0);f([k.property()],b.prototype,"rotate",void 0);f([k.property()],b.prototype,"view",void 0);f([k.property()],b.prototype,"zoomBox",void 0);return b=f([k.subclass("esri.views.2d.navigation.MapViewNavigation")],b)}(k.declared(q));a.default=y})},"esri/views/2d/navigation/ZoomBox":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/screenUtils ../../../core/accessorSupport/decorators".split(" "),
function(y,a,v,f,t,q,k){return function(a){function m(f){f=a.call(this,f)||this;f._container=null;f._overlay=null;f._backgroundShape=null;f._boxShape=null;f._box={x:0,y:0,width:0,height:0};f._redraw=f._redraw.bind(f);return f}v(m,a);m.prototype.destroy=function(){this.view=null};Object.defineProperty(m.prototype,"view",{set:function(a){var e=this;this._handles&&this._handles.forEach(function(a){a.remove()});this._handles=null;this._destroyOverlay();this._set("view",a);a&&(a.on("drag",["Shift"],function(a){return e._handleDrag(a,
1)}),a.on("drag",["Shift","Ctrl"],function(a){return e._handleDrag(a,-1)}))},enumerable:!0,configurable:!0});m.prototype._start=function(a,e,f,k){this._createContainer();this._createOverlay();this.navigation.begin()};m.prototype._update=function(a,e,f,k){this._box.x=a;this._box.y=e;this._box.width=f;this._box.height=k;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))};m.prototype._end=function(a,e,f,k,c){var d=this.view;a=d.toMap(q.createScreenPoint(a+.5*f,e+.5*k));f=Math.max(f/d.width,
k/d.height);-1===c&&(f=1/f);this._destroyOverlay();this.navigation.end();d.goTo({center:a,scale:d.scale*f})};m.prototype._updateBox=function(a,e,f,k){var c=this._boxShape;c.setAttributeNS(null,"x",""+a);c.setAttributeNS(null,"y",""+e);c.setAttributeNS(null,"width",""+f);c.setAttributeNS(null,"height",""+k);c.setAttributeNS(null,"class","esri-zoom-box__outline")};m.prototype._updateBackground=function(a,e,f,k){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(a,e,f,k,this.view.width,this.view.height))};
m.prototype._createContainer=function(){var a=document.createElement("div");a.className="esri-zoom-box__container";this.view.root.appendChild(a);this._container=a};m.prototype._createOverlay=function(){var a=this.view.width,e=this.view.height,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M 0 0 L "+a+" 0 L "+a+" "+e+" L 0 "+e+" Z");f.setAttributeNS(null,"class","esri-zoom-box__overlay-background");a=document.createElementNS("http://www.w3.org/2000/svg",
"rect");e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");e.setAttributeNS(null,"class","esri-zoom-box__overlay");e.appendChild(f);e.appendChild(a);this._container.appendChild(e);this._backgroundShape=f;this._boxShape=a;this._overlay=e};m.prototype._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=
this._backgroundShape=this._boxShape=this._overlay=null};m.prototype._toSVGPath=function(a,e,f,k,c,d){f=a+f;k=e+k;return"M 0 0 L "+c+" 0 L "+c+" "+d+" L 0 "+d+" ZM "+a+" "+e+" L "+a+" "+k+" L "+f+" "+k+" L "+f+" "+e+" Z"};m.prototype._handleDrag=function(a,e){var f=a.x,k=a.y,c=a.origin.x,d=a.origin.y,l;f>c?(l=c,c=f-c):(l=f,c-=f);k>d?(f=d,k-=d):(f=k,k=d-k);switch(a.action){case "start":this._start(l,f,c,k);break;case "update":this._update(l,f,c,k);break;case "end":this._end(l,f,c,k,e)}a.stopPropagation()};
m.prototype._redraw=function(){if(this._rafId&&(this._rafId=null,this._overlay)){var a=this._box,e=a.x,f=a.y,k=a.width,a=a.height;this._updateBox(e,f,k,a);this._updateBackground(e,f,k,a);this._rafId=requestAnimationFrame(this._redraw)}};f([k.property()],m.prototype,"navigation",void 0);f([k.property()],m.prototype,"view",null);return m=f([k.subclass("esri.views.2d.navigation.ZoomBox")],m)}(k.declared(t))})},"esri/views/2d/navigation/actions/Pan":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w){return function(a){function c(c){var b=a.call(this)||this;b.animationTime=0;b.momentumEstimator=new w.PanPlanarMomentumEstimator(500,6,.92);b.momentum=null;b.tmpMomentum=e.vec3f64.create();b.momentumFinished=!1;b.viewpoint=new q({targetGeometry:new t.Point,scale:0,rotation:0});b.watch("momentumFinished",function(a){a&&b.navigation.stop()});return b}v(c,a);c.prototype.begin=function(a,b){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(b);
this.previousDrag=b};c.prototype.update=function(a,b){this.addToEstimator(b);var c=b.center.x,d=b.center.y,e=this.previousDrag,c=e?e.center.x-c:-c,d=e?d-e.center.y:d;a.viewpoint=u.translateBy(this.viewpoint,a.viewpoint,[c||0,d||0]);this.previousDrag=b};c.prototype.end=function(a,b){this.addToEstimator(b);this.momentum=this.navigation.momentumEnabled?this.momentumEstimator.evaluateMomentum():null;this.animationTime=0;if(this.momentum)this.onAnimationUpdate(a);this.previousDrag=null;this.navigation.end()};
c.prototype.addToEstimator=function(a){var b=a.center.x,c=a.center.y,d=p.createScreenPointArray(-b,c),b=e.vec3f64.fromValues(-b,c,0);this.momentumEstimator.add(d,b,.001*a.timestamp)};c.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,function(c,d){b.momentumFinished=!b.momentum||b.momentum.isFinished(b.animationTime);d*=.001;if(!b.momentumFinished){var e=b.momentum.valueDelta(b.animationTime,d);l.vec3.scale(b.tmpMomentum,b.momentum.direction,
e);a.viewpoint=u.translateBy(c,c,b.tmpMomentum)}b.animationTime+=d})};c.prototype.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())};f([m.property()],c.prototype,"momentumFinished",void 0);f([m.property()],c.prototype,"viewpoint",void 0);f([m.property()],c.prototype,"navigation",void 0);return c=f([m.subclass("esri.views.2d.navigation.actions.Pan")],c)}(m.declared(k))})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(y,a,v,f,t,q,k){Object.defineProperty(a,"__esModule",{value:!0});var p=function(a){function f(e,f,k,c,d){e=a.call(this,e,f,k)||this;e.sceneVelocity=c;e.direction=d;return e}v(f,a);f.prototype.value=function(e){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,e)};return f}(k.Momentum);a.PanPlanarMomentum=p;y=function(){function a(a,e,f){void 0===a&&(a=300);void 0===e&&(e=12);void 0===f&&(f=.84);this.minimumInitialVelocity=a;this.stopVelocity=e;this.friction=f;this.time=
new q.FilteredFiniteDifference(.6);this.screen=[new q.FilteredFiniteDifference(.4),new q.FilteredFiniteDifference(.4)];this.scene=[new q.FilteredFiniteDifference(.6),new q.FilteredFiniteDifference(.6),new q.FilteredFiniteDifference(.6)];this.tmpDirection=t.vec3f64.create()}a.prototype.add=function(a,e,f){this.time.hasLastValue&&.015>this.time.computeDelta(f)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(e[0]),this.scene[1].update(e[1]),this.scene[2].update(e[2]),this.time.update(f))};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,e=this.screen[1].filteredDelta,a=Math.sqrt(a*a+e*e)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,
e,k){f.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var l=f.vec3.length(this.tmpDirection);0<l&&f.vec3.scale(this.tmpDirection,this.tmpDirection,1/l);return new p(a,e,k,l/this.time.filteredDelta,this.tmpDirection)};return a}();a.PanPlanarMomentumEstimator=y})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(y,a){Object.defineProperty(a,"__esModule",{value:!0});y=function(){function a(a){this.gain=
a}a.prototype.update=function(a){if(this.hasLastValue){var f=this.computeDelta(a);this.updateDelta(f)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});a.prototype.computeDelta=function(a){return a-
this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();a.FilteredFiniteDifference=y})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(y,a,v){Object.defineProperty(a,"__esModule",{value:!0});y=function(){function a(a,f,k){this._initialVelocity=a;this._stopVelocity=f;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,f){var k=this.value(a);return this.value(a+
f)-k};a.prototype.valueFromInitialVelocity=function(a,f){f=Math.min(f,this.duration);var k=1-this.friction;return a*(Math.pow(k,f)-1)/Math.log(k)};return a}();a.Momentum=y})},"esri/views/2d/navigation/actions/Pinch":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e,u,w){return function(a){function c(c){var b=a.call(this,c)||this;b._animationTime=0;b._momentumFinished=!1;b._rotationMomentumEstimator=new u.RotationMomentumEstimator(.6,.15,.95);b._rotationDirection=1;b._zoomDirection=1;b._zoomMomentumEstimator=new w.ZoomMomentumEstimator;b._zoomOnly=null;b.zoomMomentum=null;b.rotateMomentum=null;b.viewpoint=new q({targetGeometry:new t.Point,scale:0,rotation:0});b.watch("_momentumFinished",function(a){a&&b.navigation.stop()});return b}
v(c,a);c.prototype.begin=function(a,b){this.navigation.begin();this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=b.angle;this._previousRadius=this._startRadius=b.radius;this._previousCenter=b.center;this._updateTimestamp=null;a.constraints.rotationEnabled&&this.addToRotateEstimator(0,b.timestamp);this.addToZoomEstimator(b,1)};c.prototype.update=function(a,b){null===this._updateTimestamp&&(this._updateTimestamp=b.timestamp);
var c=b.angle,d=b.radius,e=b.center,f=Math.abs(180*(c-this._startAngle)/Math.PI),k=Math.abs(d-this._startRadius),l=this._startRadius/d;if(this._previousRadius){var m=d/this._previousRadius,n=180*(c-this._previousAngle)/Math.PI;this._rotationDirection=0<=n?1:-1;this._zoomDirection=1<=m?1:-1;a.constraints.rotationEnabled?(null===this._zoomOnly&&200<b.timestamp-this._updateTimestamp&&(this._zoomOnly=0<k-f),null===this._zoomOnly||this._zoomOnly?n=0:this.addToRotateEstimator(c-this._startAngle,b.timestamp)):
n=0;this.addToZoomEstimator(b,l);this.navigation.setViewpoint([e.x,e.y],1/m,n,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=c;this._previousRadius=d;this._previousCenter=e};c.prototype.end=function(a,b){if(this.navigation.momentumEnabled&&(this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,this.rotateMomentum||this.zoomMomentum))this.onAnimationUpdate(a);this.navigation.end()};
c.prototype.addToRotateEstimator=function(a,b){this._rotationMomentumEstimator.add(a,.001*b)};c.prototype.addToZoomEstimator=function(a,b){this._zoomMomentumEstimator.add(b,.001*a.timestamp)};c.prototype.canZoomIn=function(a){var b=a.scale;a=a.constraints.effectiveMaxScale;return 0===a||b>a};c.prototype.canZoomOut=function(a){var b=a.scale;a=a.constraints.effectiveMinScale;return 0===a||b<a};c.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,
function(c,d){var f=!b.canZoomIn(a)&&1<b._zoomDirection||!b.canZoomOut(a)&&1>b._zoomDirection,g=!b.rotateMomentum||b.rotateMomentum.isFinished(b._animationTime),f=f||!b.zoomMomentum||b.zoomMomentum.isFinished(b._animationTime);d*=.001;b._momentumFinished=g&&f;if(!b._momentumFinished){var g=b.rotateMomentum?Math.abs(b.rotateMomentum.valueDelta(b._animationTime,d))*b._rotationDirection*180/Math.PI:0,f=b.zoomMomentum?Math.abs(b.zoomMomentum.valueDelta(b._animationTime,d)):1,k=l.vec2f64.create(),n=l.vec2f64.create();
if(b._previousCenter){m.vec2.set(k,b._previousCenter.x,b._previousCenter.y);e.getPaddingScreenTranslation(n,a.size,a.padding);m.vec2.add(k,k,n);var n=a.constraints,p=a.scale,q=p*f;1>f&&!n.canZoomInTo(q)?(f=p/n.effectiveMaxScale,b.zoomMomentum=null,b.rotateMomentum=null):1<f&&!n.canZoomOutTo(q)&&(f=p/n.effectiveMinScale,b.zoomMomentum=null,b.rotateMomentum=null);e.scaleAndRotateBy(c,a.viewpoint,f,g,k,a.size)}}b._animationTime+=d})};c.prototype.stopMomentumNavigation=function(){if(this.rotateMomentum||
this.zoomMomentum)this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()};f([p.property()],c.prototype,"_momentumFinished",void 0);f([p.property()],c.prototype,"viewpoint",void 0);f([p.property()],c.prototype,"navigation",void 0);return c=f([p.subclass("esri.views.2d.navigation.actions.Pinch")],c)}(p.declared(k))})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(y,a,v,f){Object.defineProperty(a,"__esModule",{value:!0});y=function(a){function f(f,p,m,l){void 0===f&&(f=3);void 0===p&&(p=.01);void 0===m&&(m=.95);void 0===l&&(l=12);return a.call(this,f,p,m,l)||this}v(f,a);f.prototype.add=function(f,p){if(this.value.hasLastValue){var k=this.value.lastValue;for(f-=k;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;f=k+f}a.prototype.add.call(this,f,p)};return f}(f.MomentumEstimator);
a.RotationMomentumEstimator=y})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(y,a,v,f,t,q){Object.defineProperty(a,"__esModule",{value:!0});y=function(){function a(a,f,k,e){void 0===a&&(a=2.5);void 0===f&&(f=.01);void 0===k&&(k=.95);void 0===e&&(e=12);this.minimumInitialVelocity=a;this.stopVelocity=f;this.friction=k;this.maxVelocity=e;this.value=new t.FilteredFiniteDifference(.8);
this.time=new t.FilteredFiniteDifference(.3)}a.prototype.add=function(a,f){if(this.time.hasLastValue){if(.01>this.time.computeDelta(f))return;if(this.value.hasFilteredDelta){var k=this.value.computeDelta(a);0>this.value.filteredDelta*k&&this.value.reset()}}this.time.update(f);this.value.update(a)};a.prototype.reset=function(){this.value.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,
a=f.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,f,k){return new q.Momentum(a,f,k)};return a}();a.MomentumEstimator=y})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(y,a,v,f,t){Object.defineProperty(a,"__esModule",{value:!0});var q=function(a){function f(f,
k,e){return a.call(this,f,k,e)||this}v(f,a);f.prototype.value=function(f){f=a.prototype.value.call(this,f);return Math.exp(f)};f.prototype.valueDelta=function(f,k){var e=a.prototype.value.call(this,f);f=a.prototype.value.call(this,f+k);return Math.exp(f-e)};return f}(f.Momentum);a.ZoomMomentum=q;y=function(a){function f(f,k,e,p){void 0===f&&(f=2.5);void 0===k&&(k=.01);void 0===e&&(e=.95);void 0===p&&(p=12);return a.call(this,f,k,e,p)||this}v(f,a);f.prototype.add=function(f,k){a.prototype.add.call(this,
Math.log(f),k)};f.prototype.createMomentum=function(a,f,e){return new q(a,f,e)};return f}(t.MomentumEstimator);a.ZoomMomentumEstimator=y})},"esri/views/2d/navigation/actions/Rotate":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Viewpoint ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../viewpointUtils".split(" "),
function(y,a,v,f,t,q,k,p,m,l,e){var u=l.vec2f64.create(),w=l.vec2f64.create();return function(a){function c(c){c=a.call(this,c)||this;c._previousCenter=l.vec2f64.create();c.viewpoint=new q({targetGeometry:new t.Point,scale:0,rotation:0});return c}v(c,a);c.prototype.begin=function(a,b){this.navigation.begin();m.vec2.set(this._previousCenter,b.center.x,b.center.y)};c.prototype.update=function(a,b){var c=a.state,d=c.size,c=c.padding;m.vec2.set(u,b.center.x,b.center.y);e.getAnchor(w,d,c);a.viewpoint=
e.rotateBy(this.viewpoint,a.content.viewpoint,e.angleBetween(w,this._previousCenter,u));m.vec2.copy(this._previousCenter,u)};c.prototype.end=function(a,b){this.navigation.end()};f([p.property()],c.prototype,"viewpoint",void 0);f([p.property()],c.prototype,"navigation",void 0);return c=f([p.subclass("esri.views.2d.actions.Rotate")],c)}(p.declared(k))})},"esri/views/2d/magnifier/MagnifierView2D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../request ../../../core/promiseUtils ../../webgl ../engine".split(" "),
function(y,a,v,f,t,q,k,p,m){Object.defineProperty(a,"__esModule",{value:!0});var l=m.enums.WGLDrawPhase,e=function(a){function e(){var c=a.call(this)||this;c.visible=!1;c._loadResources(y.toUrl("../../../images/magnifier/mask.png"),y.toUrl("../../../images/magnifier/overlay.png"));return c}v(e,a);e.prototype.destroy=function(){this._readbackTexture&&(this._readbackTexture.dispose(),this._readbackTexture=null,this._maskTexture.dispose(),this._maskTexture=null,this._overlayTexture.dispose(),this._overlayTexture=
null,this._vertexArrayObject.dispose(),this._vertexArrayObject=null,this._program.dispose(),this._program=null)};Object.defineProperty(e.prototype,"magnifier",{get:function(){return this._magnifier},set:function(a){var c=this;this._magnifier=a;this._handle&&this._handle.remove();this._handle=a.watch("version",function(){c.visible=a.visible});this.visible=a.visible},enumerable:!0,configurable:!0});e.prototype.doRender=function(a){var c=this.stage.context;if(a.drawPhase===l.MAP&&this._canRender()){this._updateResources(c);
var e=this._magnifier,b=1/e.factor,f=Math.ceil(b*this.overlay.width),k=Math.ceil(b*this.overlay.height),h=a.state.size,m=a.pixelRatio,b=m*h[0];a=m*h[1];var p=e.position||{x:.5*h[0],y:.5*h[1]},h=m*p.x,m=a-m*p.y,p=.5*f,q=.5*k;p>h?h=p:h>=b-p&&(h=b-p-1);q>m?m=q:m>=a-q&&(m=a-q-1);var p=h-p,q=m-q,t=this._readbackTexture;c.bindTexture(t,0);c.gl.copyTexImage2D(t.descriptor.target,0,t.descriptor.pixelFormat,p,q,f,k,0);f=(f=this.stage.background&&this.stage.background.color)?[f.a*f.r/255,f.a*f.g/255,f.a*f.b/
255,f.a]:[1,1,1,1];k=-1+(h+e.offsetX)/b*2;e=-1+(m-e.offsetY)/a*2;b=this.overlay.width/b*2;a=this.overlay.height/a*2;h=this._program;c.bindVAO(this._vertexArrayObject);c.bindTexture(this._overlayTexture,6);c.bindTexture(this._maskTexture,7);c.bindProgram(h);h.setUniform4fv("u_background",f);h.setUniform1i("u_readbackTexture",0);h.setUniform1i("u_overlyTexture",6);h.setUniform1i("u_maskTexture",7);h.setUniform2f("u_drawPos",k,e);h.setUniform1f("u_width",b);h.setUniform1f("u_height",a);c.drawArrays(5,
0,4);c.bindVAO()}};e.prototype._canRender=function(){return this.mask&&this.overlay&&null!=this._magnifier};e.prototype._loadResources=function(a,d){return f(this,void 0,void 0,function(){var c,b,e;return t(this,function(f){switch(f.label){case 0:return[4,k.all([q(a,{responseType:"image"}),q(d,{responseType:"image"})])];case 1:return c=f.sent(),b=c[0].data,e=c[1].data,this.mask=b,this.overlay=e,this.requestRender(),[2]}})})};e.prototype._updateResources=function(a){if(!this._readbackTexture){var c=
1/this._magnifier.factor,e=Math.ceil(c*this.overlay.width),c=Math.ceil(c*this.overlay.height);this._program=m.createMagnifierProgram(a);var b=new Uint16Array([0,1,0,0,1,1,1,0]);this._vertexArrayObject=new p.VertexArrayObject(a,m.magnifier.attributes,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:p.BufferObject.createVertex(a,35044,b)});this._overlayTexture=new p.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9728,flipped:!0},this.overlay);this._maskTexture=new p.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask);this._readbackTexture=new p.Texture(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:e,height:c})}};return e}(m.DisplayObject);a.default=e})},"*noref":1}});
define("require exports ./LabelManager ./layers/graphics/GraphicsView2D ./navigation/MapViewNavigation ./magnifier/MagnifierView2D".split(" "),function(y,a,v,f,t,q){Object.defineProperty(a,"__esModule",{value:!0});a.LabelManager=v.default;a.GraphicsView2D=f.default;a.MapViewNavigation=t.default;a.MagnifierView2D=q.default});