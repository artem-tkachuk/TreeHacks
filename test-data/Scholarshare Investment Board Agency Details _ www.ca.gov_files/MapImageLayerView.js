// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.12/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils ./RefreshableLayerView @dojo/framework/shim/Set".split(" "),function(u,v,g,d,l,m,q,n,b,r,t){return function(e){function c(c){return e.call(this,c)||this}g(c,e);c.prototype.fetchPopupFeatures=function(c){return m(this,
void 0,void 0,function(){var b,f,h,k,d,e,g=this;return l(this,function(p){switch(p.label){case 0:b=this.layer;if(!c)return[2,n.reject(new q("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:b}))];f=this.get("view.scale");h=[];k=function(a){var c=0===a.minScale||f<=a.minScale,b=0===a.maxScale||f>=a.maxScale;a.visible&&c&&b&&(a.sublayers?a.sublayers.forEach(k):a.popupTemplate&&a.popupEnabled&&h.push(a))};b.sublayers.forEach(k);d=h.map(function(a){return m(g,void 0,void 0,
function(){var b,d,e,g;return l(this,function(f){switch(f.label){case 0:return[4,a.popupTemplate.getRequiredFields()];case 1:return b=f.sent(),d=a.createQuery(),e=r.calculateTolerance(a.renderer),d.geometry=this.createFetchPopupFeaturesQueryGeometry(c,e),d.outFields=b,[4,a.queryFeatures(d)];case 2:return g=f.sent(),[2,g.features]}})})});return[4,n.eachAlways(d)];case 1:return e=p.sent(),[2,e.reduce(function(a,b){return a.concat(b.value)},[]).filter(function(a){return null!=a})]}})})};d([b.property()],
c.prototype,"layer",void 0);return c=d([b.subclass("esri.views.layers.MapImageLayerView")],c)}(b.declared(t))});